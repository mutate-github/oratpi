
Документация: TPI (Total Performance Insight) for Oracle

Краткое описание:

TPI — это мощная консольная система мониторинга и диагностики баз данных Oracle, объединяющая в себе функции Enterprise Manager, AWR/ASH отчетов, 
SQL-тюнинга и повседневного администрирования. Легковесный инструмент, написанный на bash/perl/SQL, не требующий запущенного агента и потребляющий минимум ресурсов.
Универсально работающий под ОС: Linux, IBM AIX, SunOS, Cygwin\OpenSSH - Windows. Начиная с версии oracle 9i и далее. 

Ключевые преимущества:

Все-in-One: Замена десяткам разрозненных скриптов.

Консольный интерфейс: Быстрый запуск и интеграция в автоматизированные pipeline.

Экспертный уровень: Встроенные лучшие практики для глубокой диагностики проблем.

Низкие накладные расходы: Не требует серьезного сетевого канала, HTTP, Java, Docker (но может быть развернут в контейнере) и развертывания сложных систем.

Доступ: В случае удаленного сервера с БД, необходим доступ по ssh (настраивается правило доступа в скрипте rtpi) или tns (настраивается в конфиге .tpi_login, учетка\пароль шифруется)
        Синтаксис для rtpi: rtpi HOST SID [in=INST_ID] [con=CON_ID] [опции] [параметры]

В скрипте rtpi, прописываются простые правила запуска скрипта tpi на удаленной машине, либо подключение через TNS:

пример из rtpi:

  SRV-ORA*:dbpro*)                       cat $wtpi | $SSHCMD mp ". ~/.ora_env; /bin/bash -s $sid '" $login_str "' $args" ;; - тут для хостов SRV-ORA* и БД dbpro* по ssh идем на сервер mp, затем с него подключаемся по TNS $login_str, которая получена из .tpi_login
  aisprod:aisutf)                        $wtpi $sid $login_str $args ;;                                                     - тут для сервера aisprod и БД aisutf просто подключаемся по TNS $login_str, которая получена из .tpi_login
  ais*:*|unit*:*|alpha:*|beta:*|crm:*)   cat $wtpi | $SSHCMD oracle@$P1_ ". ~/.ora_env; /bin/bash -s $sid $args" ;;         - тут для серверов ais* unit* alpha* beta* crm* и любых БД на них просто по ssh запускаем скрипт tpi с параметрами
  *:*)                                   cat $wtpi | $SSHCMD oracle@$P1_ ". ~/.bash_profile ; /bin/bash -s $sid $args" ;;   - тут для всех остальных серверов и любых БД просто по ssh запускаем скрипт tpi с параметрами


Конфиг подключения к БД, если нет доступа по SSH
.tpi_login       - конфиг со строкой подключения к БД через TNS, обычно настраиватся если нет доступа по ssh

пример:
$ cat .tpi_login
#HOST    DB        TNS строка подключения
server2  orcl3    /10/12/26/13/80/15/30/12/12/8/16/13/27@(DESCRIPTION=(ADDRESS=(COMMUNITY=TCP.WORLD)(PROTOCOL=TCP)(HOST=10.0.9.217)(PORT=1521))(CONNECT_DATA=(SERVICE_NAME=orcl3)))

зашифровать логин:
./encryption_goog_xor.sh user/password
XOR-ed Data: /10/12/26/13/80/15/30/12/12/8/16/13/27

расшифровать логин:
./encryption_goog_xor.sh /10/12/26/13/80/15/30/12/12/8/16/13/27
Restored String: user/password


Синтаксис: tpi SID [in=INST_ID] [con=CON_ID] [опции] [параметры]
[опции]      - первое слово или символ, например: redo
[параметры]  - дальнейшие параметры, в [ ] - необязательны параметр, "ВЕРХНИЙ_РЕГИСТР" - имя объекта или текст запроса, { } - команды, | - один перечисленных из параметров,
               например формат интервала: dd/mm/yy-HH:MI-HH:MI(hours) можно записать так: 14/10/25-18:00-20:00, а можно так: 14/10/25-18:00-2 (т.е. понимается, что 2 часа после 14/10/25-18:00 )
               (umc)chart - можно вызывать с параметрами: uchart или cchart или mchart
               с FK (TABLE_NAME [OWNER] | %) - тут скобки () следует понимать как обязательно либо "TABLE_NAME [OWNER]" либо "%"

====================================================================================================================================
Далее будут рассмотрены все опции по порядку:

1. Быстрый старт
Полный Синтаксис:
bash
tpi <SID_БД> [опции] [параметры]                                 - standalone DB
tpi <SID_БД/PDB> [опции] [параметры]                             - standalone PDB - Container Pluggable DB
tpi <SID_БД> [in=INST_ID] [con=CON_ID]  [опции] [параметры]      - in="instance node in RAC" con="CONTAINER_ID"
tpi - без параметров покажет все опции

Примеры для начала работы:

1.1 "Без опций" - Активные сессии в БД в реальном времени (аналог oratop, но без статистики):
tpi PRODDB  

SPID        SID SERIAL# INS CON USERNAME             OSUSER            MACHINE           PROGRAM / MODULE / ACTION                                 PGAU CMD    SQL_ID        EVENT                            SW LOGON          LAST S
-------- ------ ------- --- --- -------------------- ----------------- ----------------- ------------------------------------------------------- ------ ------ ------------- --------------------------- ------- ----------- ------- -
74777       428   50802   1   0 IBS                  DELL              WORKGROUP\DESKTOP plsqldev.exe / PL/SQL Developer / Process_Opers.sql         26                      SQL*Net message from client  103274 13/10 11:08  103274 I
229079       68   44271   1   0 AUDM                 oracle            prod-db.nc152.cmp oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) / AUD_MGR /      3 PL/SQL               PL/SQL lock timer                 3 14/10 10:00   21077 A
74781         9   37593   1   0 IBS                  DELL              WORKGROUP\DESKTOP plsqldev.exe / plsqldev.exe /                                5                      SQL*Net message from client   15927 13/10 11:08   15926 I
232132      370   20875   1   0 IBS                  DELL              WORKGROUP\DESKTOP plsqldev.exe / plsqldev.exe /                                6                      SQL*Net message from client   15742 14/10 10:22   15742 I
264848       17   23845   1   0 IBS                  DELL              WORKGROUP\DESKTOP UAdm.exe / Администратор доступа /                           8                      SQL*Net message from client    1464 14/10 15:17    1464 I
227293      194    2981   1   0 IBS                  DELL              DESKTOP-KV785D7   JDBC Thin Client / CFT Platform IDE /                        5                      SQL*Net message from client      32 14/10 09:42      32 I
3707374     188   41335   1   0 IBS                  mb                WIN-IM1JGQJFHHM   JDBC Thin Client / CFT Platform IDE /                        5                      SQL*Net message from client      26 10/10 08:20      26 I
65161       135   59843   1   0 IBS                  DELL              WORKGROUP\DESKTOP Novo121_97.exe / Автоматизированное рабочее место / 15:     17                      SQL*Net message from client      10 13/10 09:49      10 I
230492      313   15872   1   0 IBS                  DELL              WORKGROUP\DESKTOP OraMon.exe / OraMon.exe /                                    5                      SQL*Net message from client       1 14/10 10:05       0 I
268423      371    9705   1   0 SYS                  oracle            prod-db.nc152.cmp sqlplus@prod-db.nc152.cmp.nkz.icdc.io (TNS V1-V3 / tpi       2 SELECT 20gymysxkb0bv SQL*Net message to client         0 14/10 15:51       0 A

дополнительные опции для отображения только неактивных, только в сосстоянии killed, опции оборажения плана запроса, параметры оптимизатора в данной сессии
a - Allsess | in - INACTIVE | k - KILLED | [access OBJECT] | P.SPID\S.SID\S.PROCESS [bind] [PEEKED_BINDS OUTLINE all ALLSTATS ADVANCED last adaptive PREDICATE partition] | p [param_name] ] 


1.2 "P.SPID | S.SID | S.PROCESS" - Детали сессии 2076 в БД в реальном времени, ключевые данные из v$session, v$process, статистики IO\MEM, ожидания, запрос, план запроса, предыдущий запрос:
tpi PRODDB  2076

===============================================================================
S.sid / S.serial#                      : 2076  43523
P.spid / P.program / Parent SID        : 9896412 / oracle@srvoradb / 65532
P.pid / S.process / S.audsid           : 986 / 19348:42516 / 424958852
S.terminal / P.terminal                : S1562 / UNKNOWN
S.username / S.osuser / S.machine      : GAL_VEK#A.LUNNOVA / a.lunnova / HCASKONA\S1562
S.program / S.module / S.action        : atlexec.exe / atlexec.exe /
Object_name / PLSQL_ENTRY_OBJECT_ID    :
S.status / S.servers / S.type          : ACTIVE / DEDICATED / USER
Tran Active (S.taddr)                  : NONE
S.logon_time                           : Tue 09:15:18
S.last_call_et                         : Tue 13:55:52 -        0.4 min
S.lockwait / P.latchwait / P.latchspin : NONE / NONE / NONE
WAITING: db file sequential read, file#=292, block#=3899072, blocks=1
V$SESS_IO: BLOCK_GETS=1049  CONSISTENT_GETS=45346484  PHYSICAL_READS=833498  BLOCK_CHANGES=799
V$PROCESS_MEMORY: Category(AllocMb/UsedMb/MaxMb): SQL(1/0/2)  PL/SQL(0/0/0)  Other(3//3)  Freeable(0/0/)
Explain plan from dbms_xplan.display_cursor:
SQL_ID  dnp6x9ursjfxp, child number 0
-------------------------------------
SELECT /*+ FIRST_ROWS(25) INDEX_ASC(T0,"KATSOPR31")
PARALLEL_INDEX(T0,"KATSOPR31", 1) LEADING(T0) */ T0.ROWID FROM
GAL_VEK."KATSOPR" T0 WHERE (T0."FVIDSOPR"=:P1) AND
(UPPER(T0."FUSERFIELD")>=UPPER(:P2) AND
UPPER(T0."FUSERFIELD")<UPPER(:P3)) AND T0."FATL_BRANCH"
IN(:P4,:P5,:P6,:P7,:P8,:P9)
Plan hash value: 2755837146
------------------------------------------------------------------------------------------
| Id  | Operation                    | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT             |           |       |       |  5516 (100)|          |
|   1 |  FILTER                      |           |       |       |            |          |
|   2 |   TABLE ACCESS BY INDEX ROWID| KATSOPR   |    26 |   962 |  5516   (1)| 00:00:01 |
|   3 |    INDEX RANGE SCAN          | KATSOPR31 |  5033K|       |   104   (1)| 00:00:01 |
------------------------------------------------------------------------------------------
Previous SQL statement for SQL_ID: 9d1bdmx4bnwa4
SELECT /*+ FIRST_ROWS(25) INDEX_ASC(T0,"OBOROT6") PARALLEL_INDEX
(T0,"OBOROT6", 1) LEADING(T0) */ T0.ROWID FROM GAL_VEK."OBOROT"
T0 WHERE (T0."FTIDK"=:P1 AND T0."FCSOPRDOC"=:P2) AND T0."FATL_BR
ANCH" IN(:P3,:P4,:P5,:P6,:P7,:P8)
===============================================================================
Elapsed: 00:00:04.02

1.3 "P.SPID | S.SID | S.PROCESS" advanced - в случае использования параметров "плана" можно получить детальные данные "Outline Data" "Peeked Binds" "Predicate Information"
tpi PRODDB  2076 advanced
===============================================================================
S.sid / S.serial#                      : 580  40249
P.spid / P.program / Parent SID        : 44434074 / oracle@srvoradb / 65532
P.pid / S.process / S.audsid           : 1447 / 49880:73224 / 424965159
S.terminal / P.terminal                : S15223B9 / UNKNOWN
S.username / S.osuser / S.machine      : GAL_VEK#N.ILLARIONOVA / n.illarionova / HCASKONA\S15223B9
S.program / S.module / S.action        : atlexec.exe / atlexec.exe /
Object_name / PLSQL_ENTRY_OBJECT_ID    :
S.status / S.servers / S.type          : ACTIVE / DEDICATED / USER
Tran Active (S.taddr)                  : NONE
S.logon_time                           : Tue 09:56:34
S.last_call_et                         : Tue 13:34:02 -       26.2 min
S.lockwait / P.latchwait / P.latchspin : NONE / NONE / NONE
WAITING: db file sequential read, file#=685, block#=1414383, blocks=1
V$SESS_IO: BLOCK_GETS=92167  CONSISTENT_GETS=28074586  PHYSICAL_READS=14928826  BLOCK_CHANGES=363615
V$PROCESS_MEMORY: Category(AllocMb/UsedMb/MaxMb): SQL(1025/1024/1026)  PL/SQL(0/0/0)  Other(19//19)  Freeable(59/0/)
Explain plan from dbms_xplan.display_cursor:
SQL_ID  b81y9jj7nasxn, child number 0
-------------------------------------
SELECT /*+ FIRST_ROWS(25) */ T0.ROWID FROM GAL_VEK."SPORDER" T0 WHERE
(T0."FCPARTY"=:P1) AND T0."FATL_BRANCH" IN(:P2,:P3,:P4,:P5,:P6) ORDER
BY T0."FCPARTY", T0.ROWID
Plan hash value: 1877746724
----------------------------------------------------------------------------------------
| Id  | Operation          | Name      | Rows  | Bytes |TempSpc| Cost (%CPU)| Time     |
----------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT   |           |       |       |       |  5090 (100)|          |
|   1 |  SORT ORDER BY     |           |   236K|    10M|    12M|  5090   (1)| 00:00:01 |
|   2 |   INLIST ITERATOR  |           |       |       |       |            |          |
|*  3 |    INDEX RANGE SCAN| SPORDER19 |   236K|    10M|       |  2352   (1)| 00:00:01 |
----------------------------------------------------------------------------------------
Query Block Name / Object Alias (identified by operation id):
-------------------------------------------------------------
1 - SEL$1
3 - SEL$1 / T0@SEL$1
Outline Data
-------------
/*+
BEGIN_OUTLINE_DATA
IGNORE_OPTIM_EMBEDDED_HINTS
OPTIMIZER_FEATURES_ENABLE('11.2.0.3')
DB_VERSION('11.2.0.3')
FIRST_ROWS(25)
OUTLINE_LEAF(@"SEL$1")
INDEX(@"SEL$1" "T0"@"SEL$1" ("SPORDER"."FATL_BRANCH" "SPORDER"."FCPARTY"))
END_OUTLINE_DATA
*/
Peeked Binds (identified by position):
--------------------------------------
1 - :P1 (RAW(30)): 8000000000000000
2 - :P2 (RAW(30)): 8000000000000006
3 - :P3 (RAW(30)): 8000000000000007
4 - :P4 (RAW(30)): 800100000000000b
5 - :P5 (RAW(30)): 8001000000011a02
6 - :P6 (RAW(30)): 800100000001c321
Predicate Information (identified by operation id):
---------------------------------------------------
3 - access((("T0"."FATL_BRANCH"=RAWTOHEX(:P2) OR
"T0"."FATL_BRANCH"=RAWTOHEX(:P3) OR "T0"."FATL_BRANCH"=RAWTOHEX(:P4) OR
"T0"."FATL_BRANCH"=RAWTOHEX(:P5) OR "T0"."FATL_BRANCH"=RAWTOHEX(:P6))) AND
"T0"."FCPARTY"=RAWTOHEX(:P1))
Column Projection Information (identified by operation id):
-----------------------------------------------------------
1 - (#keys=2) "T0"."FCPARTY"[CHARACTER,16], "T0".ROWID[ROWID,10]
2 - "T0".ROWID[ROWID,10], "T0"."FCPARTY"[CHARACTER,16]
3 - "T0".ROWID[ROWID,10], "T0"."FATL_BRANCH"[CHARACTER,16],
"T0"."FCPARTY"[CHARACTER,16]
Previous SQL statement for SQL_ID: 7jg91xkf390nr
SELECT /*+ FIRST_ROWS(25) INDEX_ASC(T0,"KATMOL0") PARALLEL_INDEX
(T0,"KATMOL0", 1) LEADING(T0) */ T0.ROWID FROM GAL_VEK."KATMOL"
T0 WHERE (T0."FNREC"=:P1)
===============================================================================
Elapsed: 00:00:07.85

1.4 "P.SPID | S.SID | S.PROCESS" p имя-параметра - Используя опцию "p опция|%" Можно получить параметры оптимизатора этой сессии:
$ tpi PRODDB 580 p optim

Session parameters  V$SES_OPTIMIZER_ENV :
       SID         ID NAME                                     SQL_FEATURE               ISD VALUE
---------- ---------- ---------------------------------------- ------------------------- --- -------------------------
       580          9 optimizer_features_enable                QKSFM_CBO                 YES 11.2.0.3
       580         38 optimizer_mode                           QKSFM_ALL                 YES all_rows
       580         66 optimizer_index_cost_adj                 QKSFM_CBO                 YES 100
       580         67 optimizer_index_caching                  QKSFM_CBO                 YES 0
       580        105 optimizer_dynamic_sampling               QKSFM_CBO                 YES 2
       580        167 optimizer_secure_view_merging            QKSFM_ALL                 YES true
       580        228 optimizer_use_pending_statistics         QKSFM_CBO                 YES false
       580        238 optimizer_capture_sql_plan_baselines     QKSFM_CBO                 YES false
       580        239 optimizer_use_sql_plan_baselines         QKSFM_CBO                 YES true
       580        258 optimizer_use_invisible_indexes          QKSFM_INDEX               YES false


2.0
Опция "db" - общая информация об контейнерах\инстансе\базы\registry\патчах
$ tpi mprod db

GV$CONTAINERS:
INST_ID CON_ID       DBID NAME                 OPEN_MODE  RESTRICTED OPEN_TIME          TOTAL_SIZE_MB BLOCK_SIZE RECOVERY
------- ------ ---------- -------------------- ---------- ---------- ----------------- -------------- ---------- --------
      1      0 2904955675 MPROD                READ WRITE NO         30/09/25 11:49:53              0          0 ENABLED

GV$INSTANCE:
INST_ID HOST_NAME                      INSTANCE_NAME   VERSION_FULL      STARTUP_TIME      STATUS     ARCHIVER   LOGINS     DATABASE_STATUS INSTANCE_ROLE
------- ------------------------------ --------------- ----------------- ----------------- ---------- ---------- ---------- --------------- --------------------
      1 prod-db.nc152.cmp.nkz.icdc.io  mprod           19.25.0.0.0       30/09/25 11:49:36 OPEN       STARTED    ALLOWED    ACTIVE          PRIMARY_INSTANCE

V$DATABASE:
        DBID NAME     CREATED    LOG_MODE      RESLOGTIME          OPEN_MODE            DB_ROLE                  CURRENT_SCN PROTECTION_LEVEL     SWITCH_STATUS   FORCELOG FLASHB_ON SUPPLLOG PLATFORM_NAME
------------ -------- ---------- ------------- ------------------- -------------------- -------------------- --------------- -------------------- --------------- -------- --------- -------- ----------------------------
  2904955675 MPROD    30/09/2025 ARCHIVELOG    30/09/25 11:40:12   READ WRITE           PRIMARY                     88658610 MAXIMUM PERFORMANCE  TO STANDBY      YES      NO        NO       Linux x86 64-bit

BANNER_FULL
-------------------------------------------------------------------------------------------
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.25.0.0.0


DBA_REGISTRY:
COMP_ID    COMP_NAME                                VERSION_FULL STATUS       MODIFIED             SCHEMA          PROCEDURE
---------- ---------------------------------------- ------------ ------------ -------------------- --------------- ---------------------------------------------
CATALOG    Oracle Database Catalog Views            19.25.0.0.0  VALID        22-DEC-2024 06:49:25 SYS             DBMS_REGISTRY_SYS.VALIDATE_CATALOG
CATPROC    Oracle Database Packages and Types       19.25.0.0.0  VALID        22-DEC-2024 06:49:25 SYS             DBMS_REGISTRY_SYS.VALIDATE_CATPROC
RAC        Oracle Real Application Clusters         19.25.0.0.0  OPTION OFF   22-DEC-2024 06:42:55 SYS             DBMS_CLUSTDB.VALIDATE
JAVAVM     JServer JAVA Virtual Machine             19.25.0.0.0  VALID        22-DEC-2024 06:49:27 SYS             INITJVMAUX.VALIDATE_JAVAVM
XML        Oracle XDK                               19.25.0.0.0  VALID        22-DEC-2024 06:49:27 SYS             XMLVALIDATE
CATJAVA    Oracle Database Java Packages            19.25.0.0.0  VALID        22-DEC-2024 06:49:27 SYS             DBMS_REGISTRY_SYS.VALIDATE_CATJAVA
XDB        Oracle XML Database                      19.25.0.0.0  VALID        22-DEC-2024 06:49:26 XDB             DBMS_REGXDB.VALIDATEXDB
OWM        Oracle Workspace Manager                 19.25.0.0.0  VALID        22-DEC-2024 06:49:27 WMSYS           VALIDATE_OWM
CONTEXT    Oracle Text                              19.25.0.0.0  VALID        22-DEC-2024 06:49:27 CTXSYS          VALIDATE_CONTEXT

REGISTRY$HISTORY:
ACTION_TIME         ACTION          NAMESPACE       VERSION                 ID COMMENTS                                                               BUNDLE_SERIES
------------------- --------------- --------------- --------------- ---------- ---------------------------------------------------------------------- --------------------
                    BOOTSTRAP       DATAPATCH       19                         RDBMS_19.25.0.0.0DBRU_LINUX.X64_241010
22/12/2024 06:49:10 RU_APPLY        SERVER          19.0.0.0.0                 Patch applied on 19.25.0.0.0: Release_Update - 241010184253
DBA_REGISTRY_SQLPATCH:

  PATCH_ID  PATCH_UID PATCH_TYPE ACTION     STATUS    ACTION_TIM DESCRIPTION                  LOGFILE                     RU_LOGFILE                  SOURCE_VERSION  SOURCE_BUILD_DE TARGET_VERSION  TARGET_BUILD_DE TARGET_BUI
---------- ---------- ---------- ---------- --------- ---------- ---------------------------- --------------------------- --------------------------- --------------- --------------- --------------- --------------- ----------
  36912597   25871884 RU         APPLY      SUCCESS   22/12/2024 Database Release Update : 19 /app/oracle/cfgtoollogs/sql /app/oracle/cfgtoollogs/sql 19.1.0.0.0      Feature Release 19.25.0.0.0     Release_Update  10/10/2024
                                                       06:49:09  .25.0.0.241015 (36912597)    patch/36912597/25871884/369 patch/36912597/25871884/369                                                                  18:42:53
                                                                                              12597_apply_MDEV_2024Dec22_ 12597_ru_apply_MDEV_2024Dec
                                                                                              06_46_21.log                22_06_46_20.log

2.1 дополнительные опции:
 db [ nls|option|properties|fusage|acl ] - gv$instance, v$database, dba_registry, dba_registry_sqlpatch, nls_database_paramters, v$option, database_properties information

$ tpi mprod db nls

PARAMETER                      VALUE
------------------------------ ----------------------------------------
NLS_CALENDAR                   GREGORIAN
NLS_CHARACTERSET               CL8MSWIN1251
NLS_COMP                       BINARY
NLS_CURRENCY                   $
NLS_DATE_FORMAT                DD-MON-RR
NLS_DATE_LANGUAGE              AMERICAN
NLS_DUAL_CURRENCY              $
NLS_ISO_CURRENCY               AMERICA
NLS_LANGUAGE                   AMERICAN
NLS_LENGTH_SEMANTICS           BYTE
NLS_NCHAR_CHARACTERSET         AL16UTF16
NLS_NCHAR_CONV_EXCP            FALSE
NLS_NUMERIC_CHARACTERS         .,
NLS_RDBMS_VERSION              19.0.0.0.0
NLS_SORT                       BINARY
NLS_TERRITORY                  AMERICA
NLS_TIMESTAMP_FORMAT           DD-MON-RR HH.MI.SSXFF AM
NLS_TIMESTAMP_TZ_FORMAT        DD-MON-RR HH.MI.SSXFF AM TZR
NLS_TIME_FORMAT                HH.MI.SSXFF AM
NLS_TIME_TZ_FORMAT             HH.MI.SSXFF AM TZR

$ tpi mprod db option

PARAMETER                                          VALUE                    CON_ID
-------------------------------------------------- -------------------- ----------
ASM Proxy Instance                                 FALSE                         0
Active Data Guard                                  TRUE                          0
Adaptive Execution Plans                           TRUE                          0
Advanced Analytics                                 TRUE                          0
Advanced Compression                               TRUE                          0
Advanced Index Compression                         TRUE                          0
Advanced replication                               TRUE                          0
Application Role                                   TRUE                          0
Auto SQL Plan Management                           TRUE                          0
Automatic Data Optimization                        TRUE                          0
Automatic Storage Management                       FALSE                         0
Backup Encryption                                  TRUE                          0
Basic Compression                                  TRUE                          0
Bit-mapped indexes                                 TRUE                          0
Block Change Tracking                              TRUE                          0
Block Media Recovery                               TRUE                          0
Cache Fusion Lock Accelerator                      TRUE                          0
Centrally Managed User                             TRUE                          0
Change Data Capture                                TRUE                          0


$ tpi mprod db properties

database_properties:

PROPERTY_NAME                            PROPERTY_VALUE                           DESCRIPTION
---------------------------------------- ---------------------------------------- -------------------------------------------------------
DBTIMEZONE                               -05:00                                   DB time zone
DEFAULT_EDITION                          ORA$BASE                                 Name of the database default edition
DEFAULT_PERMANENT_TABLESPACE             USERS                                    Name of default permanent tablespace
DEFAULT_TBS_TYPE                         SMALLFILE                                Default tablespace type
DEFAULT_TEMP_TABLESPACE                  TEMP                                     Name of default temporary tablespace
DICT.BASE                                2                                        dictionary base tables version #
DICTIONARY_ENDIAN_TYPE                   LITTLE                                   Endian type of the data dictionary
DST_PRIMARY_TT_VERSION                   43                                       Version of primary timezone data file
DST_SECONDARY_TT_VERSION                 0                                        Version of secondary timezone data file
DST_UPGRADE_STATE                        NONE                                     State of Day Light Saving Time Upgrade
EXPORT_VIEWS_VERSION                     8                                        Export views revision #
Flashback Timestamp TimeZone             GMT                                      Flashback timestamp created in GMT
GLOBAL_DB_NAME                           MPROD                                    Global database name
MAX_PDB_SNAPSHOTS                        8                                        maximum number of snapshots for a given PDB
MAX_STRING_SIZE                          STANDARD                                 MAX_STRING_SIZE parameter used for dictionary metadata
NLS_CALENDAR                             GREGORIAN                                Calendar system
NLS_CHARACTERSET                         CL8MSWIN1251                             Character set
NLS_COMP                                 BINARY                                   NLS comparison
NLS_CURRENCY                             $                                        Local currency
NLS_DATE_FORMAT                          DD-MON-RR                                Date format
NLS_DATE_LANGUAGE                        AMERICAN                                 Date language
NLS_DUAL_CURRENCY                        $                                        Dual currency symbol
NLS_ISO_CURRENCY                         AMERICA                                  ISO currency
NLS_LANGUAGE                             AMERICAN                                 Language
NLS_LENGTH_SEMANTICS                     BYTE                                     NLS length semantics
NLS_NCHAR_CHARACTERSET                   AL16UTF16                                NCHAR Character set
NLS_NCHAR_CONV_EXCP                      FALSE                                    NLS conversion exception
NLS_NUMERIC_CHARACTERS                   .,                                       Numeric characters
NLS_RDBMS_VERSION                        19.0.0.0.0                               RDBMS version for NLS parameters
NLS_SORT                                 BINARY                                   Linguistic definition
NLS_TERRITORY                            AMERICA                                  Territory
NLS_TIMESTAMP_FORMAT                     DD-MON-RR HH.MI.SSXFF AM                 Time stamp format
NLS_TIMESTAMP_TZ_FORMAT                  DD-MON-RR HH.MI.SSXFF AM TZR             Timestamp with timezone format
NLS_TIME_FORMAT                          HH.MI.SSXFF AM                           Time format
NLS_TIME_TZ_FORMAT                       HH.MI.SSXFF AM TZR                       Time with timezone format
NO_USERID_VERIFIER_SALT                  A50B084BB23A8A120C7773A412792E00         Per database random key for computing faux salt
TDE_MASTER_KEY_ID
WORKLOAD_CAPTURE_MODE                                                             CAPTURE implies workload capture is in progress
WORKLOAD_REPLAY_MODE                                                              PREPARE implies external replay clients can connect; RE
                                                                                  PLAY implies workload replay is in progress

$ tpi mprod db fusage

DBA_FEATURE_USAGE_STATISTICS:

NAME                                                                   VERSION           DETECTED_USAGES CURRE FIRST_USAGE_DATE     LAST_USAGE_DATE
---------------------------------------------------------------------- ----------------- --------------- ----- -------------------- --------------------
Automatic Maintenance - Optimizer Statistics Gathering                 19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Automatic Maintenance - SQL Tuning Advisor                             19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Automatic Maintenance - Space Advisor                                  19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Automatic Reoptimization                                               19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Automatic SGA Tuning                                                   19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Automatic SQL Execution Memory                                         19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Automatic SQL Tuning Advisor                                           19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Automatic Segment Space Management (system)                            19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Automatic Segment Space Management (user)                              19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Automatic Undo Management                                              19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Backup MEDIUM Compression                                              19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Character Set                                                          19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Data Guard                                                             19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Deferred Segment Creation                                              19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Extensibility                                                          19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
JSON                                                                   19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Job Scheduler                                                          19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
LOB                                                                    19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Locally Managed Tablespaces (system)                                   19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Locally Managed Tablespaces (user)                                     19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Materialized Views (User)                                              19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Object                                                                 19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Oracle Call Interface (OCI)                                            19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Oracle Java Virtual Machine (system)                                   19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Oracle Java Virtual Machine (user)                                     19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Oracle Utility External Table (ORACLE_LOADER)                          19.0.0.0.0                      1 FALSE 30/09/25 17:49:41    30/09/25 17:49:41
Partitioning (system)                                                  19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Partitioning (user)                                                    19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
RMAN - Disk Backup                                                     19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Real-Time SQL Monitoring                                               19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Recovery Area                                                          19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Recovery Manager (RMAN)                                                19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Result Cache                                                           19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
SQL Plan Directive                                                     19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
SQL Tuning Set (system)                                                19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
SQL*Plus                                                               19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
SecureFiles (system)                                                   19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
SecureFiles (user)                                                     19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Server Parameter File                                                  19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Services                                                               19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Statistics Advisor                                                     19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Traditional Audit                                                      19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08
Unified Audit                                                          19.0.0.0.0                      2 TRUE  30/09/25 17:49:41    07/10/25 23:50:08


$ tpi  mprod db acl
"ACL in database dba_network_acls   dba_network_acl_privileges"

HOST                                     LOWER_PORT UPPER_PORT ACL                                                ACLID            ACL_OWNER
---------------------------------------- ---------- ---------- -------------------------------------------------- ---------------- --------------------
*                                                              NETWORK_ACL_29DB23E88CA39A7DE065F8163E2EBD2C       0000000080002724 SYS

ACL                                                PRINCIPAL            PRIVILEGE  IS_GRAN INVERT  START_DATE           END_DATE
-------------------------------------------------- -------------------- ---------- ------- ------- -------------------- --------------------
NETWORK_ACL_29DB23E88CA39A7DE065F8163E2EBD2C       GSMADMIN_INTERNAL    resolve    true    false



3. Параметры БД:
  p [FALSE] [PAR1 PAR2 ..] | ph [FALSE] [PARAMETER] | services | dir | resource_limit | resumable - instance parameters or hidden parameters, [FALSE] - only changed parameters, v$services, dba_directories , parameters like: p adaptive

$ tpi mprod p adaptive

NAME                                        TYPE        VALUE                                              ISDEFAULT ISMODIFIED DESCRIPTION
------------------------------------------- ----------- -------------------------------------------------- --------- ---------- ----------------------------------------------------------------------
optimizer_adaptive_plans                    Boolean     FALSE                                              FALSE     FALSE      controls all types of adaptive plans
optimizer_adaptive_reporting_only           Boolean     FALSE                                              TRUE      FALSE      use reporting-only mode for adaptive optimizations
optimizer_adaptive_statistics               Boolean     FALSE                                              FALSE     FALSE      controls all types of adaptive statistics
parallel_adaptive_multi_user                Boolean     FALSE                                              TRUE      FALSE      enable adaptive setting of degree for multiple user streams


3.1 измененные параметры БД, ISDEFAULT=FALSE:
$ tpi mprod p FALSE adaptive

NAME                                        TYPE        VALUE                                              ISDEFAULT ISMODIFIED DESCRIPTION
------------------------------------------- ----------- -------------------------------------------------- --------- ---------- ----------------------------------------------------------------------
optimizer_adaptive_plans                    Boolean     FALSE                                              FALSE     FALSE      controls all types of adaptive plans

3.2 скрытые параметры (hidden)

$ tpi mprod ph  adaptive

Parameter                                   Description                                                            Sess Value                               DefSessVal Inst Value                               DefInstVal
------------------------------------------- ---------------------------------------------------------------------- ---------------------------------------- ---------- ---------------------------------------- ----------
_adaptive_direct_read                       Adaptive Direct Read                                                   TRUE                                     TRUE       TRUE                                     TRUE
_adaptive_direct_write                      Adaptive Direct Write                                                  TRUE                                     TRUE       TRUE                                     TRUE
_adaptive_fetch_enabled                     enable/disable adaptive fetch in parallel group by                     TRUE                                     TRUE       TRUE                                     TRUE


3.3 Сервисы БД:
$ tpi mprod services
v$services:

HOST_NAME                                SERVICE_NAME              NETWORK_NAME
---------------------------------------- ------------------------- -------------------------
prod-db.nc152.cmp.nkz.icdc.io            mprodtaf                  mprodtaf
prod-db.nc152.cmp.nkz.icdc.io            MPROD                     MPROD
prod-db.nc152.cmp.nkz.icdc.io            SYS$BACKGROUND
prod-db.nc152.cmp.nkz.icdc.io            SYS$USERS
Elapsed: 00:00:00.01
gv$active_services:

SERVICE_ID NAME                      NETWORK_NAME              CREATION_DATE
---------- ------------------------- ------------------------- -----------------
         1 SYS$BACKGROUND                                      22/12/24 06:25:41
         2 SYS$USERS                                           22/12/24 06:25:41
         4 MPROD                     MPROD                     13/05/25 17:41:55
         5 mprodtaf                  mprodtaf                  13/05/25 17:51:46


3.4 Дирректории БД:
$ tpi mprod dir
dba_directories:

OWNER                DIRECTORY_NAME                 DIRECTORY_PATH                                                                   ORIGIN_CON_ID
-------------------- ------------------------------ -------------------------------------------------------------------------------- -------------
SYS                  DATA_PUMP_DIR                  /app/oracle/admin/mdev/dpdump/                                                               0
SYS                  DBMS_OPTIM_ADMINDIR            /app/oracle/product/19c/rdbms/admin                                                          0
SYS                  DBMS_OPTIM_LOGDIR              /app/oracle/product/19c/cfgtoollogs                                                          0
SYS                  JAVA$JOX$CUJS$DIRECTORY$       /app/oracle/product/19c/javavm/admin/                                                        0

3.5 Ресурсы БД и процент от лимита
$ tpi mprod resource_limit
v$resource_limit:

RESOURCE_NAME                            CURRENT_UTILIZATION LIMIT_VALUE     PERCENT
---------------------------------------- ------------------- --------------- -------
processes                                                 99        300           33
sessions                                                 122        472           25
enqueue_locks                                             42       5860            0
max_rollback_segments                                     11      65535            0
parallel_max_servers                                      16      32767            0

3.6 Количество сессий в состоянии resumable, удобно для мониторинга
$ tpi mprod resumable

RESUMABLE_COUNT
---------------
              0


4. Какие сесии \ транзакции используют в данный момент db-links
 tpi mprod wholink

ORIGIN                                   GTXID                               LSESSION        USERNAME             STATU WAITING                                         SW
---------------------------------------- ----------------------------------- --------------- -------------------- ----- ---------------------------------------- ---------
mrct-prd-app.shoppinglive.loca 1234      MPRD.7b83ecb9.13.1.12379453         29 33360        MUSER                I     SQL*Net message from client                     33
mrct-prd-app.shoppinglive.loca 1234      MPRD.7b83ecb9.18.7.4006092          277 12537       MUSER                I     SQL*Net message from client                     34
mrct-prd-app.shoppinglive.loca 1234      MPRD.7b83ecb9.8.22.17519981         522 64820       MUSER                I     SQL*Net message from client                     33
mrct-prd-app.shoppinglive.loca 1234      MPRD.7b83ecb9.1.22.6891727          540 44153       MUSER                I     SQL*Net message from client                     26
mrct-prd-app.shoppinglive.loca 1234      MPRD.7b83ecb9.25.17.256251          777 53645       MUSER                I     SQL*Net message from client                     33


5. Опции работы со статистикой объектов. {gather|delete|set|lock} Сбор, Удаление, установка, блокировка статистики. Далее ключевое слово: table \ partition \ index \ schema \ database \ system \ dictionary \ fixed . Далее - "имя объекта".
$ tpi mprod analyze
 analyze {gather|delete|set|lock} {table TABLE_NAME OWNER [PERCENT] [NUMROWS NUMLBLKS]} | lock\unlock {partition TABLE_NAME OWNER PART_NAME} | {index INDEX_NAME OWNER [PERCENT] [NUMROWS NUMLBLKS NUMDIST]} | {schema SCHEMA} | database | {system [INTERVAL_MIN|stop|show]} | dictionary | fixed - operations with stats

6. Какой аудит включен в БД:
$ tpi mprod audit

AUDIT STATEMENT
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
AUDIT CREATE SESSION  BY ACCESS ;

Опции работы с аудитом dba_audit_trail:

audit [login | logons [dd/mm/yy-HH:MI-HH:MI(hours)] | maxcon [dd/mm/yy-HH:MI-HH:MI(hours)] [CNT] | 1017 [dd/mm/yy-HH:MI-HH:MI(hours)] [USR] | obj [dd/mm/yy-HH:MI-HH:MI(hours)] [OBJ] ] - DDL users audit, login - check all users for simple password, logons - all logon, maxcon - max of db connections above CNT (def 100) for a period (def 1H), 1017 - failed login, obj - obj audit

6.1 Аудит-проверка пользователей в БД на предмет нахождения пользователей с "простым паролем".
$ tpi mprod audit login

Wait... Check users for account_status='OPEN' and simple password:

AUDM/AUDM - CONNECTED
IBS/IBS - CONNECTED
T_TESTOV/T_TESTOV - CONNECTED


6.2 Данные из аудита, кто подключался к БД начиная с этого времени
$ tpi mprod audit logons 14/10/25-09:00-15:00

USERNAME             OS_USERNAME                    USERHOST                                 TERMINAL             HH24                RETURNCODE
-------------------- ------------------------------ ---------------------------------------- -------------------- ------------------- ----------
IBS                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 09:12:09          0
IBS                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 09:12:10          0
IBS                  DELL                           DESKTOP-KV785D7                          unknown              14/10/2025 09:42:41          0
IBS                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 09:51:01          0
AUD                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 09:54:37          0
IBS                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 09:55:33          0
IBS                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 09:59:09          0
IBS                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 10:04:59          0
IBS                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 10:05:52          0
IBS                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 10:22:03          0
A_ARYP               assem                          WORKGROUP\VERA_S                         VERA_S               14/10/2025 14:38:22          0

6.3 Количество подключений к БД за этот период больше 2, удобно для поиска пользователей, кто чрезмерно часто подключается к БД.
$ tpi mprod audit maxcon 14/10/25-09:00-15:00 2

USERNAME             OS_USERNAME                    USERHOST                                 TERMINAL             HH24            RETURNCODE  COUNT
-------------------- ------------------------------ ---------------------------------------- -------------------- --------------- ---------- ------
IBS                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 09            0      5
IBS                  DELL                           WORKGROUP\DESKTOP-KV785D7                DESKTOP-KV785D7      14/10/2025 10            0      3


6.4 Пользователи кто неверно вводил пароль "1017" за этот промежуток времени, (240 - в часах), "28000" - account is lock или был залокирован
$ tpi mprod audit 1017 10/10/25-09:00-240

USERNAME                       OS_USERNAME          USERHOST                       TERMINAL                       DATE_TIME         ACTION_NAME                  RETURNCODE
------------------------------ -------------------- ------------------------------ ------------------------------ ----------------- ---------------------------- ----------
A_ARYP                         assem                WORKGROUP\VERA_S               VERA_S                         10/10/25 16:09:49 LOGON                              1017
APP_ADM                        oracle               prod-db.nc152.cmp.nkz.icdc.io                                 14/10/25 16:40:53 LOGON                              1017
APP_SRV                        oracle               prod-db.nc152.cmp.nkz.icdc.io                                 14/10/25 16:40:54 LOGON                              1017
ALHRO                          oracle               prod-db.nc152.cmp.nkz.icdc.io                                 14/10/25 16:41:25 LOGON                              1017
ALHRW                          oracle               prod-db.nc152.cmp.nkz.icdc.io                                 14/10/25 16:41:26 LOGON                              1017
ANDY                           oracle               prod-db.nc152.cmp.nkz.icdc.io                                 14/10/25 16:41:27 LOGON                              1017
ANONYMOUS                      oracle               prod-db.nc152.cmp.nkz.icdc.io                                 14/10/25 16:41:27 LOGON                             28000
APPLSYS                        oracle               prod-db.nc152.cmp.nkz.icdc.io                                 14/10/25 16:41:28 LOGON                              1017
APPLSYS                        oracle               prod-db.nc152.cmp.nkz.icdc.io                                 14/10/25 16:41:29 LOGON                              1017



6.5 Аудит объекта, в данном случае - любого - "%" за интервал времени.
$ tpi mprod audit obj 10/10/25-09:00-240 %

DATE_TIME            OBJ_NAME                            ACTION_NAME       USERNAME                       OS_USERNAME          USERHOST                       TERMINAL
-------------------- ----------------------------------- ----------------- ------------------------------ -------------------- ------------------------------ ------------------------------
13/10/25 12:36:35    SYS.HIST_HEAD$                      SELECT            IBS                            DELL                 WORKGROUP\DESKTOP-KV785D7      DESKTOP-KV785D7
13/10/25 17:13:04    SYS.HIST_HEAD$                      SELECT            IBS                            DELL                 WORKGROUP\DESKTOP-KV785D7      DESKTOP-KV785D7


7. Различные и Общие показатели "здоровья" БД:

$ tpi mprod health

"dba_segments: NON-SYSTEM objects detected in SYSTEM tablespace"

OWNER                            COUNT(*) TABLESPACE_NAME
------------------------------ ---------- ------------------------------
OJVMSYS                                 6 SYSTEM
GSMADMIN_INTERNAL                       2 SYSTEM

"v$license information about session HWM:"

SESSIONS_CURRENT SESSIONS_HIGHWATER CPU_COUNT_CURRENT
---------------- ------------------ -----------------
              13                 27                 8

"V$SYSSTAT V$ROWCACHE V$BUFFER_POOL_STATISTICS V$SGASTAT V$WAITSTAT Cache usage:"

NAME                                                                        RATIO REMARKS
---------------------------------------------------------------------- ---------- --------------------------------------------------------------------------------
Data Dictionary cache                                                     98.8004 Target ~ 99%
Library cache                                                              99.957 Target ~ 99%
Index usage ratio                                                         99.3708 Target ~ 99%
Memory usage in Sorts ratio                                                   100 Ratio sorts in memory to total sorts
Buffer cache hit ratio                                                    99.9425 Target ~ 99%
Buffer pool: DEFAULT block_size: 8192 hit ratio                           99.9573 Target ~ 99%
Average buffers scanned                                                         1 Target ~ 1..2, if above -- too low buffers
Average dirty buffers                                                           0 Target ~ ??, if too much durty -- too low buffers
consistent reads - undo records applied / consistent read rollbacks             0 Less is better
Undo header contention                                                 .000001069 Target < 1%
Undo block contention                                                   .00000016 Target < 1%
Rollstat ratio sum(waits)*100/sum(gets)                                .029510428 Target < 5%, see also: "select * from v$waitstat where class='undo header'"
Redolog space ratio                                                     1479997.3 Target > 5000. Increase the size of redolog buffer and logfile to faster disk
Shared pool free memory (MB)                                             422.3403 If much free mem -- maybe its redundant??

"v$latch: all ratios should be <= 1% if not then decrease the value of log_small_entry_max_size in init.ora"

LATCH_NAME                 GETS     MISSES Immed Gets Immed Misses     RATIO1     RATIO2
-------------------- ---------- ---------- ---------- ------------ ---------- ----------
redo log management           0          0          0            0          0          0
redo transport task       90802          1          0            0          0          0
redo writing           11641065       3772          0            0        .03          0
redo copy                   356          0   39960100         9923          0        .02
redo allocation        23778448      29438   39955098        19871        .12        .04
redo gen encryption         363          0          0            0          0          0
key structure


"v$system_event: If Avg_wait_time is minor ignore it otherwise check the log buffer size w.r.t transaction rate and memory size"

EVENT                                              TOTAL_WAITS TOTAL_TIMEOUTS TIME_WAITED AVERAGE_WAIT TIME_WAITED_MICRO TOTAL_WAITS_FG TOTAL_TIMEOUTS_FG TIME_WAITED_FG AVERAGE_WAIT_FG TIME_WAITED_MICRO_FG WAIT_CLASS
-------------------------------------------------- ----------- -------------- ----------- ------------ ----------------- -------------- ----------------- -------------- --------------- -------------------- ---------------
log file sequential read                                 28935              0        1276          .04          12758379          12532                 0           1054             .08             10540445 System I/O
log file single write                                      734              0          35          .05            353290              2                 0              0               0                   17 System I/O
log file parallel write                                2389486              0      183832          .08        1838316869              0                 0              0               0                    0 System I/O
log buffer space                                             1              0           3         3.27             32654              0                 0              0               0                    0 Configuration
log file switch (private strand flush incomplete)           10              0          10         1.04            103817              9                 0              9             .97                87395 Configuration
log file switch completion                                   7              0           7         1.05             73701              3                 0              3              .9                27107 Configuration
log file sync                                           110620              0        7711          .07          77110114         109173                 0           7617             .07             76170932 Commit

"v$waitstat: order by time desc (in centiseconds)"

CLASS                   COUNT       TIME
------------------ ---------- ----------
data block               2008        146
undo header              1542         64
segment header             13          1
undo block                231          1
1st level bmb              33          0
2nd level bmb               9          0
3rd level bmb              16          0
bitmap block                0          0
bitmap index block          0          0
file header block           1          0
unused                      0          0
system undo header          0          0
system undo block           0          0
extent map                  0          0
free list                   0          0
save undo header            0          0
save undo block             0          0
sort block                  0          0

"dba_tables all_tab_modifications: Table Change > 100% (first 30)"

OWNER                          TABLE_NAME                     PERCENTAGE
------------------------------ ------------------------------ ----------
IBS                            RTL_USERS                          124975
AUDM                           SETTINGS                            98810
SYS                            SCHEDULER$_JOB                      17077
SYS                            WRM$_WR_CONTROL                      5950
SYS                            WRM$_DATABASE_INSTANCE               2975
SYS                            EXP_OBJ$                             2425
IBS                            Z#SYSTEM_JOBS                         899
SYS                            OPTSTAT_HIST_CONTROL$                 818
IBS                            SYSTEM_OPTIONS                        704
SYS                            MON_MODS_ALL$                         537
AUD                            LICENSE_SETTINGS                      316
SYS                            KET$_AUTOTASK_STATUS                  300
SYS                            WRI$_SQLMON_USAGE                     300
SYS                            EXP_STAT$                             239
SYS                            WRI$_HEATMAP_TOP_TABLESPACES          200
IBS                            LICENSE_DATA                          150
SYS                            KET$_CLIENT_TASKS                     100


7.1  Consistent Read buffers in SGA

$ tpi mprod health cr

Consistent read buffers (>100) v$bh in SGA group by owner,object_name,object_type
OWNER                          OBJECT_NAME                    OBJECT_TYPE          DIRTY        CNT
------------------------------ ------------------------------ -------------------- ----- ----------
IBS                            Z#MST_IMPORT_STR               TABLE                N           3152
IBS                            Z#PR_CALC                      TABLE                N           2463
IBS                            IDX_Z#MST_IMPORT_STR_20        INDEX                N           1877
IBS                            SOURCES                        TABLE                N           1216
IBS                            Z#PLAN_OPER                    TABLE                N           1152
IBS                            Z#RECORDS                      TABLE                N            872
IBS                            IDX_Z#MST_IMPORT_VALS          INDEX                N            851
IBS                            DEPENDENCIES                   TABLE                N            710
IBS                            ERRORS                         TABLE                N            624
IBS                            IDX_Z#PLAN_OPER_COLL_ID        INDEX                N            468
IBS                            IDX_HOST2PLP_METHOD_ID         INDEX                N            337
IBS                            Z#DOCUMENT                     TABLE                N            334
IBS                            CLASS_TAB_COLUMNS              TABLE                N            332
IBS                            Z#FACT_PLAN_OPER               TABLE                N            318
IBS                            IDX_DEPENDENCIES_REFCING       INDEX                N            275
IBS                            IDX_Z#MST_IMPORT_IVT           INDEX                N            261
IBS                            RTL_PARAMETERS                 TABLE                N            255
IBS                            RTL_ENTRIES                    TABLE                N            243
IBS                            Z#STRING_CALC_PRC              TABLE                N            233
IBS                            IDX_SOURCES_NAME               INDEX                N            231
IBS                            IDE_RESOURCE_HASH              TABLE                N            222
IBS                            Z#CLIENT                       TABLE                N            218
IBS                            IDX_Z#RECORDS_COL_DATE_IDN     INDEX                N            200
IBS                            Z#PL_ARC_USV                   TABLE                N            161
IBS                            IDX_ERRORS_METHOD_ID           INDEX                N            142
IBS                            METHODS                        TABLE                N            139
IBS                            Z#PL_ARC_US                    TABLE                N            131
IBS                            Z#MAIN_DOCUM                   TABLE                N            128
IBS                            Z#MAIN_DOCUM_REF               TABLE                N            127
IBS                            IDX_RTL_ENTRIES_METHOD_ID_NAME INDEX                N            126
IBS                            PK_RTL_PARAMS_RTL_ID_POS       INDEX                N            120
IBS                            CONTROLS                       TABLE                N            111
Elapsed: 00:00:00.79

7.2  Hot buffers in SGA, touch counts

$ tpi mprod health hot

Hot buffers in buffer cache  avg(tch)>100 and count(buffers)>20, 'cache buffers chains' latch contention:
OWNER                OBJECT_TYPE                    OBJECT_NAME                        BLOCKS  BUFFERS AVG_TOUCHES
-------------------- ------------------------------ ------------------------------ ---------- -------- -----------
IBS                  INDEX                          PK_CLASS_ATTRIBUTE_CLASS_ID           112      105         152
IBS                  TABLE                          METHODS                              1408    1,505         151
IBS                  TABLE                          Z#DOCUMENT                           1408    1,727         151
IBS                  INDEX                          UNQ_CLS_REL_CHLD_DIST                  48       40         149
IBS                  TABLE                          CLASSES                               256      179         142
IBS                  INDEX                          IDX_CRITERIA_CLASS_ID_FLAGS            32       23         141
IBS                  TABLE                          Z#ACCOUNT                              96       93         138
IBS                  TABLE                          Z#MAIN_DOCUM                         2944    3,014         136
IBS                  TABLE                          Z#LEDGER_DOC                          120      115         132
IBS                  INDEX                          UNQ_METHODS_CLASS_SHORT_NAME          120      112         120
IBS                  INDEX                          PK_METHODS_ID                          72       67         119
IBS                  INDEX                          IDX_Z#PRODUCT_GROUP_OPERS              56       55         116
IBS                  TABLE                          DICT_CHANGES                         1408    1,383         115
IBS                  TABLE                          CLASS_ATTRIBUTES                      256      232         111
IBS                  INDEX                          PK_CLS_TAB_COLS_CLS_ID_QUAL           256      157         106
IBS                  TABLE                          Z#AC_FIN                              256      253         104
IBS                  INDEX                          IDX_Z#MST_IMPORT_IVT                 3200    3,370         104


8. oratop - множество показателей БД в реальном времени, а также список активных сессий, удобно выводить на терминал для real-time monitoring DB

$ tpi  mprod oratop
NCPU   - Number of CPU                                   AAS    - Average Active Sessions. (! if>#cpu)           IOMBPS - I/O megabytes per second (throughput)
HCPUB  - Host cpu busy %(busy/busy+idle). (! if>90%)     AST    - Active user Sessions Total (ASCPU+ASIO+ASWA)   IOPS   - I/O requests per second
CPUUPS - CPU Usage Per Sec                               ASCPU  - Active Sessions on CPU                         IORL   - I/O avg synch s/b/read latency in msec (! if>10ms)
LOAD   - Current os load. (! if>2*#CPU and high cpu)     ASIO   - Active Sessions waiting on user I/O            LOGR   - Logical reads per sec
DCTR   - DB CPU time ratio  % Cpu/DB_Time                ASWA   - Active Sessions Waiting, (! if>ASCPU+ASIO)     PHYR   - Physical reads per sec
DWTR   - DB WAIT time ratio (! if>50 and high ASWA)      ASPQ   - Active Parallel Sessions                       PHYW   - Physical writes per sec
SPFR   - Shared pool free %                              UTPS   - User transactions per sec                      TEMP   - Temp space used (Mb)
TPGA   - Total pga allocated                             UCPS   - User calls per sec                             DBTM   - Database Time Per Sec
SCT    - Session Count Total                             SSRT   - Sql service response time (T/call)

1                     2      3    4    5    6      7      8     9    10    11    12    13    14    15     16       17       18     19      20     21         22      23      24     25     26   27   29
BEGIN_TIME        HCPUB CPUUPS LOAD DCTR DWTR   SPFR   TPGA   SCT   AAS   AST ASCPU  ASIO  ASWA  ASPQ   UTPS     UCPS     SSRT IOMBPS    IOPS   IORL       LOGR    PHYR    PHYW   TEMP   DBTM   IN NCPU
----------------- ----- ------ ---- ---- ---- ------ ------ ----- ----- ----- ----- ----- ----- ----- ------ -------- -------- ------ ------- ------ ---------- ------- ------- ------ ------ ---- ----
14/10/25-16:55:21     0      3    0   98    1     19    692    10     0     1     0     0     1     0      0        2       91      0       5      0        592       0       0      1      0    1    8

 INS EVENT   (Cumulative Top 5 Timed Events)                                      TOTWA            TWSEC           AVGMS           PCTWA WCLAS
---- ----------------------------------------------------------------- ---------------- ---------------- --------------- --------------- ---------------
   1 DB CPU                                                                           0           25,992             .00              85
   1 log file parallel write                                                  2,389,809            1,839             .80               6 System I/O
   1 External Procedure initial connection                                       84,906            1,077           12.70               4 Application
   1 library cache lock                                                             945              952        1,006.90               3 Concurrency
   1 LGWR all worker groups                                                     939,869              846             .90               3 Other

Database active sessions:
INS PPID        SID SERIAL USERNAME         PROGRAM / MODULE / ACTION                                      PGA CMD    SQLID         PLSQL_ENTRY                      S STE EVENT/*LATCH                 W/T s    LCET m
--- -------- ------ ------ ---------------- ------------------------------------------------------------ ----- ------ ------------- -------------------------------- - --- ------------------------ --------- ---------
  1 229079       68  44271 AUDM             J001 / AUD_MGR / Auditing sessions                               3 PL/SQL               AUDM.AUD_MGR                     A WAI PL/SQL lock timer                6       415
  1 279044       67  17317 SYS              sqlplus@prod-db.nc152.cmp.nkz.icdc.io (TNS V1-V3 /  / oracle     8 SELECT g18ynnyfa9n8t                                  A CPU cpu runqueue                     0         0



8.1 множество sysmetric_history показателей БД:
$ tpi mprod oratop h
DB=mprod 14/10/25-16:57:25 ver=13.10.25  oratop [ h [in=INST_ID] [con=[CON_ID]] | dhsh [in=INST_ID] [con=[CON_ID]] [dd/mm/yy-HH:MI-HH:MI(hours) - def3d] ] - Database and Instance parameters, h - history V$SYSMETRIC_HISTORY V$ACTIVE_SESSION_HISTORY, dhsh - dba_hist_sysmetric_history dba_hist_snapshot
Legend:
NCPU   - Number of CPU                                   AAS    - Average Active Sessions. (! if>#cpu)           IOMBPS - I/O megabytes per second (throughput)
HCPUB  - Host cpu busy %(busy/busy+idle). (! if>90%)     AST    - Active user Sessions Total (ASCPU+ASIO+ASWA)   IOPS   - I/O requests per second
CPUUPS - CPU Usage Per Sec                               ASCPU  - Active Sessions on CPU                         IORL   - I/O avg synch s/b/read latency in msec (! if>10ms)
LOAD   - Current os load. (! if>2*#CPU and high cpu)     ASIO   - Active Sessions waiting on user I/O            LOGR   - Logical reads per sec
DCTR   - DB CPU time ratio  % Cpu/DB_Time                ASWA   - Active Sessions Waiting, (! if>ASCPU+ASIO)     PHYR   - Physical reads per sec
DWTR   - DB WAIT time ratio (! if>50 and high ASWA)      ASPQ   - Active Parallel Sessions                       PHYW   - Physical writes per sec
SPFR   - Shared pool free %                              UTPS   - User transactions per sec                      TEMP   - Temp space used (Mb)
TPGA   - Total pga allocated                             UCPS   - User calls per sec                             DBTM   - Database Time Per Sec
SCT    - Session Count Total                             SSRT   - Sql service response time (T/call)

1                     2      3    4    5    6      7      8     9    10    11    12    13    14    15     16       17       18     19      20     21         22      23      24     25     26   27   28   29
BEGIN_TIME        HCPUB CPUUPS LOAD DCTR DWTR   SPFR   TPGA   SCT   AAS   AST ASCPU  ASIO  ASWA  ASPQ   UTPS     UCPS     SSRT IOMBPS    IOPS   IORL       LOGR    PHYR    PHYW   TEMP   DBTM   IN  CON NCPU
----------------- ----- ------ ---- ---- ---- ------ ------ ----- ----- ----- ----- ----- ----- ----- ------ -------- -------- ------ ------- ------ ---------- ------- ------- ------ ------ ---- ---- ----
14/10/25-15:59:54     2      3    0   98    1     19    738   123     0     1     1     0     0     0      0       55       56      4     124      0       1216       0       0      1      3    1    0    8
14/10/25-16:14:54     1      1    0  109    0     19    679   121     0     1     1     0     0     0      0        5       27      0      13      0        765       0       0      1      1    1    0    8
14/10/25-16:15:54     1      1    0  112    0     19    679   121     0     1     1     0     0     0      0        5       36      0      13      0        592       0       7      1      1    1    0    8
14/10/25-16:16:54     0      0    0   86   13     19    679   121     0     1     1     0     1     0      0        1       15      0       5      0        586       0       0      1      0    1    0    8
14/10/25-16:38:53     0      1    0   93    6     19    692   122     0     1     1     0     0     0      0        4       22      0       6      0       3003       0       0      1      1    1    0    8
14/10/25-16:39:53     0      0    0   36   63     19    692   124     0     1     0     0     1     0      0        3       60      0       6      0        800       0       0      1      2    1    0    8
14/10/25-16:40:53     0      2    0    2   97     19    693   122     0     1     0     0     1     0      1        6     1708      0      13      0       1058       0       0      1     97    1    0    8
14/10/25-16:41:53     1      2    0    2   97     19    693   122     0     1     0     0     1     0      0        7     2384      0       8      0        606       0       0      1     96    1    0    8
14/10/25-16:42:53     1      2    0    2   97     19    693   123     0     1     0     0     1     0      0        6     2150      0       8      0        678       0       0      1     95    1    0    8
14/10/25-16:43:53     0      1    0    6   93     19    692   122     0     1     0     0     1     0      0        2      483      0       6      0        599       0       0      1     17    1    0    8
14/10/25-16:51:54     0      1    0   98    1     19    692   122     0     1     1     0     0     0      0        3       52      0       5      0       1507       0       0      1      1    1    0    8
14/10/25-16:52:54     0      2    0  100    0     19    716   123     0     1     1     0     0     0      0        3       53      0       5      0       7980       0       0      1      2    1    0    8
14/10/25-16:53:54     0      3    0   98    1     19    692   122     0     1     1     0     0     0      0        1       91      0       5      0       1782       0       0      1      3    1    0    8
14/10/25-16:54:54     0      2    0   91    8     18    691   122     0     1     1     0     0     0      0        6       41      0       9      0       6004       3       0      3      2    1    0    8
14/10/25-16:54:54     0      0    0   86    0     19    692     0     0     1     1     0     0     0      0        2        0      0       0      0        592       0       0      1      0    1    0    8

по любой табличной форме можно выводить графики в терминале, указывая через пробел номера колонок, пример:
$ tpi mprod oratop h | diagram.sh  3 11 15 17 19 20 22 23 24
BEGIN_TIME         CPUUPS  LEVELS           AST  LEVELS           ASPQ  LEVELS  UCPS  LEVELS          IOMBPS  LEVELS           IOPS  LEVELS           LOGR  LEVELS           PHYR  LEVELS           PHYW  LEVELS
14/10/25-15:59:54  3       |========        1    |==============  0     |       55    |=============  4       |==============  124   |=============   1216  |=               0     |                0     |
14/10/25-16:14:54  1       |==              1    |==============  0     |       5     |               0       |                13    |                765   |                0     |                0     |
14/10/25-16:15:54  1       |==              1    |==============  0     |       5     |               0       |                13    |                592   |                0     |                7     |=============
14/10/25-16:16:54  0       |                1    |==============  0     |       1     |               0       |                5     |                586   |                0     |                0     |
14/10/25-16:38:53  1       |==              1    |==============  0     |       4     |               0       |                6     |                3003  |====            0     |                0     |
14/10/25-16:39:53  0       |                1    |==============  0     |       3     |               0       |                6     |                800   |                0     |                0     |
14/10/25-16:40:53  2       |=====           1    |==============  0     |       6     |               0       |                13    |                1058  |                0     |                0     |
14/10/25-16:41:53  2       |=====           1    |==============  0     |       7     |               0       |                8     |                606   |                0     |                0     |
14/10/25-16:42:53  2       |=====           1    |==============  0     |       6     |               0       |                8     |                678   |                0     |                0     |
14/10/25-16:43:53  1       |==              1    |==============  0     |       2     |               0       |                6     |                599   |                0     |                0     |
14/10/25-16:51:54  1       |==              1    |==============  0     |       3     |               0       |                5     |                1507  |=               0     |                0     |
14/10/25-16:52:54  2       |=====           1    |==============  0     |       3     |               0       |                5     |                7980  |==============  0     |                0     |
14/10/25-16:53:54  3       |========        1    |==============  0     |       1     |               0       |                5     |                1782  |==              0     |                0     |
14/10/25-16:54:54  2       |=====           1    |==============  0     |       6     |               0       |                9     |                6004  |==========      3     |==============  0     |
14/10/25-16:56:54  2       |=====           1    |==============  0     |       4     |               0       |                7     |                1093  |=               0     |                0     |
14/10/25-16:58:54  0       |                1    |==============  0     |       5     |               0       |                0     |                830   |                0     |                0     |
14/10/25-16:58:54  1       |==              1    |==============  0     |       5     |               0       |                5     |                2696  |====            0     |                0     |
14/10/25-16:59:54  5       |==============  1    |==============  0     |       55    |=============  4       |==============  125   |==============  2380  |===             0     |                1     |=
14/10/25-16:59:54  0       |                1    |==============  0     |       3     |               0       |                0     |                6798  |===========     0     |                0     |


$ tpi mprod oratop dhsh 14/10/25-09:00-24
DB=mprod 14/10/25-16:59:26 ver=13.10.25  oratop [ h [in=INST_ID] [con=[CON_ID]] | dhsh [in=INST_ID] [con=[CON_ID]] [dd/mm/yy-HH:MI-HH:MI(hours) - def3d] ] - Database and Instance parameters, h - history V$SYSMETRIC_HISTORY V$ACTIVE_SESSION_HISTORY, dhsh - dba_hist_sysmetric_history dba_hist_snapshot
Legend:
AAS      - 'Average Active Sessions'         IOPS    - 'I/O Requests per Second'                          REDOKBPS - 'Redo Generated Per Sec'
BCPUUPS  - 'Background CPU Usage Per Sec'    IORL    - 'Average Synchronous Single-Block Read Latency'    REDOKBPT - 'Redo Generated Per Txn'
CPUUPS   - 'CPU Usage Per Sec'               LOGRPT  - 'Logical Reads Per Txn'                            RSPTIMPT - 'Response Time Per Txn'
BLCHPT   - 'DB Block Changes Per Txn'        LNGPS   - 'Logons Per Sec'                                   SSRT     - 'SQL Service Response Time'
ENQREQPT - 'Enqueue Requests Per Txn'        NETMBPS - 'Network Traffic Volume Per Sec'                   TPARSPT  - 'Total Parse Count Per Txn'
EXECPS   - 'Executions Per Sec'              PHYR    - 'Physical Reads Per Sec'                           UCPS     - 'User Calls Per Sec'
HCPUUPS  - 'Host CPU Usage Per Sec'          PHYRPT  - 'Physical Reads Per Txn'                           UTPS     - 'User Transaction Per Sec'
IOMBPS   - 'I/O Megabytes per Second'        PHYW    - 'Physical Writes Per Sec'                          NCPU     - 'Number of CPU'
"Stat from dba_hist_sysmetric_history dba_hist_snapshot in begin_interval_time between to_date('14/10/25 09:00','dd/mm/yy hh24:mi') and to_date('14/10/25 09:00','dd/mm/yy hh24:mi') + interval '24' hour + interval '2' minute"

1                     2       3      4        5        6       7       8      9      10     11        12     13      14      15      16      17       18       19         20       21      22       23     24  25  26   27
BEGIN_TIME          AAS BCPUUPS CPUUPS   BLCHPT ENQREQPT  EXECPS HCPUUPS IOMBPS    IOPS   IORL    LOGRPT  LGNPS NETMBPS    PHYR  PHYRPT    PHYW REDOKBPS REDOKBPT   RSPTIMPT     SSRT TPARSPT     UCPS   UTPS  IN CON NCPU
----------------- ----- ------- ------ -------- -------- ------- ------- ------ ------- ------ --------- ------ ------- ------- ------- ------- -------- -------- ---------- -------- ------- -------- ------ --- --- ----
14/10/25-09:00:56     0       1      1       35      545     260       4      0       9      0      1708      0       0       0       0       1        5        9      17409       19      38        4      0   1   0    8
14/10/25-10:00:57     0       1      1       28      516     265       4      0      10      0      1563      0       0       1       0       1        4        7      16024       20      36        4      1   1   0    8
14/10/25-11:00:59     0       1      2       24      367     263       5      0       9      0      1728      0       0       0       0       1        4        5      24725       40      26        3      1   1   0    8
14/10/25-12:00:00     0       1      1      188      352     354       4      0       8      0      1686      0       0       0       0       3       34       27      14314       22      24        2      1   1   0    8
14/10/25-13:00:02     0       1      1       38      366     261       3      0      10      0      1201      0       0       0       0       1        6        7      11853       19      26        3      1   1   0    8
14/10/25-14:00:03     0       1      1       22      369     260       3      0       9      0      1174      0       0       0       0       1        4        5      11305       18      26        3      1   1   0    8
14/10/25-15:00:04     0       1      1       22      369     272       4      0       9      0      1660      0       0       0       0       1        4        5      14864       20      27        3      1   1   0    8

аналогично, нашлядный график по показателей:
$ tpi mprod oratop dhsh 14/10/25-09:00-15:00 | diagram.sh 2 5 6 9 10 11 13 14 15 17 18 21 23 24

BEGIN_TIME         AAS  LEVELS  BLCHPT  LEVELS           ENQREQPT  LEVELS           IOMBPS  LEVELS  IOPS  LEVELS           IORL  LEVELS  LGNPS  LEVELS  NETMBPS  LEVELS  PHYR  LEVELS           PHYW  LEVELS           REDOKBPS  LEVELS          SSRT  LEVELS           UCPS  LEVELS           UTPS  LEVELS
14/10/25-09:00:56  0    |       35      |=               545       |==============  0       |       9     |============    0     |       0      |       0        |       0     |                1     |====            5         |=              19    |======          4     |==============  0     |
14/10/25-10:00:57  0    |       28      |=               516       |=============   0       |       10    |==============  0     |       0      |       0        |       1     |==============  1     |====            4         |               20    |======          4     |==============  1     |==============
14/10/25-11:00:59  0    |       24      |                367       |=========       0       |       9     |============    0     |       0      |       0        |       0     |                1     |====            4         |               40    |==============  3     |==========      1     |==============
14/10/25-12:00:00  0    |       188     |==============  352       |========        0       |       8     |===========     0     |       0      |       0        |       0     |                3     |==============  34        |=============  22    |=======         2     |======          1     |==============
14/10/25-13:00:02  0    |       38      |==              366       |=========       0       |       10    |==============  0     |       0      |       0        |       0     |                1     |====            6         |=              19    |======          3     |==========      1     |==============
14/10/25-14:00:03  0    |       22      |                369       |=========       0       |       9     |============    0     |       0      |       0        |       0     |                1     |====            4         |               18    |=====           3     |==========      1     |==============
14/10/25-15:00:04  0    |       22      |                369       |=========       0       |       9     |============    0     |       0      |       0        |       0     |                1     |====            4         |               20    |======          3     |==========      1     |==============


9. Параметры и статистика по SGA, пулам и т.п.

$ tpi mprod sga

Size of total v$sga:

   TOTAL_SGA_MB
---------------
          16384
Size of v$sga_dynamic_components :

COMPONENT                                CURRENT_SIZE_MB     MIN_SIZE_MB     MAX_SIZE_MB
---------------------------------------- --------------- --------------- ---------------
shared pool                                         2208            2208            2208
large pool                                            64              64              64
java pool                                              0               0               0
streams pool                                           0               0               0
unified pga pool                                       0               0               0
memoptimize buffer cache                               0               0               0
DEFAULT buffer cache                               13952           13952           13952
KEEP buffer cache                                      0               0               0
RECYCLE buffer cache                                   0               0               0
DEFAULT 2K buffer cache                                0               0               0
DEFAULT 4K buffer cache                                0               0               0
DEFAULT 8K buffer cache                                0               0               0
DEFAULT 16K buffer cache                               0               0               0
DEFAULT 32K buffer cache                               0               0               0
Shared IO Pool                                       128             128             128
Data Transfer Cache                                    0               0               0
In-Memory Area                                         0               0               0
In Memory RW Extension Area                            0               0               0
In Memory RO Extension Area                            0               0               0
ASM Buffer Cache                                       0               0               0
                                         --------------- --------------- ---------------
sum                                                16352           16352           16352
Size of db_cache_size:

NAME                      BLOCK_SIZE RESIZE_STATE            CURRENT_SIZE         BUFFERS     TARGET_SIZE  TARGET_BUFFERS       PREV_SIZE    PREV_BUFFERS
-------------------- --------------- -------------------- --------------- --------------- --------------- --------------- --------------- ---------------
DEFAULT                         8192 STATIC                         13952         1707812           13952         1707812               0               0

Sizes in v$sgastat:

POOL                 NAME                           BYTES          CON_ID
-------------------- -------------------- --------------- ---------------
                     fixed_sga                   13693168               0
                     buffer_cache             14629732352               0
                     log_buffer                  19857408               0
                     shared_io_pool             134217728               0

          VALUE POOL                           BYTES    Percent Free
--------------- -------------------- --------------- ---------------
              0 shared pool                377024384               0
              0 large pool                  51380224               0

Sizes in v$sga_resize_ops:

START_TIME        COMPONENT                 OPER_TYPE            OPER_MODE                 INITIAL_MB        FINAL_MB END_TIME
----------------- ------------------------- -------------------- -------------------- --------------- --------------- -----------------
30/09/25 11:49:38 DEFAULT buffer cache      STATIC                                                  0           13952 30/09/25 11:49:38
30/09/25 11:49:38 DEFAULT buffer cache      INITIALIZING                                        13952           13952 30/09/25 11:49:40
30/09/25 11:49:38 shared pool               STATIC                                                  0            2208 30/09/25 11:49:38

Shared pool details and autocalculate:

SHARED_POOL_SIZE    SUM_OBJ_SIZE    SUM_SQL_SIZE   SUM_USER_SIZE MIN_SHARED_POOL
---------------- --------------- --------------- --------------- ---------------
               0       256883392       852774165           56500    1442628274.1

Shared pool usage:

NAME                                               RATIO REMARKS
---------------------------------------- --------------- ----------------------------------------------------------------------
Data Dictionary cache                            98.7927 Must be about 99%
Library cache                                    99.9568 Must be about 99%
Index usage ratio                                 99.371 Must be about 99%
Memory usage in Sorts ratio                          100 Relatively of sorting in Memories to all sorting
Cache hit ratio                                  99.9426 Must be about 99%
Buffer pool DEFAULT hit ratio                    99.9574 Must be about 99%
Average buffers scanned                                1 Must be 1..2, if more than 2 -- not enough buffers for server
Average dirty buffers                                  0 Must be <, if too much "dirty" -- not enough buffers for server
Shared pool free memory (MB)                    358.3512 If too much free memory -- may be excess of mem ?


10. Статистика PGA по сессиям

$ tpi mprod pga

    SID USERNAME        OSUSER          PROGRAM                             MACHINE              SESSION_PGA_MEMORY SESSION_PGA_MEMORY_MAX SESSION_UGA_MEMORY SESSION_UGA_MEMORY_MAX
------- --------------- --------------- ----------------------------------- -------------------- ------------------ ---------------------- ------------------ ----------------------
      4                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk        114,035,840            116,657,280          4,954,336            105,954,000
     64                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk         41,225,344             42,339,456            369,728                369,728
    124                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk         31,506,208             31,842,288            435,216                435,216
    418                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk         29,428,864             30,542,976            369,728                369,728
      6                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk         29,428,864             31,657,088            369,728                369,728
    301                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk         29,428,864             30,542,976            369,728                369,728
    428 IBS             DELL            plsqldev.exe                        WORKGROUP\DESKTOP-KV         28,491,552             37,871,600         26,928,136             28,042,880
    429                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk         24,214,656             58,162,304         15,581,696             23,312,976
    135 IBS             DELL            Novo121_97.exe                      WORKGROUP\DESKTOP-KV         20,413,568             81,182,496         16,799,208             62,307,064
    123                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk         19,849,200             20,963,312            435,216                500,704
     17 IBS             DELL            UAdm.exe                            WORKGROUP\DESKTOP-KV          9,927,808             34,651,936          7,455,344             31,142,072
    181                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk          9,035,472             27,844,304            369,728                369,728
    371 A_ARYP          assem           Novo121_97.exe                      WORKGROUP\VERA_S              8,503,072             12,042,016          7,377,664              8,921,776
    370 IBS             DELL            plsqldev.exe                        WORKGROUP\DESKTOP-KV          7,044,224             22,134,560          5,659,832             20,964,824
    188 IBS             mb              JDBC Thin Client                    WIN-IM1JGQJFHHM               6,340,384              8,314,864          5,056,072              6,944,752
    194 IBS             DELL            JDBC Thin Client                    DESKTOP-KV785D7               6,143,776              8,314,864          4,939,464              6,617,240
    365                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk          5,995,648             12,352,640          4,364,128              9,400,848
     69 A_ARYP          assem           ORAMON.EXE                          WORKGROUP\VERA_S              5,816,096              7,135,216          4,677,512              5,397,880
    313 IBS             DELL            OraMon.exe                          WORKGROUP\DESKTOP-KV          5,685,024              6,086,640          4,546,536              4,740,760
      9 IBS             DELL            plsqldev.exe                        WORKGROUP\DESKTOP-KV          5,619,488             14,270,240          4,481,048              5,048,304
    422                 oracle          oracle@prod-db.nc152.cmp.nkz.icdc.i prod-db.nc152.cmp.nk          5,602,432             11,631,744          4,393,768              9,080,776


дополнительные опции для мониторинга PGA
 pga [usage | pga_detail_get P.pid | pga_detail_cancel P.pid | pga_detail_show P.pid ] - PGA sessions information, pga_detail_show - V$PROCESS_MEMORY_DETAIL

10.1 Текущее использование PGA в %, если не используется AMM.
$ tpi mprod pga usage
PGA usage in %

PGA_USAGE
---------
       14


10.2 pga_detail_get P.pid | pga_detail_cancel P.pid | pga_detail_show P.pid - Текущее использование PGA в процессе P.pid ,  pga_detail_show - V$PROCESS_MEMORY_DETAIL работает через oradebug:

ORADEBUG SETMYPID
Statement processed.
ORADEBUG DUMP PGA_DETAIL_GET 74777
Statement processed.

11. Все что связано с объемом \ размером, объем генерации архивных логов в разрезе часов, суток (можно указать за сколько дней). Общий размер БД, размер TEMPORARY ТП.
$ tpi mprod size

Archived logs Switches information and SizeGb from v$arhived_log by last 7 days:
                      Total       Total
Date     THREAD# Day Switch     Size GB    h00    h01    h02    h03    h04    h05    h06    h07    h08    h09    h10    h11    h12    h13    h14    h15    h16    h17    h18    h19    h20    h21    h22    h23    AVGGB
-------- ------- --- ------ ----------- ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ --------
07/10/25       1 Tue      7         .81     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .7     .0     .0     .0     .0     .1      .03
08/10/25       1 Wed     25         .92     .0     .0     .0     .0     .0     .0     .0     .1     .0     .0     .0     .1     .1     .1     .1     .0     .1     .1     .0     .0     .0     .0     .0     .1      .04
09/10/25       1 Thu     25         .75     .0     .0     .0     .0     .0     .0     .0     .1     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .2     .0     .0     .0     .0     .0      .03
10/10/25       1 Fri     27        1.84     .0     .0     .0     .0     .0     .0     .0     .1     .0     .0     .0     .1     .3     .0     .1     .9     .0     .0     .0     .0     .0     .0     .0     .0      .08
11/10/25       1 Sat     25         .92     .0     .0     .0     .0     .0     .0     .1     .2     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .1     .2     .0     .0     .0     .1      .04
12/10/25       1 Sun     25         .73     .0     .0     .0     .0     .0     .0     .0     .1     .0     .0     .0     .0     .0     .0     .0     .1     .0     .0     .1     .1     .0     .0     .0     .1      .03
13/10/25       1 Mon     25         .53     .0     .0     .0     .0     .0     .0     .0     .1     .0     .0     .0     .0     .0     .0     .0     .1     .0     .0     .1     .0     .0     .0     .0     .0      .02
14/10/25       1 Tue     18         .55     .0     .0     .0     .0     .0     .0     .1     .1     .0     .0     .0     .1     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0      .02

Archive logs dest information from v$archive_dest:
DEST_NAME                      STATUS     DESTINATION
------------------------------ ---------- ------------------------------------------------------------------------------------------
LOG_ARCHIVE_DEST_1             VALID      USE_DB_RECOVERY_FILE_DEST
LOG_ARCHIVE_DEST_2             VALID      mprod-stb-db

Overall database size:
TABLESPACE_NAME                              DB_SIZE_MB
----------------------------------- -------------------
I_AUD                                            615.00
I_DICT                                           263.75
I_USR                                            720.00
PART                                               5.00
SYSAUX                                         2,320.00
SYSTEM                                         5,430.00
TOOLS                                              5.00
T_AUD                                          2,550.00
T_DICT                                           911.25
T_USR                                            691.25
UNDOTBS1                                      22,470.00
USERS                                              5.00
                                    -------------------
SUM                                           35,986.25

TABLESPACE_NAME                              DB_SIZE_MB
----------------------------------- -------------------
TEMP                                             694.00
                                    -------------------
SUM                                              694.00


параметры:
  size [days | tbs [free [SORT_COL_NAME]] | temp | sysaux | df [io|usage|lastseg[TBS]] | maxseg TBS | maxext | fra | rbin [all] | grows (days)] - Size of DB+archl (7 def), tablespaces, datafiles (HWM in DF+script), maxseg in all DB\TBS, FRA info + db_recovery_file_dest usage; recyclebin; ( exec 'alter system set "_enable_space_preallocation"=0' )

11.1 Табличные пространства:
$ tpi mprod size tbs

TABLESPACE_NAME                        MAX_SIZE BLOCK_SIZE STATUS     CONTENTS   LOGGING    EXTENT_MAN ALLOCATION SEGMENT_SP DEF_TAB_COMPR RETENTION    ENCRYPTED
------------------------------ ---------------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ------------- ------------ ----------
I_AUD                             2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     AUTO       DISABLED      NOT APPLY    NO
I_DICT                            2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     AUTO       DISABLED      NOT APPLY    NO
I_USR                             2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     AUTO       DISABLED      NOT APPLY    NO
PART                              2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     AUTO       DISABLED      NOT APPLY    NO
SYSAUX                            2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     AUTO       DISABLED      NOT APPLY    NO
SYSTEM                            2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     MANUAL     DISABLED      NOT APPLY    NO
TOOLS                             2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     AUTO       DISABLED      NOT APPLY    NO
T_AUD                             2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     AUTO       DISABLED      NOT APPLY    NO
T_DICT                            2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     AUTO       DISABLED      NOT APPLY    NO
T_USR                             2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     AUTO       DISABLED      NOT APPLY    NO
USERS                             2,147,483,645       8192 ONLINE     PERMANENT  LOGGING    LOCAL      SYSTEM     AUTO       DISABLED      NOT APPLY    NO
TEMP                              2,147,483,645       8192 ONLINE     TEMPORARY  NOLOGGING  LOCAL      UNIFORM    MANUAL     DISABLED      NOT APPLY    NO
UNDOTBS1                          2,147,483,645       8192 ONLINE     UNDO       LOGGING    LOCAL      SYSTEM     MANUAL     DISABLED      NOGUARANTEE  NO

11.2 Свободное место в табличных пространствах:
$ tpi mprod size tbs free

Tablespace_Name                MaxBytes_MB Allocated_MB    Free_MB    Used_MB     %_Free     %_Used
------------------------------ ----------- ------------ ---------- ---------- ---------- ----------
SYSTEM                               32768         5430      27370       5398      83.53      16.47
T_AUD                                32768         2550      30375       2393       92.7        7.3
SYSAUX                               32768         2320      30620       2148      93.44       6.56
T_DICT                               32768          911      31900        868      97.35       2.65
I_AUD                                32768          615      32183        585      98.21       1.79
I_USR                                65536          720      64850        686      98.95       1.05
T_USR                                65536          691      64879        657         99          1
I_DICT                               32768          264      32517        251      99.23        .77
UNDOTBS1                             32768        22470      32736         32       99.9         .1
TEMP                                 32768            1      32767          1        100          0
PART                                 32768            5      32767          1        100          0
USERS                                32768            5      32767          1        100          0
TOOLS                                32768            5      32767          1        100          0

11.3 Сессии, использующие TEMP, а также свободное место в TEMP табличных пространствах:
$ tpi mprod size temp

TEMP Tablespace Usage information:
TABLESPACE         TEMP_SIZE Mb SPID     SID_SERIAL      USERNAME             OSUSER               MACHINE                                        PROGRAM                                       STATUS   SQL_ID
------------------ ------------ -------- --------------- -------------------- -------------------- ---------------------------------------------- --------------------------------------------- -------- -------------
TEMP                          1 65161    135 59843       IBS                  DELL                 WORKGROUP\DESKTOP-KV785D7                      Novo121_97.exe                                INACTIVE

TEMP Tablespace Usage information:
TABLESPACE_NAME                 FREE Mb TOTAL Mb USED_PER
------------------------------ -------- -------- --------
TEMP                             32,767   32,768      .00


11.3 Использование ТП sysaux
$ tpi mprod size sysaux

OCCUPANT_DESC                                                          SPACE_USAGE_KBYTES
---------------------------------------------------------------------- ------------------
Server Manageability - Advisor Framework                                           858880
Server Manageability - Automatic Workload Repository                               586944
Server Manageability - Optimizer Statistics History                                354112
XDB                                                                                 64384
Unified Job Scheduler                                                               57088
Server Manageability - Other Components                                             39232
AUDSYS schema objects                                                               37888
LogMiner                                                                            11264
Workspace Manager                                                                    6720
Transaction Layer - SCN to TIME mapping                                              3456
PL/SQL Identifier Collection                                                         2944
Oracle Text                                                                          2880
SQL Management Base Schema                                                           2752
Analytical Workspace Object Table                                                    1984
Oracle Streams                                                                       1728
Logical Standby                                                                      1600
Enterprise Manager Monitoring User                                                   1408
Automated Maintenance Tasks                                                           576
                                                                       ------------------
sum                                                                               2035840

11.4 Датафайлы БД и их основные характеристики, для standby БД тоже работает и покажет SCN датафайлов:
$ tpi  mprod size df

DataFiles information:
TABLESPACE_NAME           FILE_ID FILE_NAME                                                              STATUS     ENABLED         BLOCK_SIZE        BYTES     MAXBYTES INCREMENT_BY AUT CHECKPOINT_CHANGE#
------------------------- ------- ---------------------------------------------------------------------- ---------- --------------- ---------- ------------ ------------ ------------ --- ------------------
I_AUD                           5 /app/oracle/oradata/mprod/i_aud01.dbf                                  ONLINE     READ WRITE            8192    644874240  34359721984      1310720 YES           88678431
I_DICT                          6 /app/oracle/oradata/mprod/i_dict01.dbf                                 ONLINE     READ WRITE            8192    276561920  34359721984      1310720 YES           88678431
I_USR                           7 /app/oracle/oradata/mprod/i_usr01.dbf                                  ONLINE     READ WRITE            8192    360448000  34359721984      1310720 YES           88678431
I_USR                           8 /app/oracle/oradata/mprod/i_usr02.dbf                                  ONLINE     READ WRITE            8192    394526720  34359721984      1310720 YES           88678431
PART                            9 /app/oracle/oradata/mprod/part01.dbf                                   ONLINE     READ WRITE            8192      5242880  34359721984      1310720 YES           88678431
SYSAUX                          2 /app/oracle/oradata/mprod/sysaux01.dbf                                 ONLINE     READ WRITE            8192   2432696320  34359721984     10485760 YES           88678431
SYSTEM                          1 /app/oracle/oradata/mprod/system01.dbf                                 SYSTEM     READ WRITE            8192   5693767680  34359721984     10485760 YES           88678431
TOOLS                          14 /app/oracle/oradata/mprod/tools01.dbf                                  ONLINE     READ WRITE            8192      5242880  34359721984      1310720 YES           88678431
T_AUD                          10 /app/oracle/oradata/mprod/t_aud01.dbf                                  ONLINE     READ WRITE            8192   2673868800  34359721984      1310720 YES           88678431
T_DICT                         11 /app/oracle/oradata/mprod/t_dict01.dbf                                 ONLINE     READ WRITE            8192    955514880  34359721984      1310720 YES           88678431
T_USR                          12 /app/oracle/oradata/mprod/t_usr01.dbf                                  ONLINE     READ WRITE            8192    346030080  34359721984      1310720 YES           88678431
T_USR                          13 /app/oracle/oradata/mprod/t_usr02.dbf                                  ONLINE     READ WRITE            8192    378798080  34359721984      1310720 YES           88678431
UNDOTBS1                        3 /app/oracle/oradata/mprod/undotbs01.dbf                                ONLINE     READ WRITE            8192  23561502720  34359721984      5242880 YES           88678431
USERS                           4 /app/oracle/oradata/mprod/users01.dbf                                  ONLINE     READ WRITE            8192      5242880  34359721984      1310720 YES           88678431

DataFiles information:
TABLESPACE_NAME           FILE_ID FILE_NAME                                                              STATUS     ENABLED         BLOCK_SIZE        BYTES     MAXBYTES INCREMENT_BY AUT
------------------------- ------- ---------------------------------------------------------------------- ---------- --------------- ---------- ------------ ------------ ------------ ---
TEMP                            1 /app/oracle/oradata/mprod/temp01.dbf                                   ONLINE     READ WRITE            8192    727711744  34359721984       655360 YES


11.5 Статистика IO по датафайлам:
$ tpi mprod size df io

v$filestat, v$datafile: DataFile's Disk Activity information:
                                                                                                                                 Read           write             Avg
Datafile Name                                                                                  PHYRDS         PHYWRTS        Time(ms)        Time(ms)        Time(ms)
------------------------------------------------------------------------------------- --------------- --------------- --------------- --------------- ---------------
/app/oracle/oradata/mprod/i_aud01.dbf                                                           10820           12483            1213             786               0
/app/oracle/oradata/mprod/i_dict01.dbf                                                          12582           29571             638            1648               0
/app/oracle/oradata/mprod/i_usr01.dbf                                                           12370            9770             828             475               0
/app/oracle/oradata/mprod/i_usr02.dbf                                                           13958            7856             909             390               0
/app/oracle/oradata/mprod/part01.dbf                                                               32               0               2               0               0
/app/oracle/oradata/mprod/sysaux01.dbf                                                          87458          326442            5298           17496               0
/app/oracle/oradata/mprod/system01.dbf                                                         136756          157039           12289            8519               0
/app/oracle/oradata/mprod/t_aud01.dbf                                                           37170           19043            4810            1279               0
/app/oracle/oradata/mprod/t_dict01.dbf                                                          33712           28526            1926            1676               0
/app/oracle/oradata/mprod/t_usr01.dbf                                                           14286            4835             824             282               0
/app/oracle/oradata/mprod/t_usr02.dbf                                                           15599           11150             801             649               0
/app/oracle/oradata/mprod/tools01.dbf                                                              32               0               2               0               0
/app/oracle/oradata/mprod/undotbs01.dbf                                                           425          117910              86            9281               0
/app/oracle/oradata/mprod/users01.dbf                                                              32               0               2               0               0

11.6 Статистика использования датафайлов, процент заполнения и т.п.
$ tpi mprod size df usage

Tablespace\Datafiles Usage information:
ID# TABLESPACE_NAME                       Total Bytes       SQL Blocks       VMS Blocks         Bytes Free    % Free         Bytes Used    % Used
--- ------------------------------ ------------------ ---------------- ---------------- ------------------ --------- ------------------ ---------
5   I_AUD                                 644,874,240           78,720        1,259,520         31,260,672     4.848        613,613,568    95.152
6   I_DICT                                276,561,920           33,760          540,160         13,565,952     4.905        262,995,968    95.095
7   I_USR                                 360,448,000           44,000          704,000         25,952,256     7.200        334,495,744    92.800
8   I_USR                                 394,526,720           48,160          770,560         10,027,008     2.542        384,499,712    97.458
9   PART                                    5,242,880              640           10,240          4,194,304    80.000          1,048,576    20.000
2   SYSAUX                              2,432,696,320          296,960        4,751,360        179,896,320     7.395      2,252,800,000    92.605
1   SYSTEM                              5,693,767,680          695,040       11,120,640         33,882,112      .595      5,659,885,568    99.405
14  TOOLS                                   5,242,880              640           10,240          4,194,304    80.000          1,048,576    20.000
10  T_AUD                               2,673,868,800          326,400        5,222,400        164,954,112     6.169      2,508,914,688    93.831
11  T_DICT                                955,514,880          116,640        1,866,240         45,809,664     4.794        909,705,216    95.206
12  T_USR                                 346,030,080           42,240          675,840         18,284,544     5.284        327,745,536    94.716
13  T_USR                                 378,798,080           46,240          739,840         18,087,936     4.775        360,710,144    95.225
3   UNDOTBS1                           23,561,502,720        2,876,160       46,018,560     23,526,506,496    99.851         34,996,224      .149
4   USERS                                   5,242,880              640           10,240          4,194,304    80.000          1,048,576    20.000
                                   ------------------ ---------------- ---------------- ------------------ --------- ------------------ ---------
avg                                                                                                           27.740                       72.260
sum                                    37,734,318,080        4,606,240       73,699,840     24,080,809,984               13,653,508,096

11.7 Статистика по последним сегментам в датафайле, а также генерится скрипт по resize датафайлам, если есть возможность их уменьшить:

$ tpi mprod size df lastseg T_USR

OWNER           SEGMENT_NAME                      PARTITION_NAME                    SEGMENT_TYPE         TABLESPACE_NAME         EXTENT_ID FILE_ID   BLOCK_ID      BYTES     BLOCKS RELATIVE_FNO
--------------- --------------------------------- --------------------------------- -------------------- ---------------------- ---------- ------- ---------- ---------- ---------- ------------
IBS             IDX_Z#MST_IMPORT_IVT                                                INDEX                T_USR                          39      12      39936    1048576        128           12
IBS             IDX_Z#MST_IMPORT_IVT                                                INDEX                T_USR                          38      13      43904    1048576        128           13

Smallest used position in datafiles:

VALUE
----------
8192

                                                                               Smallest
                                                                                   Size  Current    Poss.
FILE_ID FILE_NAME                                                                 Poss.     Size  Savings
------- ---------------------------------------------------------------------- -------- -------- --------
     12 /app/oracle/oradata/mprod/t_usr01.dbf                                       313      330       17
     13 /app/oracle/oradata/mprod/t_usr02.dbf                                       344      362       18
                                                                                                 --------
sum                                                                                                    35

Script with commands for resize datafiles:

CMD
------------------------------------------------------------------------------------------------------------------------------------------------------
alter database datafile '/app/oracle/oradata/mprod/t_usr01.dbf' resize 314m;
alter database datafile '/app/oracle/oradata/mprod/t_usr02.dbf' resize 345m;


11.8  Максимальные сегменты в ТП или БД, если не указать ТП
$ tpi mprod size maxseg T_USR

TABLESPACE_NAME                OWNER                          SEGMENT_NAME                             SEGMENT_TYPE         COMPRESSION               MBYTES
------------------------------ ------------------------------ ---------------------------------------- -------------------- --------------- ----------------
T_USR                          IBS                            Z#MST_IMPORT_STR                         TABLE                DISABLED                     120
T_USR                          IBS                            IDX_Z#MST_IMPORT_VALS                    INDEX                DISABLED                     104
T_USR                          IBS                            Z#PR_CALC                                TABLE                DISABLED                      56
T_USR                          IBS                            Z#CLIENT                                 TABLE                DISABLED                      52
T_USR                          IBS                            Z#REP_TEXT                               TABLE                DISABLED                      52
T_USR                          IBS                            IDX_Z#MST_IMPORT_IVT                     INDEX                DISABLED                      25


11.8  Сегмент, которому не хватит свободного места в ТП, при следующем добавлении экстента
$ tpi mprod size maxext


11.9 Параметры FRA, процент заполнения:

$ tpi mprod size fra
DB=mprod 14/10/25-18:33:12 ver=13.10.25  size [days | tbs [free [SORT_COL_NAME]] | temp | sysaux | df [io|usage|lastseg[TBS]] | maxseg TBS | maxext | fra | rbin [all] | grows (days)] - Size of DB+archl (7 def), tablespaces, datafiles (HWM in DF+script), maxseg in all DB\TBS, FRA info + db_recovery_file_dest usage; recyclebin; ( exec 'alter system set "_enable_space_preallocation"=0' )

NAME                             DISPLAY_VALUE                                      ISMODIFIED DESCRIPTION
-------------------------------- -------------------------------------------------- ---------- ---------------------------------------------------------
db_recovery_file_dest            /app/oracle/fast_recovery_area                     FALSE      default database recovery file location
db_recovery_file_dest_size       80G                                                FALSE      database recovery files size limit
db_flashback_retention_target    1440                                               FALSE      Maximum Flashback Database log retention time in minutes.

View: V$FLASH_RECOVERY_AREA_USAGE
FILE_TYPE               PERCENT_SPACE_USED PERCENT_SPACE_RECLAIMABLE NUMBER_OF_FILES     CON_ID
----------------------- ------------------ ------------------------- --------------- ----------
CONTROL FILE                             0                         0               0          0
REDO LOG                                 0                         0               0          0
ARCHIVED LOG                           .11                       .11               1          0
BACKUP PIECE                             0                         0               0          0
IMAGE COPY                               0                         0               0          0
FLASHBACK LOG                            0                         0               0          0
FOREIGN ARCHIVED LOG                     0                         0               0          0
AUXILIARY DATAFILE COPY                  0                         0               0          0

View: v$recovery_file_dest
NAME                                                                  SPACE_LIMIT      SPACE_AVAILABLE   PCT_FULL
------------------------------------------------------------ -------------------- -------------------- ----------
/app/oracle/fast_recovery_area                                     85,899,345,920       85,899,345,920          0

View: v$recovery_file_dest
NAME                                                                  SPACE_LIMIT           SPACE_USED    SPACE_RECLAIMABLE NUMBER_OF_FILES
------------------------------------------------------------ -------------------- -------------------- -------------------- ---------------
/app/oracle/fast_recovery_area                                     85,899,345,920           93,915,136           93,915,136               1


11.10 Параметры FRA, процент заполнения:

$ tpi mprod size fra



11.11 Объекты recyclebin, сгруппированные по OWNER:

$ tpi mprod size rbin

OWNER                          TS_NAME                                MB
------------------------------ ------------------------------ ----------
GAL_VEK#A.CHZHON               USERS                                   8
GAL_VEK#A.ISHCHENKO            USERS                                  16
GAL_VEK#A.OKOROKOVA            USERS                                  40
GAL_VEK#A.SEROVA               USERS                                  32
GAL_VEK#AL.MARKIN              USERS                                   8
GAL_VEK#AN.KEL                 USERS                                  24
GAL_VEK#AN.SMIRNOVA2           USERS                                  16
GAL_VEK#DOLGANOVANN            USERS                                  80
GAL_VEK#E.BAZILEVA             USERS                                  48
GAL_VEK#E.SAMSONOVA            USERS                                   8
GAL_VEK#E.TOLPIS               USERS                                  32
GAL_VEK#E.TURKINA              USERS                                  24
GAL_VEK#E.TURKINA
GAL_VEK#G.KHOKHLOVA            USERS                                  40
GAL_VEK#IU.DEMINA              USERS                                  48
GAL_VEK#IU.KULSHE              USERS                                  16
GAL_VEK#IU.SHULEPOVA           USERS                                  16
GAL_VEK#IU.SVETLYKH            USERS                                  24
GAL_VEK#K.ARHANGELSKAYA        USERS                                  40
GAL_VEK#K.GULIAEVA             USERS                                   8
GAL_VEK#KILUSHEVAEY            USERS                                  32
GAL_VEK#KOMRAKOVASV            USERS                                   8
GAL_VEK#KOZLOVDA               USERS                                  16
GAL_VEK#L.LARINA               USERS                                  32
GAL_VEK#MA.ZININA              USERS                                  32
GAL_VEK#MARKINADA1             USERS                                  24
GAL_VEK#MELADZEDD              USERS                                  16
GAL_VEK#N.ILLARIONOVA          USERS                                  16
GAL_VEK#N.KURKINA              USERS                                  16
GAL_VEK#NI.KUZNETSOV           USERS                                  16
GAL_VEK#RICHKOVAIV             USERS                                  32
GAL_VEK#ROMANENKOMA            USERS                                  32
GAL_VEK#RUKAVTSEVAOV           USERS                                   8
GAL_VEK#S.DMITRENKO            USERS                                  24
GAL_VEK#S.GOLOVKINA            USERS                                  16
GAL_VEK#S.KLISHINA             USERS                                  16
GAL_VEK#SHUBINAEV              USERS                                  40
GAL_VEK#STRELKOVAS             USERS                                   8
GAL_VEK#TIMOFEEVATA1           USERS                                  16
GAL_VEK#V.BRIN                 USERS                                  16
GAL_VEK#YAROVANK               USERS                                  24
GAL_VEK#ZAVYALOVATV            USERS                                  56
GAL_VEK#ZHAGARINAYN            USERS                                  32
Elapsed: 00:00:00.08

11.12 Объекты recyclebin все:
$ tpi mprod size rbin all

OWNER                          OBJECT_NAME                    ORIGINAL_NAME                       TYPE                 TS_NAME                        UND PUR DROPTIME
------------------------------ ------------------------------ ----------------------------------- -------------------- ------------------------------ --- --- -------------------------
GAL_VEK#IU.KULSHE              BIN$LozbTSOVAArgY8CoAYMyyA==$0 DONRECS                             TABLE                USERS                          YES YES 2025-02-20:08:07:54
GAL_VEK#ROMANENKOMA            BIN$Lozf6PLGAQDgY8CoAYPRQA==$0 DONRECS                             TABLE                USERS                          YES YES 2025-02-20:08:09:12
GAL_VEK#L.LARINA               BIN$Loz6av+6ATDgY8CoAYPnyQ==$0 DONRECS                             TABLE                USERS                          YES YES 2025-02-20:08:16:36
GAL_VEK#S.DMITRENKO            BIN$Lo3ks7LYAbTgY8CoAYM0cg==$0 DONRECS                             TABLE                USERS                          YES YES 2025-02-20:09:22:07
GAL_VEK#SHUBINAEV              BIN$Lo30PTNUAC7gY8CoAYM9Gw==$0 DONRECS                             TABLE                USERS                          YES YES 2025-02-20:09:26:28
GAL_VEK#S.KLISHINA             BIN$Lo4l5lbXAjDgY8CoAYOK4A==$0 DONRECS                             TABLE                USERS                          YES YES 2025-02-20:09:40:21
GAL_VEK#RICHKOVAIV             BIN$Lo5BORNeACrgY8CoAYNgNQ==$0 DONRECS                             TABLE                USERS                          YES YES 2025-02-20:09:47:59
GAL_VEK#DOLGANOVANN            BIN$Lo5ISyIcAubgY8CoAYMsAg==$0 DONRECS                             TABLE                USERS                          YES YES 2025-02-20:09:49:58
GAL_VEK#N.ILLARIONOVA          BIN$Lo5e/lr+AcDgY8CoAYOMNA==$0 SPSOPR_JRN0                         INDEX                USERS                          NO  YES 2025-02-20:09:56:19
GAL_VEK#N.ILLARIONOVA          BIN$Lo5e/lr/AcDgY8CoAYOMNA==$0 SPSOPR_JRN                          TABLE                USERS                          YES YES 2025-02-20:09:56:19
GAL_VEK#A.OKOROKOVA            BIN$Lo6YkoIGAErgY8CoAYNUZA==$0 DONRECS                             TABLE                USERS                          YES YES 2025-02-20:10:12:25


11.13 Рост по добавлению датафайлов за последний год, + рост БД за последние 30 дней:

$ tpi mprod size grows 30

Month      Growth in Gb
---------- ------------
2024 10             511
2024 11             799
2024 12             255
2025 01             191
2025 02             223
2025 03             201
2025 04             223
2025 05             223
2025 06             191
2025 07             287
2025 08             287
2025 09             319
2025 10             159
Elapsed: 00:00:00.37

"DBA_HIST_SEG_STAT: The database grows for 30 days:"

SNAP_TIME                    Database Size(MB)      Grows Size(MB)
14-Sep-2025 17:00            16,428,873             16,428,873
14-Sep-2025 18:00            16,429,151                    278
14-Sep-2025 19:00            16,429,279                    128
14-Sep-2025 20:00            16,429,287                      8
14-Sep-2025 21:00            16,429,375                     88
14-Sep-2025 22:00            16,429,584                    209
14-Sep-2025 23:00            16,429,904                    320
15-Sep-2025 00:00            16,430,168                    264
15-Sep-2025 01:00            16,430,593                    425
15-Sep-2025 02:00            16,431,984                  1,391
15-Sep-2025 03:00            16,431,985                      1
15-Sep-2025 04:00            16,432,049                     64
15-Sep-2025 05:00            16,432,193                    144
15-Sep-2025 06:00            16,432,265                     72


12. Различные показатели archievlog режима БД, в т.ч. lag отставания standby, Reclaimable v$archived_log , статус процессов GV$MANAGED_STANDBY

$ tpi mprod arch
DB=mprod 14/10/25-18:39:05 ver=13.10.25  arch [seq [SEQ|dd/mm/yy-HH:MI] | scn [SCN|dd/mm/yy-HH:MI]] - archivelog, V$LOG V$ARCHIVE_DEST V$ARCHIVE_DEST_STATUS GV$MANAGED_STANDBY V$STANDBY_LOG information

V$ARCHIVE_DEST :
 ID SEQUENCE STATUS           BINDING    TARGET  COMPRES VALID_TYPE      VALID_ROLE   DESTINATION                                             ERROR
--- -------- ---------------- ---------- ------- ------- --------------- ------------ ------------------------------------------------------- ---------------------------------------------------------------------------
  1      368 VALID            MANDATORY  PRIMARY DISABLE ALL_LOGFILES    ALL_ROLES    USE_DB_RECOVERY_FILE_DEST
  2      369 VALID            OPTIONAL   STANDBY DISABLE ONLINE_LOGFILE  PRIMARY_ROLE mprod-stb-db

V$ARCHIVE_DEST_STATUS :
 ID RECOVERY_MODE             STATUS           DATABASE_MODE   ARCHIVED_THREAD# ARCHIVED_SEQ# APPLIED_SEQ#
--- ------------------------- ---------------- --------------- ---------------- ------------- ------------
  1 IDLE                      VALID            OPEN                           1           368            0
  2 MANAGED REAL TIME APPLY   VALID            MOUNTED-STANDBY                1           368          367

V$ARCHIVED_LOG transport lag archivelog standby:
THREAD  ID STATUS           PRIMARY_SEQ PRIMARY_TIME         STANDBY_THREAD  ID STANDBY_SEQ STANDBY_NEXT_TIME        SEQ_GAP LAG_MINUTES
------ --- ---------------- ----------- -------------------- -------------- --- ----------- ----------------------- -------- -----------
     1   2 VALID                    368 14/10/2025 18:00:13               1   2         368 14/10/2025 18:00:13            0         .00

Reclaimable v$archived_log join x$kccagf   exec dbms_backup_restore.refreshagedfiles; :
APPLIED   DELETED BACKUP_COUNT RECLAIMABLE COUNT(*) FIRST_TIME      LAST_TIME        FIRST_SEQ   LAST_SEQ
--------- ------- ------------ ----------- -------- --------------- --------------- ---------- ----------
NO        NO                 1 YES                1 14/10/25 18:00  14/10/25 18:00         368        368

GV$MANAGED_STANDBY :
THREAD#  SEQUENCE# PROCESS PID                      STATUS               BLOCK#
------- ---------- ------- ------------------------ ---------------- ----------
      0          0 DGRD    1169142                  ALLOCATED                 0
      0          0 DGRD    1169156                  ALLOCATED                 0
      0          0 DGRD    1169146                  ALLOCATED                 0
      0          0 DGRD    1169583                  ALLOCATED                 0
      1        219 ARCH    1169150                  CLOSING               32768
      1        246 ARCH    1169148                  CLOSING               28672
      1        264 ARCH    1169152                  CLOSING              946176
      1        265 ARCH    1169144                  CLOSING              901120
      1        369 LNS     1169154                  WRITING               68793


21.1 Вывод сгенерированных архивных логов, после sequence 365

$ tpi mprod arch seq 365

      SEQ  ID   FIRST_CHANGE#    NEXT_CHANGE# FIRST_TIME        NEXT_TIME             Mb CREA REGI STAN ARCH APPL DELE S COMPLETION_TIME   NAME
--------- --- --------------- --------------- ----------------- ----------------- ------ ---- ---- ---- ---- ---- ---- - ----------------- ----------------------------------------------------------------------------------------
      365   1        88614804        88633580 14/10/25 14:00:14 14/10/25 15:00:14     15 FGRD FGRD NO   YES  NO   YES  D 14/10/25 15:00:14
      365   2        88614804        88633580 14/10/25 14:00:14 14/10/25 15:00:14     15 LGWR LGWR YES  YES  YES  NO   A 14/10/25 15:00:14 mprod-stb-db
      366   1        88633580        88656675 14/10/25 15:00:14 14/10/25 16:00:14     18 FGRD FGRD NO   YES  NO   YES  D 14/10/25 16:00:14
      366   2        88633580        88656675 14/10/25 15:00:14 14/10/25 16:00:14     18 LGWR LGWR YES  YES  YES  NO   A 14/10/25 16:00:14 mprod-stb-db
      367   1        88656675        88678431 14/10/25 16:00:14 14/10/25 17:00:14     17 FGRD FGRD NO   YES  NO   YES  D 14/10/25 17:00:14
      367   2        88656675        88678431 14/10/25 16:00:14 14/10/25 17:00:14     17 LGWR LGWR YES  YES  YES  NO   A 14/10/25 17:00:14 mprod-stb-db
      368   2        88678431        88725393 14/10/25 17:00:14 14/10/25 18:00:13     90 LGWR LGWR YES  YES  YES  NO   A 14/10/25 18:00:13 mprod-stb-db
      368   1        88678431        88725393 14/10/25 17:00:14 14/10/25 18:00:13     90 FGRD FGRD NO   YES  NO   NO   A 14/10/25 18:00:13 /app/oracle/fast_recovery_area/MPROD/archivelog/2025_10_14/o1_mf_1_368_ngwlbxl0_.arc

21.2 Вывод сгенерированных  архивных логов, после определенного времени

$ tpi mprod arch seq 14/10/25-15:00

      SEQ  ID   FIRST_CHANGE#    NEXT_CHANGE# FIRST_TIME        NEXT_TIME             Mb CREA REGI STAN ARCH APPL DELE S COMPLETION_TIME   NAME
--------- --- --------------- --------------- ----------------- ----------------- ------ ---- ---- ---- ---- ---- ---- - ----------------- ----------------------------------------------------------------------------------------
      366   1        88633580        88656675 14/10/25 15:00:14 14/10/25 16:00:14     18 FGRD FGRD NO   YES  NO   YES  D 14/10/25 16:00:14
      366   2        88633580        88656675 14/10/25 15:00:14 14/10/25 16:00:14     18 LGWR LGWR YES  YES  YES  NO   A 14/10/25 16:00:14 mprod-stb-db
      367   1        88656675        88678431 14/10/25 16:00:14 14/10/25 17:00:14     17 FGRD FGRD NO   YES  NO   YES  D 14/10/25 17:00:14
      367   2        88656675        88678431 14/10/25 16:00:14 14/10/25 17:00:14     17 LGWR LGWR YES  YES  YES  NO   A 14/10/25 17:00:14 mprod-stb-db
      368   2        88678431        88725393 14/10/25 17:00:14 14/10/25 18:00:13     90 LGWR LGWR YES  YES  YES  NO   A 14/10/25 18:00:13 mprod-stb-db
      368   1        88678431        88725393 14/10/25 17:00:14 14/10/25 18:00:13     90 FGRD FGRD NO   YES  NO   NO   A 14/10/25 18:00:13 /app/oracle/fast_recovery_area/MPROD/archivelog/2025_10_14/o1_mf_1_368_ngwlbxl0_.arc


21.3 Вывод соответствия scn времени БД, + вывод сгенерированных  архивных логов, после определенного scn

$ tpi mprod arch scn  88678429

scn_to_timestamp
            SCN SCN_DATE
--------------- --------------------
       88678429 14/10/25 17:00:12

v$archived_log where 88678429 between FIRST_CHANGE# and NEXT_CHANGE# order by recid :

      SEQ  ID   FIRST_CHANGE#    NEXT_CHANGE# FIRST_TIME        NEXT_TIME             Mb CREA REGI STAN ARCH APPL DELE S COMPLETION_TIME   NAME
--------- --- --------------- --------------- ----------------- ----------------- ------ ---- ---- ---- ---- ---- ---- - ----------------- ----------------------------------------------------------------------------------------
      367   1        88656675        88678431 14/10/25 16:00:14 14/10/25 17:00:14     17 FGRD FGRD NO   YES  NO   YES  D 14/10/25 17:00:14
      367   2        88656675        88678431 14/10/25 16:00:14 14/10/25 17:00:14     17 LGWR LGWR YES  YES  YES  NO   A 14/10/25 17:00:14 mprod-stb-db


21.4 Вывод сгенерированных  архивных логов, в момент времени

$ tpi mprod arch scn  14/10/25-16:00

      SEQ  ID   FIRST_CHANGE#    NEXT_CHANGE# FIRST_TIME        NEXT_TIME             Mb CREA REGI STAN ARCH APPL DELE S COMPLETION_TIME   NAME
--------- --- --------------- --------------- ----------------- ----------------- ------ ---- ---- ---- ---- ---- ---- - ----------------- ----------------------------------------------------------------------------------------
      366   1        88633580        88656675 14/10/25 15:00:14 14/10/25 16:00:14     18 FGRD FGRD NO   YES  NO   YES  D 14/10/25 16:00:14
      366   2        88633580        88656675 14/10/25 15:00:14 14/10/25 16:00:14     18 LGWR LGWR YES  YES  YES  NO   A 14/10/25 16:00:14 mprod-stb-db



22. Сессии, генерящие redo на основе данных v$sess_io, v$transaction, V$STATNAME - redo size

$ tpi mprod  redo

Top 25 ACTIVE Sessions Generating Lots of Redo v$session, v$sess_io:

   SID  SERIAL# USERNAME                  OSUSER                    PMA                                                                                                  BLOCK_CHANGES   Changes Mb
------ -------- ------------------------- ------------------------- ---------------------------------------------------------------------------------------------------- ------------- ------------
  6333    21973 KAFKA                     BI$                       Galaxy2Kafka.exe \ Galaxy2Kafka.exe \                                                                      1395786       10,905
  3099    20215 KAFKA                     BI$                       Galaxy2Kafka.exe \ Galaxy2Kafka.exe \                                                                      1395676       10,904
  3113    50309 KAFKA                     BI$                       Galaxy2Kafka.exe \ Galaxy2Kafka.exe \                                                                      1281854       10,014
  2560    59661 KAFKA                     BI$                       Galaxy2Kafka.exe \ Galaxy2Kafka.exe \                                                                      1252683        9,787
   190    17265 GAL_VEK#D.GALYNINA        d.galynina                atlexec.exe \ atlexec.exe \                                                                                 102042          797
  2310    47819 GAL_VEK#T.MINAKOVA        t.minakova                atlexec.exe \ atlexec.exe \                                                                                  38856          304
  6514    42337 GAL_VEK#A.PUTINTSEVA      a.putintseva              atlexec.exe \ atlexec.exe \                                                                                  18159          142
  1195    40113 GAL_VEK#P.DEMIANOVA       p.demianova               atlexec.exe \ atlexec.exe \                                                                                  10597           83
  4441    27963 GAL_VEK#DIADOCIMP         Termscheduler             atlexec.exe \ atlexec.exe \                                                                                   9106           71
  3096    64645 GAL_VEK#A.SUNKINA         a.sunkina                 atlexec.exe \ atlexec.exe \                                                                                   6301           49
  4429    33325 GAL_VEK#E.MISHAKINA       e.mishakina               atlexec.exe \ atlexec.exe \                                                                                    742            6
  4066    21169 GAL_ASUP                  oracle                    oracle@srvoradb (J000) \ DBMS_SCHEDULER \ UPD_5MIN_JOB                                                          63            0
  6434    56475 GAL_ASUP                  oracle                    oracle@srvoradb (J001) \ DBMS_SCHEDULER \ UPDATE_PLANNED_VOLUME                                                 20            0
  2790    21553 GAL_ASUP                  oracle                    oracle@srvoradb (J003) \ DBMS_SCHEDULER \ UPD_4HOUR_JOB                                                         16            0
  3714    40473 KUDIAKOV_02               USR1CV8                   rmngr.exe \ rmngr.exe \                                                                                          5            0
  2866    49799 KUDIAKOV                  USR1CV8                   rmngr.exe \ rmngr.exe \                                                                                          4            0

Top 25 ACTIVE Sessions Generating Lots of Redo v$session, v$transaction Run the query multiple times and examine the delta between each occurrence of USED_UBLK and USED_UREC:

   SID  SERIAL# USERNAME                  PROGRAM                                           USED_UBLK  USED_UREC START_TIME
------ -------- ------------------------- ------------------------------------------------ ---------- ---------- --------------------
  5545    26347 KAFKA                     Galaxy2Kafka.exe                                          4        234 10/14/25 16:50:08

Top 25 Sessions Generating Lots of Redo  V$SESSION s, V$SESSTAT t, V$STATNAME sn, V$SQLAREA :

   SID  SERIAL# USERNAME                  PROGRAM                        Redo Size MB SQL_TEXT
------ -------- ------------------------- ------------------------------ ------------ ----------------------------------------------------------------------------------------------------------------------------------
  7283    36937 GAL_VEK#GORSHKOVANA       atlexec.exe                           61608
  2084    42319 GAL_VEK#T.LARINA          atlexec.exe                           12614
  1915     6715 GAL_VEK#SV.GERASIMOVA     atlexec.exe                            8496
  5626    31645 GAL_VEK#T.LARINA          atlexec.exe                            4265
  2546    23353 GAL_VEK#SCHEDULER         atlexec.exe                            4044 SELECT /*+ FIRST_ROWS(25) INDEX_ASC(T0,"ATTRNAM1") PARALLEL_INDEX(T0,"ATTRNAM1", 1) LEADING(T0) */ T0.ROWID FROM GAL_VEK."ATTRNAM"
                                                                                       T0 WHERE (T0."FWTABLE"=:P1 AND T0."FNAME$UP"=UPPER(:P2))


22.1 Redo logs БД, размер, а также активные группы:

$ tpi mprod redo logs

    GROUP# MEMBER                                                                           TYPE    STATUS
---------- -------------------------------------------------------------------------------- ------- -------
         1 /gredo2/mprod/redo12.log                                                        ONLINE
         1 /gredo3/mprod/redo13.log                                                        ONLINE
         2 /gredo2/mprod/redo22.log                                                        ONLINE
         2 /gredo3/mprod/redo23.log                                                        ONLINE
         3 /gredo2/mprod/redo32.log                                                        ONLINE
         3 /gredo3/mprod/redo33.log                                                        ONLINE
         4 /gredo2/mprod/redo42.log                                                        ONLINE
         4 /gredo3/mprod/redo43.log                                                        ONLINE
         5 /gredo2/mprod/redo52.log                                                        ONLINE
         5 /gredo3/mprod/redo53.log                                                        ONLINE
         6 /gredo2/mprod/redo62.log                                                        ONLINE
         6 /gredo3/mprod/redo63.log                                                        ONLINE
         7 /gredo2/mprod/stbredo01.log                                                     STANDBY
         8 /gredo3/mprod/stbredo02.log                                                     STANDBY
         9 /gredo2/mprod/stbredo03.log                                                     STANDBY
        10 /gredo3/mprod/stbredo04.log                                                     STANDBY

    GROUP#           BYTES STATUS           ARC  SEQUENCE#
---------- --------------- ---------------- --- ----------
         1   5,368,709,120 INACTIVE         YES     253118
         2   5,368,709,120 CURRENT          NO      253121
         3   5,368,709,120 INACTIVE         YES     253120
         4   5,368,709,120 INACTIVE         YES     253117
         5   5,368,709,120 INACTIVE         YES     253119
         6   5,368,709,120 INACTIVE         YES     253116



23. Сессии с активными транзакциями, использующие сегменты отката и временем последнего вызова.

$ tpi mprod undo

Sessions with active transactions v$session, v$transaction, dba_undo_extents (F: 0-triansaction, 8-rollback), estimate USED_UBLK: (used_later / (used_now - used_later)) :

   SID  SERIAL# USERNAME             OSUSER          STATUS     PROGRAM \ MODULE \ ACTION                                         UNDOSEG                 F  USED_UBLK   Undo Mb LAST_CALL_ET
------ -------- -------------------- --------------- ---------- ----------------------------------------------------------------- ----------------------- - ---------- --------- -------------------------
    57    47705 MADMIN               oracle          INACTIVE   oracle@mrct-prd-db.shoppinglive.local (TNS V1-V3 \ oracle@mrct-pr _SYSSMU1_215802770$     0          1         0 Tue 16:34:26 - 20.4 min
                                                                d-db.shoppinglive.local (TNS V1-V3 \

   540    44153 MUSER                jboss           INACTIVE   JDBC Thin Client \ JDBC Thin Client \                             _SYSSMU1_215802770$     0          1         0 Tue 16:54:09 - 0.7 min
   522    64820 MUSER                jboss           INACTIVE   JDBC Thin Client \ JDBC Thin Client \                             _SYSSMU8_3690834147$    0          1         0 Tue 16:54:09 - 0.7 min
   805    45004 MADMIN               oracle          INACTIVE   oracle@mrct-prd-db.shoppinglive.local (TNS V1-V3 \ oracle@mrct-pr _SYSSMU8_3690834147$    0          1         0 Tue 16:36:15 - 18.6 min
                                                                d-db.shoppinglive.local (TNS V1-V3 \

   777    53645 MUSER                jboss           INACTIVE   JDBC Thin Client \ JDBC Thin Client \                             _SYSSMU25_44264662$     0          1         0 Tue 16:54:09 - 0.7 min
   306    55251 MADMIN               oracle          INACTIVE   oracle@mrct-prd-db.shoppinglive.local (TNS V1-V3 \ oracle@mrct-pr _SYSSMU13_77396757$     0          1         0 Tue 16:32:32 - 22.3 min
                                                                d-db.shoppinglive.local (TNS V1-V3 \

   277    12537 MUSER                jboss           INACTIVE   JDBC Thin Client \ JDBC Thin Client \                             _SYSSMU18_2014654978$   0          1         0 Tue 16:53:09 - 1.7 min
   798      167 MADMIN               oracle          INACTIVE   oracle@mrct-prd-db.shoppinglive.local (TNS V1-V3 \ oracle@mrct-pr _SYSSMU18_2014654978$   0          1         0 Tue 16:32:56 - 21.9 min
                                                                d-db.shoppinglive.local (TNS V1-V3 \

   771    28112 MADMIN               oracle          INACTIVE   oracle@mrct-prd-db.shoppinglive.local (TNS V1-V3 \ oracle@mrct-pr _SYSSMU25_44264662$     0          1         0 Tue 16:51:25 - 3.4 min
                                                                d-db.shoppinglive.local (TNS V1-V3 \

    29    33360 MUSER                jboss           INACTIVE   JDBC Thin Client \ JDBC Thin Client \                             _SYSSMU13_77396757$     0          1         0 Tue 16:54:09 - 0.7 min


23.1 Сессии с активными откатывающими транзакциями, оценочным временем отката:
$ tpi mprod undo recovery


24. sesstat - Мониторинг статистики сессий. list - Вывод списка статистик.

tpi mprod sesstat list

STATISTIC# NAME                                                             CLASS
---------- ---------------------------------------------------------------- -------
         0 OS CPU Qt wait time                                              User
         1 Requests to/from client                                          User
         2 logons cumulative                                                User
         3 logons current                                                   User
         4 opened cursors cumulative                                        User
         5 opened cursors current                                           User
         6 user commits                                                     User
         7 user rollbacks                                                   User
         8 user calls                                                       User
         9 recursive calls                                                  User


24.1 Статистика сессий, сгенерировавщих redo size

$ tpi mprod sesstat redo size
Sessions of top 60 event :

   SID SERIAL# USERNAME                  OSUSER                         MODULE                                             NAME                                                         CLASS                    VALUE
------ ------- ------------------------- ------------------------------ -------------------------------------------------- ------------------------------------------------------------ ---------- -------------------
   135   59843 IBS                       DELL                           Автоматизированное рабочее место                   redo size                                                    Redo                 112599232
   239   28472                           oracle                                                                            redo size                                                    Redo                 106971652
   429   27811                           oracle                         MMON_SLAVE                                         redo size                                                    Redo                 102454996
   181   57445                           oracle                                                                            redo size                                                    Redo                  84033368
   365   27952                           oracle                         MMON_SLAVE                                         redo size                                                    Redo                  52229716
   416   20332                           oracle                                                                            redo size                                                    Redo                  22299860


24.2 Статистика сессии 68, сгенерировавщей redo*

$ tpi mprod sesstat sess 68 redo

Top 60 Session event for SID = 68 and name like "redo%":

   SID SERIAL# USERNAME                  OSUSER               MODULE                                             NAME                                                                   CLASS                    VALUE
------ ------- ------------------------- -------------------- -------------------------------------------------- ---------------------------------------------------------------------- ---------- -------------------
    68   44271 AUDM                      oracle               AUD_MGR                                            redo size                                                              Redo                   6681604
    68   44271 AUDM                      oracle               AUD_MGR                                            redo entries                                                           Redo                      6597



25. sysstat - Системная статистика, с момента старта БД
$ tpi  mprod sysstat

STARTUP_TIME      UPTIME_DAYS UPTIME_HOURS UPTIME_MIN UPTIME_SEC
----------------- ----------- ------------ ---------- ----------
30/09/25 11:49:36       14.31       343.39      20603    1236205

"v$sysstat for name like "

STATISTIC# NAME                                                              CLASS                         VALUE            VALUE_PER_DAY           VALUE_PER_HOUR            VALUE_PER_MIN            VALUE_PER_SEC
---------- ----------------------------------------------------------------- ---------- ------------------------ ------------------------ ------------------------ ------------------------ ------------------------
       171 logical read bytes from cache                                     Cache            11,962,676,879,360          836,087,285,181           34,836,970,216              580,616,170                9,676,936
        34 session uga memory max                                            User                626,668,297,600           43,798,674,906            1,824,944,788               30,415,746                  506,929
        33 session uga memory                                                User                521,349,161,904           36,437,781,427            1,518,240,893               25,304,015                  421,734
        67 cell physical IO interconnect bytes                               SQL                 487,265,183,285           34,055,607,149            1,418,983,631               23,649,727                  394,162
        57 physical read total bytes                                         Cache               386,966,248,448           27,045,582,137            1,126,899,256               18,781,654                  313,028
        66 physical write total bytes                                        Cache               100,298,934,837            7,010,025,012              292,084,375                4,868,073                   81,135
       190 physical write bytes                                              Cache                21,539,799,040            1,505,445,001               62,726,875                1,045,448                   17,424
       313 redo size                                                         Redo                 13,242,649,324              925,546,250               38,564,427                  642,740                   10,712
      1010 table scan rows gotten                                            SQL                   9,630,742,998              673,105,347               28,046,056                  467,434                    7,791
      1013 table scan disk non-IMC rows gotten                               SQL                   9,621,876,370              672,485,646               28,020,235                  467,004                    7,783
        30 in call idle wait time                                            User                  8,893,952,050              621,610,054               25,900,419                  431,674                    7,195


25.1 sysstat - Системная статистика по конкретной статистике: "redo size"

$ tpi mprod sysstat redo size

STARTUP_TIME      UPTIME_DAYS UPTIME_HOURS UPTIME_MIN UPTIME_SEC
----------------- ----------- ------------ ---------- ----------
30/09/25 11:49:36       14.31       343.41      20605    1236278

"v$sysstat for name like redo size"

STATISTIC# NAME                                                              CLASS                         VALUE            VALUE_PER_DAY           VALUE_PER_HOUR            VALUE_PER_MIN            VALUE_PER_SEC
---------- ----------------------------------------------------------------- ---------- ------------------------ ------------------------ ------------------------ ------------------------ ------------------------
       313 redo size                                                         Redo                 13,242,786,592              925,501,191               38,562,550                  642,709                   10,712
       316 redo size for direct writes                                       Redo                    364,846,020               25,498,064                1,062,419                   17,707                      295
       315 redo size for lost write detection                                Redo                              0                        0                        0                        0                        0



26. segstat - Статистика по сегментам
$ tpi mprod segstat

top row lock waits:

OWNER                          OBJECT_NAME                         OBJECT_TYPE          STATISTIC_NAME                      VALUE
------------------------------ ----------------------------------- -------------------- ------------------------- ---------------
AUD                            IDX_IBS_DIARY5_AUDSID               INDEX PARTITION      row lock waits                          5
IBS                            Z#IX_Z#MAIN_DOCUM_COL97             INDEX                row lock waits                          2
SYS                            COL_USAGE$                          TABLE                row lock waits                          1
IBS                            METHODS                             TABLE                row lock waits                          1
SYS                            MON_MODS_ALL$                       TABLE                row lock waits                          1
SYS                            OBJ$                                TABLE                row lock waits                          0
SYS                            I_OBJ#                              INDEX                row lock waits                          0
SYS                            I_UNDO1                             INDEX                row lock waits                          0
SYS                            I_COBJ#                             INDEX                row lock waits                          0
SYS                            I_USER#                             INDEX                row lock waits                          0
SYS                            I_CDEF1                             INDEX                row lock waits                          0
SYS                            I_FILE2                             INDEX                row lock waits                          0
SYS                            I_TS#                               INDEX                row lock waits                          0
SYS                            I_ICOL1                             INDEX                row lock waits                          0
SYS                            CON$                                TABLE                row lock waits                          0
SYS                            TS$                                 TABLE                row lock waits                          0
SYS                            CDEF$                               TABLE                row lock waits                          0
SYS                            I_CDEF4                             INDEX                row lock waits                          0
SYS                            I_COL2                              INDEX                row lock waits                          0
SYS                            I_CDEF2                             INDEX                row lock waits                          0
Elapsed: 00:00:00.24

top buffer busy waits:

OWNER                          OBJECT_NAME                         OBJECT_TYPE          STATISTIC_NAME                      VALUE
------------------------------ ----------------------------------- -------------------- ------------------------- ---------------
SYS                            SEG$                                TABLE                buffer busy waits                     719
IBS                            SOURCES                             TABLE                buffer busy waits                     418
IBS                            PK_DICT_CHANGES                     INDEX                buffer busy waits                      45
IBS                            IDX_DICT_CHANGES_MDATE              INDEX                buffer busy waits                      43
AUDSYS                         AUD$UNIFIED                         TABLE PARTITION      buffer busy waits                      42
SYS                            COL_USAGE$                          TABLE                buffer busy waits                      34
IBS                            IDX_SOURCES_NAME                    INDEX                buffer busy waits                      30
IBS                            PK_RTL_USERS_ID                     INDEX                buffer busy waits                      27
SYS                            ACCESS$                             TABLE                buffer busy waits                      24
IBS                            IDE_RESOURCE_HASH                   TABLE                buffer busy waits                      24
IBS                            METHODS                             TABLE                buffer busy waits                      24
SYS                            MON_MODS_ALL$                       TABLE                buffer busy waits                      18
IBS                            SYS_LOB0000067963C00004$$           LOB                  buffer busy waits                      18
SYS                            I_SETTINGS1                         INDEX                buffer busy waits                      12
IBS                            HOST2PLP                            TABLE                buffer busy waits                      11
AUD                            IDX_IBS_DIARY5_AUDSID               INDEX PARTITION      buffer busy waits                      10
SYS                            SCHEDULER$_JOB                      TABLE                buffer busy waits                       9
SYS                            I_COL3                              INDEX                buffer busy waits                       8
IBS                            IDX_DEPENDENCIES_REFCING            INDEX                buffer busy waits                       8
SYS                            I_AUD_TIMESTAMP                     INDEX                buffer busy waits                       8
Elapsed: 00:00:00.16

top logical reads:

OWNER                          OBJECT_NAME                         OBJECT_TYPE          STATISTIC_NAME                      VALUE
------------------------------ ----------------------------------- -------------------- ------------------------- ---------------
IBS                            IDX_Z#VAL_TUNING_COLL_CODE          INDEX                logical reads                   205365184
IBS                            Z#GR_TUNINGS                        TABLE                logical reads                   160930704
IBS                            Z#VAL_TUNING                        TABLE                logical reads                    64577568
SYS                            SCHEDULER$_EVENT_LOG                TABLE                logical reads                    58599344
SYS                            I_SCHEDULER_JOB_RUN_DETAILS         INDEX                logical reads                    53484944
SYS                            OBJ$                                TABLE                logical reads                    28794992
IBS                            PK_Z#VAL_TUNING_ID                  INDEX                logical reads                    26556432
SYS                            IND$                                TABLE                logical reads                    22972048
SYS                            EXP_STAT$                           TABLE                logical reads                    11014832
IBS                            PK_Z#AC_FIN_ID                      INDEX                logical reads                    10339728
IBS                            Z#TYPE_DOC_RC                       TABLE                logical reads                     9861040
IBS                            Z#MAIN_DOCUM                        TABLE                logical reads                     9567968
SYS                            OPTSTAT_HIST_CONTROL$               TABLE                logical reads                     8885984
IBS                            Z#BRANCH                            TABLE                logical reads                     7548336
SYS                            I_OBJ1                              INDEX                logical reads                     6475376
IBS                            Z#RECORDS                           TABLE                logical reads                     6228000
IBS                            Z#USER                              TABLE                logical reads                     6204912
SYS                            WRI$_ADV_OBJECTS_IDX_02             INDEX                logical reads                     6013184
IBS                            PK_CLASSES_ID                       INDEX                logical reads                     5973280
SYS                            SCHEDULER$_JOB_RUN_DETAILS          TABLE                logical reads                     5919712
Elapsed: 00:00:00.16

top physical reads\writes:

OWNER                          OBJECT_NAME                         OBJECT_TYPE          STATISTIC_NAME                      VALUE
------------------------------ ----------------------------------- -------------------- ------------------------- ---------------
SYS                            I_OPTSTAT_SNAPSHOT$                 INDEX                physical writes                     68671
SYS                            WRI$_ADV_OBJECTS                    TABLE                physical reads direct               38657
SYS                            EXP_STAT$                           TABLE                physical writes                     34146
SYS                            WRI$_ADV_OBJECTS_IDX_01             INDEX                physical writes                     17904
SYS                            I_WRI$_OPTSTAT_HH_OBJ_ICOL_ST       INDEX                physical writes                     15906
SYS                            SCHEDULER$_JOB_RUN_DETAILS          TABLE                physical writes                     14877
SYS                            SCHEDULER$_EVENT_LOG                TABLE                physical writes                     13291
AUD                            IBS_DIARY5                          TABLE PARTITION      physical writes                     11950
AUD                            IDX_IBS_DIARY5_AUDSID               INDEX PARTITION      physical writes                     11863
SYS                            COL_USAGE$                          TABLE                physical writes                     11222
SYS                            SMON_SCN_TIME                       TABLE                physical writes                     11098
SYS                            OBJ$                                TABLE                physical writes                      9600
SYS                            SCHEDULER$_JOB                      TABLE                physical writes                      8675
IBS                            PK_FRM_LOCKS_OBJ_ID                 INDEX                physical writes                      8094
IBS                            FRM_LOCKS                           TABLE                physical writes                      7776
IBS                            RTL_USERS                           TABLE                physical writes                      7112
SYS                            EXP_OBJ$                            TABLE                physical writes                      6965
SYS                            WRH$_SQL_PLAN                       TABLE                physical writes                      6324
SYS                            IDL_UB1$                            TABLE                physical reads                       6285
SYS                            WRH$_SEG_STAT_OBJ                   TABLE                physical writes                      6005
Elapsed: 00:00:00.21

top space allocated:

OWNER                          OBJECT_NAME                         OBJECT_TYPE          STATISTIC_NAME                      VALUE
------------------------------ ----------------------------------- -------------------- ------------------------- ---------------
AUD                            IBS_DIARY5                          TABLE PARTITION      space allocated                  16777216
AUD                            IBS_OSH                             TABLE PARTITION      space allocated                  10485760
AUD                            IBS_DIARY7                          TABLE PARTITION      space allocated                  10485760
AUD                            IBS_DIARY6                          TABLE PARTITION      space allocated                  10485760
AUD                            IBS_DIARY2                          TABLE PARTITION      space allocated                  10485760
AUD                            IBS_DIARY1                          TABLE PARTITION      space allocated                  10485760
AUD                            IBS_VALSH                           TABLE PARTITION      space allocated                  10485760
AUD                            IBS_OSH                             TABLE PARTITION      space allocated                  10485760
AUD                            IBS_OCH                             TABLE PARTITION      space allocated                  10485760
AUD                            IBS_DIARY6                          TABLE PARTITION      space allocated                  10485760
AUD                            IBS_DIARY1                          TABLE PARTITION      space allocated                  10485760
AUD                            IBS_DIARY7                          TABLE PARTITION      space allocated                  10485760
AUD                            IBS_DP                              TABLE PARTITION      space allocated                  10485760
AUD                            IBS_VALSH                           TABLE PARTITION      space allocated                  10485760
SYS                            SOURCE$                             TABLE                space allocated                   8388608
SYS                            WRI$_OPTSTAT_HISTGRM_HISTORY        TABLE PARTITION      space allocated                   6291456
IBS                            IDX_Z#MST_IMPORT_IVT                INDEX                space allocated                   6291456
AUD                            IDX_IBS_DP_DIARY_ID                 INDEX PARTITION      space allocated                   5242880
AUD                            IDX_IBS_OSH_OBJ_ID                  INDEX PARTITION      space allocated                   5242880
AUD                            IDX_IBS_OCH_OBJ_ID                  INDEX PARTITION      space allocated                   5242880
Elapsed: 00:00:00.16

top ITL waits:

OWNER                          OBJECT_NAME                         OBJECT_TYPE          STATISTIC_NAME                      VALUE
------------------------------ ----------------------------------- -------------------- ------------------------- ---------------
SYS                            OBJ$                                TABLE                ITL waits                               0
SYS                            SEG$                                TABLE                ITL waits                               0
SYS                            I_OBJ3                              INDEX                ITL waits                               0
SYS                            I_OBJ2                              INDEX                ITL waits                               0
SYS                            FILE$                               TABLE                ITL waits                               0
SYS                            I_CCOL1                             INDEX                ITL waits                               0
SYS                            I_OBJ#                              INDEX                ITL waits                               0
SYS                            IND$                                TABLE                ITL waits                               0
SYS                            I_UNDO1                             INDEX                ITL waits                               0
SYS                            I_COBJ#                             INDEX                ITL waits                               0
SYS                            I_USER#                             INDEX                ITL waits                               0
SYS                            I_CDEF1                             INDEX                ITL waits                               0
SYS                            I_FILE2                             INDEX                ITL waits                               0
SYS                            I_TS#                               INDEX                ITL waits                               0
SYS                            I_ICOL1                             INDEX                ITL waits                               0
SYS                            CON$                                TABLE                ITL waits                               0
SYS                            TS$                                 TABLE                ITL waits                               0
SYS                            CDEF$                               TABLE                ITL waits                               0
SYS                            I_CDEF4                             INDEX                ITL waits                               0
SYS                            I_COL2                              INDEX                ITL waits                               0



27. o - информация по объекту, можно указать имя объекта, ID объекта, можно маску "TABL%"

$ tpi mprod o Z#AC_FIN

Objects from dba_objects where object_name like upper('z#AC_FIN') and owner like upper(nvl('','%')):
 OBJECT_ID OWNER                          OBJECT_NAME                    OBJECT_TYPE          CREATED           LAST_DDL_TIME     STATUS
---------- ------------------------------ ------------------------------ -------------------- ----------------- ----------------- -------
     65169 IBS                            Z#AC_FIN                       TABLE                30/01/25 22:56:18 04/02/25 16:54:54 VALID



$ tpi mprod o 65169
DB=mprod 14/10/25-19:17:23 ver=13.10.25  o OBJECT_NAME | OBJECT_ID | invalid [OWNER] | ddl [last N hours] | depend REFERENCED_OBJ_NAME | depend last_analyzed HH OBJ_NAME - Show what REFERENCED_OBJ_NAME was last analyzed in depended OBJ_NAME - dba_objects information , ALL  =  65169

Objects from dba_objects where object_id = '65169':
 OBJECT_ID OWNER                          OBJECT_NAME                    OBJECT_TYPE          CREATED           LAST_DDL_TIME     STATUS
---------- ------------------------------ ------------------------------ -------------------- ----------------- ----------------- -------
     65169 IBS                            Z#AC_FIN                       TABLE                30/01/25 22:56:18 04/02/25 16:54:54 VALID


27.1 Невалидные объекты БД, с генерацией скрипта по компиляции:

$ tpi mprod o invalid IBS

Invalid dba_objects for owner like nvl(upper('IBS'),'%') :
OWNER                            COUNT(*)
------------------------------ ----------
IBS                                  2514
                               ----------
SUM                                  2514


Invalid dba_objects for owner like nvl(upper('IBS'),'%') :
OWNER                          OBJECT_NAME                    OBJECT_TYPE               STATUS
------------------------------ ------------------------------ ------------------------- --------------------
IBS                            ORSAUTILS                      JAVA SOURCE               INVALID
IBS                            ORSAUTILS                      PACKAGE                   INVALID
IBS                            PR$AR04                        PACKAGE                   INVALID
IBS                            Z#PLP_DIAG_INFO#INTERFACE      PACKAGE                   INVALID
IBS                            Z#SESSION_CTX#INTERFACE        PACKAGE                   INVALID
IBS                            Z$ACCREDITIV_INT_PRX_FINORD    PACKAGE                   INVALID
IBS                            Z$BANKS_LOANS_INT_PR1589881966 PACKAGE                   INVALID
IBS                            Z$DECLAR_INTERFACE_P1589885285 PACKAGE                   INVALID
IBS                            Z$DEPN_INTERFACE_PRX_FIN_ORDER PACKAGE                   INVALID


recompile commands for invalid objects owner like nvl(upper('IBS'),'%') :
CMD
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
alter PACKAGE "IBS"."Z#STRING_REC#INTERFACE" COMPILE BODY;
alter PACKAGE "IBS"."Z#PROLONG_DOCS#INTERFACE" COMPILE BODY;
alter PACKAGE "IBS"."Z#SPIS_USER_DIR_OT#INTERFACE" COMPILE BODY;
alter PACKAGE "IBS"."Z#PRS_CONN_DOCS#INTERFACE" COMPILE BODY;
alter PACKAGE "IBS"."Z#PRS_GRAF_NOWORK#INTERFACE" COMPILE BODY;
alter PACKAGE "IBS"."Z#PRS_SPIS_SEND#INTERFACE" COMPILE BODY;
alter PACKAGE "IBS"."Z$U$26224174" COMPILE BODY;
alter PACKAGE "IBS"."Z$U$26490687" COMPILE BODY;
alter PACKAGE "IBS"."Z#DB_KT_CLIENT#INTERFACE" COMPILE BODY;
alter PACKAGE "IBS"."Z$KFM_STORAGE_FILL_STORAGE" COMPILE BODY;
alter PACKAGE "IBS"."Z#ADD_CONTR#INTERFACE" COMPILE BODY;
alter PACKAGE "IBS"."Z#QUOT_TIMED#INTERFACE" COMPILE BODY;
alter PACKAGE "IBS"."Z$RKO_FOR_DELETE" COMPILE BODY;
alter PACKAGE "IBS"."Z#RATING_LIST#INTERFACE" COMPILE BODY;
alter PACKAGE "IBS"."Z$VZ_CLIENT_SYNCHRONIZING_GR" COMPILE BODY;
alter PACKAGE "IBS"."Z#REQ_HISTORY#INTERFACE" COMPILE BODY;

27.2 Объекты, которые изменялись за последние 5 часов:
$ tpi mprod o ddl 5

Last  dba_objects where last_ddl_time > sysdate-(5/24):
OWNER                          OBJECT_NAME                    SUBOBJECT_NAME                  OBJECT_ID DATA_OBJECT_ID OBJECT_TYPE          CREATED              LAST_DDL_TIME        STATUS   TE
------------------------------ ------------------------------ ------------------------------ ---------- -------------- -------------------- -------------------- -------------------- -------- --
IBS                            Z$MST_IMPORT_STR_MST1608357196                                    187608                PACKAGE BODY         16/09/25 16:06:41    14/10/25 17:21:11    VALID    N
SYS                            WRH$_CON_SYSTEM_EVENT                                              11778                TABLE                22/12/24 06:27:49    14/10/25 18:56:35    VALID    N
SYS                            WRH$_CON_SYSSTAT                                                   11890                TABLE                22/12/24 06:27:50    14/10/25 18:56:35    VALID    N

27.3 ОБъекты, зависимые от объекта "Z#AC_FIN"

$ tpi mprod o depend Z#AC_FIN

OWNER                          NAME                           TYPE            REFERENCED_OWNER               REFERENCED_NAME                REFERENCED_TYPE REFERENCED_LIN DEPENDENCY_TYPE
------------------------------ ------------------------------ --------------- ------------------------------ ------------------------------ --------------- -------------- ------------------------------
IBS                            VW_CRIT_BLOANS_ALL_TAKING      VIEW            IBS                            Z#AC_FIN                       TABLE                          HARD
IBS                            VW_CRIT_BLOANS_NO_CONFIRM      VIEW            IBS                            Z#AC_FIN                       TABLE                          HARD
IBS                            VW_CRIT_BLOANS_NO_WORK         VIEW            IBS                            Z#AC_FIN                       TABLE                          HARD
IBS                            VW_CRIT_BLOANS_SWIFT_CONFIRM   VIEW            IBS                            Z#AC_FIN                       TABLE                          HARD
IBS                            VW_CRIT_CERT_RICHES            VIEW            IBS                            Z#AC_FIN                       TABLE                          HARD
IBS                            VW_CRIT_GSM_SUP_REC            VIEW            IBS                            Z#AC_FIN                       TABLE                          HARD
IBS                            VW_CRIT_DEALS_ACCS             VIEW            IBS                            Z#AC_FIN                       TABLE                          HARD
IBS                            VW_CRIT_DEBT_DOG               VIEW            IBS                            Z#AC_FIN                       TABLE                          HARD


27.4 Показать, какие объекты были проанализированы от чего, зависимый объект OBJ_NAME='Z$MST_IMPORT_STR_MST1608357196' мог инвалидироваться за последние 24 часа
$ tpi mprod o depend last_analyzed 24 Z\$MST_IMPORT_STR_MST1608357196 
(спецсимвол "$" - надо экранировать "\$")

DB=mprod 14/10/25-19:30:14 ver=13.10.25  o OBJECT_NAME | OBJECT_ID | invalid [OWNER] | ddl [last N hours] | depend REFERENCED_OBJ_NAME | depend last_analyzed HH OBJ_NAME - Show what REFERENCED_OBJ_NAME was last analyzed in depended OBJ_NAME - dba_objects information , ALL  =  depend last_analyzed 24 Z$MST_IMPORT_STR_MST1608357196
"DBA_DEPENDENCIES where name=upper('Z$MST_IMPORT_STR_MST1608357196') and owner like nvl(upper(''),'%') and (REFERENCED_OWNER, REFERENCED_NAME) in (select owner, table_name from dba_tables where last_analyzed > sysdate - interval '24' hour);"

OWNER                          NAME                           TYPE            REFERENCED_OWNER               REFERENCED_NAME                REFERENCED_TYPE REFERENCED_LIN DEPENDENCY_TYPE
------------------------------ ------------------------------ --------------- ------------------------------ ------------------------------ --------------- -------------- ------------------------------
IBS                            Z$MST_IMPORT_STR_MST1608357196 PACKAGE BODY    IBS                            Z#MAIN_DOCUM                   TABLE                          HARD
IBS                            Z$MST_IMPORT_STR_MST1608357196 PACKAGE BODY    IBS                            Z#CLIENT                       TABLE                          HARD


28. s - информация по сегменту, можно указать имя сегмента, можно маску "TABL%", также выдается информация по партициям, если есть, а также по LOB сегментам, если есть.

$ tpi mprod s Z#MST_REPORT
"DBA_SEGMENTS:"

TABLESPACE_NAME        OWNER                SEGMENT_NAME                   PARTITION_NAME                 SEGMENT_TYPE    SEGMENT_SUBTYPE  NEXT_EXTENT    SIZE_MB     BLOCKS         MAX_SIZE
---------------------- -------------------- ------------------------------ ------------------------------ --------------- --------------- ------------ ---------- ---------- ----------------
T_USR                  IBS                  Z#MST_REPORT                                                  TABLE           ASSM                  65,536       .125         16    2,147,483,645
                                                                                                                                                       ----------
SUM                                                                                                                                                          .125
"DBA_LOBS:"

TABLESPACE_NAME        OWNER                SEGMENT_NAME                   TABLE_NAME                     COLUMN_NAME                    PAR COMPRE
---------------------- -------------------- ------------------------------ ------------------------------ ------------------------------ --- ------
T_USR                  IBS                  SYS_LOB0000204136C00010$$      Z#MST_REPORT                   C_MST_BODY                     NO  NO
T_USR                  IBS                  SYS_LOB0000204136C00011$$      Z#MST_REPORT                   C_MST_ART                      NO  NO
"DBA_SEGMENTS, DBA_LOBS:"

TABLESPACE_NAME        OWNER                SEGMENT_NAME                   PARTITION_NAME                 TABLE_NAME                     COLUMN_NAME                    INDEX_NAME                SEGMENT_TYPE    SEGMENT_SUBTYPE    SIZE_MB
---------------------- -------------------- ------------------------------ ------------------------------ ------------------------------ ------------------------------ ------------------------- --------------- --------------- ----------
T_USR                  IBS                  SYS_LOB0000204136C00010$$                                     Z#MST_REPORT                   C_MST_BODY                     SYS_IL0000204136C00010$$  LOBSEGMENT      SECUREFILE          1.1875
T_USR                  IBS                  SYS_LOB0000204136C00011$$                                     Z#MST_REPORT                   C_MST_ART                      SYS_IL0000204136C00011$$  LOBSEGMENT      SECUREFILE          1.1875
                                                                                                                                                                                                                                  ----------
SUM                                                                                                                                                                                                                                    2.375


29. e - информация по экстентам:

$ tpi mprod e Z#MST_REPORT

Extents from dba_extents where ExtentName = Z#MST_REPORT
OWNER                          TABLESPACE_NAME                BLOCK_SIZE FILE_NAME                                                    SEGMENT_NAME         SEGMENT_TYPE            CNT
------------------------------ ------------------------------ ---------- ------------------------------------------------------------ -------------------- -------------------- ------
IBS                            T_USR                                8192 /app/oracle/oradata/mprod/t_usr02.dbf                        Z#MST_REPORT         TABLE                     2


30. t - Информация по таблице, индексы, проиндексированные колонки, статистика по колонкам

$ tpi mprod t Z#MST_REPORT
DB=mprod 14/10/25-19:44:48 ver=14.10.25  t [part] TABLE_NAME [OWNER] | last_analyzed HH [OWNER] | chained [PERCENT] - dba_tables, dba_part_tables, dba_tab_partitions, dba_tab_subpartitions information , PARAMETERS =  Z#MST_REPORT

TABLESPACE_NAME        OWNER                TABLE_NAME                   LOGG CACHE         ROWS AVGRLEN   SIZE_MB    EST_MB   DIFF_MB LAST_ANALYZED     COMPRESS COMPRESS_FOR    PART IOT_TYPE T EXT
---------------------- -------------------- ---------------------------- ---- ------ ----------- ------- --------- --------- --------- ----------------- -------- --------------- ---- -------- - ---
T_USR                  IBS                  Z#MST_REPORT                 YES      N            5     240         0         0         0 19/09/25 07:00:42 DISABLED                 NO            N NO

dba_indexes:

TABLESPACE_NAME        OWNER                INDEX_NAME                        INDEX_TYPE            UNIQUENESS BLEVEL DISTINCT_KEYS STATUS          ROWS LAST_ANALYZED     COMPRESS PART VISIBILITY
---------------------- -------------------- --------------------------------- --------------------- ---------- ------ ------------- -------- ----------- ----------------- -------- ---- ----------
I_USR                  IBS                  PK_Z#MST_REPORT_ID                NORMAL                UNIQUE          0             5 VALID              5 19/09/25 07:00:42 DISABLED NO   VISIBLE
T_USR                  IBS                  SYS_IL0000204136C00010$$          LOB                   UNIQUE                          VALID                                  DISABLED NO   VISIBLE
T_USR                  IBS                  SYS_IL0000204136C00011$$          LOB                   UNIQUE                          VALID                                  DISABLED NO   VISIBLE
I_USR                  IBS                  Z#IX_Z#MST_REPORT_REF8            NORMAL                NONUNIQUE       0             1 VALID              5 19/09/25 07:00:42 DISABLED NO   VISIBLE

dba_ind_columns:

INDEX_OWNER          INDEX_NAME                        COLUMN_NAME                    COLUMN_POSITION COLUMN_LENGTH DESC
-------------------- --------------------------------- ------------------------------ --------------- ------------- ----
IBS                  PK_Z#MST_REPORT_ID                ID                                           1            22 ASC
IBS                  Z#IX_Z#MST_REPORT_REF8            C_MST_STATUS                                 1            22 ASC

dba_tab_cols:

COLUMN_NAME                    TYPE            LENGTH PRECISION SCALE NULL COLID  NUM_DISTINCT      DENSITY     NUM_NULLS LAST_ANALYZED     GLOB_ST AVG_COL_LEN CHAR_LENGTH CHAR HIDD VIRT HISTOGRAM
------------------------------ -------------- ------- --------- ----- ---- ----- ------------- ------------ ------------- ----------------- ------- ----------- ----------- ---- ---- ---- --------------------
ID                             NUMBER              22                 N        1             5   0.20000000             0 19/09/25 07:00:42 YES               7           0      NO   NO   NONE
SN                             NUMBER              22                 Y        2             2   0.50000000             0 19/09/25 07:00:42 YES               3           0      NO   NO   NONE
SU                             NUMBER              22                 Y        3             3   0.33333333             0 19/09/25 07:00:42 YES               5           0      NO   NO   NONE
C_MST_AUTHOR                   VARCHAR2           200                 Y        4             1   1.00000000             0 19/09/25 07:00:42 YES              32         200 B    NO   NO   NONE
C_MST_DATLAST                  DATE                 7                 Y        5             5   0.20000000             0 19/09/25 07:00:42 YES               8           0      NO   NO   NONE
C_MST_CODE                     VARCHAR2           200                 Y        6             5   0.20000000             0 19/09/25 07:00:42 YES              13         200 B    NO   NO   NONE
C_MST_NAME                     VARCHAR2           500                 Y        7             5   0.20000000             0 19/09/25 07:00:42 YES              24         500 B    NO   NO   NONE
C_MST_STATUS                   NUMBER              22                 Y        8             1   0.10000000             0 19/09/25 07:00:42 YES               6           0      NO   NO   FREQUENCY
C_MST_PAR                      VARCHAR2          4000                 Y        9             3   0.33333333             2 19/09/25 07:00:42 YES               6        4000 B    NO   NO   NONE
C_MST_BODY                     CLOB              4000                 Y       10             0   0.00000000             4 19/09/25 07:00:42 YES              28           0      NO   NO   NONE
C_MST_ART                      BLOB              4000                 Y       11             0   0.00000000             1 19/09/25 07:00:42 YES             110           0      NO   NO   NONE


30.1  t part - инфонмация по партицированным таблицам:

$ tpi mprod t part IBS_DIARY1
dba_part_tables:

OWNER                TABLE_NAME                   PARTIT SUBPAR    P_CNT DEF_SUBP_CNT P_KEY_CNT SUBP_KEY_CNT STATUS   DEF_TBS              PCT_FR PCT_US DEF_LO DEF_COMP DEF_COM_ INTERVAL
-------------------- ---------------------------- ------ ------ -------- ------------ --------- ------------ -------- -------------------- ------ ------ ------ -------- -------- ------------------------------
AUD                  IBS_DIARY1                   RANGE  NONE         23            0         1            0 VALID    T_AUD                     0        NONE   NONE

dba_part_key_columns:

OWNER                NAME                           OBJECT_TYPE     COLUMN_NAME                    COLUMN_POSITION
-------------------- ------------------------------ --------------- ------------------------------ ---------------
AUD                  IBS_DIARY1                     TABLE           TIME                                         1

dba_indexes:

dba_ind_columns:

dba_tab_partitions:

TABLE_OWNER          TABLE_NAME                   PARTITION_NAME               HIGH_VALUE                                   PPOS TABLESPACE_NAME        LOGG COMPRESS COMPRESS_FOR           ROWS  BLOCKS LAST_ANALYZED     INTE SCR
-------------------- ---------------------------- ---------------------------- -------------------------------------------- ---- ---------------------- ---- -------- --------------- ----------- ------- ----------------- ---- ----
AUD                  IBS_DIARY1                   P00                          TIMESTAMP' 2024-07-01 00:00:00'                 1 T_AUD                  YES  DISABLED                           0       0 31/01/25 08:00:53 NO   YES
AUD                  IBS_DIARY1                   P24_07                       TIMESTAMP' 2024-08-01 00:00:00'                 2 T_AUD                  YES  DISABLED                           0       0 31/01/25 08:00:53 NO   YES
AUD                  IBS_DIARY1                   P24_08                       TIMESTAMP' 2024-09-01 00:00:00'                 3 T_AUD                  YES  DISABLED                           0       0 31/01/25 08:00:53 NO   YES
AUD                  IBS_DIARY1                   P24_09                       TIMESTAMP' 2024-10-01 00:00:00'                 4 T_AUD                  YES  DISABLED                           0       0 31/01/25 08:00:53 NO   YES
AUD                  IBS_DIARY1                   P24_10                       TIMESTAMP' 2024-11-01 00:00:00'                 5 T_AUD                  YES  DISABLED                           0       0 31/01/25 08:00:53 NO   YES
AUD                  IBS_DIARY1                   P24_11                       TIMESTAMP' 2024-12-01 00:00:00'                 6 T_AUD                  YES  DISABLED                           0       0 31/01/25 08:00:53 NO   YES
AUD                  IBS_DIARY1                   P24_12                       TIMESTAMP' 2025-01-01 00:00:00'                 7 T_AUD                  YES  DISABLED                           0       0 31/01/25 08:00:53 NO   YES
AUD                  IBS_DIARY1                   P25_01                       TIMESTAMP' 2025-02-01 00:00:00'                 8 T_AUD                  YES  DISABLED                           0       0 31/01/25 08:00:53 NO   YES
AUD                  IBS_DIARY1                   P25_02                       TIMESTAMP' 2025-03-01 00:00:00'                 9 T_AUD                  YES  DISABLED                         422    1006 19/02/25 08:00:23 NO   YES
AUD                  IBS_DIARY1                   P25_03                       TIMESTAMP' 2025-04-01 00:00:00'                10 T_AUD                  YES  DISABLED                         473    1006 28/03/25 07:00:23 NO   YES
AUD                  IBS_DIARY1                   P25_04                       TIMESTAMP' 2025-05-01 00:00:00'                11 T_AUD                  YES  DISABLED                        1540    1006 04/04/25 07:00:30 NO   YES
AUD                  IBS_DIARY1                   P25_05                       TIMESTAMP' 2025-06-01 00:00:00'                12 T_AUD                  YES  DISABLED                         148    1006 23/05/25 07:00:25 NO   YES
AUD                  IBS_DIARY1                   P25_06                       TIMESTAMP' 2025-07-01 00:00:00'                13 T_AUD                  YES  DISABLED                           9    1006 01/07/25 07:00:17 NO   YES
AUD                  IBS_DIARY1                   P25_07                       TIMESTAMP' 2025-08-01 00:00:00'                14 T_AUD                  YES  DISABLED                         307    1006 01/08/25 07:00:32 NO   YES
AUD                  IBS_DIARY1                   P25_08                       TIMESTAMP' 2025-09-01 00:00:00'                15 T_AUD                  YES  DISABLED                        1177    1006 30/08/25 19:04:24 NO   YES
AUD                  IBS_DIARY1                   P25_09                       TIMESTAMP' 2025-10-01 00:00:00'                16 T_AUD                  YES  DISABLED                      506410    4282 16/09/25 07:01:34 NO   YES
AUD                  IBS_DIARY1                   P25_10                       TIMESTAMP' 2025-11-01 00:00:00'                17 T_AUD                  YES  DISABLED                        9427    1006 11/10/25 07:06:47 NO   YES
AUD                  IBS_DIARY1                   P25_11                       TIMESTAMP' 2025-12-01 00:00:00'                18 T_AUD                  YES  DISABLED                           0       0 03/06/25 07:00:19 NO   YES
AUD                  IBS_DIARY1                   P25_12                       TIMESTAMP' 2026-01-01 00:00:00'                19 T_AUD                  YES  DISABLED                           0       0 03/07/25 07:00:21 NO   YES
AUD                  IBS_DIARY1                   P26_01                       TIMESTAMP' 2026-02-01 00:00:00'                20 T_AUD                  YES  DISABLED                           0       0 02/08/25 15:00:12 NO   YES
AUD                  IBS_DIARY1                   P26_02                       TIMESTAMP' 2026-03-01 00:00:00'                21 T_AUD                  YES  DISABLED                           0       0 03/09/25 07:00:36 NO   YES
AUD                  IBS_DIARY1                   P26_03                       TIMESTAMP' 2026-04-01 00:00:00'                22 T_AUD                  YES  DISABLED                           0       0 03/10/25 07:04:12 NO   YES
AUD                  IBS_DIARY1                   P99                          MAXVALUE                                       23 T_AUD                  YES  DISABLED                           0       0 03/10/25 07:04:12 NO   YES



30.2 t last_analyzed HH [OWNER]  - таблицы по которым собиралась статистика последние HH часов.

$ tpi mprod t last_analyzed 24 IBS

Last analyzed tables where owner like nvl('IBS','%') and last_analyzed > sysdate - interval '24' hour:

TABLESPACE_NAME        OWNER                TABLE_NAME                   LOGG CACHE         ROWS AVGRLEN   SIZE_MB    EST_MB   DIFF_MB LAST_ANALYZED     COMPRESS COMPRESS_FOR    PART IOT_TYPE T EXT
---------------------- -------------------- ---------------------------- ---- ------ ----------- ------- --------- --------- --------- ----------------- -------- --------------- ---- -------- - ---
T_DICT                 IBS                  DEPLOYMENT_SUPPLY            YES      N            0       0         0         0         0 14/10/25 07:01:06 DISABLED                 NO            N NO
T_DICT                 IBS                  FRM_LOCKS                    NO       N            0       0         0         0         0 14/10/25 07:01:06 DISABLED                 NO            N NO
T_DICT                 IBS                  MODEL_LOCKS                  YES      N           13      93         0         0         0 14/10/25 07:00:05 DISABLED                 NO            N NO
T_DICT                 IBS                  RTL_USERS                    NO       N            4      99         0         0         0 14/10/25 07:00:04 DISABLED                 NO            N NO
T_DICT                 IBS                  SYSINFO_VARIABLES            YES      N            3     133         0         0         0 14/10/25 07:00:05 DISABLED                 NO            N NO
T_DICT                 IBS                  SYSTEM_OPTIONS               YES      N          320     780         0         0         0 14/10/25 07:00:06 DISABLED                 NO            N NO
T_USR                  IBS                  Z#CLIENT                     YES      N       126462     354        52        43         9 14/10/25 07:01:04 DISABLED                 NO            N NO
T_USR                  IBS                  Z#KFM_ACTION_LOG             YES      N          272      65         0         0         0 14/10/25 07:00:18 DISABLED                 NO            N NO
T_USR                  IBS                  Z#MAIN_DOCUM                 YES      N        43332     405        23        17         6 14/10/25 07:01:06 DISABLED                 NO            N NO
T_USR                  IBS                  Z#MST_COMMENT                YES      N            4      41         0         0         0 14/10/25 07:00:02 DISABLED                 NO            N NO
T_USR                  IBS                  Z#SYSTEM                     YES      N            1      50         0         0         0 14/10/25 07:00:05 DISABLED                 NO            N NO
T_USR                  IBS                  Z#SYSTEM_JOBS                YES      Y          830     140         0         0         0 14/10/25 07:00:05 DISABLED                 NO            N NO

30.3 t chained [PERCENT] - статистика по chained rows таблиц более PERCENT 

$ tpi mprod t chained 2

STARTUP_TIME      UPTIME_DAYS UPTIME_HOURS UPTIME_MIN UPTIME_SEC
----------------- ----------- ------------ ---------- ----------
30/09/25 11:49:36       14.52       348.55      20913    1254770

"v$sysstat for name like %continued%"

STATISTIC# NAME                                                              CLASS                         VALUE            VALUE_PER_DAY           VALUE_PER_HOUR            VALUE_PER_MIN            VALUE_PER_SEC
---------- ----------------------------------------------------------------- ---------- ------------------------ ------------------------ ------------------------ ------------------------ ------------------------
      1017 table fetch continued row                                         SQL                       2,214,659                  152,495                    6,354                      106                        2


31. i [part] INDEX_NAME [OWNER] - данные по индексу. Выражения для функциональных индексов. Если есть unusable, то сгенерится скрипт по ребилду индексов

$ tpi mprod i IDX_Z#CLIENT_INN

dba_indexes for index_name like IDX_Z#CLIENT_INN and owner like nvl('','%')

TABLESPACE_NAME TABLE_NAME                        OWNER                INDEX_NAME                        INDEX_TYPE      UNIQUENESS DISTINCT_KEYS STATUS        NUM_ROWS LAST_ANALYZED     COMPRESSION  PART DE VISIBILIT
--------------- --------------------------------- -------------------- --------------------------------- --------------- ---------- ------------- ---------- ----------- ----------------- ------------ ---- -- ---------
I_USR           Z#CLIENT                          IBS                  IDX_Z#CLIENT_INN                  NORMAL          NONUNIQUE            219 VALID              231 14/10/25 07:01:05 DISABLED     NO   1  VISIBLE

dba_ind_expressions for index_name like IDX_Z#CLIENT_INN and owner like nvl('','%')

recompile cmd for  index_name like IDX_Z#CLIENT_INN and owner like nvl('','%')



31.1. Информация по партицированным индексам,:

$ tpi mprod i part IDX_IBS_DIARY4_TCODE

dba_indexes:

TABLESPACE_NAME        OWNER                INDEX_NAME                        INDEX_TYPE            UNIQUENESS BLEVEL DISTINCT_KEYS STATUS          ROWS LAST_ANALYZED     COMPRESS PART VISIBILITY
---------------------- -------------------- --------------------------------- --------------------- ---------- ------ ------------- -------- ----------- ----------------- -------- ---- ----------
                       AUD                  IDX_IBS_DIARY4_TCODE              NORMAL                NONUNIQUE       1          6841 N/A            18491 09/10/25 07:00:30 DISABLED YES  VISIBLE

dba_part_key_columns:

OWNER                NAME                           OBJEC COLUMN_NAME                    COLUMN_POSITION
-------------------- ------------------------------ ----- ------------------------------ ---------------
AUD                  IDX_IBS_DIARY4_TCODE           INDEX TIME                                         1

dba_ind_columns:

INDEX_OWNER          INDEX_NAME                        COLUMN_NAME                    COLUMN_POSITION COLUMN_LENGTH DESC
-------------------- --------------------------------- ------------------------------ --------------- ------------- ----
AUD                  IDX_IBS_DIARY4_TCODE              TOPIC                                        1             1 ASC
AUD                  IDX_IBS_DIARY4_TCODE              CODE                                         2            30 ASC

dba_part_indexes:

OWNER                INDEX_NAME                        TABLE_NAME                     PARTIT SUBPAR    P_CNT P_KEY_CNT SUBP_KEY_CNT DEF_TBS              PCT_FR
-------------------- --------------------------------- ------------------------------ ------ ------ -------- --------- ------------ -------------------- ------
AUD                  IDX_IBS_DIARY4_TCODE              IBS_DIARY4                     RANGE  NONE          9         1            0 I_AUD                     0

dba_ind_partitions:

INDEX_OWNER          INDEX_NAME                     PARTITION_NAME                 HIGH_VALUE                       PPOS STATUS   TABLESPACE_NAME      PFRE COMPRESS BLEV   LEAF_B  DIS_KEYS       ROWS LAST_ANALYZED       GLS INTE SCR
-------------------- ------------------------------ ------------------------------ ------------------------------- ----- -------- -------------------- ---- -------- ---- -------- --------- ---------- ------------------- --- ---- ----
AUD                  IDX_IBS_DIARY4_TCODE           P00                            TIMESTAMP' 2024-07-01 00:00:00'     1 USABLE   I_AUD                   0 DISABLED    0        0         0          0 31/01/25 08:00:53   YES NO   YES
AUD                  IDX_IBS_DIARY4_TCODE           P24_C                          TIMESTAMP' 2024-10-01 00:00:00'     2 USABLE   I_AUD                   0 DISABLED    0        0         0          0 31/01/25 08:00:53   YES NO   YES
AUD                  IDX_IBS_DIARY4_TCODE           P24_D                          TIMESTAMP' 2025-01-01 00:00:00'     3 USABLE   I_AUD                   0 DISABLED    0        0         0          0 31/01/25 08:00:53   YES NO   YES
AUD                  IDX_IBS_DIARY4_TCODE           P25_A                          TIMESTAMP' 2025-04-01 00:00:00'     4 USABLE   I_AUD                   0 DISABLED    1       32      6222       7505 18/03/25 07:00:18   YES NO   YES
AUD                  IDX_IBS_DIARY4_TCODE           P25_B                          TIMESTAMP' 2025-07-01 00:00:00'     5 USABLE   I_AUD                   0 DISABLED    1        6        64       1471 21/06/25 07:00:18   YES NO   YES
AUD                  IDX_IBS_DIARY4_TCODE           P25_C                          TIMESTAMP' 2025-10-01 00:00:00'     6 USABLE   I_AUD                   0 DISABLED    1       27       590       6582 26/09/25 07:06:05   YES NO   YES
AUD                  IDX_IBS_DIARY4_TCODE           P25_D                          TIMESTAMP' 2026-01-01 00:00:00'     7 USABLE   I_AUD                   0 DISABLED    1       12       253       2761 14/10/25 07:05:49   YES NO   YES
AUD                  IDX_IBS_DIARY4_TCODE           P26_A                          TIMESTAMP' 2026-04-01 00:00:00'     8 USABLE   I_AUD                   0 DISABLED    0        0         0          0 02/08/25 15:00:12   YES NO   YES
AUD                  IDX_IBS_DIARY4_TCODE           P99                            MAXVALUE                            9 USABLE   I_AUD                   0 DISABLED    0        0         0          0 02/08/25 15:00:12   YES NO   YES

dba_ind_subpartitions:


31.2 i candidate [TABLE_NAME|%] [TABLE_OWNER] [TBS] - генерится скрипт с индексами, кандидатами на перестройку, размер и процент прироста:

$ tpi mprod i candidate % %

set echo on timing on
alter session set ddl_lock_timeout=360;
alter session force parallel ddl parallel 16;
alter session set "_scn_wait_interface_max_timeout_secs"=1;
--CMD                                                                                         OWNER.TABLE_NAME                              OWNER.INDEX_NAME                                     BYTES_MB    PERCENT_GAIN
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
--                                                                                        --  MSAP.ZPBESCHR                                 MSAP.I_PB_MBMS                                             54    41
alter index MSAP.I_PB_MBMS rebuild online;
alter index MSAP.I_PB_MBMS noparallel;
--                                                                                        --  MSAP.Z_SUPPLIER_GLD                           MSAP.PK_ZSG_MBML                                           56    34
alter index MSAP.PK_ZSG_MBML rebuild online;
alter index MSAP.PK_ZSG_MBML noparallel;
--                                                                                        --  MSAP.ZPRODUKT                                 MSAP.I_ZP_MBMVV                                            57    37
alter index MSAP.I_ZP_MBMVV rebuild online;
alter index MSAP.I_ZP_MBMVV noparallel;
--                                                                                        --  MADMIN.PRD_REF_PRICE                          MADMIN.I_U_PRP_CHASAPVAL                                   61    34
alter index MADMIN.I_U_PRP_CHASAPVAL rebuild online;
alter index MADMIN.I_U_PRP_CHASAPVAL noparallel;
--                                                                                        --  MSAP.ZMATFIND                                 MSAP.I_MA_MBMM                                             72    46
alter index MSAP.I_MA_MBMM rebuild online;
alter index MSAP.I_MA_MBMM noparallel;


31.3 i last_analyzed HH [OWNER] - индексы, по которым собиралась статистика за последние HH часов

$ tpi  mprod i last_analyzed 24 IBS

Last analyzed indexes where owner like nvl('IBS','%') and last_analyzed > sysdate - interval '24' hour:

TABLESPACE_NAME        TABLE_NAME                     OWNER                INDEX_NAME                        INDEX_TYPE            UNIQUENESS DISTINCT_KEYS STATUS          ROWS LAST_ANALYZED     COMPRESS PART DE VISIBILITY
---------------------- ------------------------------ -------------------- --------------------------------- --------------------- ---------- ------------- -------- ----------- ----------------- -------- ---- -- ----------
T_DICT                 DEPLOYMENT_SUPPLY              IBS                  UNQ_DEPLOYMENT_SUPPLY             NORMAL                UNIQUE                 0 VALID              0 14/10/25 07:01:06 DISABLED NO   1  VISIBLE
I_DICT                 FRM_LOCKS                      IBS                  PK_FRM_LOCKS_OBJ_ID               NORMAL                UNIQUE                 0 VALID              0 14/10/25 07:01:06 DISABLED NO   1  VISIBLE
I_DICT                 FRM_LOCKS                      IBS                  IDX_FRM_LOCKS_USER_ID             NORMAL                NONUNIQUE              0 VALID              0 14/10/25 07:01:06 DISABLED NO   1  VISIBLE
T_USR                  MODEL_LOCKS                    IBS                  PK_MODEL_LOCKS_ID                 NORMAL                UNIQUE                13 VALID             13 14/10/25 07:00:05 DISABLED NO   1  VISIBLE
I_DICT                 RTL_USERS                      IBS                  PK_RTL_USERS_ID                   NORMAL                UNIQUE                 4 VALID              4 14/10/25 07:00:04 DISABLED NO   1  VISIBLE
T_USR                  SYSINFO_VARIABLES              IBS                  PK_SYSINFO_VAR_GROUPS_CODE        NORMAL                UNIQUE                 3 VALID              3 14/10/25 07:00:05 DISABLED NO   1  VISIBLE
I_DICT                 SYSTEM_OPTIONS                 IBS                  PK_SYSTEM_OPTIONS                 NORMAL                UNIQUE               320 VALID            320 14/10/25 07:00:06 DISABLED NO   1  VISIBLE
I_USR                  Z#CLIENT                       IBS                  Z#IX_Z#CLIENT_REF69               NORMAL                NONUNIQUE              1 VALID             34 14/10/25 07:01:06 DISABLED NO   1  VISIBLE
I_USR                  Z#CLIENT                       IBS                  Z#IX_Z#CLIENT_COL39               NORMAL                UNIQUE            126462 VALID         126462 14/10/25 07:01:06 DISABLED NO   1  VISIBLE
I_USR                  Z#CLIENT                       IBS                  Z#IX_Z#CLIENT_COL13               NORMAL                UNIQUE            126462 VALID         126462 14/10/25 07:01:06 DISABLED NO   1  VISIBLE

31.4 i rebuild TABLE_NAME OWNER [ONLINE [PARALLEL N]] - генерация скрипта для перестройки индексов указанной таблицы:

$ tpi  mprod i  rebuild Z#SYSTEM IBS ONLINE PARALLEL 8

Rebuild indexes for table=Z#SYSTEM and owner=IBS
alter session set ddl_lock_timeout=360;
alter session force parallel ddl parallel 16;
alter session set "_scn_wait_interface_max_timeout_secs"=1;

CMD
------------------------------------------------------------------------------------------
CMD2
------------------------------------------------------------------------------------------
ALTER INDEX IBS.PK_Z#SYSTEM_ID REBUILD ONLINE PARALLEL 8;
ALTER INDEX IBS.PK_Z#SYSTEM_ID noparallel;

ALTER INDEX IBS.Z#IX_Z#SYSTEM_REF11 REBUILD ONLINE PARALLEL 8;
ALTER INDEX IBS.Z#IX_Z#SYSTEM_REF11 noparallel;

ALTER INDEX IBS.Z#IX_Z#SYSTEM_REF2 REBUILD ONLINE PARALLEL 8;
ALTER INDEX IBS.Z#IX_Z#SYSTEM_REF2 noparallel;

ALTER INDEX IBS.Z#IX_Z#SYSTEM_REF3 REBUILD ONLINE PARALLEL 8;
ALTER INDEX IBS.Z#IX_Z#SYSTEM_REF3 noparallel;

ALTER INDEX IBS.Z#IX_Z#SYSTEM_REF4 REBUILD ONLINE PARALLEL 8;
ALTER INDEX IBS.Z#IX_Z#SYSTEM_REF4 noparallel;

ALTER INDEX IBS.Z#IX_Z#SYSTEM_REF5 REBUILD ONLINE PARALLEL 8;
ALTER INDEX IBS.Z#IX_Z#SYSTEM_REF5 noparallel;

32. l [LOB_NAME] - информация по имени LOB сегмента, объекты с спецсимволами "$" необходимо экранировать или взять в одинарные кавычки 'SYS_LOB0000204136C00010$$'

$ tpi  mprod l 'SYS_LOB0000204136C00010$$'

Segment from dba_lobs where segment_name = upper('SYS_LOB0000204136C00010$$')

OWNER                TABLE_NAME                     COLUMN_NAME                    SEGMENT_NAME                   TABLESPACE_NAME                INDEX_NAME                     PAR
-------------------- ------------------------------ ------------------------------ ------------------------------ ------------------------------ ------------------------------ ---
IBS                  Z#MST_REPORT                   C_MST_BODY                     SYS_LOB0000204136C00010$$      T_USR                          SYS_IL0000204136C00010$$       NO


Index from dba_lobs where index_name = upper('SYS_LOB0000204136C00010$$')



$ tpi mprod l 'SYS_IL0000204136C00011$$'

Segment from dba_lobs where segment_name = upper('SYS_IL0000204136C00011$$')


Index from dba_lobs where index_name = upper('SYS_IL0000204136C00011$$')

OWNER                TABLE_NAME                     COLUMN_NAME                    SEGMENT_NAME                   TABLESPACE_NAME                INDEX_NAME                     PAR
-------------------- ------------------------------ ------------------------------ ------------------------------ ------------------------------ ------------------------------ ---
IBS                  Z#MST_REPORT                   C_MST_ART                      SYS_LOB0000204136C00011$$      T_USR                          SYS_IL0000204136C00011$$       NO


32.1 l [unused OWNER LOBSEGMENT] - статистика по LOB сегменту,  объекты с спецсимволами "$" необходимо экранировать или взять в одинарные кавычки 'SYS_LOB0000204136C00010$$'

$ tpi mprod l unused IBS 'SYS_LOB0000204136C00010$$'

SEGMENT_NAME = IBS.SYS_LOB0000204136C00010$$
------------------------------
TOTAL_BLOCKS = 152
TOTAL_BYTES = 1245184
TOTAL_MB = 1.1875
UNUSED_BLOCKS = 0
UNUSED BYTES = 0
UNUSED MB = 0
LAST_USED_EXTENT_FILE_ID = 13
LAST_USED_EXTENT_BLOCK_ID = 31360
LAST_USED_BLOCK = 128

"Some recomendations:"
alter table IBS.Z#MST_REPORT enable row movement;
alter table IBS.Z#MST_REPORT shrink space cascade;
alter table IBS.Z#MST_REPORT disable row movement;
alter table IBS.Z#MST_REPORT modify lob (C_MST_BODY) (shrink space cascade);
alter table IBS.Z#MST_REPORT move lob (C_MST_BODY) STORE AS (TABLESPACE T_USR);
"Other recomendation for IOT: ALTER TABLE iot_name OVERFLOW SHRINK SPACE;"


33. c CONSTRAINT_NAME [OWNER] - Данные по констрейнту, тип, статус, валидация, дата изменения и т.п.

$ tpi mprod c PK_SYSTEM_OPTIONS

dba_constraints dba_cons_columns for constraint: PK_SYSTEM_OPTIONS

OWNER             TABLE_NAME                CONSTRAINT_NAME           COLUMN_NAME            P CO SEARCH_CONDITION               R_OWNER           R_CONSTRAINT_NAME         DELETE_RUL STATUS    VALIDATED     LAST_CHANGE
----------------- ------------------------- ------------------------- -------------------- --- -- ------------------------------ ----------------- ------------------------- ---------- --------- ------------- -------------------
IBS               SYSTEM_OPTIONS            PK_SYSTEM_OPTIONS         ID                     1 P                                                                                        ENABLED   VALIDATED     30/01/25 23:44:53


33.1 с T TABLE_NAME OWNER - все констрейнты таблицы:

$ tpi mprod c t SYSTEM_OPTIONS IBS

dba_constraints dba_cons_columns for table: SYSTEM_OPTIONS

OWNER             TABLE_NAME                CONSTRAINT_NAME           COLUMN_NAME            P CO SEARCH_CONDITION               R_OWNER           R_CONSTRAINT_NAME         DELETE_RUL STATUS    VALIDATED     LAST_CHANGE
----------------- ------------------------- ------------------------- -------------------- --- -- ------------------------------ ----------------- ------------------------- ---------- --------- ------------- -------------------
IBS               SYSTEM_OPTIONS            FK_SYSTEM_OPTIONS_PAR_ID  PARENT_ID              1 R                                 IBS               PK_SYSTEM_OPTIONS         NO ACTION  ENABLED   VALIDATED     30/01/25 23:45:24
IBS               SYSTEM_OPTIONS            PK_SYSTEM_OPTIONS         ID                     1 P                                                                                        ENABLED   VALIDATED     30/01/25 23:44:53


33.2 c PK PRIMARY_KEY OWNER - Первичный ключ, а также список внешних ключей, ссылающихся на на данный первичный ключ, а также скрипт по отключению этих констрейнтов

$ tpi mprod c PK PK_SYSTEM_OPTIONS IBS

dba_constraints: PK: PK_SYSTEM_OPTIONS OWNER: IBS

OWNER                          CONSTRAINT_NAME                C TABLE_NAME                     DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     LAST_CHANGE
------------------------------ ------------------------------ - ------------------------------ --------- -------- -------------- --------- ------------- -----------------
IBS                            PK_SYSTEM_OPTIONS              P SYSTEM_OPTIONS                           ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     30/01/25 23:44:53

What Foregin Key references to PK: PK_SYSTEM_OPTIONS

OWNER                          CONSTRAINT_NAME                TABLE_NAME
------------------------------ ------------------------------ ------------------------------
IBS                            FK_SYSTEM_OPTIONS_PAR_ID       SYSTEM_OPTIONS
IBS                            FK_OBJECTS_OPTIONS_OPTION      OBJECTS_OPTIONS

Script to disable the restriction that refers to the PK: PK_SYSTEM_OPTIONS:

SCRIPT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
alter table IBS.SYSTEM_OPTIONS disable constraint FK_SYSTEM_OPTIONS_PAR_ID;
alter table IBS.OBJECTS_OPTIONS disable constraint FK_OBJECTS_OPTIONS_OPTION;


33.3 c FK (TABLE_NAME [OWNER] | %)  - Таблицы с неиндексированным внешним ключем, при DML с которыми могут возникать TM блокировки

$ tpi mprod c FK % IBS

Tables with non-indexed foreign keys: Table: %:

OWNER                TABLE_NAME                     CONSTRAINT_NAME                COLUMNS                CREATE_INDEX_DDL
-------------------- ------------------------------ ------------------------------ ---------------------- ---------------------------------------------------------------------------------------------------------------------------
IBS                  CLASSES                        FK_CLASSES_INIT_STATE_ID       ID,INIT_STATE_ID       create index IBS.IDX_FK_CLASSES_INIT_STATE_ID_92 on IBS.CLASSES(ID,INIT_STATE_ID) tablespace SYSTEM;
IBS                  CLASSES                        FK_CLASSES_PROFILE_ID          PART_PROFILE_ID        create index IBS.IDX_FK_CLASSES_PROFILE_ID_123 on IBS.CLASSES(PART_PROFILE_ID) tablespace SYSTEM;
IBS                  CLASSES                        FK_CLASSES_REF_PART_CLASS_ID   REF_PART_CLASS_ID      create index IBS.IDX_FK_CLASSES_REF_PART_CLASS_ID_137 on IBS.CLASSES(REF_PART_CLASS_ID) tablespace SYSTEM;
IBS                  CLASS_ATTRIBUTES               FK_CLASS_ATTRIBUTES_PART_ID    PART_ID                create index IBS.IDX_FK_CLASS_ATTRIBUTES_PART_ID_45 on IBS.CLASS_ATTRIBUTES(PART_ID) tablespace SYSTEM;
IBS                  CLASS_PARTS                    FK_CLS_PARTS_CLASS_ID          CLASS_ID               create index IBS.IDX_FK_CLS_PARTS_CLASS_ID_140 on IBS.CLASS_PARTS(CLASS_ID) tablespace SYSTEM;
IBS                  CLASS_TABLES                   FK_CLASS_TABLES_PROFILE_ID     PART_PROFILE_ID        create index IBS.IDX_FK_CLASS_TABLES_PROFILE_ID_73 on IBS.CLASS_TABLES(PART_PROFILE_ID) tablespace SYSTEM;
IBS                  CONTROLS                       CTL2CLASS                      CLASS_ID               create index IBS.IDX_CTL2CLASS_76 on IBS.CONTROLS(CLASS_ID) tablespace SYSTEM;
IBS                  CONTROLS                       FK_CONTROLS_CRIT_CLASS_ID      CRIT_CLASS_ID          create index IBS.IDX_FK_CONTROLS_CRIT_CLASS_ID_49 on IBS.CONTROLS(CRIT_CLASS_ID) tablespace SYSTEM;
IBS                  CRITERIA_COLUMNS               FK_CRIT_COLUMNS_R_CLASS_ID     REF_CLASS_ID           create index IBS.IDX_FK_CRIT_COLUMNS_R_CLASS_ID_78 on IBS.CRITERIA_COLUMNS(REF_CLASS_ID) tablespace SYSTEM;
IBS                  CRITERIA_COLUMNS               FK_CRIT_COLUMNS_T_C_ID         TARGET_CLASS_ID        create index IBS.IDX_FK_CRIT_COLUMNS_T_C_ID_139 on IBS.CRITERIA_COLUMNS(TARGET_CLASS_ID) tablespace SYSTEM;


34. u USERNAME - Данные по пользователю с привилегиями и квотами:

$ tpi mprod u AUD
DB=mprod 15/10/25-01:07:42 ver=14.10.25  u [ USERNAME [{sys|role|tab} PRIVILEGE] ] - dba_users, dba_sys_privs, dba_role_privs, dba_tab_privs information , PARAMETERS =  AUD

USERNAME                       ACCOUNT_STATUS       LOCK_DATE         EXPIRY_DATE       DEFAULT_TABLESPACE        TEMPORARY_TABLESPACE CREATED           PROFILE              LAST_LOGIN
------------------------------ -------------------- ----------------- ----------------- ------------------------- -------------------- ----------------- -------------------- -------------------
AUD                            EXPIRED(GRACE)                         21/10/25 09:54:37 T_AUD                     TEMP                 30/01/25 22:48:41 DEFAULT              14/10/25 09:54:37

NAME                           LCOUNT PASSWORD_SPARE4
------------------------------ ------ ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
AUD                                 0 ;S:AD4887701A6FB0F644F4268D154289FF38E4487AC037A836D18DD0E6F352;T:870C0BD469F958634D8F6C9462BED984EBFE88767CC9EEA44B76477C937178E821C3A7F3873874869DF011B2CEEDE959397C77DA244DF4DF664FA8F27DD603231D6C167F828FCB905147B4B0FBB899B7

v$pwfile_users:

sys privs:

GRANTEE                        PRIVILEGE                           ADM COM INH
------------------------------ ----------------------------------- --- --- ---
AUD                            ALTER SYSTEM                        NO  NO  NO
AUD                            CREATE ANY DIRECTORY                NO  NO  NO
AUD                            CREATE PROCEDURE                    NO  NO  NO
AUD                            CREATE ROLE                         NO  NO  NO
AUD                            CREATE SEQUENCE                     NO  NO  NO
AUD                            CREATE SESSION                      NO  NO  NO
AUD                            CREATE TABLE                        NO  NO  NO
AUD                            CREATE TRIGGER                      NO  NO  NO
AUD                            CREATE VIEW                         NO  NO  NO
AUD                            DROP ANY DIRECTORY                  NO  NO  NO
AUD                            UNLIMITED TABLESPACE                NO  NO  NO

role privs:

GRANTEE                        GRANTED_ROLE                   ADM DEL DEF COM INH
------------------------------ ------------------------------ --- --- --- --- ---
AUD                            AUD_REVISOR                    YES NO  NO  NO  NO

tab privs:

GRANTEE                        OWNER                     TABLE_NAME                     GRANTOR              PRIVILEGE            GRA HIE COM TYPE            INH
------------------------------ ------------------------- ------------------------------ -------------------- -------------------- --- --- --- --------------- ---
AUD                            SYS                       DBA_ROLE_PRIVS                 SYS                  SELECT               NO  NO  NO  VIEW            NO
AUD                            SYS                       DBMS_LOCK                      SYS                  EXECUTE              NO  NO  NO  PACKAGE         NO
AUD                            SYS                       DBMS_OUTPUT                    SYS                  EXECUTE              NO  NO  NO  PACKAGE         NO
AUD                            SYS                       DBMS_SESSION                   SYS                  EXECUTE              NO  NO  NO  PACKAGE         NO
AUD                            SYS                       DBMS_SQL                       SYS                  EXECUTE              NO  NO  NO  PACKAGE         NO
AUD                            SYS                       DBMS_UTILITY                   SYS                  EXECUTE              NO  NO  NO  PACKAGE         NO
AUD                            SYS                       UTL_FILE                       SYS                  EXECUTE              NO  NO  NO  PACKAGE         NO
AUD                            SYS                       UTL_RAW                        SYS                  EXECUTE              NO  NO  NO  PACKAGE         NO
AUD                            SYS                       UTL_SMTP                       SYS                  EXECUTE              NO  NO  NO  PACKAGE         NO
AUD                            SYS                       V_$LOCK                        SYS                  SELECT               NO  NO  NO  VIEW            NO
AUD                            SYS                       V_$MYSTAT                      SYS                  SELECT               NO  NO  NO  VIEW            NO
AUD                            SYS                       V_$PROCESS                     SYS                  SELECT               NO  NO  NO  VIEW            NO
AUD                            SYS                       V_$SESSION                     SYS                  SELECT               NO  NO  NO  VIEW            NO

tbs quotas:

TABLESPACE_NAME                USERNAME               SUM (Mb)       MAX_BYTES          BLOCKS      MAX_BLOCKS
------------------------------ -------------------- ---------- --------------- --------------- ---------------
                                                    ----------
sum

34. u [ USERNAME [{sys|role|tab} PRIVILEGE] ] - Данные по всем пользователям с указанной привилегией:

пример, все пользователи с системной привилегией "alter system"

$ tpi mprod u % sys alter system

GRANTEE                        PRIVILEGE                           ADM COM INH
------------------------------ ----------------------------------- --- --- ---
SYSBACKUP                      ALTER SYSTEM                        NO  NO  NO
IBS                            ALTER SYSTEM                        NO  NO  NO
SYSDG                          ALTER SYSTEM                        NO  NO  NO
AUD                            ALTER SYSTEM                        NO  NO  NO
SYS                            ALTER SYSTEM                        NO  NO  NO
GSMADMIN_INTERNAL              ALTER SYSTEM                        NO  NO  NO
SYSRAC                         ALTER SYSTEM                        NO  NO  NO


пример, все пользователи с ролью "DBA"

$ tpi mprod u % role dba

GRANTEE                        GRANTED_ROLE                   ADM DEL DEF COM INH
------------------------------ ------------------------------ --- --- --- --- ---
SYSTEM                         DBA                            NO  NO  YES NO  NO
SYS                            DBA                            YES NO  YES NO  NO

пример, все выданные напрямую привилегии на объект в имени которого есть "%AC_FIN_NUM%", это может быть пакет, процедура, представление, таблица и т.п.

$ tpi mprod u % tab AC_FIN_NUM

GRANTEE                        OWNER                     TABLE_NAME                     GRANTOR              PRIVILEGE            GRA HIE COM TYPE            INH
------------------------------ ------------------------- ------------------------------ -------------------- -------------------- --- --- --- --------------- ---
IBS_USER                       IBS                       VW_CRIT_AC_FIN_NUM_KAS         IBS                  READ                 NO  NO  NO  VIEW            NO
IBS_USER                       IBS                       VW_CRIT_AC_FIN_NUM             IBS                  READ                 NO  NO  NO  VIEW            NO


35. r [ {role|granted_role} ROLE ] - привилегии роли в разных видах

пример, весь список ролей, выданный ролям
$ tpi mprod r

ROLE                                     GRANTED_ROLE                             ADM
---------------------------------------- ---------------------------------------- ---
DATAPUMP_EXP_FULL_DATABASE               EXP_FULL_DATABASE                        NO
DATAPUMP_IMP_FULL_DATABASE               EXP_FULL_DATABASE                        NO
DATAPUMP_IMP_FULL_DATABASE               IMP_FULL_DATABASE                        NO
DBA                                      ACCHK_READ                               YES
DBA                                      CAPTURE_ADMIN                            NO
DBA                                      DATAPUMP_EXP_FULL_DATABASE               NO
DBA                                      DATAPUMP_IMP_FULL_DATABASE               NO
DBA                                      EM_EXPRESS_ALL                           NO
DBA                                      EXECUTE_CATALOG_ROLE                     NO
DBA                                      EXP_FULL_DATABASE                        NO
DBA                                      GATHER_SYSTEM_STATISTICS                 NO
DBA                                      IMP_FULL_DATABASE                        NO
DBA                                      JAVA_ADMIN                               NO
DBA                                      OPTIMIZER_PROCESSING_RATE                NO
DBA                                      SCHEDULER_ADMIN                          NO
DBA                                      SELECT_CATALOG_ROLE                      NO
DBA                                      WM_ADMIN_ROLE                            NO
DBA                                      XDBADMIN                                 NO
DBA                                      XDB_SET_INVOKER                          NO
EM_EXPRESS_ALL                           EM_EXPRESS_BASIC                         NO
EM_EXPRESS_BASIC                         SELECT_CATALOG_ROLE                      NO
EXECUTE_CATALOG_ROLE                     HS_ADMIN_EXECUTE_ROLE                    NO
EXP_FULL_DATABASE                        EXECUTE_CATALOG_ROLE                     NO
EXP_FULL_DATABASE                        SELECT_CATALOG_ROLE                      NO
GSMADMIN_ROLE                            AQ_ADMINISTRATOR_ROLE                    NO
GSMADMIN_ROLE                            CONNECT                                  NO
GSMADMIN_ROLE                            XDBADMIN                                 NO
GSMROOTUSER_ROLE                         CONNECT                                  NO
GSMUSER_ROLE                             DATAPUMP_EXP_FULL_DATABASE               NO
GSMUSER_ROLE                             GDS_CATALOG_SELECT                       NO
GSM_POOLADMIN_ROLE                       CONNECT                                  NO
HS_ADMIN_ROLE                            HS_ADMIN_EXECUTE_ROLE                    NO
HS_ADMIN_ROLE                            HS_ADMIN_SELECT_ROLE                     NO
IMP_FULL_DATABASE                        EXECUTE_CATALOG_ROLE                     NO
IMP_FULL_DATABASE                        SELECT_CATALOG_ROLE                      NO
JAVASYSPRIV                              JAVAUSERPRIV                             NO
LOGSTDBY_ADMINISTRATOR                   RESOURCE                                 NO
OEM_MONITOR                              SELECT_CATALOG_ROLE                      NO
PDB_DBA                                  ACCHK_READ                               YES
RECOVERY_CATALOG_OWNER_VPD               RECOVERY_CATALOG_OWNER                   NO
RECOVERY_CATALOG_OWNER_VPD               RECOVERY_CATALOG_USER                    YES
RESOURCE                                 SODA_APP                                 NO
SELECT_CATALOG_ROLE                      HS_ADMIN_SELECT_ROLE                     NO
SYSUMF_ROLE                              SELECT_CATALOG_ROLE                      NO

пример, какие роли выданы роли DBA:

$ tpi mprod r role DBA

ROLE                                     GRANTED_ROLE                             ADM
---------------------------------------- ---------------------------------------- ---
DBA                                      ACCHK_READ                               YES
DBA                                      CAPTURE_ADMIN                            NO
DBA                                      DATAPUMP_EXP_FULL_DATABASE               NO
DBA                                      DATAPUMP_IMP_FULL_DATABASE               NO
DBA                                      EM_EXPRESS_ALL                           NO
DBA                                      EXECUTE_CATALOG_ROLE                     NO
DBA                                      EXP_FULL_DATABASE                        NO
DBA                                      GATHER_SYSTEM_STATISTICS                 NO
DBA                                      IMP_FULL_DATABASE                        NO
DBA                                      JAVA_ADMIN                               NO
DBA                                      OPTIMIZER_PROCESSING_RATE                NO
DBA                                      SCHEDULER_ADMIN                          NO
DBA                                      SELECT_CATALOG_ROLE                      NO
DBA                                      WM_ADMIN_ROLE                            NO
DBA                                      XDBADMIN                                 NO
DBA                                      XDB_SET_INVOKER                          NO


Пример, какой роли выдана роль CONNECT:

$ tpi mprod r granted_role CONNECT

ROLE                                     GRANTED_ROLE                             ADM
---------------------------------------- ---------------------------------------- ---
GSMADMIN_ROLE                            CONNECT                                  NO
GSMROOTUSER_ROLE                         CONNECT                                  NO
GSM_POOLADMIN_ROLE                       CONNECT                                  NO


36. trg [ "" | [TRIGGER_NAME] [TRIGGER_OWNER] | t [TABLE_NAME] [TABLE_OWNER] ]  - триггеры, без допполнительных опций показывает logon, startup триггеры

$ tpi mprod trg

OWNER                          TRIGGER_NAME                   TRIGGER_TYPE         TRIGGERING_EVENT                  BASE_OBJECT_TYPE TABLE_OWNER                    TABLE_NAME                     STATUS
------------------------------ ------------------------------ -------------------- --------------------------------- ---------------- ------------------------------ ------------------------------ --------------------
AUDM                           LOGON_TRIGGER                  AFTER EVENT          LOGON                             DATABASE         SYS                                                           ENABLED
SYS                            SERVICE_UP_TRG                 AFTER EVENT          STARTUP                           DATABASE         SYS                                                           ENABLED

пример, все триггеры схемы AUD

$ tpi mprod trg % AUD

OWNER                          TRIGGER_NAME                   TRIGGER_TYPE         TRIGGERING_EVENT                  BASE_OBJECT_TYPE TABLE_OWNER                    TABLE_NAME                     STATUS
------------------------------ ------------------------------ -------------------- --------------------------------- ---------------- ------------------------------ ------------------------------ --------------------
AUD                            SETTINGS_BEFORE_INS_UPD        BEFORE EACH ROW      INSERT OR UPDATE                  TABLE            AUD                            SETTINGS                       ENABLED
AUD                            AUDIT_SETTINGS_CHANGES         AFTER EACH ROW       INSERT OR UPDATE OR DELETE        TABLE            AUD                            SETTINGS                       ENABLED
AUD                            DIARY_INDEXES_CHANGES          AFTER EACH ROW       INSERT OR UPDATE OR DELETE        TABLE            AUD                            DIARY_INDEXES                  ENABLED
AUD                            DIARY_PARTITIONS_CHANGES       AFTER EACH ROW       INSERT OR UPDATE OR DELETE        TABLE            AUD                            DIARY_PARTITIONS               ENABLED
AUD                            DIARY_TABLES_CHANGES           AFTER EACH ROW       INSERT OR UPDATE OR DELETE        TABLE            AUD                            DIARY_TABLES                   ENABLED
AUD                            LICENSE_SETTINGS_CHANGES       AFTER EACH ROW       INSERT OR UPDATE OR DELETE        TABLE            AUD                            LICENSE_SETTINGS               ENABLED
AUD                            NOTIFICATIONS_CHANGES          AFTER EACH ROW       INSERT OR UPDATE OR DELETE        TABLE            AUD                            NOTIFICATIONS                  ENABLED
AUD                            RECIPIENTS_CHANGES             AFTER EACH ROW       INSERT OR UPDATE OR DELETE        TABLE            AUD                            RECIPIENTS                     ENABLED
AUD                            USERS_CHANGES                  AFTER EACH ROW       INSERT OR UPDATE OR DELETE        TABLE            AUD                            USERS                          ENABLED

пример, триггеры таблицы SETTINGS , схемы AUD

$ tpi mprod trg t SETTINGS  AUD

OWNER                          TRIGGER_NAME                   TRIGGER_TYPE         TRIGGERING_EVENT                  BASE_OBJECT_TYPE TABLE_OWNER                    TABLE_NAME                     STATUS
------------------------------ ------------------------------ -------------------- --------------------------------- ---------------- ------------------------------ ------------------------------ --------------------
AUD                            SETTINGS_BEFORE_INS_UPD        BEFORE EACH ROW      INSERT OR UPDATE                  TABLE            AUD                            SETTINGS                       ENABLED
AUD                            AUDIT_SETTINGS_CHANGES         AFTER EACH ROW       INSERT OR UPDATE OR DELETE        TABLE            AUD                            SETTINGS                       ENABLED

37. profile [PROFILE] - настройки профилей пользователей

$ tpi mprod profile

PROFILE                        RESOURCE_NAME                  RESOURCE LIMIT                          COM INH IMP
------------------------------ ------------------------------ -------- ------------------------------ --- --- ---
DEFAULT                        COMPOSITE_LIMIT                KERNEL   UNLIMITED                      NO  NO  NO
DEFAULT                        CONNECT_TIME                   KERNEL   UNLIMITED                      NO  NO  NO
DEFAULT                        CPU_PER_CALL                   KERNEL   UNLIMITED                      NO  NO  NO
DEFAULT                        CPU_PER_SESSION                KERNEL   UNLIMITED                      NO  NO  NO
DEFAULT                        FAILED_LOGIN_ATTEMPTS          PASSWORD 10                             NO  NO  NO
DEFAULT                        IDLE_TIME                      KERNEL   UNLIMITED                      NO  NO  NO
DEFAULT                        INACTIVE_ACCOUNT_TIME          PASSWORD UNLIMITED                      NO  NO  NO
DEFAULT                        LOGICAL_READS_PER_CALL         KERNEL   UNLIMITED                      NO  NO  NO
DEFAULT                        LOGICAL_READS_PER_SESSION      KERNEL   UNLIMITED                      NO  NO  NO
DEFAULT                        PASSWORD_GRACE_TIME            PASSWORD 7                              NO  NO  NO
DEFAULT                        PASSWORD_LIFE_TIME             PASSWORD 180                            NO  NO  NO
DEFAULT                        PASSWORD_LOCK_TIME             PASSWORD 1                              NO  NO  NO
DEFAULT                        PASSWORD_REUSE_MAX             PASSWORD UNLIMITED                      NO  NO  NO
DEFAULT                        PASSWORD_REUSE_TIME            PASSWORD UNLIMITED                      NO  NO  NO
DEFAULT                        PASSWORD_ROLLOVER_TIME         PASSWORD 0                              NO  NO  NO
DEFAULT                        PASSWORD_VERIFY_FUNCTION       PASSWORD NULL                           NO  NO  NO
DEFAULT                        PRIVATE_SGA                    KERNEL   UNLIMITED                      NO  NO  NO
DEFAULT                        SESSIONS_PER_USER              KERNEL   UNLIMITED                      NO  NO  NO
TUZ                            COMPOSITE_LIMIT                KERNEL   DEFAULT                        NO  NO  NO
TUZ                            CONNECT_TIME                   KERNEL   DEFAULT                        NO  NO  NO
TUZ                            CPU_PER_CALL                   KERNEL   DEFAULT                        NO  NO  NO
TUZ                            CPU_PER_SESSION                KERNEL   DEFAULT                        NO  NO  NO
TUZ                            FAILED_LOGIN_ATTEMPTS          PASSWORD UNLIMITED                      NO  NO  NO
TUZ                            IDLE_TIME                      KERNEL   DEFAULT                        NO  NO  NO
TUZ                            INACTIVE_ACCOUNT_TIME          PASSWORD DEFAULT                        NO  NO  NO
TUZ                            LOGICAL_READS_PER_CALL         KERNEL   DEFAULT                        NO  NO  NO
TUZ                            LOGICAL_READS_PER_SESSION      KERNEL   DEFAULT                        NO  NO  NO
TUZ                            PASSWORD_GRACE_TIME            PASSWORD DEFAULT                        NO  NO  NO
TUZ                            PASSWORD_LIFE_TIME             PASSWORD UNLIMITED                      NO  NO  NO
TUZ                            PASSWORD_LOCK_TIME             PASSWORD UNLIMITED                      NO  NO  NO
TUZ                            PASSWORD_REUSE_MAX             PASSWORD DEFAULT                        NO  NO  NO
TUZ                            PASSWORD_REUSE_TIME            PASSWORD DEFAULT                        NO  NO  NO
TUZ                            PASSWORD_ROLLOVER_TIME         PASSWORD DEFAULT                        NO  NO  NO
TUZ                            PASSWORD_VERIFY_FUNCTION       PASSWORD DEFAULT                        NO  NO  NO
TUZ                            PRIVATE_SGA                    KERNEL   DEFAULT                        NO  NO  NO
TUZ                            SESSIONS_PER_USER              KERNEL   DEFAULT                        NO  NO  NO


38. links [LINK_NAME] - информация и DDL ДБ-линков

$ tpi mprod links

create database link EXTPROC_CONNECTION_DATA connect to  identified by values '' using 'EXTPROC_CONNECTION_DATA';
create database link MTEST connect to IBS identified by values '074CDA579B0DF5D53FA4C0D24620E01CF6375D9508FFF5E371A3E8D757D1498103A65F8BCB3958B50760197CB40F47D26F58D4D885B6D44FFD7F7E841E6CC0EDC384CF3D10E9E26CE09B9886C51EC7034E156F5091B2B8E728813A0DE62730D22379348AF78B90FE7BF10872AB1C55DDC3BBC08973635FBA0F0C30328943B3EA' using 'mtest';

OWNER                          NAME                                USERID                         HOST                                          CTIME
------------------------------ ----------------------------------- ------------------------------ --------------------------------------------- --------------------
IBS                            MTEST                               IBS                            mtest                                         23/09/2025 18:34:53
PUBLIC                         EXTPROC_CONNECTION_DATA                                            EXTPROC_CONNECTION_DATA                       30/01/2025 22:48:25


39. latch - latch information, информация о внутренних конкуренциях в БД latches

$ tpi mprod latch

Latch Contention information:
NAME                                                 GETS        MISSES      SLEEP       IM_GETS     IM_MISSES        PCT     IM_PCT
---------------------------------------- ---------------- ------------- ---------- ------------- ------------- ---------- ----------
space background task latch                       3013080       1576904    1272331        855458          3941     52.335       .461
ksv class latch                                    746416         21672        958             5             3      2.903         60
ksv msg queue latch                                105449          1672        153        104647           501      1.586       .479
JS global state obj latch                          429038          3153         94             0             0       .735          0
post/wait queue                                  12661199         39884         55      12052510         69823       .315       .579
undo global data                                  8930330           403          1          3450            19       .005       .551
job workq parent latch                              93091             0          0         94138          4214          0      4.476


       SID NAME                                     FUNC                                           Held       Gets  Held %     Held ms Avg hold ms
---------- ---------------------------------------- ---------------------------------------- ---------- ---------- ------- ----------- -----------
        62 space background task latch              ktsj_smco_purgeexpired                            7          1     .01        .116        .116
       356 SQL memory manager latch                 qesmmIDeamonCb                                    5          1     .01        .083        .083
       356 ksuosstats global area                   ksugetosstat                                      5          1     .01        .083        .083
       303 enqueue freelist latch                   ksqgel: get enqueue                               3          3     .00        .050        .017
       303 enqueue hash chains                      ksqgtl3                                           3          3     .00        .050        .017
       303 In memory undo latch                     ktiTxnPoolFree                                    2          2     .00        .033        .017
       303 enqueue hash chains                      ksqcnl                                            2          2     .00        .033        .017
       303 enqueue hash chains                      ksqrcl                                            1          1     .00        .017        .017
       298 checkpoint queue latch                   kcbkllrba: compute lowest lrba                    1          1     .00        .017        .017
        62 space background task latch              ktsj_smco_movetasks                               1          1     .00        .017        .017
       239 messages                                 ksarcv: after wait                                1          1     .00        .017        .017
       303 JS Sh mem access                         jsksGetShMemLatch                                 1          1     .00        .017        .017
       303 JS queue state obj latch                 jskqStateObjCreate                                1          1     .00        .017        .017
       357 post/wait queue                          kslpstevent:get                                   1          1     .00        .017        .017
       181 active checkpoint queue latch            kcbbacq: scan active checkpoints                  1          1     .00        .017        .017
       303 JS queue state obj latch                 jskqStateObjDel                                   1          1     .00        .017        .017


40.  lock [chain | lib | obj OBJECT_NAME | distrib [commit TRX | rollback TRX | purge TRX (for commited,collecting,prepared) | hardpurge TRX | hardpurge-ORA-02075-prepared TRX ] ] - blocking locks information, lib - library lock information

lock -  информация о блокировках в БД
lock lib -  информация о блокировках в library cache
lock obj OBJECT_NAME - инфомация о блокированном объекте 
lock distrib [commit TRX | rollback TRX | purge TRX (for commited,collecting,prepared) | hardpurge TRX | hardpurge-ORA-02075-prepared TRX ] - информация о блокированной распределенной транзакции - TRX, и способы ее разрешения 



41. bind - запросы без bind переменных

$ tpi mprod bind

SQL                                                            COUNT(*)   TotExecs
------------------------------------------------------------ ---------- ----------
SELECT /* DS_SVC */ /*+ dynamic_sampling(0) no_sql_tune no_m       1770       2119
select /*+  no_parallel(t) no_parallel_index(t) dbms_stats c        924       1074
select /*+ opt_param('_optimizer_use_auto_indexes' 'on')   n        348        503
select substrb(dump(val,16,0,64),1,240) ep, cnt from (select        286        365
/* SQL Analyze(1) */ select /*+  full(t)    no_parallel(t) n        205        302
select substrb(dump(val,16,0,64),1,240) ep,  freq, cdn, ndv,        133        181
SELECT count(*) FROM wri$_adv_executions e                           73         75
          54         54name,
SELECT /* OPT_DYN_SAMP */ /*+ ALL_ROWS IGNORE_WHERE_CLAUSE R         34         69


пример текста запросов "select substrb" без биндов
$ tpi most-prod-db mprod bind select substrb

sql_text

MODULE           SQL_ID         SQL_TEXT                                                                                                                           NAME  VALUE_STRING
---------------- -------------- ---------------------------------------------------------------------------------------------------------------------------------- ----- -------------------------
DBMS_SCHEDULER   gm1q4xrf9n02h  select substrb(dump(val,16,0,64),1,240) ep, cnt from (select /*+ no_expand_table(t) index_rs(t)   no_parallel(t) no_parallel_index
                                (t) dbms_stats cursor_sharing_exact use_weak_name_resl dynamic_sampling(0) no_monitoring xmlindex_sel_idx_tbl opt_param('optimizer
                                _inmemory_aware' 'false') no_substrb_pad  */"DBID" val,count(*) cnt  from "SYS"."WRH$_DB_CACHE_ADVICE" t  where "DBID" is not null
                                  group by "DBID") order by val

DBMS_SCHEDULER   czn74337280b3  select substrb(dump(val,16,0,64),1,240) ep, cnt from (select /*+ no_expand_table(t) index_rs(t)   no_parallel(t) no_parallel_index :OBJN 223925
                                (t) dbms_stats cursor_sharing_exact use_weak_name_resl dynamic_sampling(0) no_monitoring xmlindex_sel_idx_tbl opt_param('optimizer
                                _inmemory_aware' 'false') no_substrb_pad  */"SNAP_ID" val,count(*) cnt  from "SYS"."WRH$_WAITSTAT" t  where TBL$OR$IDX$PART$NUM("S
                                YS"."WRH$_WAITSTAT",0,4,0,"ROWID") = :objn and "SNAP_ID" is not null  group by "SNAP_ID") order by val



42. pipe [PIPE_NAME] - информация о pipe канале
$ tpi mprod pipe

NAME                                      PIPE_SIZE
---------------------------------------- ----------
TEST                                          24312
008AEFFC0001                                   8088
DEBUG$01AA88FF0001                             8088
01AEBE2F0001                                   4032
00C233C10001                                   4032
DEBUG$0170E4D00001                             4032
008AED420001                                   4032
004DE21E0001                                   4032
01AE4F9D0001                                   4032
0102B97C0001                                   4032
013B4F730001                                   4032
00C4AC270001                                   4032
DEBUG$0087E9C30001                             4032
00FFC8950001                                   4032
00C22F1C0001                                   4032

пример, прочитать и вывести на экран содержимое pipe канала TEST

$ tpi mprod pipe TEST
Process_1c_Opers.
Process_1c_Opers.
Process_1c_Opers.

43. longops [SID | MESSAGE | rman] - данные из v$session_longops выбранные по SID, по MESSAGE, RMAN - сессии
$ tpi mprod longops

SID                           : 7216
SERIAL#                       : 5321
OPNAME                        : Table Scan
TARGET                        : GAL_VEK.ATTRVAL
TARGET_DESC                   :
SOFAR                         : 10174387
TOTALWORK                     : 41499164
UNITS                         : Blocks
START_TIME                    : 14/10/25 23:03:45
LAST_UPDATE_TIME              : 14/10/25 23:54:03
TIMESTAMP                     :
TIME_REMAINING                : 9292
ELAPSED_SECONDS               : 3018
CONTEXT                       : 0
MESSAGE                       : Table Scan:  GAL_VEK.ATTRVAL: 10174387 out of 41499164 Blocks done
USERNAME                      : SYS
SQL_ADDRESS                   : 07000052782093B8
SQL_HASH_VALUE                : 553903074
SQL_ID                        : 3rz8qpnhh7sz2
SQL_PLAN_HASH_VALUE           : 3541775259
SQL_EXEC_START                : 14/10/25 23:03:45
SQL_EXEC_ID                   : 16777216
SQL_PLAN_LINE_ID              : 3
SQL_PLAN_OPERATION            : TABLE ACCESS
SQL_PLAN_OPTIONS              : FULL
QCSID                         : 0
---------------------------------------------------

43.1 longops rman - оборажает rman сессии, и оценивает сколько прошло и сколько осталось до окончания бекапы
$ tpi mprod longops rman

v$block_change_tracking information:

STATUS                                   FILENAME                                                             BYTES
---------------------------------------- ------------------------------------------------------------ -------------
DISABLED


RMAN sessions:

   SID SPID                     CLIENT_INFO
------ ------------------------ ------------------------------
    91 75227                    rman channel=cpu2
   569 74678                    rman channel=cpu1


v$rman_status Estimate time of current backup if block_change_tracking is disabled:
                                                                                                                COMPRESS
      ID STATUS     OBJECT_TYPE     START_TIM END_TIME  DEVICE          DBSIZE_GB        READ_GB     WRITTEN_GB   % ORIG COMPLETE % ESTIMATED  SYSDATE
-------- ---------- --------------- --------- --------- ---------- -------------- -------------- -------------- -------- ---------- ---------- ---------
  324464 RUNNING    DB INCR         15/10/25  15/10/25  DISK             2,286.78       1,994.09           2.30     0.12      87.20 15/10/2025 15/10/25
                                    01:10:28  01:57:17                                                                               02:04:09  01:57:17

v$rman_backup_job_details v$rman_status Estimate time of current backup if block_change_tracking is enabled:

  DF_TOTAL DF_BACKUPED PERCENT_COMPLETE START_TIM ESTIMATED
---------- ----------- ---------------- --------- ----------
        79          62            78.48 15/10/25  15/10/2025
                                        01:10:02   02:10:14




44. scheduler [JOB_NAME | run JOB_NAME [hours] | log JOB_NAME [hours] | autotask ] - dba_scheduler_jobs information, log | run JOB_NAME [hours] - dba_scheduler_job_log | dba_scheduler_job_run_details for JOB_NAME in last [hours] - задания шедулера
$ tpi mprod scheduler

OWNER                          JOB_NAME                       PROGRAM            JOB_ACTION                                                                                           ENABLED REPEAT_INTERVAL        LAST_START LAST_RUN_DURAT
------------------------------ ------------------------------ ------------------ ---------------------------------------------------------------------------------------------------- ------- ---------------------- ---------- --------------
AUDM                           AUD_MGR_JOB                                       begin aud_mgr.job(next_date); end;                                                                   TRUE    systimestamp+(1/1440)  14/10/25 0 +000000000 13:
                                                                                                                                                                                                                     0:00:29    59:50.881062

IBS                            CHECK_LIC_VALUES                                  begin opt_mgr.job; end;                                                                              TRUE    FREQ=DAILY; BYHOUR=3;B 15/10/25 0 +000000000 00:
                                                                                                                                                                                              YMINUTE=0;BYSECOND=0   3:00:00    00:01.409607

IBS                            DBMS_JOB$_101                                     Z$SYSTEM_JOBS_JOB_LIB.run('1609611560',job,next_date,broken);                                        TRUE    trunc(sysdate) +1+ 5/2 14/10/25 0 +000000000 00:
                                                                                                                                                                                              4 /*Ежедневно в 05:00* 5:00:00    00:01.420781
                                                                                                                                                                                              /

IBS                            DBMS_JOB$_122                                     Z$SYSTEM_JOBS_JOB_LIB.run('1609605895',job,next_date,broken);                                        TRUE    sysdate + 1/1440*5 /*П 15/10/25 0 +000000000 00:
                                                                                                                                                                                              ерерыв 5 минут*/       1:55:10    00:00.066357
44.1 scheduler run CHECK_LIC_VALUES 12 - пример, лог dba_scheduler_job_run_details работы задания CHECK_LIC_VALUES за последние 12 часов
$ tpi mprod scheduler run CHECK_LIC_VALUES 12

dba_scheduler_job_run_details for job_name like 'CHECK_LIC_VALUES' and ACTUAL_START_DATE > sysdate - (1*(nvl('12',24)/24))

OWNER                     JOB_NAME                       STATUS     SESSION_ID     SLAVE_PID    ERROR# ACTUAL_START_DATE   RUN_DURATION         ERRORS
------------------------- ------------------------------ ---------- -------------- ---------- -------- ------------------- -------------------- ----------------------------------------
IBS                       CHECK_LIC_VALUES               SUCCEEDED  255,11617      332580            0 15/10/25 03:00:00   +000 00:00:01


44.2 scheduler log CHECK_LIC_VALUES 12 - пример, лог dba_scheduler_job_log работы задания CHECK_LIC_VALUES за последние 12 часов
$ tpi mprod scheduler log CHECK_LIC_VALUES 12

dba_scheduler_job_log for job_name like 'CHECK_LIC_VALUES' and LOG_DATE > nvl('12',24) hours

    LOG_ID LOG_DATE            OWNER                JOB_NAME                       JOB_CLASS                      OPERATION  STATUS     USER_NAME            ADDITIONAL_INFO
---------- ------------------- -------------------- ------------------------------ ------------------------------ ---------- ---------- -------------------- --------------------------------------------------
   1581762 15/10/25 01:00:02   IBS                  CHECK_LIC_VALUES               DEFAULT_JOB_CLASS              RUN        SUCCEEDED


44.3 scheduler autotask - задания и параметры autotask БД, включая window и лог работы

$ tpi mprod scheduler autotask

OPERATION_NAME                                               STATUS
------------------------------------------------------------ ---------------
auto optimizer stats job                                     ENABLED
auto space advisor job                                       ENABLED
automatic sql tuning task                                    ENABLED

CLIENT_NAME                                                  STATUS
------------------------------------------------------------ ---------------
auto optimizer stats collection                              ENABLED
auto space advisor                                           ENABLED
sql tuning advisor                                           ENABLED

WINDOW_NAME          REPEAT_INTERVAL                                                        DURATION             LAST_START_DATE      ENABL
-------------------- ---------------------------------------------------------------------- -------------------- -------------------- -----
MONDAY_WINDOW        freq=daily;byday=MON;byhour=22;byminute=0; bysecond=0                  +000 04:00:00        13/10/25 22:00:00    TRUE
TUESDAY_WINDOW       freq=daily;byday=TUE;byhour=22;byminute=0; bysecond=0                  +000 04:00:00        07/10/25 22:00:00    TRUE
WEDNESDAY_WINDOW     freq=daily;byday=WED;byhour=22;byminute=0; bysecond=0                  +000 04:00:00        08/10/25 22:00:00    TRUE
THURSDAY_WINDOW      freq=daily;byday=THU;byhour=22;byminute=0; bysecond=0                  +000 04:00:00        09/10/25 22:00:00    TRUE
FRIDAY_WINDOW        freq=daily;byday=FRI;byhour=22;byminute=0; bysecond=0                  +000 04:00:00        10/10/25 22:00:00    TRUE
SATURDAY_WINDOW      freq=daily;byday=SAT;byhour=6;byminute=0; bysecond=0                   +000 20:00:00        11/10/25 06:00:00    TRUE
SUNDAY_WINDOW        freq=daily;byday=SUN;byhour=6;byminute=0; bysecond=0                   +000 20:00:00        12/10/25 06:00:00    TRUE
WEEKNIGHT_WINDOW     freq=daily;byday=MON,TUE,WED,THU,FRI;byhour=22;byminute=0; bysecond=0  +000 08:00:00                             FALSE
WEEKEND_WINDOW       freq=daily;byday=SAT;byhour=0;byminute=0;bysecond=0                    +002 00:00:00                             FALSE

CLIENT_NAME                         JOB_NAME                  JOB_STATUS JOB_START_TIME       JOB_DURATION         JOB_INFO
----------------------------------- ------------------------- ---------- -------------------- -------------------- --------------------------------------------------------------------------------
auto optimizer stats collection     ORA$AT_OS_OPT_SY_1544     SUCCEEDED  11/10/25 18:05:14    +000 00:00:11
auto optimizer stats collection     ORA$AT_OS_OPT_SY_1546     SUCCEEDED  11/10/25 22:05:19    +000 00:02:07
auto optimizer stats collection     ORA$AT_OS_OPT_SY_1548     SUCCEEDED  12/10/25 06:00:02    +000 00:02:18
auto optimizer stats collection     ORA$AT_OS_OPT_SY_1551     SUCCEEDED  12/10/25 10:05:34    +000 00:00:20
auto optimizer stats collection     ORA$AT_OS_OPT_SY_1553     SUCCEEDED  12/10/25 14:05:40    +000 00:00:17
auto optimizer stats collection     ORA$AT_OS_OPT_SY_1555     SUCCEEDED  12/10/25 18:05:45    +000 00:00:05
auto optimizer stats collection     ORA$AT_OS_OPT_SY_1557     SUCCEEDED  12/10/25 22:05:50    +000 00:00:10
auto optimizer stats collection     ORA$AT_OS_OPT_SY_1559     SUCCEEDED  13/10/25 22:00:02    +000 00:07:45


45. job [run] [JOB_ID|OWNER] - джобы dba_jobs, run - запущенные в данный момент, [JOB_ID|OWNER] - фильтр по ID или OWNER

$ tpi mprod job

dba_jobs where LOG_USER like upper('%')

        JOB LOG_USER     LAST_DATE  NEXT_DATE  B INTERVAL        FAILURES WHAT
----------- ------------ ---------- ---------- - --------------- -------- ----------------------------------------------------------------------------------------------------
         61 IBS          15/10/25 0 15/10/25 0 N sysdate + 1/144        0 Z$SYSTEM_JOBS_JOB_LIB.run('1609524454',job,next_date,broken);
                         2:04:43    2:04:58      0/4 /* Перерыв
                                                 30 сек */

        122 IBS          15/10/25 0 15/10/25 0 N sysdate + 1/144        0 Z$SYSTEM_JOBS_JOB_LIB.run('1609605895',job,next_date,broken);
                         2:00:10    2:05:10      0*5 /*Перерыв 5
                                                  минут*/


46. rman [DAYS|dftb|cfg|last|arch [SEQUENCE] | recovery] - RMAN backups | df_to_backup | v$rman_configuration information | last - hours passed since the last backup | arch - last backup archivelog
    DAYS - отобразить дней бэкапов
    dftb - отобразить каких датафайлов нет в бекапе
    recovery - данные из gv$recovery_progress
    
пример, последние бекапы за 7 дней
$ tpi mprod rman

FILENAME                                                                                   STATUS
------------------------------------------------------------------------------------------ ----------
                                                                                           DISABLED
Elapsed: 00:00:00.00
D - data file full backup, I - incremental backup, L - backup contains archived redo logs

      SESS SESSION_STAMP START_TIME           END_TIME             OUTPUT_MBYTES STATUS                    INPUT_TYPE  DOW           ELA_SEC TIME_TAKEN_DISPLAY    CF         D0    I0    I1         I2          L
---------- ------------- -------------------- -------------------- ------------- ------------------------- ----------- ---------- ---------- ------------------ ----- ---------- ----- ----- ---------- ----------
       593    1213920012 2025-10-08 00:00:14  2025-10-08 00:00:16             31 COMPLETED WITH WARNINGS   ARCHIVELOG  Wednesday           2 00:00:02               1          0     0     0          0          1
       596    1213923613 2025-10-08 01:00:14  2025-10-08 01:00:16             25 COMPLETED WITH WARNINGS   ARCHIVELOG  Wednesday           2 00:00:02               1          0     0     0          0          1
       599    1213924237 2025-10-08 01:10:38  2025-10-08 01:10:59            147 COMPLETED WITH WARNINGS   DB INCR     Wednesday          21 00:00:21               1          0     0    14          0          2
       605    1213927212 2025-10-08 02:00:13  2025-10-08 02:00:16             23 COMPLETED WITH WARNINGS   ARCHIVELOG  Wednesday           3 00:00:03               1          0     0     0          0          1
       608    1213930812 2025-10-08 03:00:13  2025-10-08 03:00:16             24 COMPLETED WITH WARNINGS   ARCHIVELOG  Wednesday           3 00:00:03               1          0     0     0          0          1
       611    1213934412 2025-10-08 04:00:14  2025-10-08 04:00:16             25 COMPLETED WITH WARNINGS   ARCHIVELOG  Wednesday           2 00:00:02               1          0     0     0          0          1
       614    1213938012 2025-10-08 05:00:13  2025-10-08 05:00:15             24 COMPLETED WITH WARNINGS   ARCHIVELOG  Wednesday           2 00:00:02               1          0     0     0          0          1
       617    1213941612 2025-10-08 06:00:13  2025-10-08 06:00:15             27 COMPLETED WITH WARNINGS   ARCHIVELOG  Wednesday           2 00:00:02               1          0     0     0          0          1
       620    1213945213 2025-10-08 07:00:14  2025-10-08 07:00:16             27 COMPLETED WITH WARNINGS   ARCHIVELOG  Wednesday           2 00:00:02               1          0     0     0          0          1

46.1 rman cfg - конфигурация rman
$ tpi mprod rman cfg


     CONF# NAME                                               VALUE                                                                                                    CON_ID
---------- -------------------------------------------------- ---------------------------------------------------------------------------------------------------- ----------
         1 DEFAULT DEVICE TYPE TO                             DISK                                                                                                          0
         2 CONTROLFILE AUTOBACKUP                             ON                                                                                                            0
         3 COMPRESSION ALGORITHM                              'MEDIUM' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE                                                       0
         4 CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE      DISK TO '/nas/MPROD/ctl_%d_%F'                                                                                0
         5 ARCHIVELOG DELETION POLICY                         TO APPLIED ON ALL STANDBY                                                                                     0
         6 RETENTION POLICY                                   TO RECOVERY WINDOW OF 14 DAYS                                                                                 0

46.2  rman last сколько часов прошло с последнего бэекапа контрольника, архивного лога, уровневого или полного бэкапа

$ tpi mprod rman last
DB=mprod 15/10/25-02:10:18 ver=14.10.25  rman [DAYS|dftb|cfg|last|arch [SEQUENCE] | recovery] - RMAN backups | df_to_backup | v$rman_configuration information | last - hours passed since the last backup | arch - last backup archivelog

NAME       LAST_FULL  LAST_LEV0  LAST_LEV1   LAST_BCK  LAST_ARCH  LAST_CTRL
--------- ---------- ---------- ---------- ---------- ---------- ----------
MPROD             -1         73          1          1          1          1


46.3 rman arch - последний забэкапленный архивный лог

$ tpi  mprod rman arch

Last archivelog scn backup in V$BACKUP_ARCHIVELOG_DETAILS

      SEQUENCE#   FIRST_CHANGE#    NEXT_CHANGE# FIRST_TIME        NEXT_TIME
--------------- --------------- --------------- ----------------- -----------------
            377        88870750        88885080 15/10/25 01:10:54 15/10/25 02:00:14

пример, когда был забекаплен архивный лог 350
$ tpi mprod rman arch 350

Backup archivelog in V$BACKUP_ARCHIVELOG_DETAILS bad, V$RMAN_BACKUP_JOB_DETAILS for SEQUENCE#=350

      SEQUENCE# START_TIME        END_TIME          OUTPUT_DEVICE_TYP INPUT_TYPE    ELAPSED_SECONDS
--------------- ----------------- ----------------- ----------------- ------------- ---------------
            350 14/10/25 01:00:14 14/10/25 01:00:16 DISK              ARCHIVELOG                  2
            350 14/10/25 01:10:36 14/10/25 01:11:01 DISK              DB INCR                    25

47. get_ddl TYPE OBJECT (OWNER) - получить ddl объекта, пакета, функции, таблицы, индекса и т.п. get_ddl - без параметров покажет все возможные типы объектов для извлечения

$ tpi mprod get_ddl table DUAL SYS

usage: get_ddl TYPE OBJECT OWNER
TYPE: TABLE  OBJECT: DUAL  OWNER: SYS
"NLS_DATE_FORMAT='dd/mm/yyyy hh24:mi:ss'"

  CREATE TABLE "SYS"."DUAL"
   (    "DUMMY" VARCHAR2(1 BYTE)
   ) PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 16384 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;

48. trace [SID SERIAL LEVEL] [db {on|off}] - Trace for session, Level: 0-Disable, 1-Enable, 4-Enable with Binds, 8-Enable with Waits, 12-4+8, Trace all db sessions: on \ off
    включить отключить трассировку 10046 дл сессии или БД целиком.

49. kill [SID SERIAL INST_ID] | [idle NUM_HOURS] | [where USERNAME="\'"SomeUser"\'"] | [ zombie_unix_list | zombie_win_list ] - Kill session, idle 5 - kill idle sessions for 5 hours and more, zombie_unix_list - only show zombie
    килл сессии
    kill idle 5 - килл сессий, которые неактивны 5 часов
    kill where USERNAME="\'"SomeUser"\'" - килл по username
    zombie_unix_list | zombie_win_list - покажет зомби процессы






50. exec [pt] "sql_statement" - запустить произвольный запрос в БД, pt - распечатать вывод построчно "print table"
    
$ tpi mprod exec pt "select * from v\$instance"

ALL: pt select * from v$instance
Execute SQL command: "select * from v$instance"
INSTANCE_NUMBER               : 1
INSTANCE_NAME                 : mprod
HOST_NAME                     : prod-db.nc152.cmp.nkz.icdc.io
VERSION                       : 19.0.0.0.0
VERSION_LEGACY                : 19.0.0.0.0
VERSION_FULL                  : 19.25.0.0.0
STARTUP_TIME                  : 30/09/25 11:49:36
STATUS                        : OPEN
PARALLEL                      : NO
THREAD#                       : 1
ARCHIVER                      : STARTED
LOG_SWITCH_WAIT               :
LOGINS                        : ALLOWED
SHUTDOWN_PENDING              : NO
DATABASE_STATUS               : ACTIVE
INSTANCE_ROLE                 : PRIMARY_INSTANCE
ACTIVE_STATE                  : NORMAL
BLOCKED                       : NO
CON_ID                        : 0
INSTANCE_MODE                 : REGULAR
EDITION                       : EE
FAMILY                        :
DATABASE_TYPE                 : SINGLE
---------------------------------------------------

пример, запуска команды ОС:
(использовать осторожно, это довольно мощно)

$ tpi mprod exec  "! ls -l"

ALL: ! ls -l
Execute SQL command: "! ls -l"
total 16
-rw-r--r-- 1 oracle oinstall 4452 Oct 14 17:05 ASMM_RESIZE.TXT
-rw-r--r-- 1 oracle oinstall 1254 Oct 15 16:49 login.sql
drwx------ 3 root   root       17 Mar 28  2025 systemd-private-03296bbb1b80464e91bc738df3cda729-chronyd.service-bEo9cr
-rw-r--r-- 1 oracle oinstall   31 Oct 15 16:49 tpilog_466929.txt


51. alert [num] - показать последние num строк alert лога

$ tpi mprod alert 20

/app/oracle/diag/rdbms/mprod/mprod/trace/alert_mprod.log
NET  (PID:452393): Archived Log entry 776 added for B-1213184412.T-1.S-390 LOS:0x0000000005506368 NXS:0x000000000550ad49 NAB:35169 ID 0xad262f1b LAD:1
Wed Oct 15 15:00:15 2025
Control autobackup written to DISK device
handle '/nas/MPROD/ctl_MPROD_c-2904955675-20251015-10'
Wed Oct 15 16:00:13 2025
ALTER SYSTEM ARCHIVE LOG
Wed Oct 15 16:00:13 2025
Thread 1 advanced to log sequence 392 (LGWR switch),  current SCN: 89197639
  Current log# 2 seq# 392 mem# 0: /app/oracle/oradata/mprod/redo02.log
Wed Oct 15 16:00:13 2025
NET  (PID:459958): Archived Log entry 779 added for B-1213184412.T-1.S-391 LOS:0x000000000550ad49 NXS:0x0000000005510c47 NAB:132472 ID 0xad262f1b LAD:1
Wed Oct 15 16:00:15 2025
Expanded controlfile section 12 from 1022 to 2044 records
Requested to grow by 1022 records; added 6 blocks of records
Control autobackup written to DISK device
handle '/nas/MPROD/ctl_MPROD_c-2904955675-20251015-11'



52. report [ash {text|html} -60] -for last hour, [awr {text|html} DD/MM/YYYY HH24_begin HH24_end], [awrdd {text|html} DD1/MM/YYYY HH24_begin HH24_end DD2/MM/YYYY HH24_begin HH24_end], [awrsql {text|html} DD/MM/YYYY HH24_begin HH24_end sql_id], [addm text DD/MM/YYYY HH24_begin HH24_end] - oracle reports
    генерация встроенных отчетов oracle 
    report ash text -60 - ash report за последний час в текстовом виде
    report awr html 14/10/2025 10 12 - awr report за указанный промежуток времени
    report awrdd {text|html} DD1/MM/YYYY HH24_begin HH24_end DD2/MM/YYYY HH24_begin HH24_end - аналочично сравнительный awr report
    report awrsql {text|html} DD/MM/YYYY HH24_begin HH24_end sql_id - awrsql report для конкретного sql_id
    report addm text DD/MM/YYYY HH24_begin HH24_end - addm report за указанный промежуток времени

53. corrupt [{rowid|dba} ID] | [fb (FILE) (BLOCK)]  - поиск  file, block по dba из trace файла, поиск объекта по [fb (FILE) (BLOCK)] 

$ tpi mprod corrupt dba 2107489080

 file      block
----- ----------
  502    1948472


OWNER           SEGMENT_NAME                   PARTITION_NAME                           SEGMENT_TYPE                   TABLESPACE_NAME         EXTENT_ID    FILE_ID   BLOCK_ID      BYTES     BLOCKS RELATIVE_FNO
--------------- ------------------------------ ---------------------------------------- ------------------------------ ---------------------- ---------- ---------- ---------- ---------- ---------- ------------
OD              ACCOUNTBAL_PK                  ACCOUNTBAL_P0005                         INDEX PARTITION                LARGE                         496        502    1948165   10485760        640          502

$ tpi mprod corrupt fb 502    1948472

OWNER           SEGMENT_NAME                   PARTITION_NAME                           SEGMENT_TYPE                   TABLESPACE_NAME         EXTENT_ID    FILE_ID   BLOCK_ID      BYTES     BLOCKS RELATIVE_FNO
--------------- ------------------------------ ---------------------------------------- ------------------------------ ---------------------- ---------- ---------- ---------- ---------- ---------- ------------
OD              ACCOUNTBAL_PK                  ACCOUNTBAL_P0005                         INDEX PARTITION                LARGE                         496        502    1948165   10485760        640          502



54. sql [ [top] | [SQL_ID | SQLTEXT] | [plan SQL_ID] | [expand SQL_ID] | [sqlarea_vercnt] | [child_reason SQL_ID] | [sql_bind_metadata SQL_ID] | [sql_shared_cursor SQL_ID] | [sqlstat [SQL_ID|par|inv|fch|sor|exe|pio|lio|row|cpu|ela|iow|mem] [executions] ] 
    Find out sql_id by SQLTEXT\SQL_ID from V$SQL, plan from VSQL_PLAN by sql_id, sqlstat from V$SQLSTAT by sql_id, GV$\SQLAREA

$ tpi mprod sql top

List of Sql Area contents Order by Buffer_gets

SQL_TEXT                                                         SQL_ID                 BUFFER_GETS       EXECUTIONS         GET_EXEC
---------------------------------------------------------------- ------------- -------------------- ---------------- ----------------
BEGIN :RESULT:=Z$SYSTEM_INIT_CONTEXT.init_user_context; END;     7vz3g9zf47vqf          777,030,215          278,398            2,791
BEGIN     AUDM.aud_mgr.init_contexts; END;                       f4u4s8d5kuk56          412,783,529          168,073            2,456

List of Sql Area contents Order by Disk_reads

SQL_TEXT                                                               DISK_READS       EXECUTIONS        READ_EXEC
---------------------------------------------------------------- ---------------- ---------------- ----------------
DECLARE job BINARY_INTEGER := :job; next_date DATE := :mydate;         39,407,972               41          961,170
broken BOOLEAN := FALSE; BEGIN Z$SYSTEM_JOBS_SUBMIT_JOB.Job('130
9056875', job, next_date); :mydate := next_date; IF broken THEN
:b := 1; ELSE :b := 0; END IF; END;

List of Sql Area contents Order by Executions

SQL_TEXT                                                                  BUFFER_GETS       EXECUTIONS         GET_EXEC
---------------------------------------------------------------- -------------------- ---------------- ----------------
SELECT A1.ID FROM Z#ACCOUNT A1 WHERE A1.C_PRD = :B2 AND A1.C_AIM           65,438,036       20,741,523                3
 = :B1 AND A1.C_DATE_CL IS NULL

List of Sql Area contents Order by Buffer_gets Per Execution

SQL_TEXT                                                                  BUFFER_GETS       EXECUTIONS         GET_EXEC
---------------------------------------------------------------- -------------------- ---------------- ----------------
DECLARE job BINARY_INTEGER := :job; next_date DATE := :mydate;            902,398,443                2      451,199,222
broken BOOLEAN := FALSE; BEGIN Z$SYSTEM_JOBS_SUBMIT_JOB.Job('304
7576715', job, next_date); :mydate := next_date; IF broken THEN
:b := 1; ELSE :b := 0; END IF; END;

List of Sql Area contents Order by Disk_reads Per Execution

SQL_TEXT                                                               DISK_READS       EXECUTIONS        READ_EXEC
---------------------------------------------------------------- ---------------- ---------------- ----------------
begin Z$FOLDER_LIB_LCTR.LocatePrepFld; end;                            39,407,970               28        1,407,428

SELECT A1.ID FROM Z#FOLDER A1 WHERE (A1.C_STAT = 5392) AND (A1.C       39,407,946               28        1,407,427
_CREATE < :B1 ) AND (A1.C_CREATE > :B1 -15) ORDER BY A1.ID

54.1 пример, текст запроса 7rjfb2bcbg8ua:

$ tpi  mprod sql  csym1nnn9mpzs
 v$sql where sql_id = csym1nnn9mpzs

SQL_ID / PHV   CN SQL_FULLTEXT
------------- --- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
csym1nnn9mpzs   0 SELECT ID, CLASS_ID, STATE_ID, C_1, C_2, C_3, REF3, C_4, REF4, C_5, TO_CHAR(C_6) C_6, C_7, C_8, C_9, C_10, REF10, C_11, REF11, C_12, C_13, C_14, C_15, C_16, C_17, TO_CHAR(C_18) C_18, REF18, C_19, REF1
 2785226574       9, C_20, REF20, C_21, REF21, C_22, C_23, REF23, C_24, C_25, REF25, C_26, REF26, C_27, REF27, C_28, REF28, C_29, REF29, C_30, C_31, C_32, C_33, C_34, C_35, C_36, REF36, TO_CHAR(C_37) C_37, REF37, C_38,
                   REF38, C_39, REF39, C_40, REF40, C_41, REF41, C_42, REF42, TO_CHAR(C_43) C_43, C_44, REF44, C_45, REF45, C_46, REF46, C_47, REF47, C_48, REF48, C_49, REF49, C_50, REF50, C_51, REF51, C_52, REF52, C_5
                  3, REF53, C_54, REF54, C_55, REF55, C_56, REF56, C_57, REF57, C_58, C_59, TO_CHAR(C_60) C_60, TO_CHAR(C_61) C_61, C_62, C_63, C_64, C_65, REF65, C_66, C_67, REF67, C_68, C_69, TO_CHAR(C_70) C_70, C_71
                  , REF71 FROM IBS.VW_CRIT_MST_MAIN_DOCUM WHERE (CLASS_ID = :1) AND (((UPPER(C_11) LIKE :2)) OR ((UPPER(C_10) LIKE :3))) AND (ROWNUM <= :4)

54.2  пример, план запроса из v$sql_plan

$ tpi mprod sql plan 7rjfb2bcbg8ua

v$sql_plan where sql_id = 7rjfb2bcbg8ua

SQL_ID        PLAN_HASH_VALUE CHILD_NUMBER       COST CARDINALITY      BYTES PLAN
------------- --------------- ------------ ---------- ----------- ---------- ----------------------------------------------------------------------------------------------------------------------------------
7rjfb2bcbg8ua      1605197924            0        105                        000 SELECT STATEMENT
                                                  105           1        332 001  HASH UNIQUE
                                                                             002   FILTER
                                                  104           1        332 003    HASH JOIN
                                                   75           1        330 004     NESTED LOOPS
                                                   74           1        307 005      NESTED LOOPS
                                                   73           9       2358 006       NESTED LOOPS
                                                   72           1        252 007        HASH JOIN
                                                   71          61      14030 008         VIEW  DISK_AND_FIXED_OBJECTS
                                                                             009          UNION-ALL
                                                                             010           CONCATENATION
                                                                             011            FILTER
                                                    2           1        130 012             NESTED LOOPS
                                                    1           1        107 013              TABLE ACCESS BY INDEX ROWID BATCHED OBJ$
                                                    1           1            014               INDEX SKIP SCAN I_OBJ2
                                                    1           1         23 015              INDEX RANGE SCAN I_USER2
                                                    1           1          6 016             TABLE ACCESS BY INDEX ROWID BATCHED USER_EDITIONING$
                                                    1           2            017              INDEX RANGE SCAN I_USER_EDITIONING
                                                    1           1          6 018             TABLE ACCESS BY INDEX ROWID BATCHED USER_EDITIONING$
                                                    1           2            019              INDEX RANGE SCAN I_USER_EDITIONING
                                                    2           1         29 020             NESTED LOOPS SEMI
                                                    1           1         20 021              INDEX SKIP SCAN I_USER2
                                                    1           1          9 022              INDEX RANGE SCAN I_OBJ4
                                                                             023            FILTER
                                                   38          56       7280 024             NESTED LOOPS
                                                   38         732       7280 025              NESTED LOOPS
                                                    1         244       5612 026               INDEX FULL SCAN I_USER2
                                                    1           3            027               INDEX RANGE SCAN I_OBJ2
                                                    1           1        107 028              TABLE ACCESS BY INDEX ROWID OBJ$
                                                    1           1          6 029             TABLE ACCESS BY INDEX ROWID BATCHED USER_EDITIONING$
                                                    1           2            030              INDEX RANGE SCAN I_USER_EDITIONING
                                                    1           1          6 031             TABLE ACCESS BY INDEX ROWID BATCHED USER_EDITIONING$
                                                    1           2            032              INDEX RANGE SCAN I_USER_EDITIONING
                                                    2           1         29 033             NESTED LOOPS SEMI
                                                    1           1         20 034              INDEX SKIP SCAN I_USER2
                                                    1           1          9 035              INDEX RANGE SCAN I_OBJ4
                                                    0           1         24 036           FIXED TABLE FULL X$KQFP
                                                                             037           FILTER
                                                    0           2         40 038            FIXED TABLE FULL X$KQFTA
                                                    0           2         52 039           FIXED TABLE FULL X$KQFVI
                                                    1         244       5368 040         TABLE ACCESS CLUSTER USER$
                                                    1           1            041          INDEX FULL SCAN I_USER#
                                                    1          15        150 042        TABLE ACCESS BY INDEX ROWID BATCHED DEPENDENCY$
                                                    1          15            043         INDEX RANGE SCAN I_DEPENDENCY2
                                                    1           1         45 044       TABLE ACCESS BY INDEX ROWID BATCHED OBJ$
                                                    1           1            045        INDEX RANGE SCAN I_OBJ1
                                                    1           1         23 046      INDEX RANGE SCAN I_USER2
                                                   29        8168      16336 047     COLLECTION ITERATOR PICKLER FETCH
                                                    1           1          6 048    TABLE ACCESS BY INDEX ROWID BATCHED USER_EDITIONING$
                                                    1           2            049     INDEX RANGE SCAN I_USER_EDITIONING
                                                    1           1          6 050    TABLE ACCESS BY INDEX ROWID BATCHED USER_EDITIONING$
                                                    1           2            051     INDEX RANGE SCAN I_USER_EDITIONING
                                                    2           1         29 052    NESTED LOOPS SEMI
                                                    1           1         20 053     INDEX SKIP SCAN I_USER2
                                                    1           1          9 054     INDEX RANGE SCAN I_OBJ4



54.3 пример, expand запроса до конечных таблиц:

$ tpi mprod sql expand  csym1nnn9mpzs

'expand views for sql_id: csym1nnn9mpzs'
SELECT "A1"."ID" "ID","A1"."CLASS_ID" "CLASS_ID","A1"."STATE_ID" "STATE_ID","A1"."C_1" "C_1","A1"."C_2" "C_2","A1"."C_3" "C_3","A1"."REF3" "REF3","A1"."C_4" "C_4","A1"."REF4" "REF4","A1"."C_5" "C_5",TO_CHAR("A1"."C_6")
"C_6","A1"."C_7" "C_7","A1"."C_8" "C_8","A1"."C_9" "C_9","A1"."C_10" "C_10","A1"."REF10" "REF10","A1"."C_11" "C_11","A1"."REF11" "REF11","A1"."C_12" "C_12","A1"."C_13" "C_13","A1"."C_14" "C_14","A1"."C_15" "C_15","A1"."C_16"
"C_16","A1"."C_17" "C_17",TO_CHAR("A1"."C_18") "C_18","A1"."REF18" "REF18","A1"."C_19" "C_19","A1"."REF19" "REF19","A1"."C_20" "C_20","A1"."REF20" "REF20","A1"."C_21" "C_21","A1"."REF21" "REF21","A1"."C_22" "C_22","A1"."C_23"
"C_23","A1"."REF23" "REF23","A1"."C_24" "C_24","A1"."C_25" "C_25","A1"."REF25" "REF25","A1"."C_26" "C_26","A1"."REF26" "REF26","A1"."C_27" "C_27","A1"."REF27" "REF27","A1"."C_28" "C_28","A1"."REF28" "REF28","A1"."C_29"
"C_29","A1"."REF29" "REF29","A1"."C_30" "C_30","A1"."C_31" "C_31","A1"."C_32" "C_32","A1"."C_33" "C_33","A1"."C_34" "C_34","A1"."C_35" "C_35","A1"."C_36" "C_36","A1"."REF36" "REF36",TO_CHAR("A1"."C_37") "C_37","A1"."REF37"
"REF37","A1"."C_38" "C_38","A1"."REF38" "REF38","A1"."C_39" "C_39","A1"."REF39" "REF39","A1"."C_40" "C_40","A1"."REF40" "REF40","A1"."C_41" "C_41","A1"."REF41" "REF41","A1"."C_42" "C_42","A1"."REF42" "REF42",TO_CHAR("A1"."C_43")
"C_43","A1"."C_44" "C_44","A1"."REF44" "REF44","A1"."C_45" "C_45","A1"."REF45" "REF45","A1"."C_46" "C_46","A1"."REF46" "REF46","A1"."C_47" "C_47","A1"."REF47" "REF47","A1"."C_48" "C_48","A1"."REF48" "REF48","A1"."C_49"
"C_49","A1"."REF49" "REF49","A1"."C_50" "C_50","A1"."REF50" "REF50","A1"."C_51" "C_51","A1"."REF51" "REF51","A1"."C_52" "C_52","A1"."REF52" "REF52","A1"."C_53" "C_53","A1"."REF53" "REF53","A1"."C_54" "C_54","A1"."REF54"
"REF54","A1"."C_55" "C_55","A1"."REF55" "REF55","A1"."C_56" "C_56","A1"."REF56" "REF56","A1"."C_57" "C_57","A1"."REF57" "REF57","A1"."C_58" "C_58","A1"."C_59" "C_59",TO_CHAR("A1"."C_60") "C_60",TO_CHAR("A1"."C_61")
"C_61","A1"."C_62" "C_62","A1"."C_63" "C_63","A1"."C_64" "C_64","A1"."C_65" "C_65","A1"."REF65" "REF65","A1"."C_66" "C_66","A1"."C_67" "C_67","A1"."REF67" "REF67","A1"."C_68" "C_68","A1"."C_69" "C_69",TO_CHAR("A1"."C_70")
"C_70","A1"."C_71" "C_71","A1"."REF71" "REF71" FROM  (SELECT "A2"."ID" "ID","A2"."CLASS_ID" "CLASS_ID","A2"."STATE_ID" "STATE_ID","A2"."C_DATE_DOC" "C_1","A2"."C_ASTR_DATE_CREATE" "C_2","A5"."C_VALUE"||'='||"A8"."C_VALUE"
"C_3","A4"."C_VID_P" "REF3","A9"."C_SHORT_NAME" "C_4","A2"."C_VID_DOC" "REF4","A10"."C_DOCUMENT_NUM_STR" "C_5","A2"."C_SUM" "C_6",DECODE("A2"."C_SUM",NULL,"A11"."C_CUR_SHORT",0,"A11"."C_CUR_SHORT","A12"."C_CUR_SHORT")
"C_7",NVL("A44"."C_MAIN_V_ID_OLD","A43"."C_MAIN_V_ID_OLD") "C_8",NVL("A47"."C_MAIN_V_ID_OLD","A46"."C_MAIN_V_ID_OLD") "C_9","A3"."C_MAIN_V_ID" "C_10","A2"."C_ACC_DT" "REF10","A6"."C_MAIN_V_ID" "C_11","A2"."C_ACC_KT"
"REF11","A13"."NAME" "C_12","A2"."STATE_ID" "REF12","A2"."C_DATE_PROV" "C_13",TO_CHAR("A10"."C_ASTR_DATE_PROV",'dd/mm/yyyy hh24:mi:ss') "C_14","A2"."C_DATE_VAL" "C_15","A2"."C_NAZN" "C_16","A41"."C_NOTE" "C_17","A14"."C_SUM"
"C_18","A2"."C_MST_SUMMARY_DOC" "REF18","A4"."C_NUM" "C_19","A3"."C_MAIN_USV" "REF19","A7"."C_NUM" "C_20","A6"."C_MAIN_USV" "REF20","A16"."C_PATTERN_CODE" "C_21","A15"."C_BUSINESS_OP" "REF21",DECODE("A2"."C_KL_DT#0",2,'
'||"A17"."C_BIC"||' =>',DECODE("A2"."C_KL_KT#0",2,'-> '||"A18"."C_BIC",NULL)) "C_22","A19"."C_VID_SEND" "C_23","A2"."C_DOC_SEND_REF" "REF23","A2"."C_DOCUMENT_DATE" "C_24","A20"."C_NAME" "C_25","A2"."C_DOCUMENT_USER"
"REF25","A21"."C_NAME" "C_26","A2"."C_PROV_USER" "REF26","A22"."C_CODE" "C_27","A2"."C_KL_DT#2#PART" "REF27","A23"."C_CODE" "C_28","A2"."C_KL_KT#2#PART" "REF28","A24"."C_KOD_NAZN" "C_29","A2"."C_EKNP" "REF29","A2"."C_KL_DT#2#1"
"C_30","A2"."C_KL_KT#2#1" "C_31","A2"."C_KL_DT#2#INN" "C_32","A2"."C_KL_KT#2#INN" "C_33","A2"."C_KL_DT#2#2" "C_34","A2"."C_KL_KT#2#2" "C_35","A10"."C_IN_FOLDER" "REF36",DECODE("A10"."C_IN_FOLDER",NULL,NULL,'(***)')
"C_36","A25"."C_DOCUMENT_NUM" "C_37","A15"."ID" "REF37","A26"."C_KOD_NAZN" "C_38","A2"."C_KOD_NAZN_PAY" "REF38","A27"."C_NAME" "C_39","A10"."C_USER_EXEC" "REF39","A2"."C_QUIT_DOC"
"REF40",DECODE("A2"."C_QUIT_DOC",NULL,NULL,'(***)') "C_40","A28"."C_CODE" "C_41","A2"."C_DEPART" "REF41","A32"."C_CHAPTER" "C_42","A31"."C_CHAPTER" "REF42","A2"."ID" "C_43","A33"."C_CODE" "C_44","A10"."C_DT_SEND"
"REF44","A34"."C_CODE" "C_45","A10"."C_KT_SEND" "REF45","A10"."C_HISTORY_STATE" "REF46",DECODE( (SELECT COUNT(1) "COUNT(1)" FROM "IBS"."Z#HISTORY_STATES" "A63" WHERE "A63"."COLLECTION_ID"="A10"."C_HISTORY_STATE" AND
ROWNUM=1),0,'{...}','{***}') "C_46","A2"."C_PRODUCT_CT#ACC_PROD" "REF47",DECODE("A2"."C_PRODUCT_CT#ACC_PROD",NULL,NULL,'(***)') "C_47","A10"."C_CORRECTION_DOC" "REF48",DECODE("A10"."C_CORRECTION_DOC",NULL,NULL,'(***)')
"C_48","A10"."C_STORNO_DOC" "REF49",DECODE("A10"."C_STORNO_DOC",NULL,NULL,'(***)') "C_49","A2"."C_DEPART" "REF50",DECODE("A2"."C_DEPART",NULL,NULL,'(***)') "C_50","A10"."C_DOP_REQ_ARR" "REF51",'{'|| (SELECT COUNT(1) "COUNT(1)"
FROM "IBS"."Z#ADDITIONAL_REQ" "A62" WHERE "A62"."COLLECTION_ID"="A10"."C_DOP_REQ_ARR")||'}' "C_51","A35"."C_NAME" "C_52","A2"."C_VID_OBOROTA" "REF52","A36"."C_NAME" "C_53","A3"."C_OTV" "REF53","A37"."C_NAME" "C_54","A6"."C_OTV"
"REF54","A38"."C_NUM_DOG" "C_55","A2"."C_PRODUCT_DT#ACC_PROD" "REF55","A39"."C_NUM_DOG" "C_56","A2"."C_PRODUCT_CT#ACC_PROD" "REF56","A10"."C_USER_TYPE" "REF57",DECODE( (SELECT COUNT(1) "COUNT(1)" FROM "IBS"."Z#USER_TYPE_REF" "A61"
WHERE "A61"."COLLECTION_ID"="A10"."C_USER_TYPE" AND ROWNUM=1),0,'{...}','{***}') "C_57","A2"."C_KL_DT#2#KRS" "C_58","A2"."C_KL_KT#2#KRS" "C_59","A2"."C_SUM_NT" "C_60","A10"."C_DOCUMENT_NUM" "C_61","A10"."C_DOCUMENT_UNO"
"C_62","A10"."C_EDITION_UNO" "C_63","A2"."C_AUTO_PROC" "C_64","A28"."C_CODE" "C_65","A2"."C_DEPART" "REF65","A2"."C_DATE_INP" "C_66","A10"."C_SUBDOCUMENTS" "REF67",DECODE( (SELECT COUNT(1) "COUNT(1)" FROM "IBS"."Z#SUBDOC_STR"
"A60" WHERE "A60"."COLLECTION_ID"="A10"."C_SUBDOCUMENTS" AND ROWNUM=1),0,'{...}','{***}') "C_67","A10"."C_TEXT_VOZV" "C_68","A10"."C_COMMENT" "C_69", (SELECT COUNT("A59"."ID") "A$1" FROM "IBS"."Z#FACT_OPER" "A59" WHERE
"A59"."C_DOC"="A2"."ID") "C_70","A2"."C_KFM_LOG" "REF71",DECODE( (SELECT COUNT(1) "COUNT(1)" FROM "IBS"."Z#KFM_ACTION_LOG" "A58" WHERE "A58"."COLLECTION_ID"="A2"."C_KFM_LOG" AND ROWNUM=1),0,'{...}','{***}') "C_71" FROM
"IBS"."Z#AC_FIN" "A47","IBS"."Z#AC_FIN" "A46","IBS"."Z#ACCOUNT" "A45","IBS"."Z#AC_FIN" "A44","IBS"."Z#AC_FIN" "A43","IBS"."Z#ACCOUNT" "A42","IBS"."Z#PATTERN" "A41","IBS"."Z#DOC_IN_FOLD" "A40","IBS"."Z#PRODUCT"
"A39","IBS"."Z#PRODUCT" "A38","IBS"."Z#USER" "A37","IBS"."Z#USER" "A36","IBS"."Z#VID_OBOROT" "A35","IBS"."Z#RKC_DOC_STATES" "A34","IBS"."Z#RKC_DOC_STATES" "A33","IBS"."Z#CHAPTERS" "A32","IBS"."Z#NEW_RASD" "A31","IBS"."Z#NEW_BS1"
"A30","IBS"."Z#PL_US" "A29","IBS"."Z#DEPART" "A28","IBS"."Z#USER" "A27","IBS"."Z#KOD_N_PAY" "A26","IBS"."Z#DOCUMENT" "A25","IBS"."Z#KOD_N_PAY" "A24","IBS"."Z#CL_PART" "A23","IBS"."Z#CL_PART" "A22","IBS"."Z#USER"
"A21","IBS"."Z#USER" "A20","IBS"."Z#VID_SEND_DOCUM" "A19","IBS"."Z#CL_BANK_N" "A18","IBS"."Z#CL_BANK_N" "A17","IBS"."Z#PATTERN_DOC" "A16","IBS"."Z#FOLDER_PAY" "A15","IBS"."Z#MAIN_DOCUM" "A14","IBS"."STATES"
"A13","IBS"."Z#FT_MONEY" "A12","IBS"."Z#FT_MONEY" "A11","IBS"."Z#DOCUMENT" "A10","IBS"."Z#NAME_PAYDOC" "A9","IBS"."Z#DIC_VPL" "A8","IBS"."Z#PL_USV" "A7","IBS"."Z#AC_FIN" "A6","IBS"."Z#DIC_VPL" "A5","IBS"."Z#PL_USV"
"A4","IBS"."Z#AC_FIN" "A3","IBS"."Z#MAIN_DOCUM" "A2" WHERE "A2"."C_ACC_DT"="A3"."ID"(+) AND "A3"."C_MAIN_USV"="A4"."ID"(+) AND "A4"."C_VID_P"="A5"."ID"(+) AND "A2"."C_ACC_KT"="A6"."ID"(+) AND "A6"."C_MAIN_USV"="A7"."ID"(+) AND
"A7"."C_VID_P"="A8"."ID"(+) AND "A2"."C_VID_DOC"="A9"."ID"(+) AND "A2"."ID"="A10"."ID" AND "A2"."C_VALUTA_PO"="A11"."ID"(+) AND "A2"."C_VALUTA"="A12"."ID"(+) AND "A2"."STATE_ID"="A13"."ID"(+) AND
"A2"."CLASS_ID"="A13"."CLASS_ID"(+) AND "A2"."C_MST_SUMMARY_DOC"="A14"."ID"(+) AND "A10"."C_IN_FOLDER"="A15"."ID"(+) AND "A15"."C_BUSINESS_OP"="A16"."ID"(+) AND "A2"."C_KL_DT#2#3"="A17"."ID"(+) AND "A2"."C_KL_KT#2#3"="A18"."ID"(+)
AND "A2"."C_DOC_SEND_REF"="A19"."ID"(+) AND "A2"."C_DOCUMENT_USER"="A20"."ID"(+) AND "A2"."C_PROV_USER"="A21"."ID"(+) AND "A2"."C_KL_DT#2#PART"="A22"."ID"(+) AND "A2"."C_KL_KT#2#PART"="A23"."ID"(+) AND "A2"."C_EKNP"="A24"."ID"(+)
AND "A15"."ID"="A25"."ID"(+) AND "A2"."C_KOD_NAZN_PAY"="A26"."ID"(+) AND "A10"."C_USER_EXEC"="A27"."ID"(+) AND "A2"."C_DEPART"="A28"."ID"(+) AND "A4"."C_USV_US"="A29"."ID"(+) AND "A29"."C_NEW_BS1"="A30"."ID"(+) AND
"A30"."C_RASD"="A31"."ID"(+) AND "A31"."C_CHAPTER"="A32"."ID"(+) AND "A10"."C_DT_SEND"="A33"."ID"(+) AND "A10"."C_KT_SEND"="A34"."ID"(+) AND "A2"."C_VID_OBOROTA"="A35"."ID"(+) AND "A3"."C_OTV"="A36"."ID"(+) AND
"A6"."C_OTV"="A37"."ID"(+) AND "A2"."C_PRODUCT_DT#ACC_PROD"="A38"."ID"(+) AND "A2"."C_PRODUCT_CT#ACC_PROD"="A39"."ID"(+) AND "A2"."C_ACC_DT"="A42"."ID"(+) AND "A42"."ID"="A43"."ID"(+) AND "A43"."C_ACC_SUMMARY"="A44"."ID"(+) AND
"A2"."C_ACC_KT"="A45"."ID"(+) AND "A45"."ID"="A46"."ID"(+) AND "A46"."C_ACC_SUMMARY"="A47"."ID"(+) AND "A2"."ID"="A40"."C_DOCUMENT"(+) AND "A40"."C_PATT_REF"="A41"."ID"(+) AND (SYS_CONTEXT('IBS_SYSTEM','ADMIN')='1' OR  EXISTS
(SELECT 1 "1" FROM "IBS"."CRITERIA_RIGHTS" "A57","IBS"."SUBJ_EQUAL" "A56" WHERE "A57"."OBJ_ID"='1609592969' AND "A57"."SUBJ_ID"="A56"."EQUAL_ID" AND "A56"."SUBJ_ID"=SYS_CONTEXT('IBS_SYSTEM','USER')) AND  EXISTS (SELECT 1 "1" FROM
"IBS"."CLASS_RIGHTS" "A55","IBS"."SUBJ_EQUAL" "A54" WHERE "A55"."OBJ_ID"="A2"."CLASS_ID" AND "A55"."SUBJ_ID"="A54"."EQUAL_ID" AND "A54"."SUBJ_ID"=SYS_CONTEXT('IBS_SYSTEM','USER')) AND ( EXISTS (SELECT 1 "1" FROM
"IBS"."OBJECT_RIGHTS_EX" "A53","IBS"."SUBJ_EQUAL" "A52" WHERE "A52"."SUBJ_ID"=SYS_CONTEXT('IBS_SYSTEM','USER') AND "A53"."SUBJ_ID"="A52"."EQUAL_ID" AND "A53"."OBJ_ID"=TO_CHAR("A2"."C_DEPART") AND
"A53"."RIGHT_CLASS_ID"="A2"."CLASS_ID" AND "A53"."CLASS_ID"='DEPART') OR SYS_CONTEXT('IBS_USER','MFIL_DIRECT')='1' AND ( EXISTS (SELECT 1 "1" FROM "IBS"."OBJECT_RIGHTS_EX" "A51","IBS"."SUBJ_EQUAL" "A50" WHERE
"A50"."SUBJ_ID"=SYS_CONTEXT('IBS_SYSTEM','USER') AND "A51"."SUBJ_ID"="A50"."EQUAL_ID" AND "A51"."OBJ_ID"=TO_CHAR("A42"."C_DEPART") AND "A51"."RIGHT_CLASS_ID"='MAIN_DOCUM' AND "A51"."CLASS_ID"='DEPART') OR  EXISTS (SELECT 1 "1"
FROM "IBS"."OBJECT_RIGHTS_EX" "A49","IBS"."SUBJ_EQUAL" "A48" WHERE "A48"."SUBJ_ID"=SYS_CONTEXT('IBS_SYSTEM','USER') AND "A49"."SUBJ_ID"="A48"."EQUAL_ID" AND "A49"."OBJ_ID"=TO_CHAR("A45"."C_DEPART") AND
"A49"."RIGHT_CLASS_ID"='MAIN_DOCUM' AND "A49"."CLASS_ID"='DEPART')))) AND SYS_CONTEXT('IBS_OPTIONS','1609592969') IS NULL AND SYS_CONTEXT('USERENV','CLIENT_IDENTIFIER') IS NULL ORDER BY "A2"."ID" DESC) "A1" WHERE
"A1"."CLASS_ID"=:B1 AND (UPPER("A1"."C_11") LIKE :B2 OR UPPER("A1"."C_10") LIKE :B3) AND ROWNUM<=:B4



54.4 пример, version_count in gv$sqlarea версии sql_id, Bind mismatchб NLS, параметры клиента, инвалидация ...

$ tpi mprod sql sqlarea_vercnt

"Top 50 SQL by version_count in gv$sqlarea"

SQL_ID        PARSING_SCHEMA_NAME       VERSION_COUNT     SHARABLE_MEM   PERSISTENT_MEM      RUNTIME_MEM
------------- ------------------------- ------------- ---------------- ---------------- ----------------
95prusc0f1xss A_ARYP                               19        3,971,965        2,096,136        2,016,792
ba6cq4dwnjk2c A_ARYP                                5        4,378,141        2,956,800        2,721,592
2n2vfcndyffbw A_ARYP                                5        5,505,747        2,427,056        2,359,736
ac2pdzsys48bd A_ARYP                                5        5,546,596        4,756,816        4,687,096
241vmx1r7th3g A_ARYP                                5        3,355,617          827,472          814,512
csym1nnn9mpzs A_ARYP                                2        2,134,690          815,840          788,912
46kpgvhby69rj A_ARYP                                1        1,063,116          951,760          937,816
fhkczgdp6mtn4 A_ARYP                                1        1,067,029          403,912          390,568
9h3t01vguvmj7 IBS                                   5        4,357,863        3,543,104        3,308,496
1bg0czmcfhyh8 IBS                                   1        1,063,056          408,200          394,736
f5yun5dynkskv IBS                                   1        1,496,257        1,163,328        1,160,128
dzmvsz4xn0528 IBS                                   1        1,075,310          406,688          392,744
3gw04wx7a0wfp IBS                                   1        1,067,332          949,584          935,880
gm8chujjanbcf R_JANDARBEKOV                         1        1,075,201          405,104          391,880
                                                      ---------------- ---------------- ----------------
sum                                                        140,348,680       94,901,736       90,541,440


54.5 пример, причины  child_reason  в 'gv$sql_shared_cursor 

$ tpi mprod sql child_reason 95prusc0f1xss

'gv$sql_shared_cursor child_cursors reasons for sql_id: 95prusc0f1xss order by s.inst_id, s.last_active_time desc'
INST                          : 1
EXECS                         : 10
LAST_LOAD_TIME                : 15.10 15:33
USERS_OPENING                 : 0
LAST_ACTIVE_TIME              : 15.10 17:21
ELA_PER_EXEC                  : .0413
PLAN_HASH_VALUE               : 1096924374
OPTIMIZER_COST                : 23
CHILD                         : 18
BIND_SENSE                    : Y
BIND_AWARE                    : Y
SHAREABLE                     : Y
USE_FEEDBACK_STATS            : N
OPTIMIZER_STATS               : N
BIND_EQ_FAILURE               : Y
ROLL_INVALID_MISMATCH         : N
BIND_UACS_DIFF                : N
REASON1                       :
SQL_PLAN_BASELINE             :
SQL_PATCH                     :
OUTLINE_CATEGORY              :
SQL_PROFILE                   :
IS_OBSOLETE                   : N
---------------------------------------------------
INST                          : 1
EXECS                         : 4
LAST_LOAD_TIME                : 15.10 15:17
USERS_OPENING                 : 0
LAST_ACTIVE_TIME              : 15.10 15:33
ELA_PER_EXEC                  : .0294
PLAN_HASH_VALUE               : 1096924374
OPTIMIZER_COST                : 23
CHILD                         : 17
BIND_SENSE                    : Y
BIND_AWARE                    : Y
SHAREABLE                     : N
USE_FEEDBACK_STATS            : N
OPTIMIZER_STATS               : N
BIND_EQ_FAILURE               : Y
ROLL_INVALID_MISMATCH         : N
BIND_UACS_DIFF                : N
REASON1                       : Bind mismatch(33)  |
SQL_PLAN_BASELINE             :
SQL_PATCH                     :
OUTLINE_CATEGORY              :
SQL_PROFILE                   :
IS_OBSOLETE                   : N
---------------------------------------------------
INST                          : 1
EXECS                         : 5
LAST_LOAD_TIME                : 15.10 07:48
USERS_OPENING                 : 0
LAST_ACTIVE_TIME              : 15.10 15:17
ELA_PER_EXEC                  : .0099
PLAN_HASH_VALUE               : 1096924374
OPTIMIZER_COST                : 10
CHILD                         : 16
BIND_SENSE                    : Y
BIND_AWARE                    : Y
SHAREABLE                     : N
USE_FEEDBACK_STATS            : N
OPTIMIZER_STATS               : N
BIND_EQ_FAILURE               : Y
ROLL_INVALID_MISMATCH         : N
BIND_UACS_DIFF                : N
REASON1                       : Bind mismatch(33)  |
SQL_PLAN_BASELINE             :
SQL_PATCH                     :
OUTLINE_CATEGORY              :
SQL_PROFILE                   :
IS_OBSOLETE                   : N


54.6 пример, sql sql_bind_metadata - поиск причины "Bind mismatch" из v$sql_bind_metadata 

$ tpi mprod sql sql_bind_metadata 95prusc0f1xss


CHILD_NUMBER   POSITION   DATATYPE MAX_LENGTH  ARRAY_LEN
------------ ---------- ---------- ---------- ----------
           0          1          1         32          0
           0          2          2         22          0
           1          1          1         32          0
           1          2          2         22          0
           2          1          1         32          0
           2          2          2         22          0
           3          1          1         32          0
           3          2          2         22          0
           4          1          1         32          0
           4          2          2         22          0
           5          1          1         32          0
           5          2          2         22          0
           6          1          1         32          0
           6          2          2         22          0
           7          1          1         32          0
           7          2          2         22          0
           8          1          1         32          0
           8          2          2         22          0
           9          1          1         32          0
           9          2          2         22          0
          10          1          1         32          0
          10          2          2         22          0
          11          1          1         32          0
          11          2          2         22          0
          12          1          1         32          0
          12          2          2         22          0
          13          1          1         32          0
          13          2          2         22          0
          14          1          1         32          0
          14          2          2         22          0
          15          1          1         32          0
          15          2          2         22          0
          16          1          1         32          0
          16          2          2         22          0
          17          1          1         32          0
          17          2          2         22          0
          18          1          1         32          0
          18          2          2         22          0


54.7 пример,  причина из gv$sql_shared_cursor child_cursors reasons for sql_id

$ tpi mprod sql sql_shared_cursor 95prusc0f1xss 

'gv$sql_shared_cursor child_cursors reasons for sql_id: 95prusc0f1xss order by child_number desc"
SQL_ID                        : 95prusc0f1xss
ADDRESS                       : 0000000076D38FC0
CHILD_ADDRESS                 : 0000000076D37B98
CHILD_NUMBER                  : 0
UNBOUND_CURSOR                : N
SQL_TYPE_MISMATCH             : N
OPTIMIZER_MISMATCH            : N
OUTLINE_MISMATCH              : N
STATS_ROW_MISMATCH            : N
LITERAL_MISMATCH              : N
FORCE_HARD_PARSE              : N
EXPLAIN_PLAN_CURSOR           : N
BUFFERED_DML_MISMATCH         : N
PDML_ENV_MISMATCH             : N
INST_DRTLD_MISMATCH           : N
SLAVE_QC_MISMATCH             : N
TYPECHECK_MISMATCH            : N
AUTH_CHECK_MISMATCH           : N
BIND_MISMATCH                 : N
DESCRIBE_MISMATCH             : N
LANGUAGE_MISMATCH             : N
TRANSLATION_MISMATCH          : N
BIND_EQUIV_FAILURE            : N
INSUFF_PRIVS                  : N
INSUFF_PRIVS_REM              : N
REMOTE_TRANS_MISMATCH         : N
LOGMINER_SESSION_MISMATCH     : N
INCOMP_LTRL_MISMATCH          : N
OVERLAP_TIME_MISMATCH         : N
EDITION_MISMATCH              : N
MV_QUERY_GEN_MISMATCH         : N
USER_BIND_PEEK_MISMATCH       : N
TYPCHK_DEP_MISMATCH           : N
NO_TRIGGER_MISMATCH           : N
FLASHBACK_CURSOR              : N
ANYDATA_TRANSFORMATION        : N
PDDL_ENV_MISMATCH             : N
TOP_LEVEL_RPI_CURSOR          : N
DIFFERENT_LONG_LENGTH         : N
LOGICAL_STANDBY_APPLY         : N
DIFF_CALL_DURN                : N
BIND_UACS_DIFF                : N
PLSQL_CMP_SWITCHS_DIFF        : N
CURSOR_PARTS_MISMATCH         : N
STB_OBJECT_MISMATCH           : N
CROSSEDITION_TRIGGER_MISMATCH : N
PQ_SLAVE_MISMATCH             : N
TOP_LEVEL_DDL_MISMATCH        : N
MULTI_PX_MISMATCH             : N
BIND_PEEKED_PQ_MISMATCH       : N
MV_REWRITE_MISMATCH           : N
ROLL_INVALID_MISMATCH         : N
OPTIMIZER_MODE_MISMATCH       : N
PX_MISMATCH                   : N
MV_STALEOBJ_MISMATCH          : N
FLASHBACK_TABLE_MISMATCH      : N
LITREP_COMP_MISMATCH          : N
PLSQL_DEBUG                   : N
LOAD_OPTIMIZER_STATS          : Y
ACL_MISMATCH                  : N
FLASHBACK_ARCHIVE_MISMATCH    : N
LOCK_USER_SCHEMA_FAILED       : N
REMOTE_MAPPING_MISMATCH       : N
LOAD_RUNTIME_HEAP_FAILED      : N
HASH_MATCH_FAILED             : N
PURGED_CURSOR                 : N
BIND_LENGTH_UPGRADEABLE       : N
USE_FEEDBACK_STATS            : N
REASON                        : <ChildNode><ChildNumber>0</ChildNumber><ID>39</ID><reason>Bind mismatch(25)</reason><size>0x0</size><details>extended_cursor_sharing</details></ChildNode>
CON_ID                        : 0
---------------------------------------------------
SQL_ID                        : 95prusc0f1xss
ADDRESS                       : 0000000076D38FC0
CHILD_ADDRESS                 : 00000000769EB508
CHILD_NUMBER                  : 1
UNBOUND_CURSOR                : N
SQL_TYPE_MISMATCH             : N
OPTIMIZER_MISMATCH            : N
OUTLINE_MISMATCH              : N
STATS_ROW_MISMATCH            : N
LITERAL_MISMATCH              : N
FORCE_HARD_PARSE              : N
EXPLAIN_PLAN_CURSOR           : N
BUFFERED_DML_MISMATCH         : N
PDML_ENV_MISMATCH             : N
INST_DRTLD_MISMATCH           : N
SLAVE_QC_MISMATCH             : N
TYPECHECK_MISMATCH            : N
AUTH_CHECK_MISMATCH           : N
BIND_MISMATCH                 : N
DESCRIBE_MISMATCH             : N
LANGUAGE_MISMATCH             : N
TRANSLATION_MISMATCH          : N
BIND_EQUIV_FAILURE            : Y
INSUFF_PRIVS                  : N
INSUFF_PRIVS_REM              : N
REMOTE_TRANS_MISMATCH         : N
LOGMINER_SESSION_MISMATCH     : N
INCOMP_LTRL_MISMATCH          : N
OVERLAP_TIME_MISMATCH         : N
EDITION_MISMATCH              : N
MV_QUERY_GEN_MISMATCH         : N
USER_BIND_PEEK_MISMATCH       : N
TYPCHK_DEP_MISMATCH           : N
NO_TRIGGER_MISMATCH           : N
FLASHBACK_CURSOR              : N
ANYDATA_TRANSFORMATION        : N
PDDL_ENV_MISMATCH             : N
TOP_LEVEL_RPI_CURSOR          : N
DIFFERENT_LONG_LENGTH         : N
LOGICAL_STANDBY_APPLY         : N
DIFF_CALL_DURN                : N
BIND_UACS_DIFF                : N
PLSQL_CMP_SWITCHS_DIFF        : N
CURSOR_PARTS_MISMATCH         : N
STB_OBJECT_MISMATCH           : N
CROSSEDITION_TRIGGER_MISMATCH : N
PQ_SLAVE_MISMATCH             : N
TOP_LEVEL_DDL_MISMATCH        : N
MULTI_PX_MISMATCH             : N
BIND_PEEKED_PQ_MISMATCH       : N
MV_REWRITE_MISMATCH           : N
ROLL_INVALID_MISMATCH         : N
OPTIMIZER_MODE_MISMATCH       : N
PX_MISMATCH                   : N
MV_STALEOBJ_MISMATCH          : N
FLASHBACK_TABLE_MISMATCH      : N
LITREP_COMP_MISMATCH          : N
PLSQL_DEBUG                   : N
LOAD_OPTIMIZER_STATS          : N
ACL_MISMATCH                  : N
FLASHBACK_ARCHIVE_MISMATCH    : N
LOCK_USER_SCHEMA_FAILED       : N
REMOTE_MAPPING_MISMATCH       : N
LOAD_RUNTIME_HEAP_FAILED      : N
HASH_MATCH_FAILED             : N
PURGED_CURSOR                 : N
BIND_LENGTH_UPGRADEABLE       : N
USE_FEEDBACK_STATS            : Y
REASON                        : <ChildNode><ChildNumber>1</ChildNumber><ID>39</ID><reason>Bind
mismatch(33)</reason><size>3x4</size><bind_position>1</bind_position><selectivity>268897646</selectivity><negative_exponent>12</negative_exponent></ChildNode>
CON_ID                        : 0


54.8 пример, sqlstat по запросу 95prusc0f1xss из  GV$SQLSTATS, с командой по удалению sql_id из кеша/

$ tpi mprod sql sqlstat 95prusc0f1xss

"After change plan do not forget purge the old statistics:"

gv$sqlarea:
  IN  CON COMMAND TO PURGE SQL STATEMENT                                         LAST_ACTIVE_TIME  SQL_ID           HASH_VALUE   EXECUTIONS      LOADS VERSION_COUNT INVALIDATIONS  PARSE_CALLS
---- ---- ---------------------------------------------------------------------- ----------------- --------------- ----------- ------------ ---------- ------------- ------------- ------------
   1    0 exec dbms_shared_pool.purge ('0000000076D38FC0,14743320','C');         15/10/25 17:21:12 95prusc0f1xss      14743320           45         23            19             1           45

gv$sql:
  IN  CON SQL_ID          PLAN_HASH_VALUE USERS_OPENING USERS_EXECUTING OPEN_VERSIONS CHILD_NUMBER   CPU_TIME ELAPSED_TIME CLUSTER_WAIT_TIME USER_IO_WAIT_TIME I
---- ---- --------------- --------------- ------------- --------------- ------------- ------------ ---------- ------------ ----------------- ----------------- -
   1    0 95prusc0f1xss        1096924374             0               0             0            0      41054        42757                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0            1      68722        78285                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0            2      35671        35737                 0                 0 N
   1    0 95prusc0f1xss        3751289970             0               0             0            3      72380        72681                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0            4      70395        90991                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0            5      31943        32419                 0                 0 N
   1    0 95prusc0f1xss        3751289970             0               0             0            6      67790        67981                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0            7      81275        87318                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0            8      34476        34908                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0            9      33495        33527                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0           10      34997        35612                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0           11      51896        52553                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0           12      90120        97112                 0                 0 N
   1    0 95prusc0f1xss         679500661             0               0             0           13     169567       171850                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0           14      36974        37296                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0           15      42270        43130                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0           16      45330        49267                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0           17     104630       117548                 0                 0 N
   1    0 95prusc0f1xss        1096924374             0               0             0           18     334387       413169                 0                 0 N

SQLStats from GV$SQLSTATS  for sql_id: 95prusc0f1xss
  IN  CON SQL_ID          PLAN_HASH_VALUE LAST_ACTIVE_TIME   PARSE_CALLS INVALIDATIONS   FCH\EX  SORT\EX         EXEC       PIO\EX          LIO\EX   ROWS_PR\EX   CPU_TIME\EX   ELA_TIME\EX  IOWAIT\EX SHARABLE_MEM
---- ---- --------------- --------------- ----------------- ------------ ------------- -------- -------- ------------ ------------ --------------- ------------ ------------- ------------- ---------- ------------
   1    0 95prusc0f1xss        1096924374 15/10/25 17:21:12           45             1       13        0           45            0          16,483        1,313         .0322         .0354          0      3844176



54.9 пример, sqlstat  из GV$SQLSTATS, с сортировкой по умолчанию order by PIO_PER_EXEC * executions desc
$ tpi mprod sql sqlstat

"TOP 40 SQLStats from GV$SQLSTATS in last_active_time between to_date('15/10/25 17:55:47','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate  order by PIO_PER_EXEC * executions desc"

  IN  CON SQL_ID          PLAN_HASH_VALUE LAST_ACTIVE_TIME   PARSE_CALLS INVALIDATIONS   FCH\EX  SORT\EX         EXEC       PIO\EX          LIO\EX   ROWS_PR\EX   CPU_TIME\EX   ELA_TIME\EX  IOWAIT\EX SHARABLE_MEM
---- ---- --------------- --------------- ----------------- ------------ ------------- -------- -------- ------------ ------------ --------------- ------------ ------------- ------------- ---------- ------------
   1    0 03guhbfpak0w7        3246118364 15/10/25 17:43:43        7,251             0        2        0        7,251            1              11            2         .0001         .0002          0       186120
   1    0 a95n8p4vpxmps                 0 15/10/25 17:00:43          365             0        0        0          365            1           6,673            1         .0816         .0830          0        20488
   1    0 4j17u5xs3wkgc                 0 15/10/25 17:55:45           17             0        0        0           16            8         536,396            1        7.8138        6.9336          0        36712
   1    0 g1021vycj5vb2                 0 15/10/25 17:50:58           93             0        0        0           93            1             261            1         .0111         .0111          0        20488
   1    0 7f3s33df44juy                 0 15/10/25 17:17:45            7             0        0        0            7           12          22,280            1         .3305         .3331          0        24544
   1    0 7sf9zx95wpnr0        2980417758 15/10/25 17:14:35            7             0        1        1            7            1              48            2         .0017         .0021          0        52680
   1    0 f8j3s70z9s2c1        4044214101 15/10/25 17:13:38            2             0        1        0            2            2              48            0         .0013         .0013          0        20232
   1    0 1a9srs2rtrk98        2186213869 15/10/25 17:13:38            2             0        1        0            2            2             222            0         .0030         .0028          0        20232
   1    0 2auyfk7aa7fu7         285971333 15/10/25 17:13:38            2             0        1        0            2            2              51            0         .0014         .0015          0        20232


54.10 пример, sqlstat  из GV$SQLSTATS, с сортировкой ela - order by elapsed_time * executions desc
$ tpi mprod sql sqlstat ela

"TOP 40 SQLStats from GV$SQLSTATS in last_active_time between to_date('15/10/25 17:59:07','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate  order by elapsed_time * executions desc"

  IN  CON SQL_ID          PLAN_HASH_VALUE LAST_ACTIVE_TIME   PARSE_CALLS INVALIDATIONS   FCH\EX  SORT\EX         EXEC       PIO\EX          LIO\EX   ROWS_PR\EX   CPU_TIME\EX   ELA_TIME\EX  IOWAIT\EX SHARABLE_MEM
---- ---- --------------- --------------- ----------------- ------------ ------------- -------- -------- ------------ ------------ --------------- ------------ ------------- ------------- ---------- ------------
   1    0 7vz3g9zf47vqf                 0 15/10/25 17:58:57      278,907             0        0        0      278,907            0           2,791            2         .0138         .0138          0        20488
   1    0 8nns00ft44cjr                 0 15/10/25 17:58:57       87,876             0        0        0       87,876            0           4,274            1         .0287         .0407          0        36712
   1    0 f4u4s8d5kuk56                 0 15/10/25 17:59:07      168,435             0        0        0      168,435            0           2,455            1         .0161         .0160          0        20488
   1    0 7hgy8gjagg1sk                 0 15/10/25 17:58:57       97,199             0        0        0       97,200            0           4,203            1         .0247         .0246          0        24544
   1    0 42uf0huvv47hz                 0 15/10/25 17:58:57       87,876             0        0        0       87,876            0              47            1         .0030         .0148          0        20488
   1    0 22356bkgsdcnh         585200625 15/10/25 17:57:07        3,880             0        1        0       13,189            0               0            1         .0191         .0193          0        60696
   1    0 b4bhfqtscdty2                 0 15/10/25 17:59:07       70,486             0        0        0       70,486            0               2            1         .0017         .0017          0        24544
   1    0 4j17u5xs3wkgc                 0 15/10/25 17:59:05           17             0        0        0           16            8         536,543            1        7.8161        6.9355          0        36712
   1    0 bn7sh27xnf8ds                 0 15/10/25 17:55:09        2,687             0        0        0        2,687            0           4,255            1         .0291         .0412          0        36712


55. ash [in=INST_ID] [con=[CON_ID]] [dd/mm/yy-HH:MI-HH:MI(hours) - def1h] [ event | sess [SID SERIAL# [all|nosqlid|tchcnt] | SQL_ID] | where [FIELD CONDITION] | sql [top [event]] [all [event]] [SQL_ID|SQL_TEXT] | plan SQL_ID PHV [fmt display plan] | sqlstat [SQL_ID|par|inv|fch|sor|exe|pio|lio|row|cpu|ela|iow|mem] [executions] | insection [username|service|machine|program,module,action|sql_opname,sql_plan_operation,sql_plan_options|PLSQL_ENTRY_OBJECT_ID|event|wait_class] | temp [sizeMb] | (umc)chart ] - Top SQL, Events, Sessions GV$ACTIVE_SESSION_HISTORY

    опция для работы с ASH, можно указать период [dd/mm/yy-HH:MI-HH:MI(hours) - def1h], - поумолчанию 1 последний час

55.1 ash - без параметров выдаст достйпный период в ASH
$ tpi mprod ash

"Avilable period at V$ACTIVE_SESSION_HISTORY:"

MIN_SAMPLE_TIME           MAX_SAMPLE_TIME
------------------------- -------------------------
30/09/2025 11:49:41       15/10/2025 18:57:07

55.2 ash event - топ 20 events
"Top 20 events from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 19:01:47','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON EVENT                                %ACTIVITY
---- ---- ----------------------------------- ----------
   1    0 ON CPU                                      69
   1    0 log file parallel write                      9
   1    0 latch free                                   4
   1    0 db file async I/O submit                     4
   1    0 control file parallel write                  3
   1    0 LGWR all worker groups                       3
   1    0 db file single write                         1
   1    0 enq: CR - block range reuse ckpt             1
   1    0 Disk file operations I/O                     1


55.3 пример, Top 30 ACTIVE Sessions in seconds from GV$ACTIVE_SESSION_HISTORY  - топ 30 сессий в ash , по активности

$ tpi mprod ash sess

"Top 30 ACTIVE Sessions in seconds from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 19:02:31','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON    SID  SERIAL USERNAME                  PROGRAM \ MODULE \ ACTION \ MACHINE                                    TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- ------ ------- ------------------------- ---------------------------------------------------------------------- ----------- --------- --------- --------- ---------
   1    0    422   47684 SYS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu        0.00      0.00                         10.81
   1    0     67    9414 IBS                       plsqldev.exe \ PL/SQL Developer \ SQL Window \ WORKGROUP\DESKTOP-KV785       11.61     11.61                          2.70
   1    0    178   62589 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \ IBS.CIT_INTERFACE.MST_FE        0.00                0.00      0.00      2.70
   1    0      9   15116 IBS                       Novo121_97.exe \ Автоматизированное рабочее место \ 18:16:Nav.View 160        0.00      0.00                          2.70
   1    0    135   15795 SYS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (M000) \ MMON_SLAVE \ Auto-Flush         0.00      0.00                          2.70
   1    0     17   12464 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.CIT_INTERFACE.MST_FE        0.00                0.00      0.00      2.70
   1    0     17   20267 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.CIT_INTERFACE.MST_FE        0.00                0.00      0.00      2.70
   1    0      9   15116 IBS                       Novo121_97.exe \ Автоматизированное рабочее место \ 18:18:Nav.View 160        0.00      0.00                          2.70
   1    0      9   15116 IBS                       Novo121_97.exe \ Автоматизированное рабочее место \ 18:18:Nav.View 158        0.00      0.00                          2.70
   1    0     17   37395 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.CIT_INTERFACE.MST_FE        0.00      0.00                          2.70
   1    0    178   39976 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \ IBS.CIT_INTERFACE.MST_FE        0.41      0.41                          2.70
   1    0    429   27811 SYS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (M006) \ MMON_SLAVE \ AWR Auto-Pu        0.00                0.00      0.00      2.70
   1    0    178   33857 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \  \  \ prod-db.nc152.cmp.        0.49      0.49                          2.70
   1    0    131   23863 SYS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (MZ00) \ MMON_SLAVE \ Execute Sta        0.00      0.00                          2.70
   1    0     17   62303 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.CIT_INTERFACE.MST_FE        0.42      0.42                          2.70
   1    0    178    8546 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \ IBS.CIT_INTERFACE.MST_FE        0.42      0.42                          2.70
   1    0    178   30584 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \  \  \ prod-db.nc152.cmp.        0.43      0.43                          2.70
   1    0    127    3446 SYS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (W005) \ KTSJ \ KTSJ Slave \ prod        0.00                0.00      0.00      2.70
   1    0     17    5664 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.CIT_INTERFACE.MST_FE        0.50      0.50                          2.70
   1    0     17   50850 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.CIT_INTERFACE.MST_FE        0.41      0.41                          2.70
   1    0     17    9194 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.FIN_ORDER.MST_AUTO_P        0.01      0.01                          2.70
   1    0     17    5519 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \  \  \ prod-db.nc152.cmp.        0.50      0.50                          2.70
   1    0     17   51597 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \  \  \ prod-db.nc152.cmp.        0.50      0.50                          2.70
   1    0    131    1597 SYS                       rman@prod-db.nc152.cmp.nkz.icdc.io (TNS V1-V3) \ rman@prod-db.nc152.cm        0.00      0.00                          2.70
   1    0     17   39458 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \  \  \ prod-db.nc152.cmp.        0.50      0.50                          2.70
   1    0      9   15116 IBS                       Novo121_97.exe \ Автоматизированное рабочее место \ 18:16:Nav.Execute         0.00      0.00                          2.70
   1    0     17   19333 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.CIT_INTERFACE.MST_FE        0.00                0.00      0.00      2.70
   1    0    178   61475 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \  \  \ prod-db.nc152.cmp.        0.50      0.50                          2.70
   1    0    178   17744 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \ IBS.CIT_INTERFACE.MST_FE        0.50      0.50                          2.70
   1    0     17   27216 IBS                       oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \  \  \ prod-db.nc152.cmp.        0.49      0.49                          2.70

55.4 - пример, Top 30 Waits in seconds  from GV$ACTIVE_SESSION_HISTORY for sid = '422' and serial = '47684' - топ активности запросов, попавших в ash указанной сессии
$ tpi mprod ash sess  422   47684

"Top 30 Waits in seconds  from GV$ACTIVE_SESSION_HISTORY for sid = '422' and serial = '47684' and sample_time between to_date('15/10/25 19:04:09','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON    SID  SERIAL USERNAME                  SQL_ID                PHV EVENT                               PROGRAM \ MODULE \ ACTION \ MACHINE                                    TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- ------ ------- ------------------------- ------------- ----------- ----------------------------------- ---------------------------------------------------------------------- ----------- --------- --------- --------- ---------
   1    0    422   47684 SYS                       b591x606ggbn6  1734303187 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu        0.00      0.00                         25.00
   1    0    422   47684 SYS                       5t471b7yabqqz  2497072095 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu        0.00      0.00                         25.00
   1    0    422   47684 SYS                       fd0n0rymuncqv  4206266407 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu        0.00      0.00                         25.00
   1    0    422   47684 SYS                       c2p32r5mzv8hb           0 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu        0.00      0.00                         25.00


55.5 пример, Session from GV$ACTIVE_SESSION_HISTORY by filter: session_id=422 and session_serial#=47684 - все запросы сессии попавшие в ash
$ tpi mprod  ash sess  422   47684 all

"Session from GV$ACTIVE_SESSION_HISTORY by filter: session_id=422 and session_serial#=47684 and sample_time between to_date('15/10/25 19:05:01','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON TIME                 SID  SERIAL USERNAME                  SQL_ID        EVENT                                    OBJ# FILE#   BLOCK# BLSTATUS     BLSID BLSERIAL PROGRAM \ MODULE \ ACTION \ MACHINE
---- ---- ----------------- ------ ------- ------------------------- ------------- ----------------------------------- --------- ----- -------- ----------- ------ -------- ----------------------------------------------------------------------
   1    0 15/10/25 18:27:06    422   47684 SYS                       5t471b7yabqqz ON CPU                                     -1     0        0 NOT IN WAIT                 oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu
   1    0 15/10/25 18:27:07    422   47684 SYS                       fd0n0rymuncqv ON CPU                                  11765     0        0 NOT IN WAIT                 oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu
   1    0 15/10/25 18:27:08    422   47684 SYS                       b591x606ggbn6 ON CPU                                   9174     0        0 NOT IN WAIT                 oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu
   1    0 15/10/25 18:27:09    422   47684 SYS                       c2p32r5mzv8hb ON CPU                                   9154     0        0 NOT IN WAIT                 oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu


55.6 пример, Top 30 Waits in seconds  from GV$ACTIVE_SESSION_HISTORY for sid = '422' and serial = '47684'  - данные по работе сессии, без привязки к sql_id, т.е. что делала сессия, увидим ON CPU, Event Waiting и т.п.
$ tpi mprod  ash sess  422   47684 nosqlid

"Top 30 Waits in seconds  from GV$ACTIVE_SESSION_HISTORY for sid = '422' and serial = '47684' and sample_time between to_date('15/10/25 19:05:41','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON    SID  SERIAL USERNAME                  EVENT                               PROGRAM \ MODULE \ ACTION \ MACHINE                                    TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- ------ ------- ------------------------- ----------------------------------- ---------------------------------------------------------------------- ----------- --------- --------- --------- ---------
   1    0    422   47684 SYS                       ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu        0.00      0.00                        100.00


55.7 пример, Session from GV$ACTIVE_SESSION_HISTORY by filter: session_id=422 and session_serial#=47684 - сессия с каким объектом больше всего touch-count objects

$ tpi mprod  ash sess  422   47684 tchcnt

"Session from GV$ACTIVE_SESSION_HISTORY by filter: session_id=422 and session_serial#=47684 and sample_time between to_date('15/10/25 19:06:07','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate by touch-count objects:"

OWNER                          OBJECT_NAME                    OBJECT_TYPE                        TCHCNT
------------------------------ ------------------------------ ------------------------------ ----------
SYS                            SYS_LOB0000009153C00008$$      LOB                                     1
SYS                            SYS_LOB0000011764C00038$$      LOB                                     1
SYS                            SYS_LOB0000009171C00012$$      LOB                                     1

55.8 пример, Session from GV$ACTIVE_SESSION_HISTORY by filter: SQL_ID: 5t471b7yabqqz - все сессии которые выполняли sql_id

$ tpi mprod  ash sess  5t471b7yabqqz

"Session from GV$ACTIVE_SESSION_HISTORY by filter: SQL_ID: 5t471b7yabqqz and sample_time between to_date('15/10/25 19:06:15','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON TIME                 SID  SERIAL USERNAME                  SQL_ID        EVENT                                    OBJ# FILE#   BLOCK# BLSTATUS     BLSID BLSERIAL PROGRAM \ MODULE \ ACTION \ MACHINE
---- ---- ----------------- ------ ------- ------------------------- ------------- ----------------------------------- --------- ----- -------- ----------- ------ -------- ----------------------------------------------------------------------
   1    0 15/10/25 18:27:06    422   47684 SYS                       5t471b7yabqqz ON CPU                                     -1     0        0 NOT IN WAIT                 oracle@prod-db.nc152.cmp.nkz.icdc.io (M004) \ MMON_SLAVE \ AWR Auto-Pu



55.9 ash where [FIELD CONDITION] - ручной запрос к ash

наппример, ash where PLSQL_ENTRY_OBJECT_ID=64249 - какие запросы были выполнены из пакета PLSQL_ENTRY_OBJECT_ID=64249

$ tpi mprod  ash where PLSQL_ENTRY_OBJECT_ID=64249
DB=mprod 15/10/25-19:12:23 ver=15.10.25  ash [in=INST_ID] [con=[CON_ID]] [dd/mm/yy-HH:MI-HH:MI(hours) - def1h] [ event | sess [SID SERIAL# [all|nosqlid|tchcnt] | SQL_ID] | where [FIELD CONDITION] | sql [top [event]] [all [event]] [SQL_ID|SQL_TEXT] | plan SQL_ID PHV [fmt display plan] | sqlstat [SQL_ID|par|inv|fch|sor|exe|pio|lio|row|cpu|ela|iow|mem] [executions] | insection [username|service|machine|program,module,action|sql_opname,sql_plan_operation,sql_plan_options|PLSQL_ENTRY_OBJECT_ID|event|wait_class] | temp [sizeMb] | (umc)chart ] - Top SQL, Events, Sessions GV$ACTIVE_SESSION_HISTORY , for: where PLSQL_ENTRY_OBJECT_ID=64249

"Stat top 30 session_state from GV$ACTIVE_SESSION_HISTORY for condition:  PLSQL_ENTRY_OBJECT_ID=64249 and  and sample_time between to_date('15/10/25 19:12:24','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON USERNAME                  SQL_ID                PHV EVENT                               PROGRAM \ MODULE \ ACTION \ MACHINE                                    TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- ------------------------- ------------- ----------- ----------------------------------- ---------------------------------------------------------------------- ----------- --------- --------- --------- ---------
   1    0 IBS                       f4u4s8d5kuk56           0 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \  \  \ prod-db.nc152.cmp.        1.48      1.48                         60.00
   1    0 IBS                       f4u4s8d5kuk56           0 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \  \  \ prod-db.nc152.cmp.        0.49      0.49                         20.00
   1    0 AUDM                      gsr7h7jgbq60d  1635149748 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J000) \ AUD_MGR \ Auditing sessi       10.00     10.00                         20.00


-- предварительно найдем ID Объекта:
$ tpi mprod  o 64249

Objects from dba_objects where object_id = '64249':
 OBJECT_ID OWNER                          OBJECT_NAME                    OBJECT_TYPE          CREATED           LAST_DDL_TIME     STATUS
---------- ------------------------------ ------------------------------ -------------------- ----------------- ----------------- -------
     64249 AUDM                           AUD_MGR                        PACKAGE              30/01/25 22:51:39 30/01/25 22:51:39 VALID


55.10 ash where "USERNAME='IBS'" - какие запросы выполнены пользователем "IBS"
 tpi mprod  ash where "USERNAME='IBS'"
DB=mprod 15/10/25-19:18:27 ver=15.10.25  ash [in=INST_ID] [con=[CON_ID]] [dd/mm/yy-HH:MI-HH:MI(hours) - def1h] [ event | sess [SID SERIAL# [all|nosqlid|tchcnt] | SQL_ID] | where [FIELD CONDITION] | sql [top [event]] [all [event]] [SQL_ID|SQL_TEXT] | plan SQL_ID PHV [fmt display plan] | sqlstat [SQL_ID|par|inv|fch|sor|exe|pio|lio|row|cpu|ela|iow|mem] [executions] | insection [username|service|machine|program,module,action|sql_opname,sql_plan_operation,sql_plan_options|PLSQL_ENTRY_OBJECT_ID|event|wait_class] | temp [sizeMb] | (umc)chart ] - Top SQL, Events, Sessions GV$ACTIVE_SESSION_HISTORY , for: where USERNAME='IBS'

"Stat top 30 session_state from GV$ACTIVE_SESSION_HISTORY for condition:  USERNAME='IBS' and  and sample_time between to_date('15/10/25 19:18:27','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON USERNAME                  SQL_ID                PHV EVENT                               PROGRAM \ MODULE \ ACTION \ MACHINE                                    TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- ------------------------- ------------- ----------- ----------------------------------- ---------------------------------------------------------------------- ----------- --------- --------- --------- ---------
   1    0 IBS                       f4u4s8d5kuk56           0 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \  \  \ prod-db.nc152.cmp.        1.48      1.48                         20.00
   1    0 IBS                       42uf0huvv47hz           0 External Procedure initial connecti oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.CIT_INTERFACE.MST_FE        0.00                0.00      0.00     13.33
                                                              on

   1    0 IBS                       7vz3g9zf47vqf           0 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.CIT_INTERFACE.MST_FE        0.83      0.83                         13.33
   1    0 IBS                       42uf0huvv47hz           0 External Procedure initial connecti oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \ IBS.CIT_INTERFACE.MST_FE        0.00                0.00      0.00      6.67
                                                              on

   1    0 IBS                       4zh3ghtdvpz8j  3218547113 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.CIT_INTERFACE.MST_FE        0.50      0.50                          6.67
   1    0 IBS                       fy9fwsa6s3ry8           0 ON CPU                              Novo121_97.exe \ Автоматизированное рабочее место \ 18:18:Nav.View 160        0.00      0.00                          6.67
   1    0 IBS                       bn7sh27xnf8ds           0 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.FIN_ORDER.MST_AUTO_P        0.01      0.01                          6.67
   1    0 IBS                       f4u4s8d5kuk56           0 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \  \  \ prod-db.nc152.cmp.        0.49      0.49                          6.67
   1    0 IBS                       g5pkzwxpgd5gk   518312487 ON CPU                              plsqldev.exe \ PL/SQL Developer \ SQL Window \ WORKGROUP\DESKTOP-KV785       11.61     11.61                          6.67
   1    0 IBS                       7vz3g9zf47vqf           0 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \ IBS.CIT_INTERFACE.MST_FE        0.50      0.50                          6.67
   1    0 IBS                                               0 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J002) \ IBS.CIT_INTERFACE.MST_FE        0.00      0.00                          6.67


или так

$ tpi mprod  ash where "username='IBS' and module like 'IBS.FIN_ORDER%'"

"Stat top 30 session_state from GV$ACTIVE_SESSION_HISTORY for condition:  USERNAME='IBS' and module like 'IBS.FIN_ORDER%' and  and sample_time between to_date('15/10/25 19:20:40','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON USERNAME                  SQL_ID                PHV EVENT                               PROGRAM \ MODULE \ ACTION \ MACHINE                                    TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- ------------------------- ------------- ----------- ----------------------------------- ---------------------------------------------------------------------- ----------- --------- --------- --------- ---------
   1    0 IBS                       bn7sh27xnf8ds           0 ON CPU                              oracle@prod-db.nc152.cmp.nkz.icdc.io (J001) \ IBS.FIN_ORDER.MST_AUTO_P        0.01      0.01                        100.00


55.11 - Top 10 SQL, CALL from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 19:22:46','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

$ tpi mprod  ash sql

"Top 10 SQL, CALL from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 19:22:46','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON SQL_ID         PLAN_HASH TYPE                         TIME_WAITED       CPU      WAIT        IO %ACTIVITY SQL_TEXT
---- ---- ------------- ---------- ---------------------------- ----------- --------- --------- --------- --------- --------------------------------------------------------------------------------
   1    0 f4u4s8d5kuk56          0 PL/SQL EXECUTE                      2.97      2.97                         20.00 BEGIN     AUDM.aud_mgr.init_contexts; END;

          772s25v1y0x8k 2909482823 SELECT                             12.00     12.00                         13.33 select shared_pool_size_for_estimate s,          shared_pool_siz
                                                                                                                    e_factor * 100 f,          estd_lc_load_time l, 0             fr
                                                                                                                    om v$shared_pool_advice

          42uf0huvv47hz          0 PL/SQL EXECUTE                      0.00                0.00      0.00     10.00 BEGIN Z$CIT_INTERFACE_MST_1609514519.MST_FEX_PROCESS_EXECUTE(NUL
                                                                                                                    L,NULL); END;

          7vz3g9zf47vqf          0 PL/SQL EXECUTE                      1.33      1.33                         10.00 BEGIN :RESULT:=Z$SYSTEM_INIT_CONTEXT.init_user_context; END;


          22356bkgsdcnh  585200625 SELECT                              0.00      0.00                          3.33 SELECT COUNT(*) FROM X$KSPPI A, X$KSPPCV2 B WHERE A.INDX + 1 = K
                                                                                                                    SPFTCTXPN AND KSPPINM = '_deferred_log_dest_is_valid' AND UPPER(
                                                                                                                    KSPFTCTXVL)='TRUE'

          5t471b7yabqqz 2497072095 CREATE TABLE                        0.00      0.00                          3.33 alter table WRH$_TABLESPACE_STAT split partition WRH$_TABLESPACE
                                                                                                                    _STAT_2904955675_MXSN at (2904955675,367) into (partition WRH$_T
                                                                                                                    ABLESPACE_STAT_2904955675_367, partition WRH$_TABLESPACE_STAT_29
                                                                                                                    04955675_MXSN tablespace SYSAUX) update indexes

          b591x606ggbn6 1734303187 DELETE                              0.00      0.00                          3.33 DELETE FROM wri$_adv_recommendations a                   WHERE a
                                                                                                                    .task_id = :task_id_num AND          (:execution_name IS NULL OR
                                                                                                                     :execution_name1 = a.exec_name)

          c2p32r5mzv8hb          0 PL/SQL EXECUTE                      0.00      0.00                          3.33 BEGIN    prvt_advisor.delete_expired_tasks;  END;

          gsr7h7jgbq60d 1635149748 SELECT                             10.00     10.00                          3.33 SELECT NVL(U.NAME,UPPER(T.USERNAME)||' Manager') NAME,U.USERNAME
                                                                                                                    ,UPPER(T.USERNAME) ORAUSER, T.OS_USERNAME,T.TERMINAL,T.SESSIONID
                                                                                                                    ,T.RETURNCODE,FROM_TZ(T.NTIMESTAMP#,'00:00') AT TIME ZONE '+05:0
                                                                                                                    0' TIME_VAL,SUBSTR(T.COMMENT_TEXT,1,200) TEXT FROM DBA_AUDIT_TRA
                                                                                                                    IL T, IBS.USERS U WHERE T.ACTION=100 AND T.NTIMESTAMP#>=:B2 AND
                                                                                                                    T.NTIMESTAMP#<:B1 AND T.RETURNCODE<>0 AND UPPER(T.USERNAME)=U.US
                                                                                                                    ERNAME(+)

55.12 - Top 30 SQL TIME_WAITED in second from GV$ACTIVE_SESSION_HISTORY  - анлогично предыдущему, но без текста запроса.

$ tpi mprod  ash sql top

"Top 30 SQL TIME_WAITED in second from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 19:23:58','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate for event like '%%'"

  IN  CON SQL_ID                PHV SQL_OPNAME      ENTRY_NAME                                    TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- ------------- ----------- --------------- --------------------------------------------- ----------- --------- --------- --------- ---------
   1    0 f4u4s8d5kuk56           0 PL/SQL EXECUTE  AUD_MGR.INIT_CONTEXTS                                2.90      2.90                         17.14
   1    0 772s25v1y0x8k  2909482823 SELECT                                                              12.00     12.00                         11.43
   1    0 42uf0huvv47hz           0 PL/SQL EXECUTE  Z$SYSTEM_JOBS_JOB_LIB.RUN                            0.00                0.00      0.00      8.57
   1    0 22356bkgsdcnh   585200625 SELECT          DBMS_RCVMAN.RESETALL                                 0.00      0.00                          2.86
   1    0 4f0cdt7px0hd6           0 ALTER TABLE                                                          0.00                0.00      0.00      2.86
   1    0 7vz3g9zf47vqf           0 PL/SQL EXECUTE  Z$SYSTEM_JOBS_JOB_LIB.RUN                            0.42      0.42                          2.86
   1    0 f4u4s8d5kuk56           0 PL/SQL EXECUTE  AUD_MGR.INIT_CONTEXTS                                0.50      0.50                          2.86
   1    0 fd0n0rymuncqv  4206266407 DELETE                                                               0.00      0.00                          2.86
   1    0 275myz015ykv6  1088645672 SELECT          Z$SYSTEM_JOBS_JOB_LIB.RUN                            0.42      0.42                          2.86
   1    0 94d0xp8nc5y74  3985478653 SELECT          Z$SYSTEM_JOBS_JOB_LIB.RUN                            0.50      0.50                          2.86
   1    0 6a2pszhkuncvx           0 PL/SQL EXECUTE  Z$SYSTEM_JOBS_JOB_LIB.RUN                            0.50      0.50                          2.86
   1    0 06au0vnr8r361           0 PL/SQL EXECUTE                                                       1.00      1.00                          2.86
   1    0 gsr7h7jgbq60d  1635149748 SELECT          AUD_MGR.JOB                                         10.00     10.00                          2.86
   1    0 30p3mh3brvpt9  3657335830 SELECT                                                               0.00      0.00                          2.86
   1    0 6xqw1kfx3hzgs  1257452056 SELECT                                                               0.00      0.00                          2.86
   1    0 5t471b7yabqqz  2497072095 CREATE TABLE                                                         0.00      0.00                          2.86
   1    0 1kb56hd6c73bv  3360256953 SELECT                                                               0.00      0.00                          2.86
   1    0 f3yfg50ga0r8n  4276582153 SELECT                                                               0.00                0.00      0.00      2.86
   1    0 c2p32r5mzv8hb           0 PL/SQL EXECUTE  PRVT_ADVISOR.DELETE_EXPIRED_TASKS                    0.00      0.00                          2.86
   1    0 g5pkzwxpgd5gk   518312487 SELECT                                                              11.61     11.61                          2.86
   1    0 4zh3ghtdvpz8j  3218547113 SELECT          Z$SYSTEM_JOBS_JOB_LIB.RUN                            0.50      0.50                          2.86
   1    0 7vz3g9zf47vqf           0 PL/SQL EXECUTE  Z$SYSTEM_JOBS_JOB_LIB.RUN                            0.41      0.41                          2.86
   1    0 7vz3g9zf47vqf           0 PL/SQL EXECUTE  Z$SYSTEM_JOBS_JOB_LIB.RUN                            0.50      0.50                          2.86
   1    0 bn7sh27xnf8ds           0 PL/SQL EXECUTE  Z$SYSTEM_JOBS_JOB_LIB.RUN                            0.01      0.01                          2.86
   1    0 b591x606ggbn6  1734303187 DELETE          PRVT_ADVISOR.DELETE_EXPIRED_TASKS                    0.00      0.00                          2.86


55.13 пример,  Top 30 SQL TIME_WAITED in second from GV$ACTIVE_SESSION_HISTORY - по event "direct%"

$ tpi mprod  ash sql top direct

"Top 30 SQL TIME_WAITED in second from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 17:27:11','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate for event like '%direct%'"

  IN  CON SQL_ID                PHV SQL_OPNAME      ENTRY_NAME                                    EVENT                               TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- ------------- ----------- --------------- --------------------------------------------- ----------------------------------- ----------- --------- --------- --------- ---------
   1    0 4v5vf6fftf0qz    19685770 SELECT          MC_DAILY_UPDATE_SCRIPT.DELTA_TOTAL_LOAD_SCHED direct path write temp                     0.10                0.00      0.10     62.96
   1    0 brr7uj8g2mgp7   782876880 SELECT                                                        direct path write temp                     0.02                0.00      0.02     22.22
   1    0 b01yka4xbtsc7  4269230725 SELECT          MC_DAILY_UPDATE_VIZRT.START_VGE_VIZRT         direct path write temp                     0.00                0.00      0.00      7.41
   1    0 bdxz9tvavy1v0  2879815268 SELECT          MC_PSW_INIT.CALC_SALES_REVIEW                 direct path read                           0.00                0.00      0.00      3.70
   1    0 4v5vf6fftf0qz    19685770 SELECT          MC_DAILY_UPDATE_SCRIPT.DELTA_TOTAL_LOAD_SCHED direct path read temp                      0.00                0.00      0.00      3.70


55.14 пример, ash sql all - Events from GV$ACTIVE_SESSION_HISTORY , все events из ash по всем сессиям для детального изучения какой-либо проблемы

 tpi mprod  ash sql all

"Events from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 17:29:11','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate and event like "

  IN  CON TIME                 SID  SERIAL USERNAME                  SQL_ID        EVENT                               WAIT_CLASS          OBJ# FILE#   BLOCK# BLSTATUS     BLSID BLSERIAL PROGRAM \ MODULE \ ACTION \ MACHINE
---- ---- ----------------- ------ ------- ------------------------- ------------- ----------------------------------- -------------- --------- ----- -------- ----------- ------ -------- -------------------------------------------------------
   1    0 15/10/25 16:29:29     62    9598 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:29:29    827   20455 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:29:29    266   38759 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:29:29      5   62182 SYS                                     log file parallel write             System I/O            -1     0        0 NO HOLDER                   oracle@mrct-prd-db.shoppinglive.local (LGWR) \  \  \ mr
   1    0 15/10/25 16:29:44    775   39044 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:29:44      5   62182 SYS                                     log file parallel write             System I/O            -1     0        0 NO HOLDER                   oracle@mrct-prd-db.shoppinglive.local (LGWR) \  \  \ mr
   1    0 15/10/25 16:29:44    266    4328 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:29:44     63   48274 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:29:52      5   62182 SYS                                     log file parallel write             System I/O            -1     0        0 NO HOLDER                   oracle@mrct-prd-db.shoppinglive.local (LGWR) \  \  \ mr
   1    0 15/10/25 16:29:52    784   38175 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:29:59     62   41265 GRAFANAUSER               azguk8k7tx8qz library cache: bucket mutex X       Concurrency           -1     0        0 VALID            9    14764 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:30:02      5   62182 SYS                                     log file parallel write             System I/O            -1     0        0 NO HOLDER                   oracle@mrct-prd-db.shoppinglive.local (LGWR) \  \  \ mr
   1    0 15/10/25 16:30:10    543   41318 MUSER                     brr7uj8g2mgp7 direct path write temp              User I/O           69013    18    61926 UNKNOWN                     JDBC Thin Client \ JDBC Thin Client \  \ hybris-bp-95d8
   1    0 15/10/25 16:30:11    543   41318 MUSER                     brr7uj8g2mgp7 direct path write temp              User I/O           69013    17   165379 UNKNOWN                     JDBC Thin Client \ JDBC Thin Client \  \ hybris-bp-95d8
   1    0 15/10/25 16:30:12    543   41318 MUSER                     brr7uj8g2mgp7 direct path write temp              User I/O           69013    17   286600 UNKNOWN                     JDBC Thin Client \ JDBC Thin Client \  \ hybris-bp-95d8
   1    0 15/10/25 16:30:13    543   41318 MUSER                     brr7uj8g2mgp7 direct path write temp              User I/O           69013    18   326168 UNKNOWN                     JDBC Thin Client \ JDBC Thin Client \  \ hybris-bp-95d8
   1    0 15/10/25 16:30:14    543   41318 MUSER                     brr7uj8g2mgp7 direct path write temp              User I/O           69013    16   964257 UNKNOWN                     JDBC Thin Client \ JDBC Thin Client \  \ hybris-bp-95d8
   1    0 15/10/25 16:30:19    547    9578 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:19      5   62182 SYS                                     log file parallel write             System I/O            -1     0        0 NO HOLDER                   oracle@mrct-prd-db.shoppinglive.local (LGWR) \  \  \ mr
   1    0 15/10/25 16:30:21    264   65288 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    290   23866 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    297   64647 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    300   29377 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    301   38389 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    310   10070 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21      5   62182 SYS                                     SYNC Remote Write                   Other                 -1     0        0 UNKNOWN                     oracle@mrct-prd-db.shoppinglive.local (LGWR) \  \  \ mr
   1    0 15/10/25 16:30:21    530   31731 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    541   11887 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    547    9578 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    557   49247 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    792    9884 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    796   65388 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    809   22780 MUSER                                   log file sync                       Commit                -1    14   208287 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    812   22084 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21    815   59019 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:30:21     11    6430 SYS                                     Redo Transport MISC                 Other                 -1     0        0 UNKNOWN                     oracle@mrct-prd-db.shoppinglive.local (NSS2) \  \  \ mr
   1    0 15/10/25 16:30:21     80   36510 MUSER                                   log file sync                       Commit             66311     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s



пример, ash sql all log file sync - все сессии, попавшие в ash ожидающие "log file sync", большой список для детального анализа

tpi mprod  ash sql all log file sync

"Events from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 17:31:24','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate and event like log file sync"

  IN  CON TIME                 SID  SERIAL USERNAME                  SQL_ID        EVENT                               WAIT_CLASS          OBJ# FILE#   BLOCK# BLSTATUS     BLSID BLSERIAL PROGRAM \ MODULE \ ACTION \ MACHINE
---- ---- ----------------- ------ ------- ------------------------- ------------- ----------------------------------- -------------- --------- ----- -------- ----------- ------ -------- -------------------------------------------------------
   1    0 15/10/25 16:31:40    320   55949 SYS                                     log file sync                       Commit                -1     0        0 VALID            5    62182 oracle@mrct-prd-db.shoppinglive.local (J001) \ DBMS_SCH
   1    0 15/10/25 16:31:40     80   36510 MUSER                                   log file sync                       Commit             66311     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:32:14    848   33478 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:32:28    593   56288 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:32:59    596   46731 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:33:29     98   60701 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:33:32    290   23866 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:33:32    803    2551 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:33:44    323   37771 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:33:59    848   35099 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:33:59    296   31275 GRAFANAUSER                             log file sync                       Commit                -1     0        0 VALID            5    62182 oracledb_exporter \ oracledb_exporter \  \ 90f58db30943
   1    0 15/10/25 16:34:53     65   33671 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    818   27469 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    815   59019 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    809   22780 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    792    9884 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    783   13973 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    773   65223 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    557   49247 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    550   12094 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    547    9578 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    541   11887 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    312   27160 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    310   10070 MUSER                                   log file sync                       Commit             67325    14   208287 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    301   38389 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    300   29377 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s
   1    0 15/10/25 16:34:53    297   64647 MUSER                                   log file sync                       Commit                -1     0        0 VALID            5    62182 JDBC Thin Client \ JDBC Thin Client \  \ mrct-prd-app.s


пример, ash sql all enq - все сессии, попавшие в ash ожидающие "enq:%"

$ tpi mprod  ash sql all enq

"Events from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 17:32:51','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate and event like enq"

  IN  CON TIME                 SID  SERIAL USERNAME                  SQL_ID        EVENT                               WAIT_CLASS          OBJ# FILE#   BLOCK# BLSTATUS     BLSID BLSERIAL PROGRAM \ MODULE \ ACTION \ MACHINE
---- ---- ----------------- ------ ------- ------------------------- ------------- ----------------------------------- -------------- --------- ----- -------- ----------- ------ -------- -------------------------------------------------------
   1    0 15/10/25 16:33:30     19   18677 SYS                                     enq: JG - queue lock                Other               9281     1    18769 VALID          538    44647 oracle@mrct-prd-db.shoppinglive.local (CJQ0) \  \  \ mr
   1    0 15/10/25 17:00:11      5   62182 SYS                                     enq: CF - contention                Other                 -1     0        0 VALID          256    35885 oracle@mrct-prd-db.shoppinglive.local (LGWR) \  \  \ mr


55.15 ash sql [SQL_ID] - статистика выполнения запроса из ash за интервал
$ tpi mprod  ash sql 4v5vf6fftf0qz

"SQL from GV$ACTIVE_SESSION_HISTORY by SQL_ID = 4v5vf6fftf0qz in sample_time between to_date('15/10/25 17:33:54','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON SQL_ID        PLAN_HASH_VALUE SQL_TEXT                                                                           EXECUTIONS       PIO\EX          LIO\EX   CPU_TIME\EX   ELA_TIME\EX    IOWAIT\EX
---- ---- ------------- --------------- -------------------------------------------------------------------------------- ------------ ------------ --------------- ------------- ------------- ------------
   1    0 4v5vf6fftf0qz        19685770 SELECT "A24"."STR_PK_ID" "STR_PK_ID","A24"."STATUS" "STATUS","A24"."SAP_ART_ID"            11       63,261         140,995      125.9759      140.6343           13
                                        "SAP_ART_ID","A24"."PRODUCT_ID" "PRODUCT_ID","A24"."PRI_CODE" "PRI_CODE","A24"."
                                        PRI_CHA_CODE" "PRI_CHA_CODE","A24"."CHA_CODE" "CHA_CODE","A24"."ARTICLE_TYPE" "A
                                        RTICLE_TYPE","A24"."PRI_LBL_ID" "PRI_LBL_ID","A24"."VALID_FROM" "VALID_FROM","A2
                                        4"."VALID_TO" "VALID_TO","A24"."CUR_PRICE" "CUR_PRICE","A24"."DIFF_PRI_FLAG" "DI
                                        FF_PRI_FLAG","A24"."HSE_PRICE" "HSE_PRICE","A24"."HSE_REF_PRICE" "HSE_REF_PRICE"
                                        ,"A24"."REF_PRICE_CODE" "REF_PRICE_CODE","A24"."PRI_LABEL" "PRI_LABEL","A24"."MA
                                        X_DAYS" "MAX_DAYS","A24"."MAX_DAYS_REF" "MAX_DAYS_REF","A24"."PRI_STR_TEXT" "PRI
                                        _STR_TEXT","A24"."PRI_LAST_TEXT" "PRI_LAST_TEXT","A24"."NO_REF_PRICE_FLAG" "NO_R
                                        EF_PRICE_FLAG","A24"."PRI_STR_ID" "PRI_STR_ID","A24"."PRI_STR_NAME" "PRI_STR_NAM
                                        E","A24"."PRI_STR_REF" "PRI_STR_REF","A24"."MIN_REF_RANGE" "MIN_REF_RANGE","A24"
                                        ."STOCK_FLAG" "STOCK_FLAG","A24"."MIN_STOCK_RANGE" "MIN_STOCK_RANGE","A24"."MIN_
                                        VALID_FROM" "MIN_VALID_FROM","A24"."SG_R



55.16 ash sql 'SELECT "A24"."STR_PK_ID" "STR_PK_ID","A24"."STATUS"' - поиск  в ash по шаблону текста запроса
$ tpi mprod  ash sql 'SELECT "A24"."STR_PK_ID" "STR_PK_ID","A24"."STATUS"'

"SQL from GV$ACTIVE_SESSION_HISTORY by 20 SQL_TEXT like SELECT "A24"."STR_PK_ID" "STR_PK_ID","A24"."STATUS" in sample_time between to_date('15/10/25 17:35:41','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON SQL_ID        PLAN_HASH_VALUE SQL_TEXT                                                                           EXECUTIONS       PIO\EX          LIO\EX   CPU_TIME\EX   ELA_TIME\EX    IOWAIT\EX
---- ---- ------------- --------------- -------------------------------------------------------------------------------- ------------ ------------ --------------- ------------- ------------- ------------
   1    0 4v5vf6fftf0qz        19685770 SELECT "A24"."STR_PK_ID" "STR_PK_ID","A24"."STATUS" "STATUS","A24"."SAP_ART_ID"            11       63,261         140,995      125.9759      140.6343           13
                                        "SAP_ART_ID","A24"."PRODUCT_ID" "PRODUCT_ID","A24"."PRI_CODE" "PRI_CODE","A24"."
                                        PRI_CHA_CODE" "PRI_CHA_CODE","A24"."CHA_CODE" "CHA_CODE","A24"."ARTICLE_TYPE" "A
                                        RTICLE_TYPE","A24"."PRI_LBL_ID" "PRI_LBL_ID","A24"."VALID_FROM" "VALID_FROM","A2
                                        4"."VALID_TO" "VALID_TO","A24"."CUR_PRICE" "CUR_PRICE","A24"."DIFF_PRI_FLAG" "DI
                                        FF_PRI_FLAG","A24"."HSE_PRICE" "HSE_PRICE","A24"."HSE_REF_PRICE" "HSE_REF_PRICE"
                                        ,"A24"."REF_PRICE_CODE" "REF_PRICE_CODE","A24"."PRI_LABEL" "PRI_LABEL","A24"."MA
                                        X_DAYS" "MAX_DAYS","A24"."MAX_DAYS_REF" "MAX_DAYS_REF","A24"."PRI_STR_TEXT" "PRI
                                        _STR_TEXT","A24"."PRI_LAST_TEXT" "PRI_LAST_TEXT","A24"."NO_REF_PRICE_FLAG" "NO_R
                                        EF_PRICE_FLAG","A24"."PRI_STR_ID" "PRI_STR_ID","A24"."PRI_STR_NAME" "PRI_STR_NAM
                                        E","A24"."PRI_STR_REF" "PRI_STR_REF","A24"."MIN_REF_RANGE" "MIN_REF_RANGE","A24"
                                        ."STOCK_FLAG" "STOCK_FLAG","A24"."MIN_STOCK_RANGE" "MIN_STOCK_RANGE","A24"."MIN_
                                        VALID_FROM" "MIN_VALID_FROM","A24"."SG_R


55.17  ash plan SQL_ID - детальный план запроса , [fmt display plan] может быть +outline, advanced и т.п.

$ tpi mprod  ash plan bvghr7ygfs84s

"Current Plan from GV$SQL_PLAN and GV$ACTIVE_SESSION_HISTORY (dbms_xplan.display_cursor) for sql_id: bvghr7ygfs84s "

SQL_ID  bvghr7ygfs84s, child number 0
-------------------------------------
SELECT CL.CJS_LOG_ID, CL.CJS_CJ_ID, CL.CJS_CJ_JOB_NAME, CASE WHEN
MAX_LOG_ID = CL.CJS_LOG_ID THEN 'Y' ELSE 'N' END NEW_LAST_RUN,
CJS_LAST_RUN_FLAG FROM CJS_LOGGING CL, ( SELECT MAX ( CJS_LOG_ID)
MAX_LOG_ID, CJS_CJ_ID FROM CJS_LOGGING GROUP BY CJS_CJ_ID) CLM WHERE
CL.CJS_CJ_ID = CLM.CJS_CJ_ID AND CASE WHEN MAX_LOG_ID = CL.CJS_LOG_ID
THEN 'Y' ELSE 'N' END <> CL.CJS_LAST_RUN_FLAG

Plan hash value: 3581759730

----------------------------------------------------------------------------------------------------------------
| Id  | Operation            | Name        | E-Rows |E-Bytes| Cost (%CPU)| E-Time   |  OMem |  1Mem |  O/1/M   |
----------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT     |             |        |       | 19728 (100)|          |       |       |          |
|*  1 |  HASH JOIN           |             |   4609K|   250M| 19728   (1)| 00:00:01 |  1856K|  1856K| 25626/0/0|
|   2 |   VIEW               |             |     43 |  1118 |  9867   (1)| 00:00:01 |       |       |          |
|   3 |    HASH GROUP BY     |             |     43 |   387 |  9867   (1)| 00:00:01 |  1186K|  1186K| 25626/0/0|
|   4 |     TABLE ACCESS FULL| CJS_LOGGING |   1482K|    12M|  9830   (1)| 00:00:01 |       |       |          |
|   5 |   TABLE ACCESS FULL  | CJS_LOGGING |   1482K|    43M|  9837   (1)| 00:00:01 |       |       |          |
----------------------------------------------------------------------------------------------------------------

Query Block Name / Object Alias (identified by operation id):
-------------------------------------------------------------

   1 - SEL$1
   2 - SEL$2 / CLM@SEL$1
   3 - SEL$2
   4 - SEL$2 / CJS_LOGGING@SEL$2
   5 - SEL$1 / CL@SEL$1

Outline Data
-------------

  /*+
      BEGIN_OUTLINE_DATA
      IGNORE_OPTIM_EMBEDDED_HINTS
      OPTIMIZER_FEATURES_ENABLE('19.1.0')
      DB_VERSION('19.1.0')
      ALL_ROWS
      OUTLINE_LEAF(@"SEL$2")
      OUTLINE_LEAF(@"SEL$1")
      NO_ACCESS(@"SEL$1" "CLM"@"SEL$1")
      FULL(@"SEL$1" "CL"@"SEL$1")
      LEADING(@"SEL$1" "CLM"@"SEL$1" "CL"@"SEL$1")
      USE_HASH(@"SEL$1" "CL"@"SEL$1")
      FULL(@"SEL$2" "CJS_LOGGING"@"SEL$2")
      USE_HASH_AGGREGATION(@"SEL$2")
      END_OUTLINE_DATA
  */

Predicate Information (identified by operation id):
---------------------------------------------------

   1 - access("CL"."CJS_CJ_ID"="CLM"."CJS_CJ_ID")
       filter("CL"."CJS_LAST_RUN_FLAG"<>CASE "MAX_LOG_ID" WHEN "CL"."CJS_LOG_ID" THEN 'Y' ELSE 'N' END )

Note
-----
   - Warning: basic plan statistics not available. These are only collected when:
       * hint 'gather_plan_statistics' is used for the statement or
       * parameter 'statistics_level' is set to 'ALL', at session or system level

Query Block Registry:
---------------------

  <q o="2" f="y"><n><![CDATA[SEL$1]]></n><f><h><t><![CDATA[CL]]></t><s><![CDATA[SEL$1]]></s></h><h><t><![C
        DATA[CLM]]></t><s><![CDATA[SEL$1]]></s></h></f></q>
  <q o="2" f="y"><n><![CDATA[SEL$2]]></n><f><h><t><![CDATA[CJS_LOGGING]]></t><s><![CDATA[SEL$2]]></s></h><
        /f></q>





55.18 ash sqlstat SQL_ID - статистика выполнения запроса из GV$SQLSTATS
$ tpi mprod  ash sqlstat  bvghr7ygfs84s

"After change plan do not forget purge the old statistics:"

gv$sqlarea:
  IN  CON COMMAND TO PURGE SQL STATEMENT                                         LAST_ACTIVE_TIME  SQL_ID           HASH_VALUE   EXECUTIONS      LOADS VERSION_COUNT INVALIDATIONS  PARSE_CALLS
---- ---- ---------------------------------------------------------------------- ----------------- --------------- ----------- ------------ ---------- ------------- ------------- ------------
   1    0 exec dbms_shared_pool.purge ('000000008B39DB00,2666274968','C');       15/10/25 17:43:18 bvghr7ygfs84s    2666274968       25,678          1             1             0       12,840

gv$sql:
  IN  CON SQL_ID          PLAN_HASH_VALUE USERS_OPENING USERS_EXECUTING OPEN_VERSIONS CHILD_NUMBER   CPU_TIME ELAPSED_TIME CLUSTER_WAIT_TIME USER_IO_WAIT_TIME IS_O
---- ---- --------------- --------------- ------------- --------------- ------------- ------------ ---------- ------------ ----------------- ----------------- ----
   1    0 bvghr7ygfs84s        3581759730             0               0             0            0 3.4816E+10   3.5256E+10                 0           1344708 N

SQLStats from GV$SQLSTATS  for sql_id: bvghr7ygfs84s
  IN  CON SQL_ID          PLAN_HASH_VALUE LAST_ACTIVE_TIME   PARSE_CALLS INVALIDATIONS   FCH\EX  SORT\EX         EXEC       PIO\EX          LIO\EX   ROWS_PR\EX   CPU_TIME\EX   ELA_TIME\EX  IOWAIT\EX SHARABLE_MEM
---- ---- --------------- --------------- ----------------- ------------ ------------- -------- -------- ------------ ------------ --------------- ------------ ------------- ------------- ---------- ------------
   1    0 bvghr7ygfs84s        3581759730 15/10/25 17:43:18       12,840             0        1        0       25,678            4         125,182            0        1.3559        1.3730          0        32400

55.19 TOP 40 SQLStats from GV$SQLSTATS in last_active_time between to_date('15/10/25 17:44:56','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate  order by elapsed_time * executions desc"
$ tpi mprod  ash sqlstat ela
"TOP 40 SQLStats from GV$SQLSTATS in last_active_time between to_date('15/10/25 17:44:56','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate  order by elapsed_time * executions desc"

  IN  CON SQL_ID          PLAN_HASH_VALUE LAST_ACTIVE_TIME   PARSE_CALLS INVALIDATIONS   FCH\EX  SORT\EX         EXEC       PIO\EX          LIO\EX   ROWS_PR\EX   CPU_TIME\EX   ELA_TIME\EX  IOWAIT\EX SHARABLE_MEM
---- ---- --------------- --------------- ----------------- ------------ ------------- -------- -------- ------------ ------------ --------------- ------------ ------------- ------------- ---------- ------------
   1    0 35pxb180czub4                 0 15/10/25 17:44:55       12,849             0        0        0       12,848           10         232,648            1        4.5344        4.6154          0        36712
   1    0 bvghr7ygfs84s        3581759730 15/10/25 17:44:55       12,850             0        1        0       25,697            4         125,182            0        1.3559        1.3730          0        32400
   1    0 f6uvh6sf4nzbp        2361342654 15/10/25 17:44:55       12,848             0        1        1       12,848            0          73,605            0        1.1109        1.1247          0       515064
   1    0 2nr0s1ujq4adh         862546139 15/10/25 17:44:54       12,850             0        5        0       25,697            0          19,949            4         .2000         .2087          0        36456
   1    0 brk3uncvzx3m2        1388734953 15/10/25 17:44:41        8,089             0        1        0        8,089            3          53,957            1         .6019         .6529          0        20232
   1    0 djppxmuqbf1ak        1821286803 15/10/25 17:44:54       12,849             0        1        0    1,208,313            0             424            1         .0042         .0044          0       766536
   1    0 f7mhgthysmucm                 0 15/10/25 17:44:34        1,070             0        0        0        1,070        1,352         334,308            0        3.8034        4.3057          0        12120
   1    0 5ukyub4r9xhz7        1395029542 15/10/25 17:43:28        1,986             0        1        0        5,249            0         492,936            1         .6588         .6749          0        40512
   1    0 bwbn1b8y5rgc8                 0 15/10/25 17:11:18           36             0        0        0           36       51,268       4,222,990            1       37.4403       89.9806          6        36712
   1    0 cuzx9ryb9w73b        4134674283 15/10/25 17:44:41        2,209             0        1        0        6,258            2          16,072            0         .3713         .3805          0        97248
   1    0 bqjmm76sbxz3d         728105121 15/10/25 17:44:55       63,582             0        1        0       63,582            0          13,039            0         .0342         .0357          0        24288
   1    0 726fur7gnp101                 0 15/10/25 17:16:24           30             0        0        0           30       11,775      12,622,944            1       68.8557       72.1556          2        36712
   1    0 fu3xus5n1mgb8                 0 15/10/25 17:40:37          424             0        0        0          424            9       1,390,922            1        4.0871        4.4642          0        36712
   1    0 brr7uj8g2mgp7         782876880 15/10/25 17:32:57           35             0      481        1           35      767,240         813,899        4,803       44.1733       50.2602          7       588072
   1    0 2c3n8upxbqm0r         767242227 15/10/25 17:40:36          424             0       15      -13          426            4       1,380,246           14        3.9088        4.0201          0       239256
   1    0 464cbyvnpaqgz        3103538819 15/10/25 17:44:41        2,122             0        1        0        6,258            0          25,158            0         .2667         .2735          0       166200
   1    0 cj4zxkz6sryj7        1122846289 15/10/25 17:44:55       10,144             0        0        0    1,821,225            0              14            1         .0001         .0009          0       109368
   1    0 4v5vf6fftf0qz          19685770 15/10/25 17:03:23           11             0        1        2           11       63,260         140,995            2      125.9759      140.6343         13       239256
   1    0 45pbx47y3rsvg         891421440 15/10/25 17:19:21           70             0       81      407           71            0       1,471,879           80       17.5572       18.2152          0       665120
   1    0 1c83z14qt09p1         389188039 15/10/25 17:44:08           10             0        8        0        2,141            0          17,721           72         .5686         .5826          0        72960
   1    0 f96kgy5awmgm5                 0 15/10/25 17:31:32          143             0        0        0          143       31,255       1,918,710            1        7.9050        8.6791          0        36712
   1    0 0z3gp29d3djft         219434934 15/10/25 17:44:48          712             0       39        0          759            9          11,773          385        1.5126        1.5383          0        32400
   1    0 4m7m0t6fjcs5x        1935744642 15/10/25 17:44:55       25,971             0        0        0    7,191,678            0               4            1         .0000         .0001          0        64800
   1    0 243vus89c1d6d        2518866345 15/10/25 17:44:44       17,170             0        1        1       17,170            0               0            0         .0481         .0568          0        28344
   1    0 azguk8k7tx8qz        3726539686 15/10/25 17:44:44       17,170             0        1        1       17,170            0               0            0         .0474         .0560          0        28344
   1    0 488vn6814utk7        2327836923 15/10/25 17:15:28           84             0  700,072        5           84        2,949         311,524      700,071       10.3332       10.6061          0       377160
   1    0 1z4rkfrpq71bu          46685850 15/10/25 17:44:53       11,207             0        1       -2       11,235            0          13,007            0         .0727         .0752          0        77016
   1    0 3zt5ma22zmccu                 0 15/10/25 16:58:48           13             0        0        0           13        4,951       8,579,472            1       59.3911       61.2566          1        36712
   1    0 g4gp07gt2z920         105323984 15/10/25 17:44:54       42,955             0        0        0       43,563            0               7            0         .0003         .0167          0        36456
   1    0 gwndpqwd84nbf        3440357129 15/10/25 17:44:44       17,168             0        1       -1       17,168           25           8,973           99         .0314         .0406          0       482616
   1    0 5rmahyhdrr7hy                 0 15/10/25 17:44:50        8,570             0        0        0        8,570            1           7,766            1         .0466         .0633          0        36712
   1    0 96cvtc2j4j38f        2190205002 15/10/25 17:44:50          336             0        4        0       38,946            0           3,524            3         .0121         .0129          0       348672
   1    0 1hafm4gsrusmw        1296416244 15/10/25 17:16:23           31             0        1        0       13,268            0           9,124            1         .0368         .0376          0        36456
   1    0 2yc0fj0v657f2                 0 15/10/25 17:43:24        1,074             0        0        0        1,074            0          43,207            1         .4558         .4641          0        36712
   1    0 76bkgjyknpf4m        2197563222 15/10/25 17:44:45        9,598             0        0        0        9,598            0               8            0         .0001         .0501          0        28344
   1    0 3ag6jzu58qh1b        3440357129 15/10/25 17:44:44       17,168             0        1       -1       17,168            1           8,391            9         .0210         .0279          0       482616
   1    0 52dvxv92k4cju        3440357129 15/10/25 17:44:44       17,169             0        1       -1       17,169            0           6,223           99         .0206         .0275          0       482616
   1    0 9zg9qd9bm4spu        2447725225 15/10/25 17:44:51      210,649             0        0        0      210,651            0               4            0         .0002         .0021          0        48576
   1    0 b01yka4xbtsc7        4269230725 15/10/25 17:10:12           36             0        4        2           36       20,816          90,872            3        8.1498       10.3424          2       194640
   1    0 aj12ru9czsq71         979109641 15/10/25 17:44:50        3,134             0        2        0        5,787            0          14,188           12         .0571         .0598          0        28344

55.20 данные из ash в разрезе insection [username|service|machine|program,module,action|sql_opname,sql_plan_operation,sql_plan_options|PLSQL_ENTRY_OBJECT_ID|event|wait_class] 

$ tpi mprod  ash insection username

"Activity top 50 in section: username from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 17:46:50','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON USERNAME                  TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- ------------------------- ----------- --------- --------- --------- ---------
   1    0 MADMIN                         474.32    446.33     27.88      0.11     53.37
   1    0 MUSER                          528.96    501.48     27.44      0.05     27.31
   1    0 SYS                             86.56     31.17     50.15      5.24     15.12
   1    0 GRAFANAUSER                      0.51      0.01      0.50      0.00      3.62
   1    0 READONLY                         0.00      0.00                          0.28
   1    0 ZABBIXMON                        0.00      0.00      0.00      0.00      0.28

$ tpi mprod  ash insection machine

"Activity top 50 in section: machine from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 17:46:59','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON MACHINE              TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- -------------------- ----------- --------- --------- --------- ---------
   1    0 mrct-prd-db.shopping      560.04    477.18     77.51      5.35     67.96
          live.local

   1    0 mrct-prd-app.shoppin      527.03    499.74     27.30      0.00     24.60
          glive.local

   1    0 90f58db30943                0.51      0.01      0.50      0.00      4.31
   1    0 hybris-bp-95d869dd5-        3.17      3.09      0.04      0.05      2.60
          hpqj9

   1    0 SHOPPINGLIVE\MSK-LNX        0.00      0.00                          0.28
          -PBI

   1    0 hybris-bp-95d869dd5-        0.00      0.00                          0.14
          99h5p

   1    0 hybris-backstudy-6f8        0.10                0.10      0.00      0.05
          cdbcc49-2n428

   1    0 hybris-backstudy-6f8        0.00      0.00                          0.05
          cdbcc49-wp7ws


$ tpi mprod  ash insection sql_opname,sql_plan_operation,sql_plan_options

"Activity top 50 in section: sql_opname,sql_plan_operation,sql_plan_options from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 17:47:13','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON SQL_OPNAME      SQL_PLAN_OPERATION             SQL_PLAN_OPTIONS               TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- --------------- ------------------------------ ------------------------------ ----------- --------- --------- --------- ---------
   1    0                                                                                    118.49     36.25     77.00      5.24     21.93
   1    0 SELECT          HASH JOIN                                                          162.10    162.09      0.00      0.01     17.46
   1    0 SELECT          TABLE ACCESS                   FULL                                400.29    400.29      0.00      0.00     17.03
   1    0 SELECT          INDEX                          RANGE SCAN                           35.58     35.58                          8.57
   1    0 SELECT          HASH JOIN                      RIGHT ANTI                           63.49     63.49                          5.59
   1    0 SELECT          HASH                           GROUP BY                            131.34    131.34                          5.07
   1    0 SELECT          HASH JOIN                      RIGHT OUTER                           0.56      0.47      0.00      0.09      3.51
   1    0 SELECT          HASH JOIN                      OUTER                                16.74     16.69      0.00      0.05      3.48
   1    0 SELECT          TABLE ACCESS                   BY INDEX ROWID BATCHED               56.41     56.41                          2.77
   1    0 SELECT          TABLE ACCESS                   BY INDEX ROWID                       14.51     14.51                          2.46
   1    0 SELECT                                                                               0.62      0.62                          1.94
   1    0 SELECT          SELECT STATEMENT                                                    14.65     14.65      0.00      0.00      1.73
   1    0 SELECT          INDEX                          FAST FULL SCAN                       14.65     14.65                          1.73
   1    0 SELECT          FIXED TABLE                    FULL                                  0.97      0.97      0.00      0.00      1.52
   1    0 PL/SQL EXECUTE                                                                       8.45      8.19      0.26      0.00      0.64
   1    0 DELETE                                                                              24.28      0.00     24.28      0.00      0.59
   1    0 SELECT          FILTER                                                               2.13      2.13                          0.50
   1    0 SELECT          INDEX                          UNIQUE SCAN                           6.27      6.27                          0.47
   1    0 INSERT                                                                               2.99      0.01      2.99      0.00      0.43
   1    0 UPDATE          UPDATE                                                               3.67      3.67      0.00      0.00      0.28
   1    0 SELECT          SORT                           ORDER BY                              8.92      8.92                          0.21
   1    0 UPDATE          TABLE ACCESS                   BY INDEX ROWID BATCHED                0.01      0.01                          0.21
   1    0 UPDATE          UPDATE STATEMENT                                                     0.00      0.00                          0.21
   1    0 SELECT          INDEX                          FULL SCAN DESCENDING                  0.85      0.85                          0.19
   1    0 DELETE          DELETE                                                               0.79      0.43      0.36      0.00      0.14
   1    0 SELECT          SORT                           UNIQUE                                0.02      0.02      0.00      0.00      0.12
   1    0 UPDATE          INDEX                          RANGE SCAN                            0.00      0.00                          0.12
   1    0 CALL METHOD                                                                          0.00      0.00                          0.09
   1    0 SELECT          FIXED TABLE                    FIXED INDEX                           0.00      0.00                          0.07
   1    0 SELECT          TABLE ACCESS                   CLUSTER                               0.00      0.00                          0.07
   1    0 SELECT          SORT                           JOIN                                  0.01      0.01                          0.07
   1    0 SELECT          VIEW                                                                 0.00      0.00                          0.05
   1    0 INSERT          INSERT STATEMENT                                                     0.00      0.00                          0.05
   1    0 SELECT          SORT                           GROUP BY NOSORT                       0.09      0.09                          0.05
   1    0 SELECT          NESTED LOOPS                   OUTER                                 0.49      0.49                          0.05
   1    0 INSERT          LOAD TABLE CONVENTIONAL                                              0.01      0.00      0.00      0.01      0.05
   1    0 SELECT          SORT                           AGGREGATE                             0.00      0.00                          0.05
   1    0 UPDATE          INDEX                          UNIQUE SCAN                           0.00      0.00                          0.05
   1    0 UPDATE          WINDOW                         SORT PUSHED RANK                      0.00      0.00                          0.05
   1    0 SELECT          BUFFER                         SORT                                  0.00      0.00                          0.05
   1    0 INSERT          TABLE ACCESS                   FULL                                  0.00      0.00                          0.02
   1    0 SELECT          HASH                           UNIQUE                                0.41      0.41                          0.02
   1    0 DELETE          TABLE ACCESS                   FULL                                  0.00      0.00                          0.02
   1    0 SELECT          SORT                           ORDER BY STOPKEY                      0.00      0.00                          0.02
   1    0 INSERT          SORT                           GROUP BY                              0.00      0.00                          0.02
   1    0 SELECT          HASH JOIN                      RIGHT SEMI                            0.01      0.01                          0.02
   1    0 SELECT          STATISTICS COLLECTOR                                                 0.35      0.35                          0.02
   1    0 INSERT          FILTER                                                               0.00      0.00                          0.02
   1    0 UPDATE                                                                               0.00      0.00                          0.02
   1    0 INSERT          SEQUENCE                                                             0.00      0.00                          0.02

Вызов какого пакета наиболее активен:
$ tpi mmprod prd ash insection PLSQL_ENTRY_OBJECT_ID

"Activity top 50 in section: PLSQL_ENTRY_OBJECT_ID from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('22/10/25 11:09:37','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON PLSQL_ENTRY_OBJECT_ID TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- --------------------- ----------- --------- --------- --------- ---------
   1    0                 72794      223.07    223.07                         43.33
   1    0                            762.06    727.85     33.32      0.89     31.68
   1    0                 72799        3.07      1.43      1.61      0.03     11.34
   1    0                 73077        0.01      0.01      0.00      0.00      4.33
   1    0                 72806       33.01      2.56     30.45      0.00      2.07
   1    0                 72805        0.37      0.36      0.00      0.01      1.97
   1    0                 15662        4.80      0.01      0.20      4.60      0.98
   1    0                 73070       62.91     62.81      0.00      0.11      0.93
   1    0                 72858        6.13      6.13                          0.78
   1    0                 73071        1.25      1.25      0.00      0.00      0.78
   1    0                 73327        0.04      0.04                          0.41
   1    0                 73051        0.02      0.02                          0.39
   1    0                 73063        0.96      0.96                          0.28
   1    0                 73072        0.49      0.49                          0.18
   1    0                  8065        0.00      0.00                          0.16
   1    0                 72795        0.02      0.02                          0.13
   1    0                 73174        0.00      0.00                          0.10
   1    0                 15599        0.00      0.00                          0.08
   1    0                 73084        0.00      0.00                          0.03
   1    0                 73196        0.47      0.47                          0.03
   1    0                 72801        0.36      0.36                          0.03


находим по ID объекта имя объекта:

$ tpi mprod o 72794

Objects from dba_objects where object_id = '72794':
 OBJECT_ID OWNER                          OBJECT_NAME                    OBJECT_TYPE          CREATED           LAST_DDL_TIME     STATUS
---------- ------------------------------ ------------------------------ -------------------- ----------------- ----------------- ----------------------------
     72794 MADMIN                         MC_CJS_CONTROL                 PACKAGE              18/08/23 13:30:34 20/10/23 12:03:16 VALID


$ tpi mprod  ash insection event

"Activity top 50 in section: event from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 17:47:20','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON EVENT                               TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- ----------------------------------- ----------- --------- --------- --------- ---------
   1    0                                          978.71    978.71                         79.26
   1    0 log file sync                             27.84               27.84      0.00      7.44
   1    0 log file parallel write                    4.29                4.29      0.00      3.89
   1    0 Redo Transport MISC                       14.39               14.39      0.00      3.22
   1    0 SYNC Remote Write                         12.74               12.74      0.00      2.16
   1    0 db file async I/O submit                   8.51                8.51      0.00      1.11
   1    0 SQL*Net message from dblink               27.29               27.29      0.00      0.92
   1    0 direct path write temp                     0.15                0.00      0.15      0.59
   1    0 switch logfile command                     8.15                8.15      0.00      0.21
   1    0 Disk file operations I/O                   5.24                0.00      5.24      0.21
   1    0 control file parallel write                0.07                0.07      0.00      0.19
   1    0 PGA memory operation                       0.01                0.01      0.00      0.14
   1    0 oracle thread bootstrap                    0.09                0.09      0.00      0.12
   1    0 Redo Transport Open                        0.84                0.84      0.00      0.09
   1    0 os thread creation                         0.02                0.02      0.00      0.07
   1    0 RMAN backup & recovery I/O                 0.00                0.00      0.00      0.05
   1    0 log buffer space                           0.59                0.59      0.00      0.05
   1    0 recovery area: computing obsolete f        0.01                0.01      0.00      0.02
          iles

   1    0 db file single write                       0.00                0.00      0.00      0.02
   1    0 log file sequential read                   0.00                0.00      0.00      0.02
   1    0 db file sequential read                    0.01                0.00      0.01      0.02
   1    0 Redo Writer Remote Sync Notify             0.00                0.00      0.00      0.02
   1    0 direct path read temp                      0.00                0.00      0.00      0.02
   1    0 library cache: bucket mutex X              0.00                0.00      0.00      0.02
   1    0 buffer busy waits                          0.00                0.00      0.00      0.02
   1    0 enq: CF - contention                       0.05                0.05      0.00      0.02
   1    0 LNS wait on LGWR                           0.00                0.00      0.00      0.02
   1    0 direct path read                           0.00                0.00      0.00      0.02

$ tpi mprod  ash insection wait_class

"Activity top 50 in section: wait_class from GV$ACTIVE_SESSION_HISTORY where sample_time between to_date('15/10/25 17:47:36','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON WAIT_CLASS     TIME_WAITED       CPU      WAIT        IO %ACTIVITY
---- ---- -------------- ----------- --------- --------- --------- ---------
   1    0                     979.01    979.01                         79.17
   1    0 Commit               27.88               27.88      0.00      7.48
   1    0 Other                28.15               28.15      0.00      5.89
   1    0 System I/O           12.89               12.89      0.00      5.30
   1    0 Network              27.29               27.29      0.00      0.95
   1    0 User I/O              5.39                0.00      5.39      0.90
   1    0 Administrative        8.15                8.15      0.00      0.21
   1    0 Concurrency           0.00                0.00      0.00      0.05
   1    0 Configuration         0.59                0.59      0.00      0.05


55.19 temp [sizeMb] - сессии из ash использовавшие temp более sizeMb 

$ tpi mprod  ash temp 100

"AWR_tempusage from gv$active_session_history for temp_diff >= 100 Mb and sample_time between to_date('15/10/25 17:49:31','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN  CON SESSION_ID SESSION_SERIAL# SAMPLE_TIME     SQL_ID            TEMP_DIFF
---- ---- ---------- --------------- --------------- --------------- -----------
   1    0        346           33720 15/10/2025 17   brr7uj8g2mgp7           261
   1    0        791           42437 15/10/2025 17   4v5vf6fftf0qz           210
   1    0        353           41408 15/10/2025 17   b01yka4xbtsc7           150

55.20 ash cchart - график первых трех event нагрузки на БД,  *** CPU ***, ### IO ###, +++ WAIT +++, приближение к cpu_count: 96, общая нагрузка

$ tpi mprod  ash cchart

"Top activity chart from gv$active_session_history in sample_time between to_date('15/10/25 17:52:29','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

  IN BEGIN_TIME       AAS PCT1 FIRST           PCT2 SECOND                      PCT3 THIRD                       CHART  *** CPU ***, ### IO ###, +++ WAIT +++,  cpu_count: 96
---- -------------- ----- ---- --------------- ---- --------------------------- ---- --------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   1 15/10/25-16:52    12   88 CPU                8 db file sequential read        2 direct path read temp       **************##                                                                                                               96
   1 15/10/25-16:53    25   88 CPU                9 db file sequential read        2 log file sync               *****************************###+                                                                                              96
   1 15/10/25-16:54    24   85 CPU               11 db file sequential read        3 log file sync               ***************************####+                                                                                               96
   1 15/10/25-16:55    29   90 CPU                7 db file sequential read        2 log file sync               **********************************###+                                                                                         96
   1 15/10/25-16:56    28   86 CPU               10 db file sequential read        3 log file sync               ********************************####+                                                                                          96
   1 15/10/25-16:57    27   83 CPU               11 db file sequential read        3 log file sync               ******************************#####+                                                                                           96
   1 15/10/25-16:58    26   86 CPU                9 db file sequential read        2 log file sync               ******************************####+                                                                                            96
   1 15/10/25-16:59    28   86 CPU               11 db file sequential read        2 log file sync               ********************************#####+                                                                                         96
   1 15/10/25-17:00    40   85 CPU               13 db file sequential read        2 log file sync               *********************************************#######+                                                                          96
   1 15/10/25-17:01    40   86 CPU               10 db file sequential read        2 log file sync               *********************************************######+                                                                           96
   1 15/10/25-17:02    31   89 CPU                7 db file sequential read        2 db file parallel read       *************************************####                                                                                      96
   1 15/10/25-17:03    29   91 CPU                6 db file sequential read        1 db file parallel read       ***********************************###                                                                                         96
   1 15/10/25-17:04    24   91 CPU                6 db file sequential read        1 log file sync               *****************************##+                                                                                               96
   1 15/10/25-17:05    27   90 CPU                8 db file sequential read        1 log file sync               *********************************###                                                                                           96
   1 15/10/25-17:06    25   89 CPU                9 db file sequential read        2 log file sync               *****************************###+                                                                                              96
   1 15/10/25-17:07    27   87 CPU               11 db file sequential read        2 log file sync               *******************************####+                                                                                           96
   1 15/10/25-17:08    27   86 CPU               11 db file sequential read        2 log file sync               *******************************####+                                                                                           96
   1 15/10/25-17:09    23   84 CPU               12 db file sequential read        2 log file sync               *************************####+                                                                                                 96
   1 15/10/25-17:10    26   84 CPU               12 db file sequential read        3 log file sync               *****************************#####+                                                                                            96
   1 15/10/25-17:11    24   83 CPU               13 db file sequential read        3 log file sync               **************************#####+                                                                                               96
   1 15/10/25-17:12    27   89 CPU                6 db file sequential read        2 log file sync               ********************************###+                                                                                           96
   1 15/10/25-17:13    28   87 CPU                8 db file sequential read        2 log file sync               ********************************####+                                                                                          96
   1 15/10/25-17:14    27   80 CPU               14 db file sequential read        2 log file sync               *****************************######+                                                                                           96
   1 15/10/25-17:15    30   75 CPU               19 db file sequential read        2 read by other session       ******************************########++                                                                                       96
   1 15/10/25-17:16    27   76 CPU               19 db file sequential read        2 log file sync               ***************************########+                                                                                           96
   1 15/10/25-17:17    28   79 CPU               16 db file sequential read        3 log file sync               *****************************#######+                                                                                          96
   1 15/10/25-17:18    29   81 CPU               12 db file sequential read        2 log file sync               ********************************######+                                                                                        96
   1 15/10/25-17:19    28   82 CPU               10 db file sequential read        4 log file sync               *******************************#####+                                                                                          96
   1 15/10/25-17:20    32   84 CPU               11 db file sequential read        3 log file sync               ************************************#####++                                                                                    96
   1 15/10/25-17:21    29   85 CPU               12 db file sequential read        2 log file sync               *********************************#####+                                                                                        96
   1 15/10/25-17:22    26   83 CPU               14 db file sequential read        1 log file sync               *****************************#####                                                                                             96
   1 15/10/25-17:23    29   85 CPU               13 db file sequential read        1 log file sync               *********************************#####                                                                                         96
   1 15/10/25-17:24    30   86 CPU               11 db file sequential read        2 log file sync               **********************************#####+                                                                                       96
   1 15/10/25-17:25    32   86 CPU               10 db file sequential read        2 log file sync               *************************************#####+                                                                                    96
   1 15/10/25-17:26    29   88 CPU                9 db file sequential read        2 log file sync               **********************************####+                                                                                        96
   1 15/10/25-17:27    25   83 CPU               11 db file sequential read        3 log file sync               ****************************#####+                                                                                             96
   1 15/10/25-17:28    24   85 CPU               11 db file sequential read        2 direct path read            ***************************####                                                                                                96
   1 15/10/25-17:29    25   85 CPU                9 db file sequential read        3 direct path read            ****************************####+                                                                                              96
   1 15/10/25-17:30    33   82 CPU               14 db file sequential read        2 read by other session       ************************************#######+                                                                                   96
   1 15/10/25-17:31    30   75 CPU               19 db file sequential read        3 read by other session       ******************************########++                                                                                       96
   1 15/10/25-17:32    27   75 CPU               20 db file sequential read        2 read by other session       ***************************########+                                                                                           96
   1 15/10/25-17:33    24   77 CPU               20 db file sequential read        2 log file sync               *************************#######+                                                                                              96
   1 15/10/25-17:34    27   76 CPU               20 db file sequential read        3 log file sync               ***************************########+                                                                                           96
   1 15/10/25-17:35    31   78 CPU               17 db file sequential read        3 log file sync               ********************************########+                                                                                      96
   1 15/10/25-17:36    28   79 CPU               19 db file sequential read        1 log file sync               ******************************########                                                                                         96
   1 15/10/25-17:37    27   77 CPU               18 db file sequential read        3 log file sync               ***************************#######+                                                                                            96
   1 15/10/25-17:38    22   84 CPU               14 db file sequential read        2 log file sync               *************************####                                                                                                  96
   1 15/10/25-17:39    21   86 CPU               10 db file sequential read        2 log file sync               ************************###+                                                                                                   96
   1 15/10/25-17:40    24   88 CPU                9 db file sequential read        1 log file sync               ****************************###+                                                                                               96
   1 15/10/25-17:41    20   87 CPU               12 db file sequential read        1 log file sync               ***********************###                                                                                                     96
   1 15/10/25-17:42    21   88 CPU                9 db file sequential read        1 log file sync               *************************###                                                                                                   96
   1 15/10/25-17:43    20   85 CPU               12 db file sequential read        2 direct path read temp       **********************####                                                                                                     96
   1 15/10/25-17:44    19   87 CPU               10 db file sequential read        2 log file sync               **********************###                                                                                                      96
   1 15/10/25-17:45    22   88 CPU                9 db file sequential read        2 log file sync               **************************###+                                                                                                 96
   1 15/10/25-17:46    21   88 CPU                9 db file sequential read        2 log file sync               *************************###+                                                                                                  96
   1 15/10/25-17:47    20   90 CPU                8 db file sequential read        1 log file sync               ************************##                                                                                                     96
   1 15/10/25-17:48    22   85 CPU               11 db file sequential read        2 direct path read temp       ************************####                                                                                                   96
   1 15/10/25-17:49    21   85 CPU               12 db file sequential read        3 log file sync               ************************####+                                                                                                  96
   1 15/10/25-17:50    26   85 CPU               12 db file sequential read        2 log file sync               *****************************####+                                                                                             96
   1 15/10/25-17:51    22   91 CPU                6 db file sequential read        3 log file sync               **************************##+                                                                                                  96
   1 15/10/25-17:52    11   90 CPU                8 db file sequential read        2 log file sync               *************#                                                                                                                 96


55.21. ash uchart - график по активным сессиям в разрезе категорий AAS      CPU     BCPU   SHEDUL      UIO      SIO   CONCUR     APPL   COMMIT   CONFIG    ADMIN      NET    QUEUE    CLUST    OTHER   IN
$ tpi mprod  ash uchart

"Data for chart: Average active/waiting sessions from gv$active_session_history in sample_time between to_date('15/10/25 17:51:17','dd/mm/yy hh24:mi:ss') - interval '1' hour and sysdate"

1                      2        3        4        5        6        7        8        9       10       11       12       13       14       15       16   18
BEGIN_TIME           AAS      CPU     BCPU   SHEDUL      UIO      SIO   CONCUR     APPL   COMMIT   CONFIG    ADMIN      NET    QUEUE    CLUST    OTHER   IN
--------------- -------- -------- -------- -------- -------- -------- -------- -------- -------- -------- -------- -------- -------- -------- -------- ----
15/10/25-16:51     16.42    13.83     0.00     0.00     2.13     0.00     0.02     0.00     0.43     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-16:52     21.95    18.85     0.00     0.00     2.52     0.00     0.00     0.00     0.57     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-16:53     22.68    19.73     0.00     0.00     2.52     0.02     0.02     0.00     0.40     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-16:54     22.00    18.47     0.00     0.00     2.80     0.02     0.05     0.00     0.63     0.00     0.00     0.03     0.00     0.00     0.00    1
15/10/25-16:55     26.63    23.73     0.00     0.00     2.33     0.02     0.00     0.02     0.48     0.00     0.00     0.00     0.00     0.00     0.05    1
15/10/25-16:56     25.87    21.82     0.00     0.00     3.22     0.00     0.05     0.00     0.78     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-16:57     24.87    20.33     0.00     0.00     3.57     0.00     0.02     0.00     0.93     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-16:58     24.25    20.53     0.00     0.00     3.05     0.02     0.03     0.00     0.62     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-16:59     25.60    21.58     0.00     0.00     3.45     0.02     0.00     0.00     0.53     0.00     0.00     0.00     0.00     0.00     0.02    1
15/10/25-17:00     38.10    31.90     0.00     0.00     5.45     0.00     0.02     0.02     0.62     0.00     0.00     0.03     0.00     0.00     0.07    1
15/10/25-17:01     37.33    31.83     0.00     0.00     4.72     0.00     0.05     0.00     0.73     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:02     29.23    25.77     0.00     0.00     3.22     0.00     0.00     0.00     0.25     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:03     26.62    23.92     0.00     0.00     2.48     0.02     0.02     0.00     0.18     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:04     22.13    19.92     0.00     0.00     1.82     0.02     0.07     0.00     0.30     0.00     0.00     0.00     0.00     0.00     0.02    1
15/10/25-17:05     25.07    22.42     0.00     0.00     2.40     0.02     0.00     0.00     0.23     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:06     22.70    19.93     0.00     0.00     2.28     0.00     0.02     0.00     0.47     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:07     25.10    21.45     0.00     0.00     3.22     0.00     0.00     0.00     0.42     0.00     0.00     0.00     0.00     0.00     0.02    1
15/10/25-17:08     24.60    21.00     0.00     0.00     3.08     0.02     0.00     0.00     0.48     0.00     0.00     0.00     0.00     0.00     0.02    1
15/10/25-17:09     21.12    17.55     0.00     0.00     3.02     0.02     0.00     0.00     0.53     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:10     25.33    21.03     0.00     0.00     3.48     0.00     0.00     0.03     0.67     0.00     0.00     0.05     0.00     0.00     0.07    1
15/10/25-17:11     22.50    18.43     0.00     0.00     3.40     0.00     0.02     0.00     0.63     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:12     25.88    22.85     0.00     0.00     2.40     0.00     0.00     0.00     0.58     0.00     0.00     0.05     0.00     0.00     0.00    1
15/10/25-17:13     26.68    23.12     0.00     0.00     3.02     0.02     0.00     0.02     0.52     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:14     26.00    20.67     0.00     0.00     4.90     0.02     0.00     0.00     0.42     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:15     29.52    22.10     0.00     0.00     6.70     0.18     0.05     0.00     0.42     0.00     0.00     0.02     0.00     0.00     0.05    1
15/10/25-17:16     27.07    20.52     0.00     0.00     6.02     0.00     0.00     0.00     0.48     0.00     0.00     0.05     0.00     0.00     0.00    1
15/10/25-17:17     27.95    22.00     0.00     0.00     5.17     0.00     0.03     0.00     0.73     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:18     29.13    23.70     0.00     0.00     4.73     0.02     0.02     0.00     0.65     0.00     0.00     0.00     0.00     0.00     0.02    1
15/10/25-17:19     28.12    23.17     0.00     0.00     3.87     0.00     0.00     0.00     1.07     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:20     31.83    26.83     0.00     0.00     3.88     0.02     0.03     0.03     1.02     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:21     28.98    24.68     0.00     0.00     3.70     0.00     0.00     0.00     0.60     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:22     25.95    21.52     0.00     0.00     4.07     0.00     0.00     0.00     0.35     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:23     29.00    24.63     0.00     0.00     4.00     0.02     0.00     0.00     0.35     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:24     29.65    25.38     0.00     0.00     3.55     0.00     0.00     0.00     0.70     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:25     32.30    27.87     0.00     0.00     3.53     0.03     0.07     0.02     0.77     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:26     28.67    25.12     0.00     0.00     3.10     0.00     0.00     0.00     0.43     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:27     25.30    20.88     0.00     0.00     3.62     0.00     0.00     0.02     0.78     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:28     23.80    20.32     0.00     0.00     3.15     0.02     0.00     0.00     0.28     0.00     0.00     0.00     0.00     0.00     0.03    1
15/10/25-17:29     24.53    20.83     0.00     0.00     3.17     0.00     0.02     0.00     0.48     0.00     0.00     0.03     0.00     0.00     0.00    1
15/10/25-17:30     33.07    27.02     0.00     0.00     5.65     0.02     0.00     0.00     0.30     0.00     0.00     0.02     0.00     0.00     0.07    1
15/10/25-17:31     29.80    22.35     0.00     0.00     7.03     0.00     0.02     0.00     0.38     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:32     27.07    20.37     0.00     0.00     6.27     0.00     0.02     0.00     0.42     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:33     24.07    18.63     0.00     0.00     5.02     0.02     0.00     0.00     0.40     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:34     27.00    20.57     0.00     0.00     5.70     0.00     0.00     0.00     0.73     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:35     30.85    24.07     0.00     0.00     5.67     0.05     0.08     0.00     0.88     0.00     0.00     0.03     0.00     0.00     0.07    1
15/10/25-17:36     28.32    22.30     0.00     0.00     5.75     0.00     0.00     0.00     0.27     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:37     26.50    20.28     0.00     0.00     5.45     0.00     0.00     0.00     0.77     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:38     21.90    18.40     0.00     0.00     3.17     0.00     0.00     0.00     0.33     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:39     20.55    17.65     0.00     0.00     2.50     0.03     0.00     0.00     0.35     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:40     24.02    21.22     0.00     0.00     2.45     0.02     0.00     0.00     0.33     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:41     19.77    17.22     0.00     0.00     2.38     0.00     0.02     0.00     0.15     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:42     21.25    18.65     0.00     0.00     2.30     0.00     0.00     0.00     0.28     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:43     19.83    16.78     0.00     0.00     2.85     0.00     0.00     0.00     0.18     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:44     19.08    16.62     0.00     0.00     2.15     0.02     0.00     0.00     0.30     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:45     21.97    19.40     0.00     0.00     2.05     0.03     0.00     0.00     0.40     0.00     0.00     0.02     0.00     0.00     0.07    1
15/10/25-17:46     20.93    18.42     0.00     0.00     2.12     0.00     0.00     0.00     0.40     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:47     20.37    18.27     0.00     0.00     1.87     0.00     0.00     0.00     0.22     0.00     0.00     0.02     0.00     0.00     0.00    1
15/10/25-17:48     21.50    18.22     0.00     0.00     2.98     0.00     0.00     0.00     0.28     0.00     0.00     0.00     0.00     0.00     0.02    1
15/10/25-17:49     21.10    17.82     0.00     0.00     2.67     0.02     0.02     0.00     0.58     0.00     0.00     0.00     0.00     0.00     0.00    1
15/10/25-17:50     25.87    21.87     0.00     0.00     3.33     0.07     0.02     0.00     0.52     0.00     0.00     0.00     0.00     0.00     0.07    1
15/10/25-17:51      6.27     5.62     0.00     0.00     0.40     0.00     0.00     0.00     0.25     0.00     0.00     0.00     0.00     0.00     0.00    1

аналогично можно построить наглядный график по выбранным колонкам:
$ tpi mprod  ash uchart | diagram.sh  2 3 6 7 8 9 10 13 16

BEGIN_TIME      AAS    LEVELS           CPU    LEVELS           UIO   LEVELS           SIO   LEVELS           CONCUR  LEVELS           APPL  LEVELS           COMMIT  LEVELS           NET   LEVELS           OTHER  LEVELS
15/10/25-16:51  9.00   |==              7.45   |==              1.22  |=               0.00  |                0.00    |                0.00  |                0.33    |===             0.00  |                0.00   |
15/10/25-16:52  21.95  |=======         18.85  |=======         2.52  |====            0.00  |                0.00    |                0.00  |                0.57    |======          0.02  |=====           0.00   |
15/10/25-16:53  22.68  |=======         19.73  |========        2.52  |====            0.02  |                0.02    |==              0.00  |                0.40    |====            0.00  |                0.00   |
15/10/25-16:54  22.00  |=======         18.47  |=======         2.80  |====            0.02  |                0.05    |========        0.00  |                0.63    |=======         0.03  |========        0.00   |
15/10/25-16:55  26.63  |=========       23.73  |==========      2.33  |===             0.02  |                0.00    |                0.02  |=========       0.48    |=====           0.00  |                0.05   |=========
15/10/25-16:56  25.87  |=========       21.82  |=========       3.22  |=====           0.00  |                0.05    |========        0.00  |                0.78    |=========       0.00  |                0.00   |
15/10/25-16:57  24.87  |========        20.33  |========        3.57  |======          0.00  |                0.02    |==              0.00  |                0.93    |============    0.02  |=====           0.00   |
15/10/25-16:58  24.25  |========        20.53  |========        3.05  |=====           0.02  |                0.03    |====            0.00  |                0.62    |=======         0.00  |                0.00   |
15/10/25-16:59  25.60  |=========       21.58  |=========       3.45  |======          0.02  |                0.00    |                0.00  |                0.53    |======          0.00  |                0.02   |===
15/10/25-17:00  38.10  |==============  31.90  |==============  5.45  |==========      0.00  |                0.02    |==              0.02  |=========       0.62    |=======         0.03  |========        0.07   |==============
15/10/25-17:01  37.33  |=============   31.83  |=============   4.72  |=========       0.00  |                0.05    |========        0.00  |                0.73    |=========       0.00  |                0.00   |
15/10/25-17:02  29.23  |==========      25.77  |===========     3.22  |=====           0.00  |                0.00    |                0.00  |                0.25    |==              0.00  |                0.00   |
15/10/25-17:03  26.62  |=========       23.92  |==========      2.48  |====            0.02  |                0.02    |==              0.00  |                0.18    |=               0.00  |                0.00   |
15/10/25-17:04  22.13  |=======         19.92  |========        1.82  |==              0.02  |                0.07    |============    0.00  |                0.30    |===             0.00  |                0.02   |===
15/10/25-17:05  25.07  |========        22.42  |=========       2.40  |====            0.02  |                0.00    |                0.00  |                0.23    |==              0.00  |                0.00   |
15/10/25-17:06  22.70  |=======         19.93  |========        2.28  |===             0.00  |                0.02    |==              0.00  |                0.47    |=====           0.00  |                0.00   |
15/10/25-17:07  25.10  |========        21.45  |=========       3.22  |=====           0.00  |                0.00    |                0.00  |                0.42    |====            0.00  |                0.02   |===
15/10/25-17:08  24.60  |========        21.00  |========        3.08  |=====           0.02  |                0.00    |                0.00  |                0.48    |=====           0.00  |                0.02   |===
15/10/25-17:09  21.12  |=======         17.55  |=======         3.02  |=====           0.02  |                0.00    |                0.00  |                0.53    |======          0.00  |                0.00   |
15/10/25-17:10  25.33  |========        21.03  |========        3.48  |======          0.00  |                0.00    |                0.03  |==============  0.67    |========        0.05  |==============  0.07   |==============
15/10/25-17:11  22.50  |=======         18.43  |=======         3.40  |======          0.00  |                0.02    |==              0.00  |                0.63    |=======         0.02  |=====           0.00   |
15/10/25-17:12  25.88  |=========       22.85  |=========       2.40  |====            0.00  |                0.00    |                0.00  |                0.58    |=======         0.05  |==============  0.00   |
15/10/25-17:13  26.68  |=========       23.12  |=========       3.02  |=====           0.02  |                0.00    |                0.02  |=========       0.52    |======          0.00  |                0.00   |
15/10/25-17:14  26.00  |=========       20.67  |========        4.90  |=========       0.02  |                0.00    |                0.00  |                0.42    |====            0.00  |                0.00   |
15/10/25-17:15  29.52  |==========      22.10  |=========       6.70  |=============   0.18  |==============  0.05    |========        0.00  |                0.42    |====            0.02  |=====           0.05   |=========
15/10/25-17:16  27.07  |=========       20.52  |========        6.02  |===========     0.00  |                0.00    |                0.00  |                0.48    |=====           0.05  |==============  0.00   |
15/10/25-17:17  27.95  |==========      22.00  |=========       5.17  |==========      0.00  |                0.03    |====            0.00  |                0.73    |=========       0.02  |=====           0.00   |
15/10/25-17:18  29.13  |==========      23.70  |==========      4.73  |=========       0.02  |                0.02    |==              0.00  |                0.65    |========        0.00  |                0.02   |===
15/10/25-17:19  28.12  |==========      23.17  |=========       3.87  |=======         0.00  |                0.00    |                0.00  |                1.07    |==============  0.02  |=====           0.00   |
15/10/25-17:20  31.83  |===========     26.83  |===========     3.88  |=======         0.02  |                0.03    |====            0.03  |==============  1.02    |=============   0.02  |=====           0.00   |
15/10/25-17:21  28.98  |==========      24.68  |==========      3.70  |======          0.00  |                0.00    |                0.00  |                0.60    |=======         0.00  |                0.00   |
15/10/25-17:22  25.95  |=========       21.52  |=========       4.07  |=======         0.00  |                0.00    |                0.00  |                0.35    |===             0.02  |=====           0.00   |
15/10/25-17:23  29.00  |==========      24.63  |==========      4.00  |=======         0.02  |                0.00    |                0.00  |                0.35    |===             0.00  |                0.00   |
15/10/25-17:24  29.65  |==========      25.38  |==========      3.55  |======          0.00  |                0.00    |                0.00  |                0.70    |========        0.02  |=====           0.00   |
15/10/25-17:25  32.30  |===========     27.87  |============    3.53  |======          0.03  |=               0.07    |============    0.02  |=========       0.77    |=========       0.02  |=====           0.00   |
15/10/25-17:26  28.67  |==========      25.12  |==========      3.10  |=====           0.00  |                0.00    |                0.00  |                0.43    |=====           0.02  |=====           0.00   |
15/10/25-17:27  25.30  |========        20.88  |========        3.62  |======          0.00  |                0.00    |                0.02  |=========       0.78    |=========       0.00  |                0.00   |
15/10/25-17:28  23.80  |========        20.32  |========        3.15  |=====           0.02  |                0.00    |                0.00  |                0.28    |==              0.00  |                0.03   |=====
15/10/25-17:29  24.53  |========        20.83  |========        3.17  |=====           0.00  |                0.02    |==              0.00  |                0.48    |=====           0.03  |========        0.00   |
15/10/25-17:30  33.07  |============    27.02  |===========     5.65  |===========     0.02  |                0.00    |                0.00  |                0.30    |===             0.02  |=====           0.07   |==============
15/10/25-17:31  29.80  |==========      22.35  |=========       7.03  |==============  0.00  |                0.02    |==              0.00  |                0.38    |====            0.02  |=====           0.00   |
15/10/25-17:32  27.07  |=========       20.37  |========        6.27  |============    0.00  |                0.02    |==              0.00  |                0.42    |====            0.00  |                0.00   |
15/10/25-17:33  24.07  |========        18.63  |=======         5.02  |=========       0.02  |                0.00    |                0.00  |                0.40    |====            0.00  |                0.00   |
15/10/25-17:34  27.00  |=========       20.57  |========        5.70  |===========     0.00  |                0.00    |                0.00  |                0.73    |=========       0.00  |                0.00   |
15/10/25-17:35  30.85  |===========     24.07  |==========      5.67  |===========     0.05  |===             0.08    |==============  0.00  |                0.88    |===========     0.03  |========        0.07   |==============
15/10/25-17:36  28.32  |==========      22.30  |=========       5.75  |===========     0.00  |                0.00    |                0.00  |                0.27    |==              0.00  |                0.00   |
15/10/25-17:37  26.50  |=========       20.28  |========        5.45  |==========      0.00  |                0.00    |                0.00  |                0.77    |=========       0.00  |                0.00   |
15/10/25-17:38  21.90  |=======         18.40  |=======         3.17  |=====           0.00  |                0.00    |                0.00  |                0.33    |===             0.00  |                0.00   |
15/10/25-17:39  20.55  |=======         17.65  |=======         2.50  |====            0.03  |=               0.00    |                0.00  |                0.35    |===             0.02  |=====           0.00   |
15/10/25-17:40  24.02  |========        21.22  |========        2.45  |====            0.02  |                0.00    |                0.00  |                0.33    |===             0.00  |                0.00   |
15/10/25-17:41  19.77  |======          17.22  |=======         2.38  |====            0.00  |                0.02    |==              0.00  |                0.15    |=               0.00  |                0.00   |
15/10/25-17:42  21.25  |=======         18.65  |=======         2.30  |===             0.00  |                0.00    |                0.00  |                0.28    |==              0.02  |=====           0.00   |
15/10/25-17:43  19.83  |======          16.78  |======          2.85  |=====           0.00  |                0.00    |                0.00  |                0.18    |=               0.02  |=====           0.00   |
15/10/25-17:44  19.08  |======          16.62  |======          2.15  |===             0.02  |                0.00    |                0.00  |                0.30    |===             0.00  |                0.00   |
15/10/25-17:45  21.97  |=======         19.40  |========        2.05  |===             0.03  |=               0.00    |                0.00  |                0.40    |====            0.02  |=====           0.07   |==============
15/10/25-17:46  20.93  |=======         18.42  |=======         2.12  |===             0.00  |                0.00    |                0.00  |                0.40    |====            0.00  |                0.00   |
15/10/25-17:47  20.37  |=======         18.27  |=======         1.87  |==              0.00  |                0.00    |                0.00  |                0.22    |==              0.02  |=====           0.00   |
15/10/25-17:48  21.50  |=======         18.22  |=======         2.98  |=====           0.00  |                0.00    |                0.00  |                0.28    |==              0.00  |                0.02   |===
15/10/25-17:49  21.10  |=======         17.82  |=======         2.67  |====            0.02  |                0.02    |==              0.00  |                0.58    |=======         0.00  |                0.00   |
15/10/25-17:50  25.87  |=========       21.87  |=========       3.33  |======          0.07  |====            0.02    |==              0.00  |                0.52    |======          0.00  |                0.07   |==============
15/10/25-17:51  14.00  |====            12.43  |====            0.98  |=               0.00  |                0.02    |==              0.00  |                0.57    |======          0.00  |                0.00   |




56  dhash [in=INST_ID] [con=[CON_ID]] [dd/mm/yy-HH:MI-HH:MI(hours) - def1h] [ event | sess [SID SERIAL# [all|nosqlid|tchcnt] | SQL_ID] | where [FIELD CONDITION] | sql [top [event]] [all [event]] [SQL_ID|SQL_TEXT] | plan SQL_ID PHV [fmt display plan] | sqlstat [SQL_ID|pio|lio|cpu|exe|ela|fch|sor|iow|row] [executions] | insection [username|service|machine|program,module,action|sql_opname,sql_plan_operation,sql_plan_options|event|wait_class] | growseg [TBS] [SEGMENT] | segstat [SEGMENT] [OWNER] [SORT_COL] | temp [sizeMb] | (umc)chart | iostat [df|redo|ctl|temp|arch|other] ] | awrinfo
       исторические данные из awr - DBA_HIST_ACTIVE_SESS_HISTORY, параметры во многом аналогичны ash - V$ACTIVE_SESSION_HISTORY, но есть некоторые отличия. Далее отличия от ash


56.1 пример, растущие сегменты за период с 01/10/25-09:03 + 10 дней в табличном пространстве JOURN
    
$ tpi mprod  dhash 01/10/25-09:03-240 growseg JOURN

"DBA_HIST_SEG_STAT: Most segments growth in begin_interval_time between to_date('01/10/25 09:03','dd/mm/yy hh24:mi') and to_date('01/10/25 09:03','dd/mm/yy hh24:mi') + interval '240' hour +  interval '2' minute"

OWNER                OBJECT_NAME                    SUBOBJECT_NAME                                 OBJECT_TYPE        Tablespace             Growth in MB Total Size(GB)
-------------------- ------------------------------ ---------------------------------------------- ------------------ ---------------------- ------------ --------------
GAL_VEK              J$1006                                                                        TABLE              JOURN                          3862          73.24
GAL_VEK              ORJOURNALINDEX1006                                                            INDEX              JOURN                           904          23.05
GAL_VEK              X$JOURNAL1                                                                    INDEX              JOURN                           256          70.59
GAL_VEK              X$JOURNAL2                                                                    INDEX              JOURN                           254          68.04
GAL_VEK              X$JOURNAL5                                                                    INDEX              JOURN                           128          35.37
GAL_VEK              ORJOURNALINDEX15018                                                           INDEX              JOURN                           .63              0
                                                                                                                                             ------------ --------------
SUM                                                                                                                                               5404.63         270.29

56.2 пример, статистика по сегменту  'X$JOURNAL1', владелец "GAL_VEK" за период с  01/10/25-09:03-6 - за 6 часов.

$ tpi mprod  dhash 01/10/25-09:03-6 segstat 'X$JOURNAL1' GAL_VEK
"Segment statistics for OBJECTS with max BLOCK_CHANGED from AWR in begin_interval_time between to_date('01/10/25 09:03','dd/mm/yy hh24:mi') and to_date('01/10/25 09:03','dd/mm/yy hh24:mi') + interval '6' hour +  interval '2' minute for SEGMENT: X$JOURNAL1 OWNER: GAL_VEK

1                                                                                                       5          6          7         8         9        10        11        12        13         14         15
BEGIN_TIME      OWNER                OBJECT_NAME                         OBJECT_TYPE             LogRe_Bl   BufBusWa  DbBlCh_Bl   PhRe_Bl   PhWr_Bl PhReDirBl PhWrDirBl     ITL_W  RowLckWa   SpAlloMb  SpAlloTMb
--------------- -------------------- ----------------------------------- -------------------- ----------- ---------- ---------- --------- --------- --------- --------- --------- --------- ---------- ----------
01/10/25-10:00  GAL_VEK              X$JOURNAL1                          INDEX                    5585984        664     657856    101369    228182         0         0         0       430          0       2304
01/10/25-11:00  GAL_VEK              X$JOURNAL1                          INDEX                    7780544        373    1133552    367787    476685         0         0         0       282          0       2304
01/10/25-13:00  GAL_VEK              X$JOURNAL1                          INDEX                    5369600        267     650752    112169    256505         0         0         0       184          0       2304
01/10/25-14:00  GAL_VEK              X$JOURNAL1                          INDEX                   10859856       3160    1341440    213001    237586         0         0         8      2234          0       2304
01/10/25-15:00  GAL_VEK              X$JOURNAL1                          INDEX                   11368304      16613    1703872    174969    205657         0         0         1      8746          0       2304


56.3  iostat [df|redo|ctl|temp|arch|other] - статистика по IO отдельно по Датафайлам, редо, контрольникам, temp, archivelog, other, по умолчанию - df, см: Legend

$ tpi mprod  dhash 01/10/25-09:03-24 iostat
Legend:
TRE_MBS  - TotalReads           SRE_MBS  - SingleReadsMBS      SMRE_LAT - Small_read_servicetime/Small_read_reqs
TRE_IOPS - TotalReadsIOPS       SRE_IOPS - SingleReadsIOPS     SMWR_LAT - Small_write_servicetime/Small_write_reqs
TWR_MBS  - TotalWrites          SWR_MBS  - SingleWritesMBS     LARE_LAT - Large_read_servicetime/Large_read_reqs
TWR_IOPS - TotoalWritesIOPS     SWR_IOPS - SingleWritesIOPS    LAWR_LAT - Large_write_servicetime/Large_rwrite_reqs
IN       - Instance_number
dba_hist_iostat_filetype param 'Archive Log' 'Control File' 'Data File' 'Log File'  'Other' 'Temp File' for  Data File

1                          2          3          4          5          6          7          8          9         10         11         12         13   14
BEGIN_TIME           TRE_MBS   TRE_IOPS    TWR_MBS   TWR_IOPS    SRE_MBS   SRE_IOPS    SWR_MBS   SWR_IOPS   SMRE_LAT   SMWR_LAT   LARE_LAT   LAWR_LAT   IN
----------------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----
01/10/25-10:00         78.62    8470.56      10.35     550.47      66.54    8456.66       5.69     513.17       0.08       0.49       1.16       0.19    1
01/10/25-11:00        645.45   14832.32       9.41     618.31     112.05   14297.00       6.17     592.43       0.07       1.55       3.92       0.37    1
01/10/25-12:00        144.20   10107.79       9.28     612.93      78.95   10041.93       6.08     587.34       0.07       0.45       3.36       0.27    1
01/10/25-13:00        134.21    8670.99       8.47     514.45      68.83    8601.41       5.29     488.99       0.07       0.42       2.39       0.20    1
01/10/25-14:00        145.79    9155.75      14.48     679.60      71.64    9078.43       8.47     631.53       0.07       0.44       3.70       0.20    1
01/10/25-15:00        668.32   14918.11      15.50     689.97     112.77   14359.80       8.32     632.51    1257.47       5.42       4.13       4.94    1
01/10/25-16:00        270.17    6940.86      12.35     603.01      53.20    6721.71       7.01     560.26       0.08       0.40       3.30       0.17    1
01/10/25-17:00         56.21    4559.60       9.74     498.61      35.82    4536.74       5.19     462.24    1592.08       0.42       0.53       0.16    1
01/10/25-18:00         33.65    3377.76       5.98     357.71      26.53    3370.29       3.53     338.09       0.07       0.39       1.28       0.15    1
01/10/25-19:00        491.67    8498.96       3.80     246.81      63.24    8069.20       2.28     234.68    3227.69       0.43       3.66       0.29    1
01/10/25-20:01         39.38    3102.58       3.39     224.00      24.36    3086.55       2.10     213.64    5065.78       0.39       0.84       0.17    1
01/10/25-21:00        242.19    5528.08      11.95     569.66      44.21    5322.54       6.69     527.57   15760.60      16.09   58303.75       2.90    1
01/10/25-22:00        165.97    6154.08       7.82     412.19      48.42    6033.09       4.56     386.08   20731.27       0.57    9753.61       0.51    1
01/10/25-23:00        566.94    3229.51      11.84     709.81      22.42    2680.77       8.07     679.60    1787.19       0.74       3.30       0.53    1
02/10/25-00:00        171.79   13186.47      12.43     701.34     103.48   13116.21       7.85     664.73   16959.60       8.15   17116.39       8.18    1
02/10/25-01:00        203.86    4875.59      13.92     802.09      38.66    4696.18       8.77     760.85       0.12       0.39       3.26       0.17    1
02/10/25-02:00        413.50    4200.18      13.22     684.93      35.78    3529.41       7.66     640.49       1.03       7.81      21.87       0.94    1
02/10/25-03:00        575.69    4392.61      10.63     440.17      30.34    3845.68       5.31     397.63       0.07       0.65       3.39       0.29    1
02/10/25-04:00         47.54    2678.24       8.78     356.25      20.88    2651.41       4.09     318.69       0.06       0.33       1.23       0.14    1
02/10/25-05:00         50.49    4178.05       8.83     379.52      32.73    4158.30       4.29     343.20       0.05       0.32       0.35       0.13    1
02/10/25-06:00        312.33   12548.15      13.80     555.14     102.86   12322.56       7.38     503.83    1265.72       0.33       3.33       0.13    1
02/10/25-07:00        749.78   20987.33      13.87     490.87     160.36   20394.70       6.36     430.79   25603.08       0.47    2030.64       4.98    1
02/10/25-08:00        330.62   15443.92      17.37     779.22     120.02   15227.11       9.57     716.86   13405.54      32.29       6.57      18.13    1
02/10/25-09:00        282.62   18591.74       6.53     439.35     147.85   18452.48       4.20     420.64    3281.97       0.90       4.38       1.08    1

также можно построить наглядный график по этим данным:
$ tpi mprod  dhash 01/10/25-09:03-24 iostat | diagram.sh  2 3 4 5 6 7 8 9 10 11 12 13

BEGIN_TIME      TRE_MBS  LEVELS           TRE_IOPS  LEVELS           TWR_MBS  LEVELS           TWR_IOPS  LEVELS          SRE_MBS  LEVELS           SRE_IOPS  LEVELS           SWR_MBS  LEVELS           SWR_IOPS  LEVELS           SMRE_LAT  LEVELS           SMWR_LAT  LEVELS           LARE_LAT  LEVELS           LAWR_LAT  LEVELS
01/10/25-10:00  78.62    |                8470.56   |=====           10.35    |=======         550.47    |=========      66.54    |=====           8456.66   |=====           5.69     |=======         513.17    |=========       0.08      |                0.49      |                1.16      |                0.19      |
01/10/25-11:00  645.45   |===========     14832.32  |=========       9.41     |=======         618.31    |==========     112.05   |=========       14297.00  |=========       6.17     |========        592.43    |==========      0.07      |                1.55      |                3.92      |                0.37      |
01/10/25-12:00  144.20   |=               10107.79  |======          9.28     |=======         612.93    |==========     78.95    |======          10041.93  |======          6.08     |========        587.34    |==========      0.07      |                0.45      |                3.36      |                0.27      |
01/10/25-13:00  134.21   |=               8670.99   |=====           8.47     |======          514.45    |========       68.83    |=====           8601.41   |=====           5.29     |=======         488.99    |========        0.07      |                0.42      |                2.39      |                0.20      |
01/10/25-14:00  145.79   |=               9155.75   |=====           14.48    |===========     679.60    |===========    71.64    |=====           9078.43   |=====           8.47     |============    631.53    |===========     0.07      |                0.44      |                3.70      |                0.20      |
01/10/25-15:00  668.32   |============    14918.11  |=========       15.50    |============    689.97    |===========    112.77   |=========       14359.80  |=========       8.32     |============    632.51    |===========     1257.47   |                5.42      |=               4.13      |                4.94      |===
01/10/25-16:00  270.17   |====            6940.86   |===             12.35    |=========       603.01    |==========     53.20    |===             6721.71   |===             7.01     |=========       560.26    |==========      0.08      |                0.40      |                3.30      |                0.17      |
01/10/25-17:00  56.21    |                4559.60   |==              9.74     |=======         498.61    |========       35.82    |==              4536.74   |==              5.19     |=======         462.24    |========        1592.08   |                0.42      |                0.53      |                0.16      |
01/10/25-18:00  33.65    |                3377.76   |=               5.98     |====            357.71    |=====          26.53    |=               3370.29   |=               3.53     |====            338.09    |=====           0.07      |                0.39      |                1.28      |                0.15      |
01/10/25-19:00  491.67   |========        8498.96   |=====           3.80     |==              246.81    |===            63.24    |====            8069.20   |====            2.28     |==              234.68    |===             3227.69   |                0.43      |                3.66      |                0.29      |
01/10/25-20:01  39.38    |                3102.58   |=               3.39     |=               224.00    |===            24.36    |=               3086.55   |=               2.10     |==              213.64    |===             5065.78   |=               0.39      |                0.84      |                0.17      |
01/10/25-21:00  242.19   |===             5528.08   |==              11.95    |=========       569.66    |=========      44.21    |===             5322.54   |==              6.69     |=========       527.57    |=========       15760.60  |========        16.09     |======          58303.75  |==============  2.90      |=
01/10/25-22:00  165.97   |==              6154.08   |===             7.82     |=====           412.19    |======         48.42    |===             6033.09   |===             4.56     |======          386.08    |======          20731.27  |===========     0.57      |                9753.61   |=               0.51      |
01/10/25-23:00  566.94   |==========      3229.51   |=               11.84    |=========       709.81    |============   22.42    |=               2680.77   |                8.07     |===========     679.60    |============    1787.19   |                0.74      |                3.30      |                0.53      |
02/10/25-00:00  171.79   |==              13186.47  |========        12.43    |=========       701.34    |============   103.48   |========        13116.21  |========        7.85     |===========     664.73    |============    16959.60  |========        8.15      |==              17116.39  |===             8.18      |=====
02/10/25-01:00  203.86   |===             4875.59   |==              13.92    |===========     802.09    |=============  38.66    |==              4696.18   |==              8.77     |============    760.85    |==============  0.12      |                0.39      |                3.26      |                0.17      |
02/10/25-02:00  413.50   |=======         4200.18   |==              13.22    |==========      684.93    |===========    35.78    |==              3529.41   |=               7.66     |===========     640.49    |===========     1.03      |                7.81      |==              21.87     |                0.94      |
02/10/25-03:00  575.69   |==========      4392.61   |==              10.63    |========        440.17    |=======        30.34    |=               3845.68   |=               5.31     |=======         397.63    |======          0.07      |                0.65      |                3.39      |                0.29      |
02/10/25-04:00  47.54    |                2678.24   |                8.78     |======          356.25    |=====          20.88    |                2651.41   |                4.09     |=====           318.69    |=====           0.06      |                0.33      |                1.23      |                0.14      |
02/10/25-05:00  50.49    |                4178.05   |=               8.83     |======          379.52    |======         32.73    |==              4158.30   |==              4.29     |=====           343.20    |=====           0.05      |                0.32      |                0.35      |                0.13      |
02/10/25-06:00  312.33   |=====           12548.15  |=======         13.80    |==========      555.14    |=========      102.86   |========        12322.56  |========        7.38     |==========      503.83    |========        1265.72   |                0.33      |                3.33      |                0.13      |
02/10/25-07:00  749.78   |==============  20987.33  |==============  13.87    |==========      490.87    |========       160.36   |==============  20394.70  |==============  6.36     |========        430.79    |=======         25603.08  |==============  0.47      |                2030.64   |                4.98      |===
02/10/25-08:00  330.62   |=====           15443.92  |==========      17.37    |==============  779.22    |=============  120.02   |==========      15227.11  |==========      9.57     |==============  716.86    |=============   13405.54  |======          32.29     |==============  6.57      |                18.13     |==============
02/10/25-09:00  282.62   |====            18591.74  |============    6.53     |====            439.35    |=======        147.85   |============    18452.48  |============    4.20     |=====           420.64    |=======         3281.97   |                0.90      |                4.38      |                1.08      |



56.4 различная статистика из awr за период, см: Legend

$ tpi mprod  dhash 01/10/25-09:03-24 awrinfo
Legend:
AAS     - Average Active Sessions     REDO_GB - Redo Size Generated per Hour             PHYREMBT - Physical Read Total (MB)        ENQTXMS - Enqueue TX contention (ms)
DBTIMEM - DB Time                     DBBLC   - Block Changed per Hour                   PHYWRMBT - Physical Write Total (MB)       ENQTMMS - Enqueue TM contention (ms)
DBCPUM  - DB CPU                      PGAMB   - PGA Size                                 PHREMBPS - Physical Read Mb per Second     TRANMIN - DB Transactions per min
LOAD    - CPU Load                    READLAT - Read S\B Latency                         PHWRMBPS - Physical Write Mb per Second    ROLLMIN - DB Rollbacks per min
LOADW   - CPU Load Windows            LFPWLAT - Log File parallel write (ms) Latency     PHREIOPS - Physical Read IOPS              IN      - Instance_number
LIOPSEC - Logical Reads per second    LFSYLAT - Log File sync (ms) Latency               PHWRIOPS - Physical Write IOPS
Data from: dba_hist_sys_time_model  dba_hist_osstat dba_hist_system_event dba_hist_sysstat dba_hist_sysmetric_summary

1                      2       3      4      5      6         7       8           9     10       11       12       13       14       15      16      17      18      19        20       21      22      23   24
BEGIN_TIME           AAS DBTIMEM DBCPUM   LOAD  LOADW   LIOPSEC REDO_GB     DBBLC^3  PGAMB  READLAT  LFPWLAT  LFSYLAT PHYREMBT PHYWRMBT PREMBPS PWRMBPS PREIOPS PWRIOPS   ENQTXMS  ENQTMMS TRANMIN ROLLMIN   IN
----------------- ------ ------- ------ ------ ------ --------- ------- ----------- ------ -------- -------- -------- -------- -------- ------- ------- ------- ------- --------- -------- ------- ------- ----
01/10/25-10:00:09      0       0      0     27    145         0       0           0   9130     0.34     0.52     1.36        0        0       0       0   11069    2621      1625        0       0       0    1
01/10/25-11:00:26     28    1713    689     34    150   2185539      27      174667  11811     0.33     0.48     1.66   358457   168734      99      47    8797    2367      6979        0   64336     720    1
01/10/25-12:00:36     32    1938    707     28    157   2013803      23      135816  11476     0.33     0.49     1.21  2379197   209044     657      58   14841    3178    869712        0   36457     237    1
01/10/25-13:00:56     26    1558    633     31    136   2228871      21      127370  13476     0.32     0.46     1.17   628681   454600     176     127   10243    2770   1564506        0   40080     167    1
01/10/25-14:00:24     22    1332    568     31    112   1763724      21      135726  12029     0.33     0.50     1.64   513389   106113     142      29    8838    2299      1860        0   48412     792    1
01/10/25-15:00:50     27    1598    655     38    136   1917198      40      235841  14137     0.35     0.54     1.90   578582   185835     162      52    9187    2974      4938        0   62471     945    1
01/10/25-16:00:18     32    1935    705     33    157   2364440      43      249101  14696     0.34     0.51     1.57  2474329   259328     685      72   15314    3634      7026        0   43463     576    1
01/10/25-17:00:32     25    1480    618     29    135   1887906      32      171396  12960     0.30     0.47     1.14  1160723   224012     325      63    7323    2613      4491        0   24821     164    1
01/10/25-18:00:00     14     878    410     12     82   1250267      24      129654   9359     0.28     0.45     0.83   320017   165998      88      46    4923    1619       401        0   16189      34    1
01/10/25-19:00:35     12     714    366     15     65   1063827      16      102008   8209     0.28     0.42     0.67   183885   114275      51      32    3613    1102       800        0   14182      29    1
01/10/25-20:01:03     12     732    353     10     63   1223244       9       60425   6823     0.28     0.42     0.69  1799001    46506     504      13    8640     811       292        0   11887      26    1
01/10/25-21:00:34      8     475    240     12     49    822943       9       58720   7414     0.28     0.42     0.69   234898    72323      66      20    3204     721       185        0   16734      49    1
01/10/25-22:00:18     10     599    280     12     52    900329      12       80995   5081     0.31     0.43     0.92   886906    83987     244      23    5657    1220        56        0   32971      77    1
01/10/25-23:00:58     13     787    375     20     71    942828      20      132020   5019     0.32     0.48     1.19   633494    99268     177      28    6147    1705        42        0   33554      62    1
02/10/25-00:00:44     12     728    370     18     75    838111      24      155405   4212     0.27     0.49     1.09  2121870   146400     594      41    3382    2067        27        0   21851      49    1
02/10/25-01:00:16     15     888    336     13     65    901518      29      186933   5379     0.29     0.40     1.39   649049   139527     179      38   13344    1745         5        0   51586      32    1
02/10/25-02:00:50     11     679    293     14     56    944402      36      236988   3746     0.30     0.43     1.55   785812   172479     221      49    4923    2717         2        0   52209      15    1
02/10/25-03:00:03      8     482    230      8     70    711055      39      257959   3109     0.28     0.38     1.22  1529377   285592     421      79    4376    2636         2        0   52123      28    1
02/10/25-04:00:37      9     513    246      9     46    916353      38      236880   3819     0.26     0.36     1.05  2142120   168030     599      47    4446    2311        12        0   55587      14    1
02/10/25-05:00:15      7     410    209      9     39    693455      34      227473   4657     0.27     0.35     1.05   210069   143093      58      39    2753    2176         0        0   57074      17    1
02/10/25-06:00:55      8     503    244     12     44    900168      33      225167   3829     0.25     0.35     1.30   227925   144315      64      40    4206    2218       849        0   86917      27    1
02/10/25-07:00:35     13     769    319     16     66    975665      42      358995   4975     0.30     0.43     1.42  1298380   252652     363      71   12694    3415        75        0   70699      30    1
02/10/25-08:00:13     16     936    375     21     86   1322715      50      434015   6024     0.31     0.45     1.41  2907904   275297     804      76   21259    2909      3140        0   63731     621    1
02/10/25-09:00:32     23    1403    579     28    114   1885735      44      344593   9245     0.00     0.00     0.00  1255996   223429     347      62   15198    3390         0        0   28363      92    1


также можно построить наглядный график по этим данным:

$ tpi mprod  dhash 01/10/25-09:03-24 awrinfo | diagram.sh  2 7 8 9 10 11 12 13 16 17 20 21 22 23

BEGIN_TIME         AAS  LEVELS           LIOPSEC  LEVELS           REDO_GB  LEVELS           DBBLC^3  LEVELS           PGAMB  LEVELS           READLAT  LEVELS           LFPWLAT  LEVELS           LFSYLAT  LEVELS           PREMBPS  LEVELS           PWRMBPS  LEVELS           ENQTXMS  LEVELS           ENQTMMS  LEVELS  TRANMIN  LEVELS           ROLLMIN  LEVELS
01/10/25-10:00:09  0    |                0        |                0        |                0        |                9130   |========        0.34     |=============   0.52     |=============   1.36     |=========       0        |                0        |                1625     |                0        |       0        |                0        |
01/10/25-11:00:26  28   |============    2185539  |============    27       |=======         174667   |=====           11811  |===========     0.33     |=============   0.48     |============    1.66     |============    99       |                47       |====            6979     |                0        |       64336    |==========      720      |==========
01/10/25-12:00:36  32   |==============  2013803  |===========     23       |=====           135816   |===             11476  |==========      0.33     |=============   0.49     |============    1.21     |========        657      |===========     58       |=====           869712   |=======         0        |       36457    |=====           237      |==
01/10/25-13:00:56  26   |===========     2228871  |=============   21       |=====           127370   |===             13476  |============    0.32     |============    0.46     |===========     1.17     |========        176      |==              127      |==============  1564506  |==============  0        |       40080    |=====           167      |=
01/10/25-14:00:24  22   |=========       1763724  |==========      21       |=====           135726   |===             12029  |===========     0.33     |=============   0.50     |============    1.64     |===========     142      |=               29       |==              1860     |                0        |       48412    |=======         792      |===========
01/10/25-15:00:50  27   |===========     1917198  |===========     40       |===========     235841   |=======         14137  |=============   0.35     |==============  0.54     |==============  1.90     |==============  162      |==              52       |=====           4938     |                0        |       62471    |=========       945      |==============
01/10/25-16:00:18  32   |==============  2364440  |==============  43       |===========     249101   |=======         14696  |==============  0.34     |=============   0.51     |=============   1.57     |===========     685      |===========     72       |=======         7026     |                0        |       43463    |======          576      |========
01/10/25-17:00:32  25   |==========      1887906  |==========      32       |========        171396   |====            12960  |============    0.30     |===========     0.47     |============    1.14     |=======         325      |=====           63       |======          4491     |                0        |       24821    |===             164      |=
01/10/25-18:00:00  14   |=====           1250267  |======          24       |======          129654   |===             9359   |========        0.28     |===========     0.45     |===========     0.83     |=====           88       |                46       |====            401      |                0        |       16189    |=               34       |
01/10/25-19:00:35  12   |====            1063827  |=====           16       |===             102008   |==              8209   |=======         0.28     |===========     0.42     |==========      0.67     |====            51       |                32       |==              800      |                0        |       14182    |=               29       |
01/10/25-20:01:03  12   |====            1223244  |======          9        |=               60425    |=               6823   |=====           0.28     |===========     0.42     |==========      0.69     |====            504      |========        13       |                292      |                0        |       11887    |=               26       |
01/10/25-21:00:34  8    |==              822943   |====            9        |=               58720    |=               7414   |======          0.28     |===========     0.42     |==========      0.69     |====            66       |                20       |=               185      |                0        |       16734    |=               49       |
01/10/25-22:00:18  10   |===             900329   |====            12       |==              80995    |=               5081   |====            0.31     |============    0.43     |==========      0.92     |======          244      |===             23       |=               56       |                0        |       32971    |====            77       |
01/10/25-23:00:58  13   |=====           942828   |====            20       |=====           132020   |===             5019   |====            0.32     |============    0.48     |============    1.19     |========        177      |==              28       |==              42       |                0        |       33554    |====            62       |
02/10/25-00:00:44  12   |====            838111   |====            24       |======          155405   |====            4212   |===             0.27     |==========      0.49     |============    1.09     |=======         594      |==========      41       |===             27       |                0        |       21851    |==              49       |
02/10/25-01:00:16  15   |======          901518   |====            29       |=======         186933   |=====           5379   |====            0.29     |===========     0.40     |==========      1.39     |=========       179      |==              38       |===             5        |                0        |       51586    |=======         32       |
02/10/25-02:00:50  11   |====            944402   |====            36       |=========       236988   |=======         3746   |==              0.30     |===========     0.43     |==========      1.55     |===========     221      |===             49       |====            2        |                0        |       52209    |========        15       |
02/10/25-03:00:03  8    |==              711055   |===             39       |==========      257959   |=======         3109   |==              0.28     |===========     0.38     |=========       1.22     |========        421      |======          79       |========        2        |                0        |       52123    |=======         28       |
02/10/25-04:00:37  9    |===             916353   |====            38       |==========      236880   |=======         3819   |==              0.26     |==========      0.36     |========        1.05     |=======         599      |==========      47       |====            12       |                0        |       55587    |========        14       |
02/10/25-05:00:15  7    |==              693455   |===             34       |=========       227473   |======          4657   |===             0.27     |==========      0.35     |========        1.05     |=======         58       |                39       |===             0        |                0        |       57074    |========        17       |
02/10/25-06:00:55  8    |==              900168   |====            33       |========        225167   |======          3829   |==              0.25     |=========       0.35     |========        1.30     |=========       64       |                40       |===             849      |                0        |       86917    |==============  27       |
02/10/25-07:00:35  13   |=====           975665   |=====           42       |===========     358995   |===========     4975   |====            0.30     |===========     0.43     |==========      1.42     |==========      363      |=====           71       |=======         75       |                0        |       70699    |===========     30       |
02/10/25-08:00:13  16   |======          1322715  |=======         50       |==============  434015   |==============  6024   |=====           0.31     |============    0.45     |===========     1.41     |==========      804      |==============  76       |=======         3140     |                0        |       63731    |=========       621      |========
02/10/25-09:00:32  23   |=========       1885735  |==========      44       |============    344593   |==========      9245   |========        0.00     |                0.00     |                0.00     |                347      |=====           62       |======          0        |                0        |       28363    |===             92       |



57. spm - SQL PLAN MANAGEMENT - множество возможностей для стабилизации планов выполнения запросов
spm [days def7 - baselines]   - список baselines созданные за последние "days"
spm find %|SQL_HANDLE SQL_PLAN_NAME - поиск baselines по маске или точному имени

$ tpi mprod  spm find SQL_78d5421f0ef3533c SQL_PLAN_7jpa23w7g6ntw9814871d

Current records in dba_sql_plan_baselines by last days: 10950


SQL_HANDLE \ PLAN_NAME         CREATOR    ORIGIN       PARSING_SC CREATED    LAST_MODIF LAST_EXECU ENA ACC FIX     COST MODULE             EXEC     CPU_T\EX     ELA_T\EX   BUFGETS\EX   DISKR\EX    ROWS\EX
------------------------------ ---------- ------------ ---------- ---------- ---------- ---------- --- --- --- -------- ------------ ---------- ------------ ------------ ------------ ---------- ----------
SQL_78d5421f0ef3533c           GAL_VEK#P. AUTO-CAPTURE GAL_VEK#P. 04/09/25 0 04/09/25 0            YES NO  NO      2429 atlexec.exe           0       .00000       .00000            0          0          0
SQL_PLAN_7jpa23w7g6ntw9814871d NEVOLIN                 NEVOLIN    8:01:01    8:01:01


Current records in dba_sql_plan_baselines by last days: 10950 and condition:  and sql_handle like 'SQL_78d5421f0ef3533c' and plan_name like nvl('SQL_PLAN_7jpa23w7g6ntw9814871d','%')

SQL_ID        PLAN_HASH_VA SQL_HANDLE           PLAN_NAME                      CREATED             LAST_MODIFIED       LAST_EXECUTED       ENA ACC FIX    COST      EXEC CPU_T/EX ELA_T/EX BUFGETS/EX DISKR/EX ROWS/EX
------------- ------------ -------------------- ------------------------------ ------------------- ------------------- ------------------- --- --- --- ------- --------- -------- -------- ---------- -------- -------
4s64pk52smqyx 109746087    SQL_78d5421f0ef3533c SQL_PLAN_7jpa23w7g6ntw9814871d 04/09/25 08:01:01   04/09/25 08:01:01                       YES NO  NO     2429         0        0        0          0        0       0


spm blplan %|SQL_HANDLE (PLAN_NAME) - baseline запрос, план и outline DBMS_XPLAN.DISPLAY_SQL_PLAN_BASELINE

spm blexec [count] - baselines которые выполнялись более count раз   dba_sql_plan_baselines

$ tpi mprod  spm blexec 100

Join views v$sql, dba_sql_plan_baselines where baselines.executions >= nvl('100',1) :
SQL_ID        PLAN_HASH_VALUE SQL_HANDLE           PLAN_NAME                      PARSING_SCHEMA_NAME     COST ORIGIN               ENA ACC FIX AUT CREATED    LAST_EXEC  EXECUTIONS
------------- --------------- -------------------- ------------------------------ -------------------- ------- -------------------- --- --- --- --- ---------- ---------- ----------
9a8k8rxs4h4ww      2829392755 SQL_dbd67c133267f64c SQLID_9A8K8RXS4H4WW_2829392755 GAL_VEK#A.VERBOVA     104388 MANUAL-LOAD          YES YES NO  YES 08/07/22 0 10/10/25 1       9688
                                                                                                                                                    7:33:41    2:53:30

67393xkm2ttqc      2804335021 SQL_f51042945ad33369 SQLID_67393XKM2TTQC_2804335021 GAL_VEK#SCHEDULER          1 MANUAL-LOAD          YES YES NO  YES 26/12/23 1 12/10/25 2   70848326
                                                                                                                                                    1:38:22    3:38:34

g6hmfsam8rt5r      3578776265 SQL_f36ee16f8ac4c5d8 SQLID_G6HMFSAM8RT5R_3578776265 GAL_VEK#DEKINAGV2         30 MANUAL-LOAD          YES YES NO  YES 07/05/25 1 13/10/25 0       2592
                                                                                                                                                    2:49:02    8:20:36

spm bllpfcc SQL_ID PLAN_HASH_VALUE [SQL_HANDLE]  - baseline load plan from cursor cache  DBMS_SPM.LOAD_PLANS_FROM_CURSOR_CACHE
spm bllpfawr SQL_ID PLAN_HASH_VALUE MIN_SNAP_ID MAX_SNAP_ID  - baseline load plan from awr snapshot  dbms_spm.load_plans_from_sqlset
spm blchattr SQL_HANDLE PLAN_NAME ATTR VALUE  - baseline change attribute  dbms_spm.alter_sql_plan_baseline
spm blchplan NEW_SQL_ID NEW_PHV OLD_SQLSET_NAME  - baseline change plan dbms_spm.load_plans_from_cursor_cache
spm blevolve SQL_HANDLE PLAN_NAME  - baseline evolute  DBMS_SPM.EVOLVE_SQL_PLAN_BASELINE
spm sqlset_list SQLSET_NAME OWNER - список SQLSET:  FROM TABLE( DBMS_SQLTUNE.SELECT_SQLSET( sqlset_name => ...

$ tpi mprod  spm sqlset_list
View dba_sqlset:
NAME                           OWNER                          CREATED           STATEMENT_COUNT
------------------------------ ------------------------------ ----------------- ---------------
tpi-9pq7t60tbyn4x-20-05-2022   SYS                            20/05/22 07:59:33               1


spm sqlset_plan SQLSET_NAME SQL_ID [PHV] - запрос и план SQLSET   DBMS_XPLAN.DISPLAY_SQLSET
spm sqlset_drop SQLSET_NAME - удалить SQLSET DBMS_SQLTUNE.DROP_SQLSET
spm bldrop SQL_HANDLE (PLAN_NAME)  - удалить baseline DBMS_SPM.drop_sql_plan_baseline
spm sqltune [SQL_ID | awr SQL_ID begin_snap end_snap]  - выполнить sqltune запроса из кеша или awr DBMS_SQLTUNE.create_tuning_task
spm sqltune_report TASK_NAME - получить report по sqltune TASK_NAME DBMS_SQLTUNE.REPORT_TUNING_TASK
spm sqltune_accept TASK_NAME - подтвердить профиль TASK_NAME dbms_sqltune.accept_sql_profile
spm sqltune_create_plan_bl TASK_NAME OWNER PLAN_HASH_VALUE - создать dbms_sqltune.create_sql_plan_baseline
spm sqltune_list [TASK_NAME] [cnt] - получить список из DBA_ADVISOR_TASKS 
spm sqltune_drop TASK_NAME - удалить TASK_NAME DBMS_SQLTUNE.DROP_TUNING_TASK
spm sql_profiles - список dba_sql_profiles + DBA_HIST_SQLSTAT
spm import_sql_profile SQL_ID_SRC PHV_SRC SQL_ID_TARGET - "Create SQL Profile DBMS_SQLTUNE.IMPORT_SQL_PROFILE hints  sql_id_source=$sql_id_src  plan_hash_value_source=$phv_src  sql_id_target=$sql_id_target  SQL_Profile_name=$sql_profile_name  SQL_Profile_desc=$sql_profile_desc"
spm sql_profile_chattr TASK_NAME ATTR VALUE - Изменить аттрибуты профиля DBMS_SQLTUNE.ALTER_SQL_PROFILE
spm sql_profile_drop NAME - удалить профиль DBMS_SQLTUNE.DROP_SQL_PROFILE
spm hints profile|baseline|patch NAME  - получить хинты профиля, baseline, patch
spm sqlpatch_list  - список sql патчей из DBA_SQL_PATCHES
spm sqlpatch_create SQL_ID 'HINTS"\'"' - создать sqlpatch , пример:  spm sqlpatch_create qqqqqqqqqqq  'OPTIMIZER_FEATURES_ENABLE('"\'"'11.2.0.4'"\'"') INDEX_RS_ASC(@"SEL$1" "KONTRAHENTAS_T"@"SEL$1" "IDX_FUNCT_KODAS")'
spm sqlpatch_alter PATCHNAME enable|disable - включить \ отключить sqlpatch
spm sqlpatch_drop PATCHNAME  - удалить sqlpatch
spm report_sql_monitor SQL_ID  -  report_sql_monitor по sql_id DBMS_SQLTUNE.report_sql_monitor, подробная информация по запросу


пример, без параметров, с указанием дней - baselines  в  dba_sql_plan_baselines 

$ tpi mprod  spm 90

Current records in dba_sql_plan_baselines by last days: 90


SQL_HANDLE \ PLAN_NAME         CREATOR    ORIGIN       PARSING_SC CREATED    LAST_MODIF LAST_EXECU ENA ACC FIX     COST MODULE             EXEC     CPU_T\EX     ELA_T\EX   BUFGETS\EX   DISKR\EX    ROWS\EX
------------------------------ ---------- ------------ ---------- ---------- ---------- ---------- --- --- --- -------- ------------ ---------- ------------ ------------ ------------ ---------- ----------
SQL_a4fd6d3d18103186           GAL_VEK#YU AUTO-CAPTURE GAL_VEK#YU 30/07/25 1 30/07/25 1            YES NO  NO        36 atlexec.exe           0       .00000       .00000            0          0          0
SQL_PLAN_a9zbd7nc10cc640f51a0f .BORISENKO              .BORISENKO 7:14:07    7:14:07

SQL_78d5421f0ef3533c           GAL_VEK#P. AUTO-CAPTURE GAL_VEK#P. 04/09/25 0 04/09/25 0            YES NO  NO      2429 atlexec.exe           0       .00000       .00000            0          0          0
SQL_PLAN_7jpa23w7g6ntw9814871d NEVOLIN                 NEVOLIN    8:01:01    8:01:01

SQL_78d5421f0ef3533c           GAL_VEK#VA AUTO-CAPTURE GAL_VEK#VA 04/09/25 1 04/09/25 1            YES NO  NO      2187 atlexec.exe           0       .00000       .00000            0          0          0
SQL_PLAN_7jpa23w7g6ntw5d0a52f7 L.KOROLEVA              L.KOROLEVA 5:03:58    5:03:58

SQL_78d5421f0ef3533c           GAL_VEK#NA AUTO-CAPTURE GAL_VEK#NA 05/09/25 1 05/09/25 1            YES NO  NO      6674 atlexec.exe           0       .00000       .00000            0          0          0
SQL_PLAN_7jpa23w7g6ntwc631cf21 .NIKITINA               .NIKITINA  6:13:14    6:13:14


Current records in dba_sql_plan_baselines by last days: 90 and condition:

SQL_ID        PLAN_HASH_VA SQL_HANDLE           PLAN_NAME                      CREATED             LAST_MODIFIED       LAST_EXECUTED       ENA ACC FIX    COST      EXEC CPU_T/EX ELA_T/EX BUFGETS/EX DISKR/EX ROWS/EX
------------- ------------ -------------------- ------------------------------ ------------------- ------------------- ------------------- --- --- --- ------- --------- -------- -------- ---------- -------- -------
d84v28q39nfbw 620930960    SQL_a4fd6d3d18103186 SQL_PLAN_a9zbd7nc10cc640f51a0f 30/07/25 17:14:07   30/07/25 17:14:07                       YES NO  NO       36         0        0        0          0        0       0
4s64pk52smqyx 109746087    SQL_78d5421f0ef3533c SQL_PLAN_7jpa23w7g6ntw9814871d 04/09/25 08:01:01   04/09/25 08:01:01                       YES NO  NO     2429         0        0        0          0        0       0
4s64pk52smqyx 1813770987   SQL_78d5421f0ef3533c SQL_PLAN_7jpa23w7g6ntw5d0a52f7 04/09/25 15:03:58   04/09/25 15:03:58                       YES NO  NO     2187         0        0        0          0        0       0
4s64pk52smqyx 328388721    SQL_78d5421f0ef3533c SQL_PLAN_7jpa23w7g6ntwc631cf21 05/09/25 16:13:14   05/09/25 16:13:14                       YES NO  NO     6674         0        0        0          0        0       0



В случае досутпа по TNS, необходим служебный пользователь, например "oratpiuser" для досутпа к БД со следующими привилегиями:
(именно эта учтека прописывается в строку подключения к БД в конфиге .tpi_login)

create user oratpiuser identified by oratpiuser#123456;
grant connect,resource, dba to oratpiuser;
grant select_catalog_role, select any dictionary to oratpiuser;
grant sysdba to oratpiuser;
grant sysbackup to oratpiuser;
grant execute on dbms_crypto to oratpiuser;
grant execute on dbms_sqldiag_internal to oratpiuser;
grant execute on dbms_ijob to oratpiuser;
grant execute on dbms_sql2 to oratpiuser;
grant delete on SYS.PENDING_TRANS$ to oratpiuser;
grant delete on SYS.PENDING_SESSIONS$ to oratpiuser;
grant delete on SYS.PENDING_SUB_SESSIONS$ to oratpiuser;
grant insert on SYS.PENDING_TRANS$ to oratpiuser;
grant insert on SYS.PENDING_SESSIONS$ to oratpiuser;
grant insert on SYS.PENDING_SUB_SESSIONS$ to oratpiuser;
grant execute on DBMS_TRANSACTION to oratpiuser;
create or replace view sys.tal_links as select * from sys.link$;
create or replace synonym oratpiuser.link$ for sys.tal_links;
create or replace view sys.tal_V_$DB_PIPES as select * from sys.V_$DB_PIPES;
create or replace synonym oratpiuser.V_$DB_PIPES for sys.tal_V_$DB_PIPES;
create or replace view sys.tal_x$kccagf as select * from sys.x$kccagf;
create or replace synonym oratpiuser.x$kccagf for sys.tal_x$kccagf;
create or replace view sys.tal_user$ as select * from sys.user$;
create or replace synonym oratpiuser.user$ for sys.tal_user$;
create or replace view sys.tal_audit$ as select * from sys.audit$;
create or replace synonym oratpiuser.audit$ for sys.tal_audit$;
create or replace view sys.tal_link$ as select * from sys.link$;
create or replace synonym oratpiuser.link$ for sys.tal_link$;
create or replace view sys.tal_x$kglpn as select * from sys.x$kglpn;
create or replace synonym oratpiuser.x$kglpn for sys.tal_x$kglpn;
create or replace view sys.tal_x$kglob as select * from sys.x$kglob;
create or replace synonym oratpiuser.x$kglob for sys.tal_x$kglob;
create or replace view sys.tal_x$bh as select * from sys.x$bh;
create or replace synonym oratpiuser.x$bh for sys.tal_x$bh;
create or replace view sys.tal_x$ksuprlat as select * from sys.x$ksuprlat;
create or replace synonym oratpiuser.x$ksuprlat for sys.tal_x$ksuprlat;
create or replace view sys.tal_x$ksuse as select * from sys.x$ksuse;
create or replace synonym oratpiuser.x$ksuse for sys.tal_x$ksuse;
create or replace view sys.tal_x$ksllw as select * from sys.x$ksllw;
create or replace synonym oratpiuser.x$ksllw for sys.tal_x$ksllw;
create or replace view sys.tal_x$ksppsv as select * from sys.x$ksppsv;
create or replace synonym oratpiuser.x$ksppsv for sys.tal_x$ksppsv;
create or replace view sys.tal_x$ksppi as select * from sys.x$ksppi;
create or replace synonym oratpiuser.x$ksppi for sys.tal_x$ksppi;
create or replace view sys.tal_x$ksppcv as select * from sys.x$ksppcv;
create or replace synonym oratpiuser.x$ksppcv for sys.tal_x$ksppcv;
create or replace view sys.tal_x$ktuxe as select * from sys.x$ktuxe;
create or replace synonym oratpiuser.x$ktuxe for sys.tal_x$ktuxe;
create or replace view sys.tal_WRM$_SNAPSHOT_DETAILS as select * from sys.WRM$_SNAPSHOT_DETAILS;
create or replace synonym oratpiuser.WRM$_SNAPSHOT_DETAILS for sys.tal_WRM$_SNAPSHOT_DETAILS;



Эта документация представляет наш инструмент как законченный продукт, с которым можно сразу начать работать. 

Для коммерческого использования, если нужна поддержка, пишите на email: mutate@mail.ru
Talgat Mukhametshin
